function _ccTexParams(e,t,n,r){this.minFilter=e,this.magFilter=t,this.wrapS=n,this.wrapT=r}define("domReady",[],function(){function u(e){var t;for(t=0;t<e.length;t+=1)e[t](s)}function a(){var e=o;i&&e.length&&(o=[],u(e))}function f(){i||(i=!0,n&&clearInterval(n),a())}function c(e){return i?e(s):o.push(e),c}var e,t,n,r=typeof window!="undefined"&&window.document,i=!r,s=r?document:null,o=[];if(r){if(document.addEventListener)document.addEventListener("DOMContentLoaded",f,!1),window.addEventListener("load",f,!1);else if(window.attachEvent){window.attachEvent("onload",f),t=document.createElement("div");try{e=window.frameElement===null}catch(l){}t.doScroll&&e&&window.external&&(n=setInterval(function(){try{t.doScroll(),f()}catch(e){}},30))}document.readyState==="complete"&&f()}return c.version="2.0.1",c.load=function(e,t,n,r){r.isBuild?n(null):c(n)},c});var cc=cc=cc||{};(function(){var e=!1,t=/\b_super\b/;cc.Class=function(){},cc.Class.extend=function(n){function o(){!e&&this.ctor&&this.ctor.apply(this,arguments)}var r=this.prototype;e=!0;var i=new this;e=!1;for(var s in n)i[s]=typeof n[s]=="function"&&typeof r[s]=="function"&&t.test(n[s])?function(e,t){return function(){var n=this._super;this._super=r[e];var i=t.apply(this,arguments);return this._super=n,i}}(s,n[s]):n[s];return o.prototype=i,o.prototype.constructor=o,o.extend=arguments.callee,o.implement=function(e){for(var t in e)i[t]=e[t]},o}})(),cc.clone=function(e){var t=e instanceof Array?[]:{};for(var n in e){var r=e[n];r instanceof Array?t[n]=cc.clone(r):typeof r!="object"||r instanceof cc.Node||r instanceof HTMLElement?t[n]=r:t[n]=cc.clone(r)}return t},cc.Log=function(e){console.log(e)},cc.MessageBox=function(e){console.log(e)},cc.COCOS2D_DEBUG==0?(cc.Log=function(){},cc.LogINFO=function(){},cc.LogERROR=function(){}):cc.COCOS2D_DEBUG==1?(cc.LogINFO=cc.Log,cc.LogERROR=function(){}):cc.COCOS2D_DEBUG>1&&(cc.LogINFO=cc.Log,cc.LogERROR=cc.Log),cc._DEBUG?cc.Assert=function(e,t){typeof console.assert=="function"?console.assert(e,t):e||t&&alert(t)}:cc.Assert=function(){},cc.LANGUAGE_ENGLISH=0,cc.LANGUAGE_CHINESE=1,cc.LANGUAGE_FRENCH=2,cc.LANGUAGE_ITALIAN=3,cc.LANGUAGE_GERMAN=4,cc.LANGUAGE_SPANISH=5,cc.LANGUAGE_RUSSIAN=6,cc.timeval=cc.Class.extend({tv_sec:0,tv_usec:0}),cc.Time={},cc.Time.gettimeofdayCocos2d=function(){var e=new cc.timeval,t=Date.now();return e.tv_usec=t%1e3*1e3,e.tv_sec=Math.floor(t/1e3),e},cc.Time.now=function(){return Date.now()},cc.Time.timersubCocos2d=function(e,t){if(!n||!e||!t)return-1;if(e instanceof cc.timeval&&t instanceof cc.timeval){var n=new cc.timeval;return n.tv_sec=t.tv_sec-e.tv_sec,n.tv_usec=t.tv_usec-e.tv_usec,t.tv_usec<e.tv_usec&&(n.tv_usec+=1e6,n.tv_sec--),n}if(!isNaN(e)&&!isNaN(t))return t-e},cc.Codec={name:"Jacob__Codec"},cc.unzip=function(){return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,arguments)},cc.unzipBase64=function(){var e=cc.Codec.Base64.decode.apply(cc.Codec.Base64,arguments);return cc.Codec.GZip.gunzip.apply(cc.Codec.GZip,[e])},cc.unzipBase64AsArray=function(e,t){t=t||1;var n=this.unzipBase64(e),r=[],i,s,o;for(i=0,o=n.length/t;i<o;i++){r[i]=0;for(s=t-1;s>=0;--s)r[i]+=n.charCodeAt(i*t+s)<<s*8}return r},cc.unzipAsArray=function(e,t){t=t||1;var n=this.unzip(e),r=[],i,s,o;for(i=0,o=n.length/t;i<o;i++){r[i]=0;for(s=t-1;s>=0;--s)r[i]+=n.charCodeAt(i*t+s)<<s*8}return r},cc.Codec.Base64={name:"Jacob__Codec__Base64"},cc.Codec.Base64._keyStr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",cc.Codec.Base64.decode=function(t){var n=[],r,i,s,o,u,a,f,l=0;t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");while(l<t.length)o=this._keyStr.indexOf(t.charAt(l++)),u=this._keyStr.indexOf(t.charAt(l++)),a=this._keyStr.indexOf(t.charAt(l++)),f=this._keyStr.indexOf(t.charAt(l++)),r=o<<2|u>>4,i=(u&15)<<4|a>>2,s=(a&3)<<6|f,n.push(String.fromCharCode(r)),a!=64&&n.push(String.fromCharCode(i)),f!=64&&n.push(String.fromCharCode(s));return n=n.join(""),n},cc.Codec.Base64.decodeAsArray=function(t,n){var r=this.decode(t),i=[],s,o,u;for(s=0,u=r.length/n;s<u;s++){i[s]=0;for(o=n-1;o>=0;--o)i[s]+=r.charCodeAt(s*n+o)<<o*8}return i},cc.Codec.GZip=function(t){this.data=t,this.debug=!1,this.gpflags=undefined,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=undefined,this.literalTree=new Array(cc.Codec.GZip.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=undefined,this.fmax=undefined},cc.Codec.GZip.gunzip=function(e){e.constructor!==Array&&e.constructor===String;var t=new cc.Codec.GZip(e);return t.gunzip()[0][0]},cc.Codec.GZip.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},cc.Codec.GZip.LITERALS=288,cc.Codec.GZip.NAMEMAX=256,cc.Codec.GZip.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],cc.Codec.GZip.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cc.Codec.GZip.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],cc.Codec.GZip.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],cc.Codec.GZip.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],cc.Codec.GZip.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],cc.Codec.GZip.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},cc.Codec.GZip.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},cc.Codec.GZip.prototype.byteAlign=function(){this.bb=1},cc.Codec.GZip.prototype.readBit=function(){var e;return this.bits++,e=this.bb&1,this.bb>>=1,this.bb==0&&(this.bb=this.readByte(),e=this.bb&1,this.bb=this.bb>>1|128),e},cc.Codec.GZip.prototype.readBits=function(e){var t=0,n=e;while(n--)t=t<<1|this.readBit();return e&&(t=cc.Codec.GZip.bitReverse[t]>>8-e),t},cc.Codec.GZip.prototype.flushBuffer=function(){this.bIdx=0},cc.Codec.GZip.prototype.addBuffer=function(e){this.buf32k[this.bIdx++]=e,this.outputArr.push(String.fromCharCode(e)),this.bIdx==32768&&(this.bIdx=0)},cc.Codec.GZip.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]==this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},cc.Codec.GZip.prototype.Rec=function(){var e=this.Places[this.treepos],t;if(this.len==17)return-1;this.treepos++,this.len++,t=this.IsPat();if(t>=0)e.b0=t;else{e.b0=32768;if(this.Rec())return-1}t=this.IsPat();if(t>=0)e.b1=t,e.jump=null;else{e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos;if(this.Rec())return-1}return this.len--,0},cc.Codec.GZip.prototype.CreateTree=function(e,t,n,r){var i;this.Places=e,this.treepos=0,this.flens=n,this.fmax=t;for(i=0;i<17;i++)this.fpos[i]=0;return this.len=0,this.Rec()?-1:0},cc.Codec.GZip.prototype.DecodeValue=function(e){var t,n,r=0,i=e[r],s;for(;;){s=this.readBit();if(s){if(!(i.b1&32768))return i.b1;i=i.jump,t=e.length;for(n=0;n<t;n++)if(e[n]===i){r=n;break}}else{if(!(i.b0&32768))return i.b0;r++,i=e[r]}}return-1},cc.Codec.GZip.prototype.DeflateLoop=function(){var e,t,n,r,i;do{e=this.readBit(),n=this.readBits(2);if(n==0){var s,o;this.byteAlign(),s=this.readByte(),s|=this.readByte()<<8,o=this.readByte(),o|=this.readByte()<<8,(s^~o)&65535&&document.write("BlockLen checksum mismatch\n");while(s--)t=this.readByte(),this.addBuffer(t)}else if(n==1){var u;for(;;){u=cc.Codec.GZip.bitReverse[this.readBits(7)]>>1,u>23?(u=u<<1|this.readBit(),u>199?(u-=128,u=u<<1|this.readBit()):(u-=48,u>143&&(u+=136))):u+=256;if(u<256)this.addBuffer(u);else{if(u==256)break;var i,a;u-=257,i=this.readBits(cc.Codec.GZip.cplext[u])+cc.Codec.GZip.cplens[u],u=cc.Codec.GZip.bitReverse[this.readBits(5)]>>3,cc.Codec.GZip.cpdext[u]>8?(a=this.readBits(8),a|=this.readBits(cc.Codec.GZip.cpdext[u]-8)<<8):a=this.readBits(cc.Codec.GZip.cpdext[u]),a+=cc.Codec.GZip.cpdist[u];for(u=0;u<i;u++){var t=this.buf32k[this.bIdx-a&32767];this.addBuffer(t)}}}}else if(n==2){var u,f,l,c,h,p=new Array(320);l=257+this.readBits(5),c=1+this.readBits(5),h=4+this.readBits(4);for(u=0;u<19;u++)p[u]=0;for(u=0;u<h;u++)p[cc.Codec.GZip.border[u]]=this.readBits(3);i=this.distanceTree.length;for(r=0;r<i;r++)this.distanceTree[r]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.distanceTree,19,p,0))return this.flushBuffer(),1;f=l+c,r=0;var d=-1;while(r<f){d++,u=this.DecodeValue(this.distanceTree);if(u<16)p[r++]=u;else if(u==16){var v;u=3+this.readBits(2);if(r+u>f)return this.flushBuffer(),1;v=r?p[r-1]:0;while(u--)p[r++]=v}else{u==17?u=3+this.readBits(3):u=11+this.readBits(7);if(r+u>f)return this.flushBuffer(),1;while(u--)p[r++]=0}}i=this.literalTree.length;for(r=0;r<i;r++)this.literalTree[r]=new cc.Codec.GZip.HufNode;if(this.CreateTree(this.literalTree,l,p,0))return this.flushBuffer(),1;i=this.literalTree.length;for(r=0;r<i;r++)this.distanceTree[r]=new cc.Codec.GZip.HufNode;var m=new Array;for(r=l;r<p.length;r++)m[r-l]=p[r];if(this.CreateTree(this.distanceTree,c,m,0))return this.flushBuffer(),1;for(;;){u=this.DecodeValue(this.literalTree);if(u>=256){var i,a;u-=256;if(u==0)break;u--,i=this.readBits(cc.Codec.GZip.cplext[u])+cc.Codec.GZip.cplens[u],u=this.DecodeValue(this.distanceTree),cc.Codec.GZip.cpdext[u]>8?(a=this.readBits(8),a|=this.readBits(cc.Codec.GZip.cpdext[u]-8)<<8):a=this.readBits(cc.Codec.GZip.cpdext[u]),a+=cc.Codec.GZip.cpdist[u];while(i--){var t=this.buf32k[this.bIdx-a&32767];this.addBuffer(t)}}else this.addBuffer(u)}}}while(!e);return this.flushBuffer(),this.byteAlign(),0},cc.Codec.GZip.prototype.unzipFile=function(e){var t;this.gunzip();for(t=0;t<this.unzipped.length;t++)if(this.unzipped[t][1]==e)return this.unzipped[t][0]},cc.Codec.GZip.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var e=[];e[0]=this.readByte(),e[1]=this.readByte(),e[0]==120&&e[1]==218&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),e[0]==31&&e[1]==139&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++);if(e[0]==80&&e[1]==75){this.modeZIP=!0,e[2]=this.readByte(),e[3]=this.readByte();if(e[2]==3&&e[3]==4){e[0]=this.readByte(),e[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var t=this.readByte();t|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte();var n=this.readByte();n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24;var r=this.readByte();r|=this.readByte()<<8,r|=this.readByte()<<16,r|=this.readByte()<<24;var i=this.readByte();i|=this.readByte()<<8;var s=this.readByte();s|=this.readByte()<<8,u=0,this.nameBuf=[];while(i--){var o=this.readByte();o=="/"|o==":"?u=0:u<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[u++]=String.fromCharCode(o))}this.fileout||(this.fileout=this.nameBuf);var u=0;while(u<s)o=this.readByte(),u++;t==8&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}}},cc.Codec.GZip.prototype.skipdir=function(){var e=[],t,n,r,i,s;this.gpflags&8&&(e[0]=this.readByte(),e[1]=this.readByte(),e[2]=this.readByte(),e[3]=this.readByte(),t=this.readByte(),t|=this.readByte()<<8,t|=this.readByte()<<16,t|=this.readByte()<<24,n=this.readByte(),n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24),this.modeZIP&&this.nextFile(),e[0]=this.readByte();if(e[0]!=8)return 0;this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),r=this.readByte();if(this.gpflags&4){e[0]=this.readByte(),e[2]=this.readByte(),this.len=e[0]+256*e[1];for(i=0;i<this.len;i++)this.readByte()}if(this.gpflags&8){i=0,this.nameBuf=[];while(s=this.readByte()){if(s=="7"||s==":")i=0;i<cc.Codec.GZip.NAMEMAX-1&&(this.nameBuf[i++]=s)}}if(this.gpflags&16)while(s=this.readByte());this.gpflags&2&&(this.readByte(),this.readByte()),this.DeflateLoop(),n=this.readByte(),n|=this.readByte()<<8,n|=this.readByte()<<16,n|=this.readByte()<<24,this.modeZIP&&this.nextFile()},cc.PI=Math.PI,cc.RAD=cc.PI/180,cc.DEG=180/cc.PI,cc.SWAP=function(e,t,n){if(typeof n=="object"&&typeof n.x!="undefined"&&typeof n.y!="undefined"){var r=n[e];n[e]=n[t],n[t]=r}else cc.Assert(!1,"CC_SWAP is being modified from original macro, please check usage")},cc.RANDOM_MINUS1_1=function(){return(Math.random()-.5)*2},cc.RANDOM_0_1=function(){return Math.random()},cc.DEGREES_TO_RADIANS=function(e){return e*cc.RAD},cc.RADIANS_TO_DEGREES=function(e){return e*cc.DEG},cc.BLEND_SRC=cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA?1:770,cc.BLEND_DST=771,cc.ENABLE_DEFAULT_GL_STATES=function(){},cc.DISABLE_DEFAULT_GL_STATES=function(){},cc.FLT_EPSILON=1.192092896e-7,cc.CONTENT_SCALE_FACTOR=cc.IS_RETINA_DISPLAY_SUPPORTED?function(){return cc.Director.sharedDirector().getContentScaleFactor()}:function(){return 1},cc.RECT_PIXELS_TO_POINTS=cc.IS_RETINA_DISPLAY_SUPPORTED?function(e){return cc.RectMake(e.origin.x/cc.CONTENT_SCALE_FACTOR(),e.origin.y/cc.CONTENT_SCALE_FACTOR(),e.size.width/cc.CONTENT_SCALE_FACTOR(),e.size.height/cc.CONTENT_SCALE_FACTOR())}:function(e){return e},cc.RECT_POINTS_TO_PIXELS=cc.IS_RETINA_DISPLAY_SUPPORTED?function(e){return cc.RectMake(e.origin.x*cc.CONTENT_SCALE_FACTOR(),e.origin.y*cc.CONTENT_SCALE_FACTOR(),e.size.width*cc.CONTENT_SCALE_FACTOR(),e.size.height*cc.CONTENT_SCALE_FACTOR())}:function(e){return e},cc.ENGINE_VERSION="Cocos2d-html5-v0.5.0-alpha2",cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL=0,cc.FONT_LABEL_SUPPORT=1,cc.DIRECTOR_FAST_FPS=1,cc.DIRECTOR_FPS_INTERVAL=.5,cc.DIRECTOR_DISPATCH_FAST_EVENTS=0,cc.DIRECTOR_MAC_USE_DISPLAY_LINK_THREAD=1,cc.COCOSNODE_RENDER_SUBPIXEL=1,cc.SPRITEBATCHNODE_RENDER_SUBPIXEL=1,cc.USES_VBO=1,cc.NODE_TRANSFORM_USING_AFFINE_MATRIX=1,cc.OPTIMIZE_BLEND_FUNC_FOR_PREMULTIPLIED_ALPHA=1,cc.TEXTURE_ATLAS_USE_TRIANGLE_STRIP=0,cc.TEXTURE_NPOT_SUPPORT=0,cc.RETINA_DISPLAY_SUPPORT=1,cc.RETINA_DISPLAY_FILENAME_SUFFIX="-hd",cc.USE_LA88_LABELS_ON_NEON_ARCH=0,cc.SPRITE_DEBUG_DRAW=0,cc.SPRITEBATCHNODE_DEBUG_DRAW=0,cc.LABELBMFONT_DEBUG_DRAW=0,cc.LABELATLAS_DEBUG_DRAW=0,cc.ENABLE_PROFILERS=0,cc.IS_RETINA_DISPLAY_SUPPORTED=1,cc.DEFAULT_ENGINE=cc.ENGINE_VERSION+"-canvas",cc.SAX_NONE=0,cc.SAX_KEY=1,cc.SAX_DICT=2,cc.SAX_INT=3,cc.SAX_REAL=4,cc.SAX_STRING=5,cc.SAX_ARRAY=6,cc.FileUtils={},cc.FileUtils.getFileData=function(e,t,n){},cc.FileUtils.getFileDataFromZip=function(e,t,n){},cc.FileUtils.ccRemoveHDSuffixFromFile=function(e){},cc.popupNotify=!0,cc.FileUtils.fullPathFromRelativePath=function(e){return e},cc.FileUtils.fullPathFromRelativeFile=function(e,t){var n;return e?(n=t.substring(0,t.lastIndexOf("/")+1),n+e):(n=t.substring(0,t.lastIndexOf(".")),n+=".png",n)},cc.FileUtils.setResourcePath=function(e){},cc.FileUtils.dictionaryWithContentsOfFile=function(e){var t=cc.SAXParser.shareParser();return this.rootDict=t.parse(e),this.rootDict},cc.FileUtils.dictionaryWithContentsOfFileThreadSafe=function(e){var t=new cc.DictMaker;return t.dictionaryWithContentsOfFile(e)},cc.FileUtils.getWriteablePath=function(){},cc.FileUtils.setIsPopupNotify=function(e){cc.popupNotify=e},cc.FileUtils.getIsPopupNotify=function(){return cc.popupNotify},cc.DictMaker=cc.Class.extend({rootDict:[],dictionaryWithContentsOfFile:function(e){var t=cc.SAXParser.shareParser();return this.rootDict=t.parse(e),this.rootDict}}),cc.Color3B=function(e,t,n){switch(arguments.length){case 0:this.r=0,this.g=0,this.b=0;case 1:e&&e instanceof cc.Color3B?(this.r=e.r||0,this.g=e.g||0,this.b=e.b||0):(this.r=0,this.g=0,this.b=0);break;case 3:this.r=e||0,this.g=t||0,this.b=n||0;break;default:throw"unknown argument type"}},cc.ccc3=function(e,t,n){return new cc.Color3B(e,t,n)},cc.WHITE=function(){return new cc.Color3B(255,255,255)},cc.YELLOW=function(){return new cc.Color3B(255,255,0)},cc.BLUE=function(){return new cc.Color3B(0,0,255)},cc.GREEN=function(){return new cc.Color3B(0,255,0)},cc.RED=function(){return new cc.Color3B(255,0,0)},cc.MAGENTA=function(){return new cc.Color3B(255,0,255)},cc.BLACK=function(){return new cc.Color3B(0,0,0)},cc.ORANGE=function(){return new cc.Color3B(255,127,0)},cc.GRAY=function(){return new cc.Color3B(166,166,166)},cc.Color4B=function(e,t,n,r){this.r=e,this.g=t,this.b=n,this.a=r},cc.ccc4=function(e,t,n,r){return new cc.Color4B(e,t,n,r)},cc.Color4F=function(e,t,n,r){this.r=e,this.g=t,this.b=n,this.a=r},cc.c4FFromccc3B=function(e){return new cc.Color4F(e.r/255,e.g/255,e.b/255,1)},cc.c4FFromccc4B=function(e){return new cc.Color4F(e.r/255,e.g/255,e.b/255,e.a/255)},cc.c4FEqual=function(e,t){return e.r==t.r&&e.g==t.g&&e.b==t.b&&e.a==t.a},cc.Vertex2F=function(e,t){this.x=e||0,this.y=t||0},cc.Vertex2=function(e,t){return new cc.Vertex2F(e,t)},cc.Vertex3F=function(e,t,n){this.x=e||0,this.y=t||0,this.Z=n||0},cc.vertex3=function(e,t,n){return new cc.Vertex3F(e,t,n)},cc.Tex2F=function(e,t){this.u=e||0,this.v=t||0},cc.tex2=function(e,t){return new cc.Tex2F(e,t)},cc.PointSprite=function(e,t,n){this.pos=e||new cc.Vertex2F(0,0),this.color=t||new cc.Color4B(0,0,0,0),this.size=n||0},cc.Quad2=function(e,t,n,r){this.tl=e||new cc.Vertex2F(0,0),this.tr=t||new cc.Vertex2F(0,0),this.bl=n||new cc.Vertex2F(0,0),this.br=r||new cc.Vertex2F(0,0)},cc.Quad3=function(e,t,n,r){this.bl=e||new cc.Vertex3F(0,0,0),this.br=t||new cc.Vertex3F(0,0,0),this.tl=n||new cc.Vertex3F(0,0,0),this.tr=r||new cc.Vertex3F(0,0,0)},cc.GridSize=function(e,t){this.x=e,this.y=t},cc.ccg=function(e,t){return new cc.GridSize(e,t)},cc.V2F_C4B_T2F=function(e,t,n){this.vertices=e||new cc.Vertex2F(0,0),this.colors=t||new cc.Color4B(0,0,0,0),this.texCoords=n||new cc.Tex2F(0,0)},cc.V2F_C4F_T2F=function(e,t,n){this.vertices=e||new cc.Vertex2F(0,0),this.colors=t||new cc.Color4F(0,0,0,0),this.texCoords=n||new cc.Tex2F(0,0)},cc.V3F_C4B_T2F=function(e,t,n){this.vertices=e||new cc.Vertex3F(0,0,0),this.colors=t||new cc.Color4B(0,0,0,0),this.texCoords=n||new cc.Tex2F(0,0)},cc.V2F_C4B_T2F_Quad=function(e,t,n,r){this.bl=e||new cc.V2F_C4B_T2F,this.br=t||new cc.V2F_C4B_T2F,this.tl=n||new cc.V2F_C4B_T2F,this.tr=r||new cc.V2F_C4B_T2F},cc.V2F_C4B_T2F_QuadZero=function(){return new cc.V2F_C4B_T2F_Quad(new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V2F_C4B_T2F(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)))},cc.V3F_C4B_T2F_Quad=function(e,t,n,r){this.tl=e||new cc.V3F_C4B_T2F,this.bl=t||new cc.V3F_C4B_T2F,this.tr=n||new cc.V3F_C4B_T2F,this.br=r||new cc.V3F_C4B_T2F},cc.V3F_C4B_T2F_QuadZero=function(){return new cc.V3F_C4B_T2F_Quad(new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)),new cc.V3F_C4B_T2F(new cc.Vertex3F(0,0,0),new cc.Color4B(0,0,0,255),new cc.Tex2F(0,0)))},cc.V2F_C4F_T2F_Quad=function(e,t,n,r){this.bl=e||new cc.V2F_C4F_T2F,this.br=t||new cc.V2F_C4F_T2F,this.tl=n||new cc.V2F_C4F_T2F,this.tr=r||new cc.V2F_C4F_T2F},cc.BlendFunc=function(e,t){this.src=e,this.dst=t},cc.TEXT_ALIGNMENT_LEFT=0,cc.TEXT_ALIGNMENT_CENTER=1,cc.TEXT_ALIGNMENT_RIGHT=2,cc.Point=function(e,t){this.x=e||0,this.y=t||0},cc.Point.CCPointEqualToPoint=function(e,t){return e.x==t.x&&e.y==t.y},cc.Size=function(e,t){this.width=e||0,this.height=t||0},cc.Size.CCSizeEqualToSize=function(e,t){return e.width==t.width&&e.height==t.height},cc.Rect=function(e,t,n,r){switch(arguments.length){case 0:this.origin=new cc.Point(0,0),this.size=new cc.Size(0,0);break;case 1:var i=e;if(!i)this.origin=new cc.Point(0,0),this.size=new cc.Size(0,0);else{if(!(i instanceof cc.Rect))throw"unknown argument type";this.origin=new cc.Point(i.origin.x,i.origin.y),this.size=new cc.Size(i.size.width,i.size.height)}break;case 2:this.origin=e?new cc.Point(e.x,e.y):new cc.Point(0,0),this.size=t?new cc.Size(t.width,t.height):new cc.Size(0,0);break;case 4:this.origin=new cc.Point(e||0,t||0),this.size=new cc.Size(n||0,r||0);break;default:throw"unknown argument type"}},cc.Rect.CCRectEqualToRect=function(e,t){return cc.Point.CCPointEqualToPoint(e.origin,t.origin)&&cc.Size.CCSizeEqualToSize(e.size,t.size)},cc.Rect.CCRectGetMaxX=function(e){return e.origin.x+e.size.width},cc.Rect.CCRectGetMidX=function(e){return(e.origin.x+e.size.width)/2},cc.Rect.CCRectGetMinX=function(e){return e.origin.x},cc.Rect.CCRectGetMaxY=function(e){return e.origin.y+e.size.height},cc.Rect.CCRectGetMidY=function(e){return e.origin.y+e.size.height/2},cc.Rect.CCRectGetMinY=function(e){return e.origin.y},cc.Rect.CCRectContainsPoint=function(e,t){var n=!1;return t.x>=cc.Rect.CCRectGetMinX(e)&&t.x<=cc.Rect.CCRectGetMaxX(e)&&t.y>=cc.Rect.CCRectGetMinY(e)&&t.y<=cc.Rect.CCRectGetMaxY(e)&&(n=!0),n},cc.Rect.CCRectIntersectsRect=function(e,t){return!(cc.Rect.CCRectGetMaxX(e)<cc.Rect.CCRectGetMinX(t)||cc.Rect.CCRectGetMaxX(t)<cc.Rect.CCRectGetMinX(e)||cc.Rect.CCRectGetMaxY(e)<cc.Rect.CCRectGetMinY(t)||cc.Rect.CCRectGetMaxY(t)<cc.Rect.CCRectGetMinY(e))},cc.Rect.CCRectOverlapsRect=function(e,t){return e.origin.x+e.size.width<t.origin.x?!1:t.origin.x+t.size.width<e.origin.x?!1:e.origin.y+e.size.height<t.origin.y?!1:t.origin.y+t.size.height<e.origin.y?!1:!0},cc.Rect.CCRectUnion=function(e,t){var n=new cc.Rect(0,0,0,0);return n.origin.x=Math.min(e.origin.x,t.origin.x),n.origin.y=Math.min(e.origin.y,t.origin.y),n.size.width=Math.max(e.origin.x+e.size.width,t.origin.x+t.size.width)-n.origin.x,n.size.height=Math.max(e.origin.y+e.size.height,t.origin.y+t.size.height)-n.origin.y,n},cc.Rect.CCRectIntersection=function(e,t){var n=new cc.Rect(Math.max(cc.Rect.CCRectGetMinX(e),cc.Rect.CCRectGetMinX(t)),Math.max(cc.Rect.CCRectGetMinY(e),cc.Rect.CCRectGetMinY(t)),0,0);return n.size.width=Math.min(cc.Rect.CCRectGetMaxX(e),cc.Rect.CCRectGetMaxX(t))-cc.Rect.CCRectGetMinX(n),n.size.height=Math.min(cc.Rect.CCRectGetMaxY(e),cc.Rect.CCRectGetMaxY(t))-cc.Rect.CCRectGetMinY(n),n},cc.PointMake=function(e,t){return new cc.Point(e,t)},cc.SizeMake=function(e,t){return new cc.Size(e,t)},cc.RectMake=function(e,t,n,r){return new cc.Rect(e,t,n,r)},cc.PointZero=function(){return new cc.Point(0,0)},cc.SizeZero=function(){return new cc.Size(0,0)},cc.RectZero=function(){return new cc.Rect(0,0,0,0)},cc.Set=cc.Class.extend({ctor:function(e){e?this._set=Object.create(e._set):this._set=new Array},copy:function(){return new this.Set(this)},mutableCopy:function(){return this.copy()},count:function(){return this._set.length},addObject:function(e){this._set.push(e)},removeObject:function(e){var t=0;for(var n=0,r=0;n<this._set.length;n++)this._set[n]!=e&&(this._set[r++]=this._set[n],t++);array.length=t},containsObject:function(e){return e in this._set==1?!0:!1},anyObject:function(){return this._set.length>0?this._set[0]:null},_set:null}),cc.NSMutableSet=cc.Set,cc.splitWithForm=function(e,t){var n=!1;do{if(!e)break;var r=e;if(r.length==0)break;var i=r.indexOf("{"),s=r.indexOf("}");if(i==-1||s==-1)break;if(i>s)break;var o=r.substr(i+1,s-i-1);if(o.length==0)break;var u=o.indexOf("{"),a=o.indexOf("}");if(u!=-1||a!=-1)break;t=o.split(",");if(t.length!=2||t[0]!=null||t[1]!=null)break}while(0);return t},cc.RectFromString=function(e){var t=cc.RectZero();do{if(!e)break;var e=e,n=e.indexOf("{")+1,r=e.lastIndexOf("}",e.length);if(n==-1||r==-1)break;e=e.substring(n,r);var i=e.indexOf("}");if(i==-1)break;i=e.indexOf(",",i);if(i==-1)break;var s=e.substr(0,i),o=e.substr(i+1,e.length-i),u=cc.splitWithForm(s.toString()),a=cc.splitWithForm(o.toString()),f=parseFloat(u[0]),l=parseFloat(u[1]),c=parseFloat(a[0]),h=parseFloat(a[1]);t=cc.RectMake(f,l,c,h)}while(0);return t},cc.PointFromString=function(e){var t=cc.PointZero();try{if(e=="")return t;var n=cc.splitWithForm(e),r=parseFloat(n[0]),i=parseFloat(n[1]);t=cc.PointMake(r,i)}catch(s){}return t},cc.SizeFromString=function(e){var t=cc.SizeZero();try{if(e=="")return t;var n=cc.splitWithForm(e),r=parseFloat(n[0]),i=parseFloat(n[1]);t=cc.SizeMake(r,i)}catch(s){}return t},cc.AffineTransform=function(e,t,n,r,i,s){this.a=e,this.b=t,this.c=n,this.d=r,this.tx=i,this.ty=s},cc.__AffineTransformMake=function(e,t,n,r,i,s){return new cc.AffineTransform(e,t,n,r,i,s)},cc.AffineTransformMake=function(e,t,n,r,i,s){return new cc.AffineTransform(e,t,n,r,i,s)},cc.__PointApplyAffineTransform=function(e,t){var n=new cc.Point;return n.x=t.a*e.x+t.c*e.y+t.tx,n.y=t.b*e.x+t.d*e.y+t.ty,n},cc.PointApplyAffineTransform=function(e,t){return cc.__PointApplyAffineTransform(e,t)},cc.__SizeApplyAffineTransform=function(e,t){var n=new cc.Size;return n.width=t.a*e.width+t.c*e.height,n.height=t.b*e.width+t.d*e.height,n},cc.SizeApplyAffineTransform=function(e,t){return cc.__SizeApplyAffineTransform(e,t)},cc.AffineTransformMakeIdentity=function(){return cc.__AffineTransformMake(1,0,0,1,0,0)},cc.AffineTransformIdentity=function(){return cc.AffineTransformMakeIdentity()},cc.RectApplyAffineTransform=function(e,t){var n=cc.Rect.CCRectGetMinY(e),r=cc.Rect.CCRectGetMinX(e),i=cc.Rect.CCRectGetMaxX(e),s=cc.Rect.CCRectGetMaxY(e),o=cc.PointApplyAffineTransform(cc.PointMake(r,n),t),u=cc.PointApplyAffineTransform(cc.PointMake(i,n),t),a=cc.PointApplyAffineTransform(cc.PointMake(r,s),t),f=cc.PointApplyAffineTransform(cc.PointMake(i,s),t),l=Math.min(Math.min(o.x,u.x),Math.min(a.x,f.x)),c=Math.max(Math.max(o.x,u.x),Math.max(a.x,f.x)),h=Math.min(Math.min(o.y,u.y),Math.min(a.y,f.y)),p=Math.max(Math.max(o.y,u.y),Math.max(a.y,f.y));return cc.RectMake(l,h,c-l,p-h)},cc.AffineTransformTranslate=function(e,t,n){return cc.__AffineTransformMake(e.a,e.b,e.c,e.d,e.tx+e.a*t+e.c*n,e.ty+e.b*t+e.d*n)},cc.AffineTransformScale=function(e,t,n){return cc.__AffineTransformMake(e.a*t,e.b*t,e.c*n,e.d*n,e.tx,e.ty)},cc.AffineTransformRotate=function(e,t){var n=Math.sin(t),r=Math.cos(t);return cc.__AffineTransformMake(e.a*r+e.c*n,e.b*r+e.d*n,e.c*r-e.a*n,e.d*r-e.b*n,e.tx,e.ty)},cc.AffineTransformConcat=function(e,t){return cc.__AffineTransformMake(e.a*t.a+e.b*t.c,e.a*t.b+e.b*t.d,e.c*t.a+e.d*t.c,e.c*t.b+e.d*t.d,e.tx*t.a+e.ty*t.c+t.tx,e.tx*t.b+e.ty*t.d+t.ty)},cc.AffineTransformEqualToTransform=function(e,t){return e.a==t.a&&e.b==t.b&&e.c==t.c&&e.d==t.d&&e.tx==t.tx&&e.ty==t.ty},cc.AffineTransformInvert=function(e){var t=1/(e.a*e.d-e.b*e.c);return cc.__AffineTransformMake(t*e.d,-t*e.b,-t*e.c,t*e.a,t*(e.c*e.ty-e.d*e.tx),t*(e.b*e.tx-e.a*e.ty))},cc.CCPOINT_EPSILON=parseFloat("1.192092896e-07F"),cc.ccp=function(e,t){return new cc.Point(e,t)},cc.ccpNeg=function(e){return new cc.Point(-e.x,-e.y)},cc.ccpAdd=function(e,t){return new cc.Point(e.x+t.x,e.y+t.y)},cc.ccpSub=function(e,t){return new cc.Point(e.x-t.x,e.y-t.y)},cc.ccpMult=function(e,t){return new cc.Point(e.x*t,e.y*t)},cc.ccpMidpoint=function(e,t){return cc.ccpMult(cc.ccpAdd(e,t),.5)},cc.ccpDot=function(e,t){return e.x*t.x+e.y*t.y},cc.ccpCross=function(e,t){return e.x*t.y-e.y*t.x},cc.ccpPerp=function(e){return new cc.Point(-e.y,e.x)},cc.ccpRPerp=function(e){return new cc.Point(e.y,-e.x)},cc.ccpProject=function(e,t){return cc.ccpMult(t,cc.ccpDot(e,t)/cc.ccpDot(t,t))},cc.ccpRotate=function(e,t){return new cc.Point(e.x*t.x-e.y*t.y,e.x*t.y+e.y*t.x)},cc.ccpUnrotate=function(e,t){return new cc.Point(e.x*t.x+e.y*t.y,e.y*t.x-e.x*t.y)},cc.ccpLengthSQ=function(e){return cc.ccpDot(e,e)},cc.ccpLength=function(e){return Math.sqrt(cc.ccpLengthSQ(e))},cc.ccpDistance=function(e,t){return cc.ccpLength(cc.ccpSub(e,t))},cc.ccpNormalize=function(e){return cc.ccpMult(e,1/cc.ccpLength(e))},cc.ccpForAngle=function(e){return new cc.Point(Math.cos(e),Math.sin(e))},cc.ccpToAngle=function(e){return Math.atan2(e.y,e.x)},cc.clampf=function(e,t,n){if(t>n){var r=t;t=n,n=r}return e<t?t:e<n?e:n},cc.ccpClamp=function(e,t,n){return new cc.Point(cc.clampf(e.x,t.x,n.x),cc.clampf(e.y,t.y,n.y))},cc.ccpFromSize=function(e){return new cc.Point(e.width,e.height)},cc.ccpCompOp=function(e,t){return new cc.Point(t(e.x),t(e.y))},cc.ccpLerp=function(e,t,n){return cc.ccpAdd(cc.ccpMult(e,1-n),cc.ccpMult(t,n))},cc.ccpFuzzyEqual=function(e,t,n){return e.x-n<=t.x&&t.x<=e.x+n&&e.y-n<=t.y&&t.y<=e.y+n?!0:!1},cc.ccpCompMult=function(e,t){return new cc.Point(e.x*t.x,e.y*t.y)},cc.ccpAngleSigned=function(e,t){var n=cc.ccpNormalize(e),r=cc.ccpNormalize(t),i=Math.atan2(n.x*r.y-n.y*r.x,cc.ccpDot(n,r));return Math.abs(i)<cc.CCPOINT_EPSILON?0:i},cc.ccpAngle=function(e,t){var n=Math.acos(cc.ccpDot(cc.ccpNormalize(e),cc.ccpNormalize(t)));return Math.abs(n)<cc.CCPOINT_EPSILON?0:n},cc.ccpRotateByAngle=function(e,t,n){var r=cc.ccpSub(e,t),i=Math.cos(n),s=Math.sin(n),o=r.x;return r.x=o*i-r.y*s+t.x,r.y=o*s+r.y*i+t.y,r},cc.ccpLineIntersect=function(e,t,n,r,i){if(e.x==t.x&&e.y==t.y||n.x==r.x&&n.y==r.y)return!1;var s=t.x-e.x,o=t.y-e.y,u=r.x-n.x,a=r.y-n.y,f=e.x-n.x,l=e.y-n.y,c=a*s-u*o;return i.x=u*l-a*f,i.y=s*l-o*f,c==0?i.x==0||i.y==0?!0:!1:(i.x=i.x/c,i.y=i.y/c,!0)},cc.ccpSegmentIntersect=function(e,t,n,r){var i=new cc.Point;return cc.ccpLineIntersect(e,t,n,r,i)&&i.x>=0&&i.x<=1&&i.y>=0&&i.y<=1?!0:!1},cc.ccpIntersectPoint=function(e,t,n,r){var i=new cc.Point;if(cc.ccpLineIntersect(e,t,n,r,i)){var s=new cc.Point;return s.x=e.x+i.x*(t.x-e.x),s.y=e.y+i.x*(t.y-e.y),s}return cc.PointZero()},cc.ccpSameAs=function(e,t){return e.x&&t.x?e.x==t.x&&e.y==t.y:!1},cc.CCNODE_TAG_INVALID=-1,cc.CCNODE_ON_ENTER=null,cc.CCNODE_ON_EXIT=null,cc.saveContext=function(){cc.renderContextType==cc.CANVAS&&cc.renderContext.save()},cc.restoreContext=function(){cc.renderContextType==cc.CANVAS&&cc.renderContext.restore()},cc.Node=cc.Class.extend({_zOrder:0,_vertexZ:0,_rotation:0,_scaleX:1,_scaleY:1,_position:cc.PointZero(),_positionInPixels:cc.PointZero(),_skewX:0,_skewY:0,_children:null,_camera:null,_grid:null,_isVisible:!0,_anchorPoint:new cc.Point(0,0),_anchorPointInPixels:new cc.Point(0,0),_contentSize:cc.SizeZero(),_contentSizeInPixels:cc.SizeZero(),_isRunning:!1,_parent:null,_isRelativeAnchorPoint:!0,_tag:cc.CCNODE_TAG_INVALID,_userData:null,_isTransformDirty:!0,_isInverseDirty:!0,_isCacheDirty:!0,_isTransformGLDirty:null,_transform:null,_inverse:null,_transformGL:null,ctor:function(){cc.NODE_TRANSFORM_USING_AFFINE_MATRIX&&(this._isTransformGLDirty=!0,this._transformGL=0),this._anchorPoint=new cc.Point(0,0),this._anchorPointInPixels=new cc.Point(0,0),this._contentSize=new cc.Size(0,0),this._contentSizeInPixels=new cc.Size(0,0)},_arrayMakeObjectsPerformSelector:function(e,t){if(!e||e.length==0)return;var n;switch(t){case cc.Node.StateCallbackType.onEnter:for(n=0;n<e.length;n++)e[n]&&e[n].onEnter();break;case cc.Node.StateCallbackType.onExit:for(n=0;n<e.length;n++)e[n]&&e[n].onExit();break;case cc.Node.StateCallbackType.onEnterTransitionDidFinish:for(n=0;n<e.length;n++)e[n]&&e[n].onEnterTransitionDidFinish();break;case cc.Node.StateCallbackType.cleanup:for(n=0;n<e.length;n++)e[n]&&e[n].cleanup();break;default:throw"Unknown callback function"}},_addDirtyRegionToDirector:function(e){},_isInDirtyRegion:function(){},setNodeDirty:function(){this._setNodeDirtyForCache(),this._isTransformDirty=this._isInverseDirty=!0,cc.NODE_TRANSFORM_USING_AFFINE_MATRIX&&(this._isTransformGLDirty=!0)},_setNodeDirtyForCache:function(){this._isCacheDirty=!0,this._parent&&this._parent._setNodeDirtyForCache()},getSkewX:function(){return this._skewX},setSkewX:function(e){this._skewX=e,this.setNodeDirty()},getSkewY:function(){return this._skewY},setSkewY:function(e){this._skewY=e,this.setNodeDirty()},getZOrder:function(){return this._zOrder},_setZOrder:function(e){this._zOrder=e},getVertexZ:function(){return this._vertexZ/cc.CONTENT_SCALE_FACTOR()},setVertexZ:function(e){this._vertexZ=e*cc.CONTENT_SCALE_FACTOR()},getRotation:function(){return this._rotation},setRotation:function(e){this._rotation=e,this.setNodeDirty()},getScale:function(){return cc.Assert(this._scaleX==this._scaleY,"cc.Node#scale. ScaleX != ScaleY. Don't know which one to return"),this._scaleX},setScale:function(e){this._scaleX=e,this._scaleY=e,this.setNodeDirty()},getScaleX:function(){return this._scaleX},setScaleX:function(e){this._scaleX=e,this.setNodeDirty()},getScaleY:function(){return this._scaleY},setScaleY:function(e){this._scaleY=e,this.setNodeDirty()},setPosition:function(e){this._position=e,cc.CONTENT_SCALE_FACTOR()==1?this._positionInPixels=this._position:this._positionInPixels=cc.ccpMult(e,cc.CONTENT_SCALE_FACTOR()),this.setNodeDirty()},setPositionInPixels:function(e){this._positionInPixels=e,cc.CONTENT_SCALE_FACTOR()==1?this._position=this._positionInPixels:this._position=cc.ccpMult(e,1/cc.CONTENT_SCALE_FACTOR()),this.setNodeDirty()},getPositionInPixels:function(){return new cc.Point(this._positionInPixels.x,this._positionInPixels.y)},getPosition:function(){return new cc.Point(this._position.x,this._position.y)},getPositionX:function(){return this._position.x},setPositionX:function(e){this.setPosition(cc.ccp(e,this._position.y))},getPositionY:function(){return this._position.y},setPositionY:function(e){this.setPosition(cc.ccp(this._position.x,e))},getChildrenCount:function(){return this._children?this._children.length:0},getChildren:function(){return this._children},getCamera:function(){return this._camera||(this._camera=new cc.Camera),this._camera},getGrid:function(){return this._grid},setGrid:function(e){this._grid=e},getIsVisible:function(){return this._isVisible},setIsVisible:function(e){this._isVisible=e,this.setNodeDirty()},getAnchorPoint:function(){return new cc.Point(this._anchorPoint.x,this._anchorPoint.y)},setAnchorPoint:function(e){cc.Point.CCPointEqualToPoint(e,this._anchorPoint)||(this._anchorPoint=e,this._anchorPointInPixels=new cc.Point(this._contentSizeInPixels.width*this._anchorPoint.x,this._contentSizeInPixels.height*this._anchorPoint.y),this.setNodeDirty())},getAnchorPointInPixels:function(){return new cc.Point(this._anchorPointInPixels.x,this._anchorPointInPixels.y)},setContentSizeInPixels:function(e){cc.Size.CCSizeEqualToSize(e,this._contentSizeInPixels)||(this._contentSizeInPixels=e,cc.CONTENT_SCALE_FACTOR()==1?this._contentSize=this._contentSizeInPixels:this._contentSize=new cc.Size(e.width/cc.CONTENT_SCALE_FACTOR(),e.height/cc.CONTENT_SCALE_FACTOR()),this._anchorPointInPixels=new cc.Point(this._contentSizeInPixels.width*this._anchorPoint.x,this._contentSizeInPixels.height*this._anchorPoint.y),this.setNodeDirty())},getContentSize:function(){return new cc.Size(this._contentSize.width,this._contentSize.height)},setContentSize:function(e){cc.Size.CCSizeEqualToSize(e,this._contentSize)||(this._contentSize=e,cc.CONTENT_SCALE_FACTOR()==1?this._contentSizeInPixels=this._contentSize:this._contentSizeInPixels=new cc.Size(e.width*cc.CONTENT_SCALE_FACTOR(),e.height*cc.CONTENT_SCALE_FACTOR()),this._anchorPointInPixels=new cc.Point(this._contentSizeInPixels.width*this._anchorPoint.x,this._contentSizeInPixels.height*this._anchorPoint.y),this.setNodeDirty())},getContentSizeInPixels:function(){return new cc.Size(this._contentSizeInPixels.width,this._contentSizeInPixels.height)},getIsRunning:function(){return this._isRunning},getParent:function(){return this._parent},setParent:function(e){this._parent=e},getIsRelativeAnchorPoint:function(){return this._isRelativeAnchorPoint},setIsRelativeAnchorPoint:function(e){this._isRelativeAnchorPoint=e,this.setNodeDirty()},getTag:function(){return this._tag},setTag:function(e){this._tag=e},getUserData:function(){return this._userData},setUserData:function(e){this._userData=e},boundingBox:function(){var e=this.boundingBoxInPixels();return cc.RECT_PIXELS_TO_POINTS(e)},boundingBoxInPixels:function(){var e=cc.RectMake(0,0,this._contentSizeInPixels.width,this._contentSizeInPixels.height);return cc.RectApplyAffineTransform(e,this.nodeToParentTransform())},boundingBoxToWorld:function(){var e=cc.RectMake(0,0,this._contentSizeInPixels.width,this._contentSizeInPixels.height);e=cc.RectApplyAffineTransform(e,this.nodeToWorldTransform()),e=new cc.Rect(0|e.origin.x-4,0|e.origin.y-4,0|e.size.width+8,0|e.size.height+8);if(!this._children)return e;for(var t=0;t<this._children.length;t++){var n=this._children[t];if(n&&n._isVisible){var r=n.boundingBoxToWorld();r&&(e=cc.Rect.CCRectUnion(e,r))}}return e},cleanup:function(){this.stopAllActions(),this.unscheduleAllSelectors(),this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.cleanup)},description:function(){return"<cc.Node | Tag ="+this._tag+">"},_childrenAlloc:function(){this._children=[]},getChildByTag:function(e){cc.Assert(e!=cc.CCNODE_TAG_INVALID,"Invalid tag");if(this._children!=null)for(var t=0;t<this._children.length;t++){var n=this._children[t];if(n&&n._tag==e)return n}return null},addChild:function(e,t,n){var r=arguments.length;cc.Assert(e!=null,"Argument must be non-nil"),cc.Assert(e._parent==null,"child already added. It can't be added again");var i=t!=null?t:e.getZOrder(),s=n!=null?n:e.getTag();e.setTag(s),this._children||this._childrenAlloc(),this._insertChild(e,i),e.setParent(this),this._isRunning&&(e.onEnter(),e.onEnterTransitionDidFinish())},removeFromParentAndCleanup:function(e){this._parent.removeChild(this,e)},removeChild:function(e,t){if(this._children==null)return;this._children.indexOf(e)>-1&&this._detachChild(e,t),this.setNodeDirty()},removeChildByTag:function(e,t){cc.Assert(e!=cc.CCNODE_TAG_INVALID,"Invalid tag");var n=this.getChildByTag(e);n==null?cc.Log("cocos2d: removeChildByTag: child not found!"):this.removeChild(n,t)},removeAllChildrenWithCleanup:function(e){if(this._children!=null){for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&(this._isRunning&&n.onExit(),e&&n.cleanup(),n.setParent(null))}this._children=[]}},_detachChild:function(e,t){this._isRunning&&e.onExit(),t&&e.cleanup(),e.setParent(null),cc.ArrayRemoveObject(this._children,e)},_insertChild:function(e,t){var n=this._children[this._children.length-1];if(!n||n.getZOrder()<=t)this._children.push(e);else for(var r=0;r<this._children.length;r++){var i=this._children[r];if(i&&i.getZOrder()>t){this._children=cc.ArrayAppendObjectToIndex(this._children,e,r);break}}e._setZOrder(t)},reorderChild:function(e,t){cc.Assert(e!=null,"Child must be non-nil"),cc.ArrayRemoveObject(this._children,e),this._insertChild(e,t),this.setNodeDirty()},draw:function(e){},visit:function(e){if(!this._isVisible)return;var t=e||cc.renderContext;t.save(),this._grid&&this._grid.isActive()&&(this._grid.beforeDraw(),this.transformAncestors()),this.transform(t);var n,r;if(this._children)for(n=0;n<this._children.length;n++){r=this._children[n];if(!(r&&r._zOrder<0))break;r.visit(t)}this.draw(t);if(this._children)for(;n<this._children.length;n++)r=this._children[n],r&&r._zOrder>=0&&r.visit(t);this._grid&&this._grid.isActive()&&this._grid.afterDraw(this),t.restore()},transformAncestors:function(){this._parent!=null&&(this._parent.transformAncestors(),this._parent.transform())},transform:function(e){var t=e||cc.renderContext;if(cc.renderContextType==cc.CANVAS){var n;if(this._isRelativeAnchorPoint)this._parent?n=this._parent._anchorPointInPixels:n=new cc.Point(0,0),t.translate(0|this._position.x-n.x,-(0|this._position.y-n.y));else{this._parent?n=this._parent._anchorPointInPixels:n=new cc.Point(0,0);var r=this._anchorPointInPixels;t.translate(0|this._position.x-n.x+r.x,-(0|this._position.y-n.y+r.y))}this._rotation!=0&&t.rotate(cc.DEGREES_TO_RADIANS(this._rotation)),(this._scaleX!=1||this._scaleY!=1)&&t.scale(this._scaleX,this._scaleY),(this._skewX!=0||this._skewY!=0)&&t.transform(1,-Math.tan(cc.DEGREES_TO_RADIANS(this._skewY)),-Math.tan(cc.DEGREES_TO_RADIANS(this._skewX)),1,0,0)}else if(cc.NODE_TRANSFORM_USING_AFFINE_MATRIX){if(this._isTransformGLDirty){var i=this.nodeToParentTransform();this._isTransformGLDirty=!1}this._vertexZ;if(this._camera&&(!this._grid||!this._grid.isActive())){var s=this._anchorPointInPixels.x!=0||this._anchorPointInPixels.y!=0;s,this._camera.locate(),s}}else this._isRelativeAnchorPoint&&(this._anchorPointInPixels.x!=0||this._anchorPointInPixels.y!=0),this._anchorPointInPixels.x==0&&this._anchorPointInPixels.y==0&&(this._positionInPixels.x!=0||this._positionInPixels.y!=0||this._vertexZ!=0),this._rotation!=0,this._scaleX!=1||this._scaleY!=1,this._camera&&(!this._grid||!this._grid.isActive())&&this._camera.locate(),this._anchorPointInPixels.x!=0||this._anchorPointInPixels.y!=0},onEnter:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnter),this.resumeSchedulerAndActions(),this._isRunning=!0},onEnterTransitionDidFinish:function(){this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onEnterTransitionDidFinish)},onExit:function(){this.pauseSchedulerAndActions(),this._isRunning=!1,this._arrayMakeObjectsPerformSelector(this._children,cc.Node.StateCallbackType.onExit)},runAction:function(e){return cc.Assert(e!=null,"Argument must be non-nil"),cc.ActionManager.sharedManager().addAction(e,this,!this._isRunning),e},stopAllActions:function(){cc.ActionManager.sharedManager().removeAllActionsFromTarget(this)},stopAction:function(e){cc.ActionManager.sharedManager().removeAction(e)},stopActionByTag:function(e){cc.Assert(e!=cc.CCACTION_TAG_INVALID,"Invalid tag"),cc.ActionManager.sharedManager().removeActionByTag(e,this)},getActionByTag:function(e){return cc.Assert(e!=cc.CCACTION_TAG_INVALID,"Invalid tag"),cc.ActionManager.sharedManager().getActionByTag(e,this)},numberOfRunningActions:function(){return cc.ActionManager.sharedManager.numberOfRunningActionsInTarget(this)},isScheduled:function(e){},scheduleUpdate:function(){this.scheduleUpdateWithPriority(0)},scheduleUpdateWithPriority:function(e){cc.Scheduler.sharedScheduler().scheduleUpdateForTarget(this,e,!this._isRunning)},unscheduleUpdate:function(){cc.Scheduler.sharedScheduler().unscheduleUpdateForTarget(this)},schedule:function(e,t){t||(t=0),cc.Assert(e,"Argument must be non-nil"),cc.Assert(t>=0,"Argument must be positive"),cc.Scheduler.sharedScheduler().scheduleSelector(e,this,t,!this._isRunning)},unschedule:function(e){if(!e)return;cc.Scheduler.sharedScheduler().unscheduleSelector(e,this)},unscheduleAllSelectors:function(){cc.Scheduler.sharedScheduler().unscheduleAllSelectorsForTarget(this)},resumeSchedulerAndActions:function(){cc.Scheduler.sharedScheduler().resumeTarget(this),cc.ActionManager.sharedManager().resumeTarget(this)},pauseSchedulerAndActions:function(){cc.Scheduler.sharedScheduler().pauseTarget(this),cc.ActionManager.sharedManager().pauseTarget(this)},nodeToParentTransform:function(){if(this._isTransformDirty){this._transform=cc.AffineTransformIdentity(),!this._isRelativeAnchorPoint&&!cc.Point.CCPointEqualToPoint(this._anchorPointInPixels,cc.PointZero())&&(this._transform=cc.AffineTransformTranslate(this._transform,this._anchorPointInPixels.x,this._anchorPointInPixels.y)),cc.Point.CCPointEqualToPoint(this._positionInPixels,cc.PointZero())||(this._transform=cc.AffineTransformTranslate(this._transform,this._positionInPixels.x,this._positionInPixels.y)),this._rotation!=0&&(this._transform=cc.AffineTransformRotate(this._transform,-cc.DEGREES_TO_RADIANS(this._rotation)));if(this._skewX!=0||this._skewY!=0){var e=cc.AffineTransformMake(1,Math.tan(cc.DEGREES_TO_RADIANS(this._skewY)),Math.tan(cc.DEGREES_TO_RADIANS(this._skewX)),1,0,0);this._transform=cc.AffineTransformConcat(e,this._transform)}if(this._scaleX!=1||this._scaleY!=1)this._transform=cc.AffineTransformScale(this._transform,this._scaleX,this._scaleY);cc.Point.CCPointEqualToPoint(this._anchorPointInPixels,cc.PointZero())||(this._transform=cc.AffineTransformTranslate(this._transform,-this._anchorPointInPixels.x,-this._anchorPointInPixels.y)),this._isTransformDirty=!1}return this._transform},parentToNodeTransform:function(){return this._isInverseDirty&&(this._inverse=cc.AffineTransformInvert(this.nodeToParentTransform()),this._isInverseDirty=!1),this._inverse},nodeToWorldTransform:function(){var e=this.nodeToParentTransform();for(var t=this._parent;t!=null;t=t.getParent())e=cc.AffineTransformConcat(e,t.nodeToParentTransform());return e},worldToNodeTransform:function(){return cc.AffineTransformInvert(this.nodeToWorldTransform())},convertToNodeSpace:function(e){var t=new cc.Point;return cc.CONTENT_SCALE_FACTOR()==1?t=cc.PointApplyAffineTransform(e,this.worldToNodeTransform()):(t=cc.ccpMult(e,cc.CONTENT_SCALE_FACTOR()),t=cc.PointApplyAffineTransform(t,this.worldToNodeTransform()),t=cc.ccpMult(t,1/cc.CONTENT_SCALE_FACTOR())),t},convertToWorldSpace:function(e){var t=new cc.Point;return cc.CONTENT_SCALE_FACTOR()==1?t=cc.PointApplyAffineTransform(e,this.nodeToWorldTransform()):(t=cc.ccpMult(e,cc.CONTENT_SCALE_FACTOR()),t=cc.PointApplyAffineTransform(t,this.nodeToWorldTransform()),t=cc.ccpMult(t,1/cc.CONTENT_SCALE_FACTOR())),t},convertToNodeSpaceAR:function(e){var t=this.convertToNodeSpace(e),n=new cc.Point;return cc.CONTENT_SCALE_FACTOR()==1?n=this._anchorPointInPixels:n=cc.ccpMult(this._anchorPointInPixels,1/cc.CONTENT_SCALE_FACTOR()),cc.ccpSub(t,n)},convertToWorldSpaceAR:function(e){var t=new cc.Point;cc.CONTENT_SCALE_FACTOR()==1?t=this._anchorPointInPixels:t=cc.ccpMult(this._anchorPointInPixels,1/cc.CONTENT_SCALE_FACTOR());var n=new cc.Point;return n=cc.ccpAdd(e,t),this.convertToWorldSpace(n)},_convertToWindowSpace:function(e){var t=new cc.Point;return t=this.convertToWorldSpace(e),cc.Director.sharedDirector().convertToUI(t)},convertTouchToNodeSpace:function(e){var t=e.locationInView(e.view());return t=cc.Director.sharedDirector().convertToGL(t),this.convertToNodeSpace(t)},convertTouchToNodeSpaceAR:function(e){var t=e.locationInView(e.view());return t=cc.Director.sharedDirector().convertToGL(t),this.convertToNodeSpaceAR(t)},update:function(e){}}),cc.Node.StateCallbackType={onEnter:1,onExit:2,cleanup:3,onEnterTransitionDidFinish:4,updateTransform:5},cc.Node.create=function(){return new cc.Node},cc.AtlasNode=cc.Node.extend({_itemsPerRow:0,_itemsPerColumn:0,_itemWidth:0,_itemHeight:0,_colorUnmodified:new cc.Color3B(0,0,0),_textureAtlas:null,_isOpacityModifyRGB:!1,_blendFunc:new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),_opacity:0,_color:null,_originalTexture:null,_quadsToDraw:0,initWithTileFile:function(e,t,n,r){return cc.Assert(e!=null,"title should not be null"),this._itemWidth=t*cc.CONTENT_SCALE_FACTOR(),this._itemHeight=n*cc.CONTENT_SCALE_FACTOR(),this._opacity=255,this._color=this._colorUnmodified=cc.WHITE(),this._isOpacityModifyRGB=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithFile(e,r),cc.renderContextType==cc.CANVAS&&(this._originalTexture=this._textureAtlas.getTexture()),this._textureAtlas?(this._updateBlendFunc(),this._updateOpacityModifyRGB(),this._calculateMaxItems(),this._quadsToDraw=r,!0):(cc.Log("cocos2d: Could not initialize cc.AtlasNode. Invalid Texture."),!1)},updateAtlasValues:function(){cc.Assert(!1,"cc.AtlasNode:Abstract updateAtlasValue not overriden")},draw:function(e){this._super();if(cc.renderContextType!=cc.CANVAS){var t=this._blendFunc.src!=cc.BLEND_SRC||this._blendFunc.dst!=cc.BLEND_DST;t,this._textureAtlas.drawNumberOfQuads(this._quadsToDraw,0),t}},getColor:function(){return this._isOpacityModifyRGB?this._colorUnmodified:this._color},setColor:function(e){if(this._color.r==e.r&&this._color.g==e.g&&this._color.b==e.b)return;this._color=this._colorUnmodified=e;if(this.getTexture()&&cc.renderContextType==cc.CANVAS){var t=cc.TextureCache.sharedTextureCache().getTextureColors(this._originalTexture);if(t){var n=this.getTexture(),r=new cc.Rect(0,0,n.width,n.height),i=cc.generateTintImage(n,t,this._color,r),s=new Image;s.src=i.toDataURL(),this.setTexture(s)}}this._isOpacityModifyRGB&&(this._color.r=e.r*this._opacity/255,this._color.g=e.g*this._opacity/255,this._color.b=e.b*this._opacity/255)},getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e;return},setIsOpacityModifyRGB:function(e){var t=this._color;this._isOpacityModifyRGB=e,this._color=t},getIsOpacityModifyRGB:function(){return this._isOpacityModifyRGB},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e){this._blendFunc=e},getTexture:function(){return this._textureAtlas.getTexture()},setTexture:function(e){this._textureAtlas.setTexture(e),this._updateBlendFunc(),this._updateOpacityModifyRGB()},setTextureAtlas:function(e){this._textureAtlas=e},getTextureAtlas:function(){return this._textureAtlas},getQuadsToDraw:function(){return this._quadsToDraw},setQuadsToDraw:function(e){this._quadsToDraw=e},_calculateMaxItems:function(){var e=this._textureAtlas.getTexture();this._itemsPerColumn=parseInt(e.height/this._itemHeight),this._itemsPerRow=parseInt(e.width/this._itemWidth)},_updateBlendFunc:function(){},_updateOpacityModifyRGB:function(){}}),cc.AtlasNode.create=function(e,t,n,r){var i=new cc.AtlasNode;return i.initWithTileFile(e,t,n,r)?i:null};var cc=cc=cc||{};cc.CCTEXTURE_2D_PIXEL_FORMAT_AUTOMATIC=0,cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888=1,cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB888=2,cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB565=3,cc.CCTEXTURE_2D_PIXEL_FORMAT_A8=4,cc.CCTEXTURE_2D_PIXEL_FORMAT_I8=5,cc.CCTEXTURE_2D_PIXEL_FORMAT_AI88=6,cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA4444=7,cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB5A1=8,cc.CCTEXTURE_2D_PIXEL_FORMAT_PVRTC4=9,cc.CCTEXTURE_2D_PIXEL_FORMAT_PVRTC2=10,cc.CCTEXTURE_2D_PIXEL_FORMAT_DEFAULT=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888,cc.TEXTURE_2D_PIXEL_FORMAT_AUTOMATIC=cc.CCTEXTURE_2D_PIXEL_FORMAT_AUTOMATIC,cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888,cc.TEXTURE_2D_PIXEL_FORMAT_RGB888=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB888,cc.TEXTURE_2D_PIXEL_FORMAT_RGB565=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB565,cc.TEXTURE_2D_PIXEL_FORMAT_A8=cc.CCTEXTURE_2D_PIXEL_FORMAT_A8,cc.TEXTURE_2D_PIXEL_FORMAT_RGBA4444=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA4444,cc.TEXTURE_2D_PIXEL_FORMAT_RGB5A1=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB5A1,cc.TEXTURE_2D_PIXEL_FORMAT_DEFAULT=cc.CCTEXTURE_2D_PIXEL_FORMAT_DEFAULT,cc.FONT_LABEL_SUPPORT,cc.ENABLE_CACHE_TEXTTURE_DATA,cc.g_defaultAlphaPixelFormat=cc.CCTEXTURE_2D_PIXEL_FORMAT_DEFAULT,cc.PVRHaveAlphaPremultiplied_=!1,cc.Texture2D=cc.Class.extend({_pVRHaveAlphaPremultiplied:null,_pixelFormat:null,_pixelsWide:null,_pixelsHigh:null,_name:null,_contentSize:null,_maxS:null,_maxT:null,_hasPremultipliedAlpha:null,ctor:function(){cc.SUPPORT_PVRTC&&(this.initWithPVRTCData=function(e,t,n,r,i,s){if(!cc.Configuration.sharedConfiguration().isSupportsPVRTC())return cc.Log("cocos2d: WARNING: PVRTC images is not supported."),!1;this.setAntiAliasTexParameters();var o,u=new cc.GLsizei;return u=i*i*n/8,r?o=n==4?cc.GL_COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:cc.GL_COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:o=n==4?cc.GL_COMPRESSED_RGB_PVRTC_4BPPV1_IMG:cc.GL_COMPRESSED_RGB_PVRTC_2BPPV1_IMG,u<32&&(u=32),this._contentSize=cc.SizeMake(i,i),this._pixelsWide=i,this._pixelsHigh=i,this._maxS=1,this._maxT=1,this._hasPremultipliedAlpha=cc.PVRHaveAlphaPremultiplied_,this._pixelFormat=s,!0})},getPixelFormat:function(){return this._pixelFormat},getPixelsWide:function(){return this._pixelsWide},getPixelsHigh:function(){return this._pixelsHigh},getName:function(){return this._name},getContentSizeInPixels:function(){var e=new cc.Size;return e.width=this._contentSize.width/cc.CONTENT_SCALE_FACTOR(),e.height=this._contentSize.height/cc.CONTENT_SCALE_FACTOR(),e},getMaxS:function(){return this._maxS},setMaxS:function(e){this._maxS=e},getMaxT:function(){return this._maxT},setMaxT:function(e){this._maxT=e},getHasPremultipliedAlpha:function(){return this._hasPremultipliedAlpha},description:function(){var e="<cc.Texture2D | Name = "+this._name+" | Dimensions = "+this._pixelsWide+" x "+this._pixelsHigh+" | Coordinates = ("+this._maxS+", "+this._maxT+")>";return e},releaseData:function(e){cc.free(e)},keepData:function(e,t){return e},initWithData:function(e,t,n,r){this.setAntiAliasTexParameters();switch(e){case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888:break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB888:break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA4444:break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB5A1:break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB565:break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_AI88:break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_A8:break;default:cc.Assert(0,"NSInternalInconsistencyException")}return this._contentSize=r,this._pixelsWide=t,this._pixelsHigh=n,this._pixelFormat=e,this._maxS=r.width/t,this._maxT=r.height/n,this._hasPremultipliedAlpha=!1,!0},drawAtPoint:function(e){var t=[0,this._maxT,this._maxS,this._maxT,0,0,this._maxS,0],n=this._pixelsWide*this._maxS,r=this._pixelsHigh*this._maxT,i=[e.x,e.y,0,n+e.x,e.y,0,e.x,r+e.y,0,n+e.x,r+e.y,0]},drawInRect:function(e){var t=[0,this._maxT,this._maxS,this._maxT,0,0,this._maxS,0],n=[e.origin.x,e.origin.y,e.origin.x+e.size.width,e.origin.y,e.origin.x,e.origin.y+e.size.height,e.origin.x+e.size.width,e.origin.y+e.size.height]},initWithImage:function(e){var t,n;if(e==null)return cc.Log("cocos2d: cc.Texture2D. Can't create Texture. UIImage is nil"),!1;var r=cc.Configuration.sharedConfiguration();cc.TEXTURE_NPOT_SUPPORT?r.isSupportsNPOT()&&(t=e.getWidth(),n=e.getHeight()):(t=cc.NextPOT(e.getWidth()),n=cc.NextPOT(e.getHeight()));var i=r.getMaxTextureSize();return n>i||t>i?(cc.Log("cocos2d: WARNING: Image (%u x %u) is bigger than the supported %u x %u",t,n,i,i),null):this._initPremultipliedATextureWithImage(e,t,n)},initWithString:function(e,t,n,r,i){arguments.length==3&&(r=arguments[1],i=arguments[2],t=cc.SizeMake(0,0),n=cc.TEXT_ALIGNMENT_CENTER),cc.ENABLE_CACHE_TEXTTURE_DATA&&cc.VolatileTexture.addStringTexture(this,e,t,n,r,i);var s=new cc.Image;return eAlign=new cc.Image.ETextAlign,eAlign=cc.TEXT_ALIGNMENT_CENTER==n?cc.Image.ALIGN_CENTER:cc.TEXT_ALIGNMENT_LEFT==n?cc.Image.ALIGN_LEFT:cc.Image.ALIGN_RIGHT,s.initWithString(e,t.width,t.height,eAlign,r,i)?this.initWithImage(s):!1},initWithPVRFile:function(e){var t=!1,n=new cc.TexturePVR;return t=n.initWithContentsOfFile(e),t?(n.setRetainName(!0),this._name=n.getName(),this._maxS=1,this._maxT=1,this._pixelsWide=n.getWidth(),this._pixelsHigh=n.getHeight(),this._contentSize=cc.SizeMake(this._pixelsWide,this._pixelsHigh),this._hasPremultipliedAlpha=cc.PVRHaveAlphaPremultiplied_,this._pixelFormat=n.getFormat(),this.setAntiAliasTexParameters()):cc.Log("cocos2d: Couldn't load PVR image %s",e),t},setTexParameters:function(e){cc.Assert(this._pixelsWide==cc.NextPOT(this._pixelsWide)&&this._pixelsHigh==cc.NextPOT(this._pixelsHigh)||e.wrapS==cc.GL_CLAMP_TO_EDGE&&e.wrapT==cc.GL_CLAMP_TO_EDGE,"cc.GL_CLAMP_TO_EDGE should be used in NPOT textures")},setAntiAliasTexParameters:function(){var e=[cc.GL_LINEAR,cc.GL_LINEAR,cc.GL_CLAMP_TO_EDGE,cc.GL_CLAMP_TO_EDGE];this.setTexParameters(e)},setAliasTexParameters:function(){var e=[cc.GL_NEAREST,cc.GL_NEAREST,cc.GL_CLAMP_TO_EDGE,cc.GL_CLAMP_TO_EDGE];this.setTexParameters(e)},generateMipmap:function(){cc.Assert(this._pixelsWide==cc.NextPOT(this._pixelsWide)&&this._pixelsHigh==cc.NextPOT(this._pixelsHigh),"Mimpap texture only works in POT textures")},bitsPerPixelForFormat:function(){var e=0;switch(this._pixelFormat){case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888:e=32;break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB565:e=16;break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_A8:e=8;break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA4444:e=16;break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB5A1:e=16;break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_PVRTC4:e=4;break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_PVRTC2:e=2;break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_I8:e=8;break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_AI88:e=16;break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB888:e=24;break;default:e=-1,cc.Assert(!1,"illegal pixel format"),cc.Log("bitsPerPixelForFormat: %d, cannot give useful result",this._pixelFormat)}return e},_initPremultipliedATextureWithImage:function(e,t,n){var r=null,i=null,s=null,o=null,u,a=new cc.Size,f=new cc.Texture2DPixelFormat,l=new cc.size_t;u=e.hasAlpha(),l=e.getBitsPerComponent(),u?f=cc.g_defaultAlphaPixelFormat:l>=8?f=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB888:(cc.Log("cocos2d: cc.Texture2D: Using RGB565 texture since image has no alpha"),f=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB565),a=cc.SizeMake(e.getWidth(),e.getHeight());switch(f){case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888:case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA4444:case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB5A1:case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB565:case cc.CCTEXTURE_2D_PIXEL_FORMAT_A8:i=e.getData(),cc.Assert(i!=null,"null image data.");if(e.getWidth()==t&&e.getHeight()==n)r=new(n*t*4),cc.memcpy(r,i,n*t*4);else{r=new(n*t*4);var c=i,h=r,p=e.getHeight();for(var d=0;d<p;++d)cc.memcpy(h+t*4*d,c+e.getWidth()*4*d,e.getWidth()*4)}break;case cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB888:i=e.getData(),cc.Assert(i!=null,"null image data.");if(e.getWidth()==t&&e.getHeight()==n)r=new(n*t*3),cc.memcpy(r,i,n*t*3);else{r=new(n*t*3);var c=i,h=r,p=e.getHeight();for(var d=0;d<p;++d)cc.memcpy(h+t*3*d,c+e.getWidth()*3*d,e.getWidth()*3)}break;default:cc.Assert(0,"Invalid pixel format")}if(f==cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB565){i=new(n*t*2),s=r,o=i;var v=t*n;for(var m=0;m<v;++m,++s)o++,o=(s>>0&255)>>3<<11|(s>>8&255)>>2<<5|(s>>16&255)>>3<<0;delete r,r=i}else if(f==cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA4444){i=new(n*t*2),s=r,o=i;var v=t*n;for(var m=0;m<v;++m,++s)o++,o=(s>>0&255)>>4<<12|(s>>8&255)>>4<<8|(s>>16&255)>>4<<4|(s>>24&255)>>4<<0;delete r,r=i}else if(f==cc.CCTEXTURE_2D_PIXEL_FORMAT_RGB5A1){i=new(n*t*2),s=r,o=i;var v=t*n;for(var m=0;m<v;++m,++s)o++,o=(s>>0&255)>>3<<11|(s>>8&255)>>3<<6|(s>>16&255)>>3<<1|(s>>24&255)>>7<<0;delete r,r=i}else f==cc.CCTEXTURE_2D_PIXEL_FORMAT_A8&&(f=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888);return r&&(this.initWithData(r,f,t,n,a),this._hasPremultipliedAlpha=e.isPremultipliedAlpha(),delete r),!0}}),cc.Texture2D.setDefaultAlphaPixelFormat=function(e){cc.g_defaultAlphaPixelFormat=e},cc.Texture2D.defaultAlphaPixelFormat=function(){return cc.g_defaultAlphaPixelFormat},cc.Texture2D.PVRImagesHavePremultipliedAlpha=function(e){cc.PVRHaveAlphaPremultiplied_=e},cc.g_sharedTextureCache=null,cc.loadImage=function(e){var t=cc.computeImageFormatType(e);if(t==cc.FMT_UNKNOWN){cc.Log("unsupported format"+e);return}var n=new Image;n.src=e,n.onLoad=function(t){cc.TextureCache.sharedTextureCache().cacheImage(e,n)}},cc.computeImageFormatType=function(e){return e.toLowerCase().indexOf(".jpg")>0||e.toLowerCase().indexOf(".jpeg")>0?cc.FMT_JPG:e.indexOf(".png")>0||e.indexOf(".PNG")>0?cc.FMT_PNG:cc.FMT_UNKNOWN},cc.TextureCache=cc.Class.extend({textures:{},_textureColorsCache:{},ctor:function(){cc.Assert(cc.g_sharedTextureCache==null,"Attempted to allocate a second instance of a singleton.")},addImageAsync:function(e,t,n){cc.Assert(e!=null,"TextureCache: path MUST not be null");var r=this.textures[e.toString()];if(r)this._addImageAsyncCallBack(t,n);else{r=new Image;var i=this;r.addEventListener("load",function(){i._addImageAsyncCallBack(t,n)}),r.src=e,this.textures[e.toString()]=r}if(cc.renderContextType==cc.CANVAS)return this.textures[e.toString()]},_addImageAsyncCallBack:function(e,t){e&&typeof t=="string"?e[t]():e&&typeof t=="function"&&t.call(e)},addPVRTCImage:function(){cc.Assert(0,"TextureCache:addPVRTCImage does not support")},description:function(){return"<TextureCache | Number of textures = "+this.textures.length+">"},addImage:function(e){cc.Assert(e!=null,"TextureCache: path MUST not be null");var t=this.textures[e.toString()];if(t)cc.Loader.shareLoader().onResLoaded();else{t=new Image;var n=this;t.addEventListener("load",function(){cc.Loader.shareLoader().onResLoaded()}),t.addEventListener("error",function(){cc.Loader.shareLoader().onResLoadingErr(e)}),t.src=e,this.textures[e.toString()]=t}if(cc.renderContextType==cc.CANVAS)return this.textures[e.toString()]},cacheImage:function(e,t){this.textures[e.toString()]||(this.textures[e.toString()]=t)},addUIImage:function(e,t){cc.Assert(e!=null,"TextureCache: image MUST not be nulll");var n=null;if(t&&this.textures.hasOwnProperty(t)){n=this.textures[t];if(n)return n}return n=new cc.Texture2D,n.initWithImage(e),t!=null&&n!=null?this.textures[t]=n:cc.Log("cocos2d: Couldn't add UIImage in TextureCache"),n},textureForKey:function(e){return this.textures.hasOwnProperty(e)?this.textures[e]:null},getKeyByTexture:function(e){for(var t in this.textures)if(this.textures[t]==e)return t;return null},getTextureColors:function(e){var t=this.getKeyByTexture(e);if(t){if(!(e instanceof HTMLImageElement))return null;t=e.src}return this._textureColorsCache.hasOwnProperty(t)||(this._textureColorsCache[t]=cc.generateTextureCacheForColor(e)),this._textureColorsCache[t]},removeAllTextures:function(){this.textures={}},removeTexture:function(e){if(!e)return;for(var t in this.textures)if(this.textures[t]==e){delete this.textures[t];return}},removeTextureForKey:function(e){if(e==null)return;this.textures[e]&&delete this.textures[e]},dumpCachedTextureInfo:function(){var e=0,t=0;for(var n in this.textures){var r=this.textures[n],i=r.bitsPerPixelForFormat(),s=r.getPixelsWide()*r.getPixelsHigh()*i/8;t+=s,e++,cc.Log("cocos2d: '"+r.toString()+"' id="+r.getName()+" "+r.getPixelsWide()+" x "+r.getPixelsHigh()+" @ "+i+" bpp => "+s/1024+" KB")}cc.Log("cocos2d: TextureCache dumpDebugInfo: "+e+" textures, for "+t/1024+" KB ("+(t/1048576).toFixed(2)+" MB)")},addPVRImage:function(e){cc.Assert(e!=null,"TextureCache: file image MUST not be null");var t=e;if(this.textures[t]!=null)return this.textures[t];var n=new cc.Texture2D;return n.initWithPVRFile(t)?this.textures[t]=n:cc.Log("cocos2d: Couldn't add PVRImage:"+t+" in TextureCache"),n}}),cc.TextureCache.sharedTextureCache=function(){return cc.g_sharedTextureCache||(cc.g_sharedTextureCache=new cc.TextureCache),cc.g_sharedTextureCache},cc.TextureCache.purgeSharedTextureCache=function(){cc.g_sharedTextureCache=null},cc.TextureAtlas=cc.Class.extend({_indices:[],_buffersVBO:[0,1],_dirty:!1,_capacity:0,_texture:null,_quads:[],getTotalQuads:function(){return this._quads.length},getCapacity:function(){return this._capacity},getTexture:function(){return this._texture},setTexture:function(e){this._texture=e},getQuads:function(){return this._quads},setQuads:function(e){this._quads=e},description:function(){return"<CCTextureAtlas | totalQuads ="+this._totalQuads+">"},_initIndices:function(){if(this._capacity==0)return;for(var e=0;e<this._capacity;e++)this._indices[e*6+0]=e*4+0,this._indices[e*6+1]=e*4+0,this._indices[e*6+2]=e*4+2,this._indices[e*6+3]=e*4+1,this._indices[e*6+4]=e*4+3,this._indices[e*6+5]=e*4+3},initWithFile:function(e,t){var n=cc.TextureCache.sharedTextureCache().addImage(e);return n?this.initWithTexture(n,t):(cc.Log("cocos2d: Could not open file: "+e),null)},initWithTexture:function(e,t){return cc.Assert(e!=null,"TextureAtlas.initWithTexture():texture should not be null"),this._capacity=t,this._texture=e,cc.Assert(this._quads.length==0&&this._indices.length==0,"TextureAtlas.initWithTexture():_quads and _indices should not be null"),this._quads=[],this._indices=[],(!this._quads||!this._indices)&&this._capacity>0?!1:(this._dirty=!0,this._initIndices(),!0)},updateQuad:function(e,t){this._quads[t]=e,this._dirty=!0},insertQuad:function(e,t){this._quads=cc.ArrayAppendObjectToIndex(this._quads,e,t),this._dirty=!0},insertQuadFromIndex:function(e,t){if(e==t)return;var n=this._quads[e];cc.ArrayRemoveObjectAtIndex(this._quads,e),e>t?this._quads=cc.ArrayAppendObjectToIndex(this._quads,n,t):this._quads=cc.ArrayAppendObjectToIndex(this._quads,n,t-1),this._dirty=!0},removeQuadAtIndex:function(e){cc.ArrayRemoveObjectAtIndex(this._quads,e),this._dirty=!0},removeAllQuads:function(){this._quads.length=0},resizeCapacity:function(e){return e==this._capacity?!0:(this._totalQuads=Math.min(this._totalQuads,e),this._capacity=e,!0)},drawNumberOfQuads:function(e,t){if(0==e)return},drawQuads:function(){this.drawNumberOfQuads(this._quads.length,0)}}),cc.TextureAtlas.create=function(e,t){var n=new cc.TextureAtlas;return n&&n.initWithFile(e,t)?n:null},cc.TextureAtlas.createWithTexture=function(e,t){var n=new cc.TextureAtlas;return n&&n.initWithTexture(e,t)?n:null},cc.CCIMAGE_FORMAT_JPG=0,cc.CCIMAGE_FORMAT_PNG=1,cc.CCIMAGE_FORMAT_RAWDATA=2,cc.NextPOT=function(e){return e-=1,e|=e>>1,e|=e>>2,e|=e>>4,e|=e>>8,e|=e>>16,e+1},cc.RenderTexture=cc.Node.extend({canvas:null,context:null,_fBO:0,_oldFBO:0,_texture:null,_uITextureImage:null,_pixelFormat:cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888,_sprite:null,ctor:function(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.setAnchorPoint(new cc.Point(0,0))},getSprite:function(){return this._sprite},setSprite:function(e){this._sprite=e},getCanvas:function(){return this.canvas},setContentSize:function(e){if(!e)return;this._super(e),this.canvas.width=e.width*1.5,this.canvas.height=e.height*1.5,this.context.translate(0,this.canvas.height)},initWithWidthAndHeight:function(e,t,n){if(cc.renderContextType==cc.CANVAS)return this.canvas.width=e||10,this.canvas.height=t||10,this.context.translate(0,this.canvas.height),!0;if(cc.Configuration.sharedConfiguration().getGlesVersion()<=GLES_VER_1_0)return!1;var r=!1;do{e*=cc.CONTENT_SCALE_FACTOR(),t*=cc.CONTENT_SCALE_FACTOR(),glGetIntegerv(cc.GL_FRAMEBUFFER_BINDING,this._oldFBO);var i=cc.NextPOT(e),s=cc.NextPOT(t),o=[];cc.BREAK_IF(!o);for(var u=0;u<i*s*4;u++)o[u]=0;this._pixelFormat=n,this._texture=new cc.Texture2D,cc.BREAK_IF(!this._texture),this._texture.initWithData(o,this._pixelFormat,i,s,cc.SizeMake(e,t)),ccglGenFramebuffers(1,this._fBO),ccglBindFramebuffer(cc.GL_FRAMEBUFFER,this._fBO),ccglFramebufferTexture2D(cc.GL_FRAMEBUFFER,cc.GL_COLOR_ATTACHMENT0,GL_TEXTURE_2D,texture.getName(),0);var a=ccglCheckFramebufferStatus(cc.GL_FRAMEBUFFER);if(a!=cc.GL_FRAMEBUFFER_COMPLETE){cc.Assert(0,"Render Texture : Could not attach texture to framebuffer");break}this._texture.setAliasTexParameters(),this._sprite=cc.Sprite.createWithTexture(this._texture),this._sprite.setScaleY(-1),this.addChild(this._sprite);var f=new cc.BlendFunc(GL_ONE,GL_ONE_MINUS_SRC_ALPHA);this._sprite.setBlendFunc(f),ccglBindFramebuffer(cc.GL_FRAMEBUFFER,this._oldFBO),r=!0}while(0);return r},begin:function(){glPushMatrix();var e=this._texture.getContentSizeInPixels(),t=cc.Director.sharedDirector().getDisplaySizeInPixels(),n=t.width/e.width,r=t.height/e.height;ccglOrtho(-1/n,1/n,-1/r,1/r,-1,1),glViewport(0,0,e.width,e.height),glGetIntegerv(cc.GL_FRAMEBUFFER_BINDING,this._oldFBO),ccglBindFramebuffer(cc.GL_FRAMEBUFFER,this._fBO),cc.ENABLE_DEFAULT_GL_STATES()},beginWithClear:function(e,t,n,r){this.begin();var i=[0,0,0,0];glGetFloatv(GL_COLOR_CLEAR_VALUE,i),glClearColor(e,t,n,r),glClear(GL_COLOR_BUFFER_BIT|GL_DEPTH_BUFFER_BIT),glClearColor(i[0],i[1],i[2],i[3])},end:function(e){ccglBindFramebuffer(cc.GL_FRAMEBUFFER,this._oldFBO),glPopMatrix();var t=cc.Director.sharedDirector().getDisplaySizeInPixels();cc.Director.sharedDirector().getOpenGLView().setViewPortInPoints(0,0,t.width,t.height);if(cc.ENABLE_CACHE_TEXTTURE_DATA&&e){var n=this._texture.getContentSizeInPixels(),r=n.width,i=n.height;this._uITextureImage=new cc.Image,1==this.getUIImageFromBuffer(this._uITextureImage,0,0,r,i)?cc.VolatileTexture.addDataTexture(this._texture,this._uITextureImage.getData(),cc.TEXTURE_2D_PIXEL_FORMAT_RGBA8888,n):cc.Log("Cache rendertexture failed!")}},clear:function(e,t,n,r){if(cc.renderContextType==cc.CANVAS){var i=e;i?this.context.clearRect(i.origin.x,i.origin.y,i.size.width,i.size.height):this.context.clearRect(0,0,this.canvas.width,-this.canvas.height)}else this.beginWithClear(e,t,n,r),this.end()},saveBuffer:function(e,t,n,r,i,s){if(typeof e=="number"){n=n||0,r=r||0,i=i||0,s=s||0;var o=!1;cc.Assert(e==cc.CCIMAGE_FORMAT_JPG||e==cc.CCIMAGE_FORMAT_PNG,"the image can only be saved as JPG or PNG format");var u=new cc.Image;if(u!=null&&this.getUIImageFromBuffer(u,n,r,i,s)){var a=cc.FileUtils.getWriteablePath()+t;o=u.saveToFile(a)}return o}if(typeof e=="string"){s=i||0,i=r||0,r=n||0,n=t||0,t=e;var o=!1,u=new cc.Image;return u!=null&&this.getUIImageFromBuffer(u,n,r,i,s)&&(o=u.saveToFile(t)),o}},getUIImageAsDataFromBuffer:function(e){var t=null;return t},getUIImageFromBuffer:function(e,t,n,r,i){if(null==e||null==this._texture)return!1;var s=this._texture.getContentSizeInPixels(),o=s.width,u=s.height;if(t<0||t>=o||n<0||n>=u)return!1;if(r<0||i<0||0==r&&0!=i||0==i&&0!=r)return!1;var a=r,f=i;0==r&&(a=o),0==i&&(f=u),a=t+a>o?o-t:a,f=n+f>u?u-n:f;var l=null,c=null,h=!1;do{cc.Assert(this._pixelFormat==cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888,"only RGBA8888 can be saved as image"),l=[];for(var p=0;p<a*f*4;p++)l[p]=0;cc.BREAK_IF(!l);var d=0,v=0,m=0;glGetIntegerv(GL_MAX_TEXTURE_SIZE,m),d=cc.NextPOT(o),v=cc.NextPOT(u),cc.BREAK_IF(0==d||0==v),cc.BREAK_IF(d>m||v>m);for(p=0;p<d*v*4;p++)c[p]=0;cc.BREAK_IF(!c),this.begin(),glPixelStorei(GL_PACK_ALIGNMENT,1),glReadPixels(0,0,d,v,GL_RGBA,GL_UNSIGNED_BYTE,c),this.end(!1);for(p=0;p<f;++p)this._memcpy(l,p*a*4,c,(n+f-p-1)*d*4+t*4,a*4);h=e.initWithImageData(l,a*f*4,cc.FMT_RAWDATA,a,f,8)}while(0);return h},_memcpy:function(e,t,n,r,i){for(var s=0;s<i;s++)e[t+s]=n[r+s]}}),cc.RenderTexture.create=function(e,t,n){n||(n=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888);var r=new cc.RenderTexture;return r&&r.initWithWidthAndHeight(e,t,n)?r:null},cc.CCPROGRESS_TIMER_RADIAL_CCW=0,cc.CCPROGRESS_TIMER_TYPE_RADIAL_CW=1,cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_LR=2,cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_RL=3,cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_BT=4,cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_TB=5,cc.PROGRESS_TEXTURE_COORDS_COUNT=4,cc.PROGRESS_TEXTURE_COORDS=30,cc.ProgressTimer=cc.Node.extend({getType:function(){return this._type},getPercentage:function(){return this._percentage},getSprite:function(){return this._sprite},initWithFile:function(e){return this.initWithTexture(cc.TextureCache.sharedTextureCache().addImage(e))},initWithTexture:function(e){return this._sprite=cc.Sprite.createWithTexture(e),this._percentage=0,this._vertexData=null,this._vertexDataCount=0,this.setAnchorPoint(cc.ccp(.5,.5)),this.setContentSize(this._sprite.getContentSize()),this._type=cc.CCPROGRESS_TIMER_RADIAL_CCW,!0},setPercentage:function(e){this._percentage!=e&&(this._percentage=cc.clampf(e,0,100),this._updateProgress())},setSprite:function(e){this._sprite!=e&&(this._sprite=e,this.setContentSize(this._sprite.getContentSize()),this._vertexData&&(this._vertexData=null,this._vertexDataCount=0))},setType:function(e){e!=this._type&&(this._vertexData&&(this._vertexData=null,this._vertexDataCount=0),this._type=e)},draw:function(e){if(cc.renderContextType==cc.CANVAS){var t=e||cc.renderContext;if(this._type>1){var n=new cc.Point(0|-this._anchorPointInPixels.x+this._drawPosition.x,0|-this._anchorPointInPixels.y+this._drawPosition.y);t.drawImage(this._sprite._texture,this._origin.x,this._origin.y,this._drawSize.width,this._drawSize.height,n.x,-(n.y+this._drawSize.height),this._drawSize.width,this._drawSize.height)}else{var r=this.getContentSize();t.beginPath();var i=Math.PI/180*this._startAngle,s=Math.PI/180*this._endAngle,o=r.width>r.height?r.width:r.height;t.arc(0,0,o,i,s,!1),t.lineTo(0,0),t.clip(),t.closePath();var u=this._sprite._offsetPositionInPixels,n=new cc.Point(0|-this._sprite._anchorPointInPixels.x+u.x,0|-this._sprite._anchorPointInPixels.y+u.y);t.drawImage(this._sprite._texture,this._sprite._rect.origin.x,this._sprite._rect.origin.y,this._sprite._rect.size.width,this._sprite._rect.size.height,n.x,-(n.y+this._sprite._rect.size.height),this._sprite._rect.size.width,this._sprite._rect.size.height)}}else{this._super();if(!this._vertexData)return;if(!this._sprite)return;var a=this._sprite.getBlendFunc(),f=a.src!=cc.BLEND_SRC||a.dst!=cc.BLEND_DST?!0:!1;f,this._type!=cc.CCPROGRESS_TIMER_RADIAL_CCW&&this._type!=cc.CCPROGRESS_TIMER_TYPE_RADIAL_CW&&(this._type==cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_LR||this._type==cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_RL||this._type==cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_BT||this._type==cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_TB),f}},_vertexFromTexCoord:function(e){var t,n=new cc.Vertex2F(0,0),r=this._sprite.getTexture();if(r){var i=Math.max(this._sprite.getQuad().br.texCoords.u,this._sprite.getQuad().bl.texCoords.u),s=Math.min(this._sprite.getQuad().br.texCoords.u,this._sprite.getQuad().bl.texCoords.u),o=Math.max(this._sprite.getQuad().tl.texCoords.v,this._sprite.getQuad().bl.texCoords.v),u=Math.min(this._sprite.getQuad().tl.texCoords.v,this._sprite.getQuad().bl.texCoords.v),a=cc.ccp(i,o),f=cc.ccp(s,u),l=cc.SizeMake(this._sprite.getQuad().br.vertices.x-this._sprite.getQuad().bl.vertices.x,this._sprite.getQuad().tl.vertices.y-this._sprite.getQuad().bl.vertices.y);t=cc.ccp(l.width*(e.x-f.x)/(a.x-f.x),l.height*(1-(e.y-f.y)/(a.y-f.y)))}else t=cc.PointZero();return n.x=t.x,n.y=t.y,n},_origin:cc.PointZero(),_drawSize:cc.SizeZero(),_drawPosition:cc.PointZero(),_startAngle:270,_endAngle:270,_updateProgress:function(){if(cc.renderContextType==cc.CANVAS){var e=this.getContentSize();switch(this._type){case cc.CCPROGRESS_TIMER_TYPE_RADIAL_CW:this._endAngle=270+3.6*this._percentage;break;case cc.CCPROGRESS_TIMER_RADIAL_CCW:this._startAngle=270-3.6*this._percentage;break;case cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_LR:this._origin=cc.PointZero(),this._drawPosition=cc.PointZero(),this._drawSize=cc.SizeMake(0|this._percentage/100*e.width,e.height);break;case cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_RL:this._drawSize=cc.SizeMake(0|this._percentage/100*e.width,e.height),this._origin=cc.ccp(e.width-this._drawSize.width|0,0),this._drawPosition=cc.ccp(e.width-this._drawSize.width,0);break;case cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_BT:this._drawSize=cc.SizeMake(e.width,0|this._percentage/100*e.height),this._drawPosition=cc.PointZero(),this._origin=cc.ccp(0,0|e.height-this._drawSize.height);break;case cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_TB:this._drawSize=cc.SizeMake(e.width,0|this._percentage/100*e.height),this._drawPosition=cc.ccp(0,e.height-this._drawSize.height|0),this._origin=cc.ccp(0,0)}}else switch(this._type){case cc.CCPROGRESS_TIMER_TYPE_RADIAL_CW:case cc.CCPROGRESS_TIMER_RADIAL_CCW:this._updateRadial();break;case cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_LR:case cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_RL:case cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_BT:case cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_TB:this._updateBar();break;default:}},_updateBar:function(){var e=this._percentage/100,t=Math.max(this._sprite.getQuad().br.texCoords.u,this._sprite.getQuad().bl.texCoords.u),n=Math.min(this._sprite.getQuad().br.texCoords.u,this._sprite.getQuad().bl.texCoords.u),r=Math.max(this._sprite.getQuad().tl.texCoords.v,this._sprite.getQuad().bl.texCoords.v),i=Math.min(this._sprite.getQuad().tl.texCoords.v,this._sprite.getQuad().bl.texCoords.v),s=cc.ccp(t,r),o=cc.ccp(n,i),u=[],a=0;if(!this._vertexData){this._vertexDataCount=cc.PROGRESS_TEXTURE_COORDS_COUNT,this._vertexData=[];for(var f=0;f<this._vertexDataCount;f++)this._vertexData[f]=cc.V2F_C4B_T2F_QuadZero();cc.Assert(this._vertexData,""),this._type==cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_LR?(this._vertexData[u[0]=0].texCoords=cc.tex2(o.x,o.y),this._vertexData[u[1]=1].texCoords=cc.tex2(o.x,s.y)):this._type==cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_RL?(this._vertexData[u[0]=2].texCoords=cc.tex2(s.x,s.y),this._vertexData[u[1]=3].texCoords=cc.tex2(s.x,o.y)):this._type==cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_BT?(this._vertexData[u[0]=1].texCoords=cc.tex2(o.x,s.y),this._vertexData[u[1]=3].texCoords=cc.tex2(s.x,s.y)):this._type==cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_TB&&(this._vertexData[u[0]=0].texCoords=cc.tex2(o.x,o.y),this._vertexData[u[1]=2].texCoords=cc.tex2(s.x,o.y)),a=u[0],this._vertexData[a].vertices=this._vertexFromTexCoord(cc.ccp(this._vertexData[a].texCoords.u,this._vertexData[a].texCoords.v)),a=u[1],this._vertexData[a].vertices=this._vertexFromTexCoord(cc.ccp(this._vertexData[a].texCoords.u,this._vertexData[a].texCoords.v));if(this._sprite.isFlipY()||this._sprite.isFlipX())this._sprite.isFlipX()&&(a=u[0],this._vertexData[a].texCoords.u=o.x+s.x-this._vertexData[a].texCoords.u,a=u[1],this._vertexData[a].texCoords.u=o.x+s.x-this._vertexData[a].texCoords.u),this._sprite.isFlipY()&&(a=u[0],this._vertexData[a].texCoords.v=o.y+s.y-this._vertexData[a].texCoords.v,a=u[1],this._vertexData[a].texCoords.v=o.y+s.y-this._vertexData[a].texCoords.v);this._updateColor()}this._type==cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_LR?(this._vertexData[u[0]=3].texCoords=cc.tex2(o.x+(s.x-o.x)*e,s.y),this._vertexData[u[1]=2].texCoords=cc.tex2(o.x+(s.x-o.x)*e,o.y)):this._type==cc.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_RL?(this._vertexData[u[0]=1].texCoords=cc.tex2(o.x+(s.x-o.x)*(1-e),o.y),this._vertexData[u[1]=0].texCoords=cc.tex2(o.x+(s.x-o.x)*(1-e),s.y)):this._type==cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_BT?(this._vertexData[u[0]=0].texCoords=cc.tex2(o.x,o.y+(s.y-o.y)*(1-e)),this._vertexData[u[1]=2].texCoords=cc.tex2(s.x,o.y+(s.y-o.y)*(1-e))):this._type==cc.CCPROGRESS_TIMER_TYPE_VERTICAL_BAR_TB&&(this._vertexData[u[0]=1].texCoords=cc.tex2(o.x,o.y+(s.y-o.y)*e),this._vertexData[u[1]=3].texCoords=cc.tex2(s.x,o.y+(s.y-o.y)*e)),a=u[0],this._vertexData[a].vertices=this._vertexFromTexCoord(cc.ccp(this._vertexData[a].texCoords.u,this._vertexData[a].texCoords.v)),a=u[1],this._vertexData[a].vertices=this._vertexFromTexCoord(cc.ccp(this._vertexData[a].texCoords.u,this._vertexData[a].texCoords.v));if(this._sprite.isFlipY()||this._sprite.isFlipX())this._sprite.isFlipX()&&(a=u[0],this._vertexData[a].texCoords.u=o.x+s.x-this._vertexData[a].texCoords.u,a=u[1],this._vertexData[a].texCoords.u=o.x+s.x-this._vertexData[a].texCoords.u),this._sprite.isFlipY()&&(a=u[0],this._vertexData[a].texCoords.v=o.y+s.y-this._vertexData[a].texCoords.v,a=u[1],this._vertexData[a].texCoords.v=o.y+s.y-this._vertexData[a].texCoords.v)},_updateRadial:function(){var e=Math.max(this._sprite.getQuad().br.texCoords.u,this._sprite.getQuad().bl.texCoords.u),t=Math.min(this._sprite.getQuad().br.texCoords.u,this._sprite.getQuad().bl.texCoords.u),n=Math.max(this._sprite.getQuad().tl.texCoords.v,this._sprite.getQuad().bl.texCoords.v),r=Math.min(this._sprite.getQuad().tl.texCoords.v,this._sprite.getQuad().bl.texCoords.v),i=cc.ccp(e,n),s=cc.ccp(t,r),o=cc.ccpAdd(s,cc.ccpCompMult(this._anchorPoint,cc.ccpSub(i,s))),u=this._percentage/100,a=2*Math.PI*(this._type==cc.CCPROGRESS_TIMER_TYPE_RADIAL_CW?u:1-u),f=cc.ccp(o.x,s.y),l=cc.ccpRotateByAngle(f,o,a),c=0,h=cc.PointZero();if(u==0)h=f,c=0;else if(u==1)h=f,c=4;else{var p=Infinity;for(var d=0;d<=cc.PROGRESS_TEXTURE_COORDS_COUNT;++d){var v=(d+(cc.PROGRESS_TEXTURE_COORDS_COUNT-1))%cc.PROGRESS_TEXTURE_COORDS_COUNT,m=cc.ccpAdd(s,cc.ccpCompMult(this._boundaryTexCoord(d%cc.PROGRESS_TEXTURE_COORDS_COUNT),cc.ccpSub(i,s))),g=cc.ccpAdd(s,cc.ccpCompMult(this._boundaryTexCoord(v),cc.ccpSub(i,s)));d==0?g=cc.ccpLerp(m,g,.5):d==4&&(m=cc.ccpLerp(m,g,.5));var y=cc.PointZero();if(cc.ccpLineIntersect(m,g,o,l,y)){if(d==0||d==4)if(!(0<=y.x&&y.x<=1))continue;y.y>=0&&y.y<p&&(p=y.y,c=d)}}h=cc.ccpAdd(o,cc.ccpMult(cc.ccpSub(l,o),p))}var b=!0;this._vertexDataCount!=c+3&&(b=!1,this._vertexData&&(this._vertexData=null,this._vertexDataCount=0));if(!this._vertexData){this._vertexDataCount=c+3,this._vertexData=[];for(var d=0;d<this._vertexDataCount;d++)this._vertexData[d]=cc.V2F_C4B_T2F_QuadZero();cc.Assert(this._vertexData,""),this._updateColor()}if(!b){this._vertexData[0].texCoords=cc.tex2(o.x,o.y),this._vertexData[0].vertices=this._vertexFromTexCoord(o),this._vertexData[1].texCoords=cc.tex2(o.x,s.y),this._vertexData[1].vertices=this._vertexFromTexCoord(cc.ccp(o.x,s.y));for(var d=0;d<c;++d){var w=cc.ccpAdd(s,cc.ccpCompMult(this._boundaryTexCoord(d),cc.ccpSub(i,s)));this._vertexData[d+2].texCoords=cc.tex2(w.x,w.y),this._vertexData[d+2].vertices=this._vertexFromTexCoord(w)}if(this._sprite.isFlipX()||this._sprite.isFlipY())for(var d=0;d<this._vertexDataCount-1;++d)this._sprite.isFlipX()&&(this._vertexData[d].texCoords.u=s.x+i.x-this._vertexData[d].texCoords.u),this._sprite.isFlipY()&&(this._vertexData[d].texCoords.v=s.y+i.y-this._vertexData[d].texCoords.v)}this._vertexData[this._vertexDataCount-1].texCoords=cc.tex2(h.x,h.y),this._vertexData[this._vertexDataCount-1].vertices=this._vertexFromTexCoord(h);if(this._sprite.isFlipX()||this._sprite.isFlipY())this._sprite.isFlipX()&&(this._vertexData[this._vertexDataCount-1].texCoords.u=s.x+i.x-this._vertexData[this._vertexDataCount-1].texCoords.u),this._sprite.isFlipY()&&(this._vertexData[this._vertexDataCount-1].texCoords.v=s.y+i.y-this._vertexData[this._vertexDataCount-1].texCoords.v)},_updateColor:function(){var e=this._sprite.getOpacity(),t=this._sprite.getColor(),n=new cc.Color4B(t.r,t.g,t.b,e);this._sprite.getTexture()instanceof HTMLImageElement||this._sprite.getTexture()instanceof HTMLCanvasElement?(n.r*=e/255,n.g*=e/255,n.b*=e/255):this._sprite.getTexture().getHasPremultipliedAlpha()&&(n.r*=e/255,n.g*=e/255,n.b*=e/255);if(this._vertexData)for(var r=0;r<this._vertexDataCount;++r)this._vertexData[r].colors=n},_boundaryTexCoord:function(e){if(e<cc.PROGRESS_TEXTURE_COORDS_COUNT)switch(this._type){case cc.CCPROGRESS_TIMER_TYPE_RADIAL_CW:return cc.ccp(cc.PROGRESS_TEXTURE_COORDS>>(e<<1)+1&1,cc.PROGRESS_TEXTURE_COORDS>>(e<<1)&1);case cc.CCPROGRESS_TIMER_RADIAL_CCW:return cc.ccp(cc.PROGRESS_TEXTURE_COORDS>>7-(e<<1)&1,cc.PROGRESS_TEXTURE_COORDS>>7-((e<<1)+1)&1);default:}return cc.PointZero()},_type:null,_percentage:0,_sprite:null,_vertexDataCount:0,_vertexData:null}),cc.ProgressTimer.create=function(e){var t=new cc.ProgressTimer;return t.initWithFile(e)?t:null},cc.ProgressTimer.createWithTexture=function(e){var t=new cc.ProgressTimer;return t.initWithTexture(e)?t:null};var cc=cc=cc||{};cc.GridBase=cc.Class.extend({_active:null,_reuseGrid:null,_gridSize:null,_texture:null,_step:new cc.Point,_grabber:null,_isTextureFlipped:null,isActive:function(){return this._active},setActive:function(e){this._active=e;if(!e){var t=cc.Director.sharedDirector(),n=t.getProjection();t.setProjection(n)}},getReuseGrid:function(){return this._reuseGrid},setReuseGrid:function(e){this._reuseGrid=e},getGridSize:function(){return this._gridSize},setGridSize:function(e){this._gridSize.x=parseInt(e.x),this._gridSize.y=parseInt(e.y)},getStep:function(){return this._step},setStep:function(e){this._step=e},isTextureFlipped:function(){return this._isTextureFlipped},setIsTextureFlipped:function(e){this._isTextureFlipped!=e&&(this._isTextureFlipped=e,this.calculateVertexPoints())},initWithSize:function(e,t,n){var r=arguments.length;if(r=1){var i=cc.Director.sharedDirector(),s=i.getWinSizeInPixels(),o=cc.NextPOT(s.width),u=cc.NextPOT(s.height),a=cc.CCTEXTURE_2D_PIXEL_FORMAT_RGBA8888,f=new cc.Texture2D;f.initWithData(a,o,u,s);if(!f)return cc.Log("cocos2d: CCGrid: error creating texture"),!1;t=f,n=!1}var l=!0;this._active=!1,this._reuseGrid=0,this._gridSize=e,this._texture=t,this._isTextureFlipped=n;var c=this._texture.getContentSizeInPixels();return this._step.x=c.width/this._gridSize.x,this._step.y=c.height/this._gridSize.y,this._grabber=new cc.Grabber,this._grabber?this._grabber.grab(this._texture):l=!1,this.calculateVertexPoints(),l},beforeDraw:function(){this.set2DProjection(),this._grabber.beforeRender(this._texture)},afterDraw:function(e){this._grabber.afterRender(this._texture),this.set3DProjection(),this._applyLandscape();if(e.getCamera().getDirty()){var t=e.getAnchorPointInPixels();e.getCamera().locate()}cc.Director.sharedDirector().setProjection(cc.Director.sharedDirector().getProjection()),cc.Director.sharedDirector().applyOrientation(),this.blit()},blit:function(){cc.Assert(0,"")},reuse:function(){cc.Assert(0,"")},calculateVertexPoints:function(){cc.Assert(0,"")},set2DProjection:function(){var e=cc.Director.sharedDirector().getWinSizeInPixels()},set3DProjection:function(){var e=cc.Director.sharedDirector().getDisplaySizeInPixels()},_applyLandscape:function(){var e=cc.Director.sharedDirector(),t=e.getDisplaySizeInPixels(),n=t.width/2,r=t.height/2,i=e.getDeviceOrientation();switch(i){case cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT:break;case cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT:break;case cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN:break;default:}}}),cc.GridBase.create=function(){var e=new cc.GridBase;return e},cc.Grid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,vertex:function(e){var t=(e.x*(this._gridSize.y+1)+e.y)*3,n=this._vertices,r=new cc.Vertex3F(n[t],n[t+1],n[t+2]);return r},originalVertex:function(e){var t=(e.x*(this._gridSize.y+1)+e.y)*3,n=this._originalVertices,r=new cc.Vertex3F(n[t],n[t+1],n[t+2]);return r},setVertex:function(e,t){var n=(e.x*(this._gridSize.y+1)+e.y)*3,r=this._vertices;r[n]=t.x,r[n+1]=t.y,r[n+2]=t.z},blit:function(){var e=this._gridSize.x*this._gridSize.y},reuse:function(){this._reuseGrid>0&&--this._reuseGrid},calculateVertexPoints:function(){var e=this._texture.getPixelsWide(),t=this._texture.getPixelsHigh(),n=this._texture.getContentSizeInPixels().height,r=this._gridSize.x*this._gridSize.y;this._vertices=[],this._originalVertices=[],this._texCoordinates=[],this._indices=[];var i=this._vertices,s=this._texCoordinates,o=this._indices,u,a;for(u=0;u<this._gridSize.x;u++)for(a=0;a<this._gridSize.y;a++){var f=u*this._step.x,l=f+this._step.x,c=a*this._step.y,h=c+this._step.y;i[u*a]=f,i[u*a+1]=c,i[u*a+2]=0,i[u*a+3]=l,i[u*a+4]=c,i[u*a+5]=0,i[u*a+6]=f,i[u*a+7]=h,i[u*a+8]=0,i[u*a+9]=l,i[u*a+10]=h,i[u*a+11]=0;var p=c,d=h;this._isTextureFlipped&&(p=n-c,d=n-h),s[u*a+12]=f/e,s[u*a+13]=p/t,s[u*a+14]=l/e,s[u*a+15]=p/t,s[u*a+16]=f/e,s[u*a+17]=d/t,s[u*a+18]=l/e,s[u*a+19]=d/t}for(u=0;u<r;u++)o[u*6+0]=u*4+0,o[u*6+1]=u*4+1,o[u*6+2]=u*4+2,o[u*6+3]=u*4+1,o[u*6+4]=u*4+2,o[u*6+5]=u*4+3}}),cc.Grid3D.create=function(e,t,n){},cc.TiledGrid3D=cc.GridBase.extend({_texCoordinates:null,_vertices:null,_originalVertices:null,_indices:null,tile:function(e){var t=(this._gridSize.y*e.x+e.y)*4*3,n=this._vertices,r=new cc.Quad3;return r},originalTile:function(e){var t=(this._gridSize.y*e.x+e.y)*4*3,n=this._originalVertices,r=new cc.Quad3(n[t],n[t+1],n[t+2],n[t+3]);return r},setTile:function(e,t){var n=(this._gridSize.y*e.x+e.y)*4*3,r=this._vertices;r[n]=t},blit:function(){var e=this._gridSize.x*this._gridSize.y},reuse:function(){if(this._reuseGrid>0){var e=this._gridSize.x*this._gridSize.y;for(var t=0,n=e.length*12;t<n;t++)this._originalVertices.push(this._vertices[t]);--this._reuseGrid}},calculateVertexPoints:function(){var e=this._texture.getPixelsWide(),t=this._texture.getPixelsHigh(),n=this._texture.getContentSizeInPixels().height,r=this._gridSize.x*this._gridSize.y;this._vertices=[],this._originalVertices=[],this._texCoordinates=[],this._indices=[];var i=this._vertices,s=this._texCoordinates,o=this._indices,u,a;for(u=0;u<this._gridSize.x;u++)for(a=0;a<this._gridSize.y;a++){var f=u*this._step.x,l=f+this._step.x,c=a*this._step.y,h=c+this._step.y;i[u*a]=f,i[u*a+1]=c,i[u*a+2]=0,i[u*a+3]=l,i[u*a+4]=c,i[u*a+5]=0,i[u*a+6]=f,i[u*a+7]=h,i[u*a+8]=0,i[u*a+9]=l,i[u*a+10]=h,i[u*a+11]=0;var p=c,d=h;this._isTextureFlipped&&(p=n-c,d=n-h),s[u*a+12]=f/e,s[u*a+13]=p/t,s[u*a+14]=l/e,s[u*a+15]=p/t,s[u*a+16]=f/e,s[u*a+17]=d/t,s[u*a+18]=l/e,s[u*a+19]=d/t}for(u=0;u<r;u++)o[u*6+0]=u*4+0,o[u*6+1]=u*4+1,o[u*6+2]=u*4+2,o[u*6+3]=u*4+1,o[u*6+4]=u*4+2,o[u*6+5]=u*4+3;for(var v=0,m=r.length*12;v<m;v++)this._originalVertices.push(this._vertices[v])}}),cc.TiledGrid3D.create=function(e,t,n){var r=new cc.TiledGrid3D;return r.initWithSize(e,t,n),r};var cc=cc=cc||{};cc.Grabber=cc.Class.extend({_fbo:0,_oldFBO:0,_glesVersion:null,ctor:function(){},grab:function(e){},beforeRender:function(e){},afterRender:function(e){}}),cc.CCACTION_TAG_INVALID=-1,cc.Action=cc.Class.extend({_originalTarget:null,_target:null,_tag:cc.CCACTION_TAG_INVALID,description:function(){return"<cc.Action | Tag = "+this._tag+">"},copyWithZone:function(e){return this.copy()},copy:function(){return cc.clone(this)},isDone:function(){return!0},startWithTarget:function(e){this._originalTarget=e,this._target=e},stop:function(){this._target=null},step:function(e){cc.Log("[Action step]. override me")},update:function(e){cc.Log("[Action update]. override me")},getTarget:function(){return this._target},setTarget:function(e){this._target=e},getOriginalTarget:function(){return this._originalTarget},setOriginalTarget:function(e){this._originalTarget=e},getTag:function(){return this._tag},setTag:function(e){this._tag=e}}),cc.Action.create=function(){var e=new cc.Action;return e},cc.FiniteTimeAction=cc.Action.extend({_duration:0,getDuration:function(){return this._duration},setDuration:function(e){this._duration=e},reverse:function(){return cc.Log("cocos2d: FiniteTimeAction#reverse: Implement me"),null}}),cc.Speed=cc.Action.extend({_speed:0,_innerAction:null,getSpeed:function(){return this._speed},setSpeed:function(e){this._speed=e},initWithAction:function(e,t){return cc.Assert(e!=null,""),this._innerAction=e,this._speed=t,!0},startWithTarget:function(e){this._super(e),this._innerAction.startWithTarget(e)},stop:function(){this._innerAction.stop(),cc.Action.stop()},step:function(e){this._innerAction.step(e*this._speed)},isDone:function(){return this._innerAction.isDone()},reverse:function(){return cc.Speed.create(this._innerAction.reverse(),this._speed)},setInnerAction:function(e){this._innerAction!=e&&(this._innerAction=e)},getInnerAction:function(){return this._innerAction}}),cc.Speed.create=function(e,t){var n=new cc.Speed;return n&&n.initWithAction(e,t)?n:null},cc.Follow=cc.Action.extend({isBoundarySet:function(){return this._boundarySet},setBoudarySet:function(e){this._boundarySet=e},initWithTarget:function(e,t){cc.Assert(e!=null,""),this._followedNode=e,this._boundarySet=!1,this._boundaryFullyCovered=!1;var n=cc.Director.sharedDirector().getWinSize();return this._fullScreenSize=cc.PointMake(n.width,n.height),this._halfScreenSize=cc.ccpMult(this._fullScreenSize,.5),t&&(this.leftBoundary=-(t.origin.x+t.size.width-this._fullScreenSize.x),this.rightBoundary=-t.origin.x,this.topBoundary=-t.origin.y,this.bottomBoundary=-(t.origin.y+t.size.height-this._fullScreenSize.y),this.rightBoundary<this.leftBoundary&&(this.rightBoundary=this.leftBoundary=(this.leftBoundary+this.rightBoundary)/2),this.topBoundary<this.bottomBoundary&&(this.topBoundary=this.bottomBoundary=(this.topBoundary+this.bottomBoundary)/2),this.topBoundary==this.bottomBoundary&&this.leftBoundary==this.rightBoundary&&(this._boundaryFullyCovered=!0)),!0},step:function(e){if(this._boundarySet){if(this._boundaryFullyCovered)return;var t=cc.ccpSub(this._halfScreenSize,this._followedNode.getPosition());this._target.setPosition(cc.ccp(cc.clampf(t.x,this.leftBoundary,this.rightBoundary),cc.clampf(t.y,this.bottomBoundary,this.topBoundary)))}else this._target.setPosition(cc.ccpSub(this._halfScreenSize,this._followedNode.getPosition()))},isDone:function(){return!this._followedNode.getIsRunning()},stop:function(){this._target=null,cc.Action.stop()},_followedNode:null,_boundarySet:!1,_boundaryFullyCovered:!1,_halfScreenSize:null,_fullScreenSize:null,leftBoundary:0,rightBoundary:0,topBoundary:0,bottomBoundary:0}),cc.Follow.create=function(e,t){var n=new cc.Follow;return t!=null&&n&&n.initWithTarget(e,t)?n:n&&n.initWithTarget(e)?n:null},cc.ActionInterval=cc.FiniteTimeAction.extend({_elapsed:0,_firstTick:!1,getElapsed:function(){return this._elapsed},initWithDuration:function(e){return this._duration=e==0?cc.FLT_EPSILON:e,this._elapsed=0,this._firstTick=!0,!0},isDone:function(){return this._elapsed>=this._duration},step:function(e){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=e,this.update(1>this._elapsed/this._duration?this._elapsed/this._duration:1)},startWithTarget:function(e){this._super(e),this._elapsed=0,this._firstTick=!0},reverse:function(){return null},setAmplitudeRate:function(e){cc.Assert(0,"Actioninterval setAmplitudeRate")},getAmplitudeRate:function(){return cc.Assert(0,"Actioninterval getAmplitudeRate"),0}}),cc.ActionInterval.create=function(e){var t=new cc.ActionInterval;return t.initWithDuration(e),t},cc.Sequence=cc.ActionInterval.extend({_actions:null,_split:null,_last:0,ctor:function(){this._actions=[]},initOneTwo:function(e,t){cc.Assert(e!=null,"Sequence.initOneTwo"),cc.Assert(t!=null,"Sequence.initOneTwo");var n=e.getDuration(),r=t.getDuration();if(isNaN(n)||isNaN(r))console.log(e),console.log(t);var i=e.getDuration()+t.getDuration();return this.initWithDuration(i),this._actions[0]=e,this._actions[1]=t,!0},startWithTarget:function(e){this._super(e),this._split=this._actions[0].getDuration()/this._duration,this._last=-1},stop:function(){this._actions[0].stop(),this._actions[1].stop(),this._super()},update:function(e){var t=0,n=0;e>=this._split?(t=1,n=this._split==1?1:(e-this._split)/(1-this._split)):(t=0,n=this._split!=0?e/this._split:1),this._last==-1&&t==1&&(this._actions[0].startWithTarget(this._target),this._actions[0].update(1),this._actions[0].stop()),this._last!=t&&(this._last!=-1&&(this._actions[this._last].update(1),this._actions[this._last].stop()),this._actions[t].startWithTarget(this._target)),this._actions[t].update(n),this._last=t},reverse:function(){return cc.Sequence._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse())}}),cc.Sequence.create=function(e){var t=typeof e=="Array"?e:arguments,n=t[0];for(var r=1;r<t.length;r++)t[r]!=null&&(n=cc.Sequence._actionOneTwo(n,t[r]));return n},cc.Sequence._actionOneTwo=function(e,t){var n=new cc.Sequence;return n.initOneTwo(e,t),n},cc.Repeat=cc.ActionInterval.extend({_times:0,_total:0,_innerAction:null,initWithAction:function(e,t){var n=e.getDuration()*t;return this.initWithDuration(n)?(this._times=t,this._innerAction=e,this._total=0,!0):!1},startWithTarget:function(e){this._total=0,this._super(e),this._innerAction.startWithTarget(e)},stop:function(){this._innerAction.stop(),this._super()},update:function(e){var t=e*this._times;if(t>this._total+1)this._innerAction.update(1),this._total++,this._innerAction.stop(),this._innerAction.startWithTarget(this._target),this._total==this._times?this._innerAction.update(0):this._innerAction.update(t-this._total);else{var n=t%1;e==1&&(n=1,this._total++),this._innerAction.update(n>1?1:n)}},isDone:function(){return this._total==this._times},reverse:function(){return cc.Repeat.create(this._innerAction.reverse(),this._times)},setInnerAction:function(e){this._innerAction!=e&&(this._innerAction=e)},getInnerAction:function(){return this._innerAction}}),cc.Repeat.create=function(e,t){var n=new cc.Repeat;return n.initWithAction(e,t),n},cc.RepeatForever=cc.ActionInterval.extend({_innerAction:null,initWithAction:function(e){return cc.Assert(e!=null,""),this._innerAction=e,!0},startWithTarget:function(e){this._super(e),this._innerAction.startWithTarget(e)},step:function(e){this._innerAction.step(e);if(this._innerAction.isDone()){var t=e+this._innerAction.getDuration()-this._innerAction.getElapsed();this._innerAction.startWithTarget(this._target),this._innerAction.step(t)}},isDone:function(){return!1},reverse:function(){return cc.RepeatForever.create(this._innerAction.reverse())},setInnerAction:function(e){this._innerAction!=e&&(this._innerAction=e)},getInnerAction:function(){return this._innerAction}}),cc.RepeatForever.create=function(e){var t=new cc.RepeatForever;return t&&t.initWithAction(e)?t:null},cc.Spawn=cc.ActionInterval.extend({initOneTwo:function(e,t){cc.Assert(e!=null,"no action1"),cc.Assert(t!=null,"no action2");var n=!1,r=e.getDuration(),i=t.getDuration();return this.initWithDuration(Math.max(r,i))&&(this._one=e,this._two=t,r>i?this._two=cc.Sequence._actionOneTwo(t,cc.DelayTime.create(r-i)):r<i&&(this._one=cc.Sequence._actionOneTwo(e,cc.DelayTime.create(i-r))),n=!0),n},startWithTarget:function(e){this._super(e),this._one.startWithTarget(e),this._two.startWithTarget(e)},stop:function(){this._one.stop(),this._two.stop(),this._super()},update:function(e){this._one&&this._one.update(e),this._two&&this._two.update(e)},reverse:function(){return cc.Spawn._actionOneTwo(this._one.reverse(),this._two.reverse())},_one:null,_two:null}),cc.Spawn.create=function(e){var t=typeof e=="Array"?e:arguments,n=t[0];for(var r=1;r<t.length;r++)t[r]!=null&&(n=this._actionOneTwo(n,t[r]));return n},cc.Spawn._actionOneTwo=function(e,t){var n=new cc.Spawn;return n.initOneTwo(e,t),n},cc.RotateTo=cc.ActionInterval.extend({_dstAngle:0,_startAngle:0,_diffAngle:0,initWithDuration:function(e,t){return this._super(e)?(this._dstAngle=t,!0):!1},startWithTarget:function(e){this._super(e),this._startAngle=e.getRotation(),this._startAngle>0?this._startAngle=this._startAngle%360:this._startAngle=this._startAngle%360,this._diffAngle=this._dstAngle-this._startAngle,this._diffAngle>180&&(this._diffAngle-=360),this._diffAngle<-180&&(this._diffAngle+=360)},reverse:function(){cc.Assert(0,"RotateTo reverse not implemented")},update:function(e){this._target&&this._target.setRotation(this._startAngle+this._diffAngle*e)}}),cc.RotateTo.create=function(e,t){var n=new cc.RotateTo;return n.initWithDuration(e,t),n},cc.RotateBy=cc.ActionInterval.extend({_angle:0,_startAngle:0,initWithDuration:function(e,t){return this._super(e)?(this._angle=t,!0):!1},startWithTarget:function(e){this._super(e),this._startAngle=e.getRotation()},update:function(e){this._target&&this._target.setRotation(this._startAngle+this._angle*e)},reverse:function(){return cc.RotateBy.create(this._duration,-this._angle)}}),cc.RotateBy.create=function(e,t){var n=new cc.RotateBy;return n.initWithDuration(e,t),n},cc.MoveTo=cc.ActionInterval.extend({initWithDuration:function(e,t){return this._super(e)?(this._endPosition=t,!0):!1},startWithTarget:function(e){this._super(e),this._startPosition=e.getPosition(),this._delta=cc.ccpSub(this._endPosition,this._startPosition)},update:function(e){this._target&&this._target.setPosition(cc.ccp(this._startPosition.x+this._delta.x*e,this._startPosition.y+this._delta.y*e))},reverse:function(){cc.Assert(0,"moveto reverse is not implemented")},_endPosition:new cc.Point,_startPosition:new cc.Point,_delta:new cc.Point}),cc.MoveTo.create=function(e,t){var n=new cc.MoveTo;return n.initWithDuration(e,t),n},cc.MoveBy=cc.MoveTo.extend({initWithDuration:function(e,t){return this._super(e,t)?(this._delta=t,!0):!1},startWithTarget:function(e){var t=this._delta;this._super(e),this._delta=t},reverse:function(){return cc.MoveBy.create(this._duration,cc.ccp(-this._delta.x,-this._delta.y))}}),cc.MoveBy.create=function(e,t){var n=new cc.MoveBy;return n.initWithDuration(e,t),n},cc.SkewTo=cc.ActionInterval.extend({initWithDuration:function(e,t,n){var r=!1;return this._super(e)&&(this._endSkewX=t,this._endSkewY=n,r=!0),r},startWithTarget:function(e){this._super(e),this._startSkewX=e.getSkewX(),this._startSkewX>0?this._startSkewX=this._startSkewX%180:this._startSkewX=this._startSkewX%-180,this._deltaX=this._endSkewX-this._startSkewX,this._deltaX>180&&(this._deltaX-=360),this._deltaX<-180&&(this._deltaX+=360),this._startSkewY=e.getSkewY(),this._startSkewY>0?this._startSkewY=this._startSkewY%360:this._startSkewY=this._startSkewY%-360,this._deltaY=this._endSkewY-this._startSkewY,this._deltaY>180&&(this._deltaY-=360),this._deltaY<-180&&(this._deltaY+=360)},update:function(e){this._target.setSkewX(this._startSkewX+this._deltaX*e),this._target.setSkewY(this._startSkewY+this._deltaY*e)},_skewX:0,_skewY:0,_startSkewX:0,_startSkewY:0,_endSkewX:0,_endSkewY:0,_deltaX:0,_deltaY:0}),cc.SkewTo.create=function(e,t,n){var r=new cc.SkewTo;return r&&r.initWithDuration(e,t,n),r},cc.SkewBy=cc.SkewTo.extend({initWithDuration:function(e,t,n){var r=!1;return this._super(e,t,n)&&(this._skewX=t,this._skewY=n,r=!0),r},startWithTarget:function(e){this._super(e),this._deltaX=this._skewX,this._deltaY=this._skewY,this._endSkewX=this._startSkewX+this._deltaX,this._endSkewY=this._startSkewY+this._deltaY},reverse:function(){return cc.SkewBy.create(this._duration,-this._skewX,-this._skewY)}}),cc.SkewBy.create=function(e,t,n){var r=new cc.SkewBy;return r&&r.initWithDuration(e,t,n),r},cc.JumpBy=cc.ActionInterval.extend({initWithDuration:function(e,t,n,r){return this._super(e)?(this._delta=t,this._height=n,this._jumps=r,!0):!1},startWithTarget:function(e){this._super(e),this._startPosition=e.getPosition()},update:function(e){if(this._target){var t=e*this._jumps%1,n=this._height*4*t*(1-t);n+=this._delta.y*e;var r=this._delta.x*e;this._target.setPosition(cc.ccp(this._startPosition.x+r,this._startPosition.y+n))}},reverse:function(){return cc.JumpBy.create(this._duration,cc.ccp(-this._delta.x,-this._delta.y),this._height,this._jumps)},_startPosition:new cc.Point,_delta:new cc.Point,_height:0,_jumps:0}),cc.JumpBy.create=function(e,t,n,r){var i=new cc.JumpBy;return i.initWithDuration(e,t,n,r),i},cc.JumpTo=cc.JumpBy.extend({startWithTarget:function(e){this._super(e),this._delta=cc.ccp(this._delta.x-this._startPosition.x,this._delta.y-this._startPosition.y)}}),cc.JumpTo.create=function(e,t,n,r){var i=new cc.JumpTo;return i.initWithDuration(e,t,n,r),i},cc.BezierConfig=cc.Class.extend({ctor:function(){this.endPosition=new cc.Point,this.controlPoint_1=new cc.Point,this.controlPoint_2=new cc.Point}}),cc.bezierat=function(e,t,n,r,i){return Math.pow(1-i,3)*e+3*i*Math.pow(1-i,2)*t+3*Math.pow(i,2)*(1-i)*n+Math.pow(i,3)*r},cc.BezierBy=cc.ActionInterval.extend({initWithDuration:function(e,t){return this._super(e)?(this._config=t,!0):!1},startWithTarget:function(e){this._super(e),this._startPosition=e.getPosition()},update:function(e){if(this._target){var t=0,n=this._config.controlPoint_1.x,r=this._config.controlPoint_2.x,i=this._config.endPosition.x,s=0,o=this._config.controlPoint_1.y,u=this._config.controlPoint_2.y,a=this._config.endPosition.y,f=cc.bezierat(t,n,r,i,e),l=cc.bezierat(s,o,u,a,e);this._target.setPosition(cc.ccpAdd(this._startPosition,cc.ccp(f,l)))}},reverse:function(){var e=new cc.BezierConfig;e.endPosition=cc.ccpNeg(this._config.endPosition),e.controlPoint_1=cc.ccpAdd(this._config.controlPoint_2,cc.ccpNeg(this._config.endPosition)),e.controlPoint_2=cc.ccpAdd(this._config.controlPoint_1,cc.ccpNeg(this._config.endPosition));var t=cc.BezierBy.create(this._duration,e);return t},ctor:function(){this._config=new cc.BezierConfig,this._startPosition=new cc.Point}}),cc.BezierBy.create=function(e,t){var n=new cc.BezierBy;return n.initWithDuration(e,t),n},cc.BezierTo=cc.BezierBy.extend({startWithTarget:function(e){this._super(e),this._config.controlPoint_1=cc.ccpSub(this._config.controlPoint_1,this._startPosition),this._config.controlPoint_2=cc.ccpSub(this._config.controlPoint_2,this._startPosition),this._config.endPosition=cc.ccpSub(this._config.endPosition,this._startPosition)}}),cc.BezierTo.create=function(e,t){var n=new cc.BezierTo;return n.initWithDuration(e,t),n},cc.ScaleTo=cc.ActionInterval.extend({initWithDuration:function(e,t,n){return this._super(e)?(this._endScaleX=t,this._endScaleY=n!=null?n:t,!0):!1},startWithTarget:function(e){this._super(e),this._startScaleX=e.getScaleX(),this._startScaleY=e.getScaleY(),this._deltaX=this._endScaleX-this._startScaleX,this._deltaY=this._endScaleY-this._startScaleY},update:function(e){this._target&&(this._target.setScaleX(this._startScaleX+this._deltaX*e),this._target.setScaleY(this._startScaleY+this._deltaY*e))},_scaleX:1,_scaleY:1,_startScaleX:1,_startScaleY:1,_endScaleX:0,_endScaleY:0,_deltaX:0,_deltaY:0}),cc.ScaleTo.create=function(e,t,n){var r=new cc.ScaleTo;return n?r.initWithDuration(e,t,n):r.initWithDuration(e,t),r},cc.ScaleBy=cc.ScaleTo.extend({startWithTarget:function(e){this._super(e),this._deltaX=this._startScaleX*this._endScaleX-this._startScaleX,this._deltaY=this._startScaleY*this._endScaleY-this._startScaleY},reverse:function(){return cc.ScaleBy.create(this._duration,1/this._endScaleX,1/this._endScaleY)}}),cc.ScaleBy.create=function(e,t,n){var r=new cc.ScaleBy;return arguments.length==3?r.initWithDuration(e,t,n):r.initWithDuration(e,t),r},cc.Blink=cc.ActionInterval.extend({initWithDuration:function(e,t){return this._super(e)?(this._times=t,!0):!1},update:function(e){if(this._target&&!this.isDone()){var t=1/this._times,n=e%t;this._target.setIsVisible(n>t/2?!0:!1)}},reverse:function(){return cc.Blink.create(this._duration,this._times)},_times:0}),cc.Blink.create=function(e,t){var n=new cc.Blink;return n.initWithDuration(e,t),n},cc.FadeIn=cc.ActionInterval.extend({update:function(e){this._target.setOpacity(255*e)},reverse:function(){return cc.FadeOut.create(this._duration)}}),cc.FadeIn.create=function(e){var t=new cc.FadeIn;return t.initWithDuration(e),t},cc.FadeOut=cc.ActionInterval.extend({update:function(e){this._target.setOpacity(255*(1-e))},reverse:function(){return cc.FadeIn.create(this._duration)}}),cc.FadeOut.create=function(e){var t=new cc.FadeOut;return t.initWithDuration(e),t},cc.FadeTo=cc.ActionInterval.extend({initWithDuration:function(e,t){return this._super(e)?(this._toOpacity=t,!0):!1},update:function(e){this._target.setOpacity(this._fromOpacity+(this._toOpacity-this._fromOpacity)*e)},startWithTarget:function(e){this._super(e),this._fromOpacity=e.getOpacity()},_toOpacity:"",_fromOpacity:""}),cc.FadeTo.create=function(e,t){var n=new cc.FadeTo;return n.initWithDuration(e,t),n},cc.TintTo=cc.ActionInterval.extend({initWithDuration:function(e,t,n,r){return this._super(e)?(this._to=cc.ccc3(t,n,r),!0):!1},startWithTarget:function(e){this._super(e),this._from=this._target.getColor()},update:function(e){this._target.setColor(cc.ccc3(this._from.r+(this._to.r-this._from.r)*e,this._from.g+(this._to.g-this._from.g)*e,this._from.b+(this._to.b-this._from.b)*e))},_to:new cc.Color3B,_from:new cc.Color3B}),cc.TintTo.create=function(e,t,n,r){var i=new cc.TintTo;return i.initWithDuration(e,t,n,r),i},cc.TintBy=cc.ActionInterval.extend({initWithDuration:function(e,t,n,r){return this._super(e)?(this._deltaR=t,this._deltaG=n,this._deltaB=r,!0):!1},startWithTarget:function(e){this._super(e);var t=e.getColor();this._fromR=t.r,this._fromG=t.g,this._fromB=t.b},update:function(e){this._target.setColor(cc.ccc3(this._fromR+this._deltaR*e,this._fromG+this._deltaG*e,this._fromB+this._deltaB*e))},reverse:function(){return cc.TintBy.create(this._duration,-this._deltaR,-this._deltaG,-this._deltaB)},_deltaR:0,_deltaG:0,_deltaB:0,_fromR:0,_fromG:0,_fromB:0}),cc.TintBy.create=function(e,t,n,r){var i=new cc.TintBy;return i.initWithDuration(e,t,n,r),i},cc.DelayTime=cc.ActionInterval.extend({update:function(e){},reverse:function(){return cc.DelayTime.create(this._duration)}}),cc.DelayTime.create=function(e){var t=new cc.DelayTime;return t.initWithDuration(e),t},cc.ReverseTime=cc.ActionInterval.extend({initWithAction:function(e){return cc.Assert(e!=null,""),cc.Assert(e!=this._other,""),this._super(e.getDuration())?(this._other=e,!0):!1},startWithTarget:function(e){this._super(e),this._other.startWithTarget(e)},update:function(e){this._other&&this._other.update(1-e)},reverse:function(){return this._other.copy()},stop:function(){this._other.stop(),this._super()},_other:null}),cc.ReverseTime.create=function(e){var t=new cc.ReverseTime;return t.initWithAction(e),t},cc.Animate=cc.ActionInterval.extend({_animation:null,_origFrame:null,_restoreOriginalFrame:!1,getAnimation:function(){return this._animation},setAnimation:function(e){this._animation=e},initWithAnimation:function(e,t){return cc.Assert(e!=null,""),this.initWithDuration(e.getFrames().length*e.getDelay(),null,null,!0)?(this._restoreOriginalFrame=t,this._animation=e,this._origFrame=null,!0):!1},initWithDuration:function(e,t,n,r){return r?this._super(e):(cc.Assert(t!=null,""),this._super(e)?(this._restoreOriginalFrame=n,this._animation=t,this._origFrame=null,!0):!1)},startWithTarget:function(e){this._super(e),this._restoreOriginalFrame&&(this._origFrame=e.displayedFrame())},update:function(e){var t=this._animation.getFrames(),n=t.length,r=0|e*n;r>=n&&(r=n-1);var i=this._target;i.isFrameDisplayed(t[r])||i.setDisplayFrame(t[r])},reverse:function(){var e=cc.Animation.create(this._animation.getFrames().reverse(),this._animation.getDelay());return cc.Animate.create(this._duration,e,this._restoreOriginalFrame)},stop:function(){this._restoreOriginalFrame&&this._target&&this._target.setDisplayFrame(this._origFrame),this._super()}}),cc.Animate.create=function(){var e=new cc.Animate;return arguments.length==3?e.initWithDuration(arguments[0],arguments[1],arguments[2]):e.initWithAnimation(arguments[0],arguments[1]),e},cc.ActionInstant=cc.FiniteTimeAction.extend({isDone:function(){return!0},step:function(e){this.update(1)},update:function(e){}}),cc.Show=cc.ActionInstant.extend({startWithTarget:function(e){this._super(e),e.setIsVisible(!0)},reverse:function(){return cc.Hide.create.call(this)}}),cc.Show.create=function(){return new cc.Show},cc.Hide=cc.ActionInstant.extend({startWithTarget:function(e){this._super(e),e.setIsVisible(!1)},reverse:function(){return cc.Show.create.call(this)}}),cc.Hide.create=function(){return new cc.Hide},cc.ToggleVisibility=cc.ActionInstant.extend({startWithTarget:function(e){this._super(),e.setIsVisible(!e.getIsVisible())},reverse:function(){return new cc.ToggleVisibility}}),cc.ToggleVisibility.create=function(){return new cc.ToggleVisibility},cc.FlipX=cc.ActionInstant.extend({initWithFlipX:function(e){return this._flipX=e,!0},startWithTarget:function(e){this._super(),e.setFlipX(this._flipX)},reverse:function(){return this.initWithFlipX(!this._flipX),this},_flipX:!1}),cc.FlipX.create=function(e){var t=new cc.FlipX;if(t.initWithFlipX(e))return t},cc.FlipY=cc.ActionInstant.extend({initWithFlipY:function(e){return this._flipY=e,!0},startWithTarget:function(e){this._super(),e.setFlipY(this._flipY)},reverse:function(){return this.actionWithFlipY(!this._flipY)},_flipY:!1}),cc.FlipY.create=function(e){var t=new cc.FlipY;if(t.initWithFlipY(e))return t},cc.Place=cc.ActionInstant.extend({initWithPosition:function(e){return this._position=e,!0},startWithTarget:function(e){this._super(e),this._target.setPosition(this._position)}}),cc.Place.create=function(e){var t=new cc.Place;return t.initWithPosition(e),t},cc.CallFunc=cc.ActionInstant.extend({initWithTarget:function(e,t,n){return this._data=n||null,this._callFunc=t||null,this._selectorTarget=e||null,!0},execute:function(){this._callFunc!=null&&this._callFunc.call(this._selectorTarget,this._target,this._data)},startWithTarget:function(e){this._super(e),this.execute()},getTargetCallback:function(){return this._selectorTarget},setTargetCallback:function(e){e!=this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=e)},_selectorTarget:null,_callFunc:null}),cc.CallFunc.create=function(e,t,n){var r=new cc.CallFunc;return r&&r.initWithTarget(e,t,n)?(r._callFunc=t,r):null},cc.HashElement=cc.Class.extend({actions:null,target:null,actionIndex:0,currentAction:null,currentActionSalvaged:!1,paused:!1,hh:null,ctor:function(){this.actions=[]}}),cc.ActionManager=cc.Class.extend({_targets:null,_currentTarget:null,_currentTargetSalvaged:!1,_searchElementByTarget:function(e,t){for(var n=0;n<e.length;n++)if(t==e[n].target)return e[n];return null},ctor:function(){cc.Assert(cc.sharedManager==null,""),this._targets=[]},init:function(){return cc.Scheduler.sharedScheduler().scheduleUpdateForTarget(this,0,!1),!0},selTarget:null,addAction:function(e,t,n){cc.Assert(e!=null,"no action"),cc.Assert(t!=null,"");var r=this._searchElementByTarget(this._targets,t);r||(r=new cc.HashElement,r.paused=n,r.target=t,r.id=t.id||"no id",this.selTarget=r,this._targets.push(r)),this._actionAllocWithHashElement(r),cc.Assert(r.actions.indexOf(e)==-1,"ActionManager.addAction(),"),r.actions.push(e),e.startWithTarget(t)},removeAllActions:function(){for(var e=0;e<this._targets.length;e++){var t=this._targets[e];t&&this.removeAllActionsFromTarget(t.target)}},removeAllActionsFromTarget:function(e){if(e==null)return;var t=this._searchElementByTarget(this._targets,e);t&&(t.currentAction in t.actions&&!t.currentActionSalvaged&&(t.currentActionSalvaged=!0),t.actions=[],this._currentTarget==t?this._currentTargetSalvaged=!0:this._deleteHashElement(t))},removeAction:function(e){if(e==null)return;var t=e.getOriginalTarget(),n=this._searchElementByTarget(this._targets,t);if(n){for(var r=0;r<n.actions.length;r++)if(n.actions[r]==e){n.actions.splice(r,1);break}}else cc.Log("cocos2d: removeAction: Target not found")},removeActionByTag:function(e,t){cc.Assert(e!=cc.CCACTION_TAG_INVALID,""),cc.Assert(t!=null,"");var n=this._searchElementByTarget(this._targets,t);if(n){var r=n.actions.length;for(var i=0;i<r;++i){var s=n.actions[i];if(s&&s.getTag()==e&&s.getOriginalTarget()==t){this._removeActionAtIndex(i,n);break}}}},getActionByTag:function(e,t){cc.Assert(e!=cc.CCACTION_TAG_INVALID,"");var n=this._searchElementByTarget(this._targets,t);if(n&&n.actions!=null)for(var r=0;r<n.actions.length;++r){var i=n.actions[r];if(i&&i.getTag()==e)return i}return null},numberOfRunningActionsInTarget:function(e){var t=this._searchElementByTarget(this._targets,e);return t?t.actions?t.actions.length:0:0},pauseTarget:function(e){var t=this._searchElementByTarget(this._targets,e);t&&(t.paused=!0)},resumeTarget:function(e){var t=this._searchElementByTarget(this._targets,e);t&&(t.paused=!1)},purgeSharedManager:function(){cc.Scheduler.sharedScheduler().unscheduleUpdateForTarget(this)},_removeActionAtIndex:function(e,t){var n=t.actions[e];n==t.currentAction&&!t.currentActionSalvaged&&(t.currentActionSalvaged=!0),t.actions[e]=null,t.actionIndex>=e&&t.actionIndex--,t.actions.length==0&&(this._currentTarget==t?this._currentTargetSalvaged=!0:this._deleteHashElement(t))},_deleteHashElement:function(e){cc.ArrayRemoveObject(this._targets,e),e&&(e.actions=null,e.target=null)},_actionAllocWithHashElement:function(e){e.actions==null&&(e.actions=[])},update:function(e){for(var t=0;t<this._targets.length;t++){this._currentTarget=this._targets[t],this._currentTargetSalvaged=!1;if(!this._currentTarget.paused)for(this._currentTarget.actionIndex=0;this._currentTarget.actionIndex<this._currentTarget.actions.length;this._currentTarget.actionIndex++){this._currentTarget.currentAction=this._currentTarget.actions[this._currentTarget.actionIndex];if(this._currentTarget.currentAction==null)continue;this._currentTarget.currentActionSalvaged=!1,this._currentTarget.currentAction.step(e);if(this._currentTarget.currentActionSalvaged)this._currentTarget.currentAction=null;else if(this._currentTarget.currentAction.isDone()){this._currentTarget.currentAction.stop();var n=this._currentTarget.currentAction;this._currentTarget.currentAction=null,this.removeAction(n)}this._currentTarget.currentAction=null}this._currentTargetSalvaged&&this._currentTarget.actions.length==0&&this._deleteHashElement(this._currentTarget)}}}),cc.ActionManager.sharedManager=function(){return cc.sharedManager||(cc.sharedManager=new cc.ActionManager,cc.sharedManager.init()||delete cc.sharedManager),cc.sharedManager},cc.sharedManager=null,cc.ProgressTo=cc.ActionInterval.extend({_to:0,_from:0,initWithDuration:function(e,t){return this._super(e)?(this._to=t,!0):!1},copyWithZone:function(e){var t=null,n=null;return e&&e._copyObject?n=e._copyObject:(n=new cc.ProgressTo,e=t=new cc.Zone(n)),this._super(e),n.initWithDuration(this._duration,this._to),n},startWithTarget:function(e){this._super(e),this._from=e.getPercentage(),this._from==100&&(this._from=0)},update:function(e){this._target instanceof cc.ProgressTimer&&this._target.setPercentage(this._from+(this._to-this._from)*e)}}),cc.ProgressTo.create=function(e,t){var n=new cc.ProgressTo;return n.initWithDuration(e,t),n},cc.ProgressFromTo=cc.ActionInterval.extend({_to:0,_from:0,initWithDuration:function(e,t,n){return this._super(e)?(this._to=n,this._from=t,!0):!1},copyWithZone:function(e){var t=null,n=null;return e&&e._copyObject?n=e._copyObject:(n=new cc.ProgressFromTo,e=t=new cc.Zone(n)),this._super(e),n.initWithDuration(this._duration,this._from,this._to),n},reverse:function(){return cc.ProgressFromTo.create(this._duration,this._to,this._from)},startWithTarget:function(e){this._super(e)},update:function(e){this._target instanceof cc.ProgressTimer&&this._target.setPercentage(this._from+(this._to-this._from)*e)}}),cc.ProgressFromTo.create=function(e,t,n){var r=new cc.ProgressFromTo;return r.initWithDuration(e,t,n),r};var cc=cc=cc||{};cc.ActionCamera=cc.ActionInterval.extend({centerXOrig:0,centerYOrig:0,centerZOrig:0,eyeXOrig:0,eyeYOrig:0,eyeZOrig:0,upXOrig:0,upYOrig:0,upZOrig:0,startWithTarget:function(e){this._super(e);var t=e.getCamera();t.getCenterXYZ(this.centerXOrig,this.centerYOrig,this.centerZOrig),t.getEyeXYZ(this.eyeXOrig,this.eyeYOrig,this.eyeZOrig),t.getUpXYZ(this.upXOrig,this.upYOrig,this.upZOrig)},reverse:function(){return cc.ReverseTime.create(this)}}),cc.OrbitCamera=cc.ActionCamera.extend({radius:0,deltaRadius:0,angleZ:0,deltaAngleZ:0,angleX:0,deltaAngleX:0,radZ:0,radDeltaZ:0,radX:0,radDeltaX:0,initWithDuration:function(e,t,n,r,i,s,o){return this._super(e)?(this.radius=t,this.deltaRadius=n,this.angleZ=r,this.deltaAngleZ=i,this.angleX=s,this.deltaAngleX=o,this.radDeltaZ=cc.DEGREES_TO_RADIANS(i),this.radDeltaX=cc.DEGREES_TO_RADIANS(o),!0):!1},sphericalRadius:function(e,t,n){var r,i,s,o,u,a,f,l,c,h,p,d=this._target.getCamera();d.getEyeXYZ(r,i,s),d.getCenterXYZ(o,u,a),f=r-o,l=i-u,c=s-a,h=Math.sqrt(Math.pow(f,2)+Math.pow(l,2)+Math.pow(c,2)),p=Math.sqrt(Math.pow(f,2)+Math.pow(l,2)),p==0&&(p=cc.FLT_EPSILON),h==0&&(h=cc.FLT_EPSILON),t=Math.acos(c/h),f<0?n=Math.PI-Math.asin(l/p):n=Math.asin(l/p),e=h/cc.Camera.getZEye()},copyWithZone:function(e){var t=null,n=null;return e&&e.copyObject?n=e.copyObject:(n=new cc.OrbitCamera,e=t=new cc.Zone(n)),cc.ActionInterval.copyWithZone(e),n.initWithDuration(this._duration,this.radius,this.deltaRadius,this.angleZ,this.deltaAngleZ,this.angleX,this.deltaAngleX),n},startWithTarget:function(e){this._super(e);var t,n,r;this.sphericalRadius(t,n,r),isNaN(this.radius)&&(this.radius=t),isNaN(this.angleZ)&&(this.angleZ=cc.RADIANS_TO_DEGREES(n)),isNaN(this.angleX)&&(this.angleX=cc.RADIANS_TO_DEGREES(r)),this.radZ=cc.DEGREES_TO_RADIANS(this.angleZ),this.radX=cc.DEGREES_TO_RADIANS(this.angleX)},update:function(e){var t=(this.radius+this.deltaRadius*e)*cc.Camera.getZEye(),n=this.radZ+this.radDeltaZ*e,r=this.radX+this.radDeltaX*e,i=Math.sin(n)*Math.cos(r)*t+this.centerXOrig,s=Math.sin(n)*Math.sin(r)*t+this.centerYOrig,o=Math.cos(n)*t+this.centerZOrig;this._target.getCamera().setEyeXYZ(i,s,o)}}),cc.OrbitCamera.create=function(e,t,n,r,i,s,o){var u=new cc.OrbitCamera;return u.initWithDuration(e,t,n,r,i,s,o)?u:null},cc.ActionEase=cc.ActionInterval.extend({initWithAction:function(e){return cc.Assert(e!=null,""),this.initWithDuration(e.getDuration())?(this._other=e,!0):!1},copyWithZone:function(e){},startWithTarget:function(e){this._super(e),this._other.startWithTarget(this._target)},stop:function(){this._other.stop(),this._super()},update:function(e){this._other.update(e)},reverse:function(){return cc.ActionEase.create(this._other.reverse())},_other:null}),cc.ActionEase.create=function(e){var t=new cc.ActionEase;return t&&t.initWithAction(e),t},cc.EaseRateAction=cc.ActionEase.extend({setRate:function(e){this._rate=e},getRate:function(){return this._rate},initWithAction:function(e,t){return this._super(e)?(this._rate=t,!0):!1},copyWithZone:function(e){},reverse:function(){return cc.EaseRateAction.create(this._other.reverse(),1/this._rate)},_rate:null}),cc.EaseRateAction.create=function(e,t){var n=new cc.EaseRateAction;return n&&n.initWithAction(e,t),n},cc.EaseIn=cc.EaseRateAction.extend({update:function(e){this._other.update(Math.pow(e,this._rate))},copyWithZone:function(e){}}),cc.EaseIn.create=function(e,t){var n=new cc.EaseIn;return n&&n.initWithAction(e,t),n},cc.EaseOut=cc.EaseRateAction.extend({update:function(e){this._other.update(Math.pow(e,1/this._rate))},copyWithZone:function(e){}}),cc.EaseOut.create=function(e,t){var n=new cc.EaseOut;return n&&n.initWithAction(e,t),n},cc.EaseInOut=cc.EaseRateAction.extend({update:function(e){var t=1,n=this._rate;n%2==0&&(t=-1),e*=2,e<1?this._other.update(.5*Math.pow(e,this._rate)):this._other.update(t*.5*(Math.pow(e-2,this._rate)+t*2))},copyWithZone:function(e){},reverse:function(){return cc.EaseInOut.create(this._other.reverse(),this._rate)}}),cc.EaseInOut.create=function(e,t){var n=new cc.EaseInOut;return n&&n.initWithAction(e,t),n},cc.EaseExponentialIn=cc.ActionEase.extend({update:function(e){this._other.update(e==0?0:Math.pow(2,10*(e/1-1))-.001)},reverse:function(){return cc.EaseExponentialOut.create(this._other.reverse())},copyWithZone:function(e){}}),cc.EaseExponentialIn.create=function(e){var t=new cc.EaseExponentialIn;return t&&t.initWithAction(e),t},cc.EaseExponentialOut=cc.ActionEase.extend({update:function(e){this._other.update(e==1?1:-Math.pow(2,-10*e/1)+1)},reverse:function(){return cc.EaseExponentialIn.create(this._other.reverse())},copyWithZone:function(e){}}),cc.EaseExponentialOut.create=function(e){var t=new cc.EaseExponentialOut;return t&&t.initWithAction(e),t},cc.EaseExponentialInOut=cc.ActionEase.extend({update:function(e){e/=.5,e<1?e=.5*Math.pow(2,10*(e-1)):e=.5*(-Math.pow(2,10*(e-1))+2),this._other.update(e)},copyWithZone:function(e){}}),cc.EaseExponentialInOut.create=function(e){var t=new cc.EaseExponentialInOut;return t&&t.initWithAction(e),t},cc.EaseSineIn=cc.ActionEase.extend({update:function(e){this._other.update(-1*Math.cos(e*Math.PI/2)+1)},reverse:function(){return cc.EaseSineOut.create(this._other.reverse())},copyWithZone:function(e){}}),cc.EaseSineIn.create=function(e){var t=new cc.EaseSineIn;return t&&t.initWithAction(e),t},cc.EaseSineOut=cc.ActionEase.extend({update:function(e){this._other.update(Math.sin(e*Math.PI/2))},reverse:function(){return cc.EaseSineIn.create(this._other.reverse())},copyWithZone:function(e){}}),cc.EaseSineOut.create=function(e){var t=new cc.EaseSineOut;return t&&t.initWithAction(e),t},cc.EaseSineInOut=cc.ActionEase.extend({update:function(e){this._other.update(-0.5*(Math.cos(Math.PI*e)-1))},copyWithZone:function(e){}}),cc.EaseSineInOut.create=function(e){var t=new cc.EaseSineInOut;return t&&t.initWithAction(e),t},cc.EaseElastic=cc.ActionEase.extend({getPeriod:function(){return this._period},setPeriod:function(e){this._period=e},initWithAction:function(e,t){return this._super(e),this._period=t==null?3:t,!0},reverse:function(){return cc.Assert(0,""),null},copyWithZone:function(e){},_period:null}),cc.EaseElastic.create=function(e,t){var n=new cc.EaseElastic;return n&&(t==null?n.initWithAction(e):n.initWithAction(e,t)),n},cc.EaseElasticIn=cc.EaseElastic.extend({update:function(e){var t=0;if(e==0||e==1)t=e;else{var n=this._period/4;e-=1,t=-Math.pow(2,10*e)*Math.sin((e-n)*Math.PI*2/this._period)}this._other.update(t)},reverse:function(){return cc.EaseElasticOut.create(this._other.reverse(),this._period)},copyWithZone:function(e){}}),cc.EaseElasticIn.create=function(e,t){var n=new cc.EaseElasticIn;return n&&(t==null?n.initWithAction(e):n.initWithAction(e,t)),n},cc.EaseElasticOut=cc.EaseElastic.extend({update:function(e){var t=0;if(e==0||e==1)t=e;else{var n=this._period/4;t=Math.pow(2,-10*e)*Math.sin((e-n)*Math.PI*2/this._period)+1}this._other.update(t)},reverse:function(){return cc.EaseElasticIn.create(this._other.reverse(),this._period)},copyWithZone:function(e){}}),cc.EaseElasticOut.create=function(e,t){var n=new cc.EaseElasticOut;return n&&(t==null?n.initWithAction(e):n.initWithAction(e,t)),n},cc.EaseElasticInOut=cc.EaseElastic.extend({update:function(e){var t=0;if(e==0||e==1)t=e;else{e*=2,this._period||(this._period=.3*1.5);var n=this._period/4;e-=1,e<0?t=-0.5*Math.pow(2,10*e)*Math.sin((e-n)*Math.PI*2/this._period):t=Math.pow(2,-10*e)*Math.sin((e-n)*Math.PI*2/this._period)*.5+1}this._other.update(t)},reverse:function(){return cc.EaseInOut.create(this._other.reverse(),this._period)},copyWithZone:function(e){}}),cc.EaseElasticInOut.create=function(e,t){var n=new cc.EaseElasticInOut;return n&&(t==null?n.initWithAction(e):n.initWithAction(e,t)),n},cc.EaseBounce=cc.ActionEase.extend({bounceTime:function(e){return e<1/2.75?7.5625*e*e:e<2/2.75?(e-=1.5/2.75,7.5625*e*e+.75):e<2.5/2.75?(e-=2.25/2.75,7.5625*e*e+.9375):(e-=2.625/2.75,7.5625*e*e+.984375)},copyWithZone:function(e){}}),cc.EaseBounce.create=function(e){var t=new cc.EaseBounce;return t&&t.initWithAction(e),t},cc.EaseBounceIn=cc.EaseBounce.extend({update:function(e){var t=1-this.bounceTime(1-e);this._other.update(t)},reverse:function(){return cc.EaseBounceOut.create(this._other.reverse())},copyWithZone:function(e){}}),cc.EaseBounceIn.create=function(e){var t=new cc.EaseBounceIn;return t&&t.initWithAction(e),t},cc.EaseBounceOut=cc.EaseBounce.extend({update:function(e){var t=this.bounceTime(e);this._other.update(t)},reverse:function(){return cc.EaseBounceIn.create(this._other.reverse())},copyWithZone:function(e){}}),cc.EaseBounceOut.create=function(e){var t=new cc.EaseBounceOut;return t&&t.initWithAction(e),t},cc.EaseBounceInOut=cc.EaseBounce.extend({update:function(e){var t=0;e<.5?(e*=2,t=(1-this.bounceTime(1-e))*.5):t=this.bounceTime(e*2-1)*.5+.5,this._other.update(t)},copyWithZone:function(e){}}),cc.EaseBounceInOut.create=function(e){var t=new cc.EaseBounceInOut;return t&&t.initWithAction(e),t},cc.EaseBackIn=cc.ActionEase.extend({update:function(e){var t=1.70158;this._other.update(e*e*((t+1)*e-t))},reverse:function(){return cc.EaseBackOut.create(this._other.reverse())},copyWithZone:function(e){}}),cc.EaseBackIn.create=function(e){var t=new cc.EaseBackIn;return t&&t.initWithAction(e),t},cc.EaseBackOut=cc.ActionEase.extend({update:function(e){var t=1.70158;e-=1,this._other.update(e*e*((t+1)*e+t)+1)},reverse:function(){return cc.EaseBackIn.create(this._other.reverse())},copyWithZone:function(e){}}),cc.EaseBackOut.create=function(e){var t=new cc.EaseBackOut;return t&&t.initWithAction(e),t},cc.EaseBackInOut=cc.ActionEase.extend({update:function(e){var t=2.5949095;e*=2,e<1?this._other.update(e*e*((t+1)*e-t)/2):(e-=2,this._other.update(e*e*((t+1)*e+t)/2+1))},copyWithZone:function(e){}}),cc.EaseBackInOut.create=function(e){var t=new cc.EaseBackInOut;return t&&t.initWithAction(e),t};var cc=cc=cc||{};cc.GridAction=cc.ActionInterval.extend({_gridSize:null,startWithTarget:function(e){this._super(e);var t=this.getGrid(),n=this._target,r=n.getGrid();r&&r.getReuseGrid()>0?r.isActive()&&r.getGridSize().x==this._gridSize.x&&r.getGridSize().y==this._gridSize.y?r.reuse():cc.Assert(0,""):(r&&r.isActive()&&r.setActive(!1),n.setGrid(t),n.getGrid().setActive(!0))},reverse:function(){return cc.ReverseTime.create(this)},initWithSize:function(e,t){return this.initWithDuration(t)?(this._gridSize=e,!0):!1},getGrid:function(){return cc.Assert(0,""),null}}),cc.GridAction.create=function(e,t){var n=new cc.GridAction;return n.initWithSize(e,t),n},cc.Grid3DAction=cc.GridAction.extend({getGrid:function(){return cc.Grid3D.create(this._gridSize)},vertex:function(e){var t=this._target.getGrid();return t.vertex(e)},originalVertex:function(e){var t=this._target.getGrid();return t.originalVertex(e)},setVertex:function(e,t){var n=this._target.getGrid();n.setVertex(e,t)}}),cc.Grid3DAction.create=function(){},cc.TiledGrid3DAction=cc.GridAction.extend({tile:function(e){var t=this._target.getGrid();return t.tile(e)},originalTile:function(e){var t=this._target.getGrid();return t.originalTile(e)},setTile:function(e,t){var n=this._target.getGrid();return n.setTile(e,t)},getGrid:function(){return cc.TiledGrid3D.create(this._gridSize)}}),cc.TiledGrid3DAction.create=function(e,t){},cc.AccelDeccelAmplitude=cc.ActionInterval.extend({_rate:null,_other:null,initWithAction:function(e,t){return cc.ActionInterval.initWithDuration(t)?(this._rate=1,this._other=e,!0):!1},startWithTarget:function(e){cc.ActionInterval.startWithTarget(e),this._other.startWithTarget(e)},update:function(e){var t=e*2;t>1&&(t-=1,t=1-t),this._other.setAmplitudeRate(Math.pow(t,this._rate))},reverse:function(){return cc.AccelDeccelAmplitude.create(this._other.reverse(),this._duration)},getRate:function(){return this._rate},setRate:function(e){this._rate=e}}),cc.AccelDeccelAmplitude.create=function(e,t){var n=new cc.AccelDeccelAmplitude;return n},cc.AccelAmplitude=cc.ActionInterval.extend({_rate:null,_other:null,initWithAction:function(e,t){return cc.ActionInterval.initWithDuration(t)?(this._rate=1,this._other=e,!0):!1},getRate:function(){return this._rate},setRate:function(e){this._rate=e},startWithTarget:function(e){cc.ActionInterval.startWithTarget(e),this._other.startWithTarget(e)},update:function(e){this._other.setAmplitudeRate(Math.pow(e,this._rate)),this._other.update(e)},reverse:function(){return cc.AccelAmplitude.create(this._other.reverse(),this._duration)}}),cc.AccelAmplitude.create=function(e,t){var n=new cc.AccelAmplitude;return n},cc.DeccelAmplitude=cc.ActionInterval.extend({_rate:null,_other:null,initWithAction:function(e,t){return cc.ActionInterval.initWithDuration(t)?(this._rate=1,this._other=e,!0):!1},getRate:function(){return this._rate},setRate:function(e){this._rate=e},startWithTarget:function(e){cc.ActionInterval.startWithTarget(e),this._other.startWithTarget(e)},update:function(e){this._other.setAmplitudeRate(Math.pow(1-e,this._rate)),this._other.update(e)},reverse:function(){return cc.DeccelAmplitude.create(this._other.reverse(),this._duration)}}),cc.DeccelAmplitude.create=function(e,t){var n=new cc.DeccelAmplitude;return n},cc.StopGrid=cc.ActionInstant.extend({startWithTarget:function(e){this._super(e);var t=this._target.getGrid();t&&t.isActive()&&t.setActive(!1)}}),cc.StopGrid.create=function(){var e=new cc.StopGrid;return e},cc.ReuseGrid=cc.ActionInstant.extend({_times:null,initWithTimes:function(e){return this._times=e,!0},startWithTarget:function(e){cc.ActionInstant.startWithTarget(e),this._target.getGrid()&&this._target.getGrid().isActive()&&this._target.getGrid().setReuseGrid(this._target.getGrid().getReuseGrid()+this._times)}}),cc.ReuseGrid.create=function(e){var t=new cc.ReuseGrid;return t},cc.TurnOffTiles=cc.TiledGrid3DAction.extend({_seed:null,_tilesCount:0,_tilesOrder:[],initWithSeed:function(e,t,n){return this.initWithSize(e,t)?(this._seed=n,this._tilesOrder=null,!0):!1},shuffle:function(e,t){var n;for(n=t-1;n>=0;n--){var r=parseInt(Math.random()*(n+1)),i=e[n];e[n]=e[r],e[r]=i}},turnOnTile:function(e){this.setTile(e,this.originalTile(e))},turnOffTile:function(e){var t=new cc.Quad3;this.setTile(e,t)},startWithTarget:function(e){var t;this._super(e),this._seed!=-1&&parseInt(Math.random()*this._seed),this._tilesCount=this._gridSize.x*this._gridSize.y,this._tilesOrder=[];for(t=0;t<this._tilesCount;++t)this._tilesOrder[t]=t;this.shuffle(this._tilesOrder,this._tilesCount)},update:function(e){var t,n,r;n=e*this._tilesCount;for(t=0;t<this._tilesCount;t++){r=this._tilesOrder[t];var i=cc.ccg(r/this._gridSize.y,r%this._gridSize.y);t<n?this.turnOffTile(i):this.turnOnTile(i)}}}),cc.TurnOffTiles.create=function(e,t,n){var r=new cc.TurnOffTiles;return arguments.length==2?r.initWithSize(e,t):arguments.length==3&&r.initWithSeed(e,t,n),r},cc.Scene=cc.Node.extend({ctor:function(){this._isRelativeAnchorPoint=!1;var e=cc.Director.sharedDirector();this.setAnchorPoint(cc.ccp(.5,.5)),this.setContentSize(e.getWinSize())},init:function(){var e=cc.Director.sharedDirector();return this.setContentSize(e.getWinSize()),!0}}),cc.Scene.create=function(){var e=new cc.Scene;return e},cc.Layer=cc.Node.extend({_isTouchEnabled:!1,_isAccelerometerEnabled:!1,_isKeypadEnabled:!1,ctor:function(){this._super(),this.setAnchorPoint(cc.ccp(.5,.5)),this._isRelativeAnchorPoint=!1;var e=cc.Director.sharedDirector();if(!e)return!1;this.setContentSize(e.getWinSize()),this._isTouchEnabled=!1,this._isAccelerometerEnabled=!1},init:function(){return!0},registerWithTouchDispatcher:function(){cc.TouchDispatcher.sharedDispatcher().addStandardDelegate(this,0)},getIsTouchEnabled:function(){return this._isTouchEnabled},setIsTouchEnabled:function(e){this._isTouchEnabled!=e&&(this._isTouchEnabled=e,this._isRunning&&(e?this.registerWithTouchDispatcher():cc.TouchDispatcher.sharedDispatcher().removeDelegate(this)))},getIsAccelerometerEnabled:function(){return this._isAccelerometerEnabled},setIsAccelerometerEnabled:function(e){e!=this._isAccelerometerEnabled&&(this._isAccelerometerEnabled=e,this._isRunning&&(e?cc.Accelerometer.sharedAccelerometer().setDelegate(this):cc.Accelerometer.sharedAccelerometer().setDelegate(null)))},getIsKeypadEnabled:function(){return this._isKeypadEnabled},setIsKeypadEnabled:function(e){e!=this._isKeypadEnabled&&(this._isKeypadEnabled=e,this._isRunning&&(e?cc.KeypadDispatcher.sharedDispatcher().addDelegate(this):cc.KeypadDispatcher.sharedDispatcher().removeDelegate(this)))},onEnter:function(){this._isTouchEnabled&&this.registerWithTouchDispatcher(),this._super(),this._isAccelerometerEnabled&&cc.Accelerometer.sharedAccelerometer().setDelegate(this),this._isKeypadEnabled&&cc.KeypadDispatcher.sharedDispatcher().addDelegate(this)},onExit:function(){this._isTouchEnabled&&cc.TouchDispatcher.sharedDispatcher().removeDelegate(this),this._isAccelerometerEnabled&&cc.Accelerometer.sharedAccelerometer().setDelegate(null),this._isKeypadEnabled&&cc.KeypadDispatcher.sharedDispatcher().removeDelegate(this),this._super()},onEnterTransitionDidFinish:function(){this._isAccelerometerEnabled&&cc.Accelerometer.sharedAccelerometer().setDelegate(this),this._super()},ccTouchBegan:function(e,t){return cc.Assert(!1,"Layer#ccTouchBegan override me"),!0},ccTouchMoved:function(e,t){},ccTouchEnded:function(e,t){},ccTouchCancelled:function(e,t){},ccTouchesBegan:function(e,t){},ccTouchesMoved:function(e,t){},ccTouchesEnded:function(e,t){},ccTouchesCancelled:function(e,t){},didAccelerate:function(e){},addLayer:function(e){cc.Assert(this._layers,"cc.Layer addLayer"),this._layers.addObject(e)}}),cc.Layer.create=function(){var e=new cc.Layer;return e&&e.init()?e:null},cc.LayerColor=cc.Layer.extend({_squareVertices:[],_squareColors:[],_opacity:0,_color:new cc.Color3B(255,255,255),_blendFunc:new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST),ctor:function(){this._squareVertices=[new cc.Vertex2F(0,0),new cc.Vertex2F(0,0),new cc.Vertex2F(0,0),new cc.Vertex2F(0,0)],this._squareColors=[new cc.Color4B(0,0,0,1),new cc.Color4B(0,0,0,1),new cc.Color4B(0,0,0,1),new cc.Color4B(0,0,0,1)],this._color=new cc.Color3B(0,0,0),this._super()},getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e,this._updateColor(),this.setNodeDirty()},getColor:function(){return this._color},setColor:function(e){this._color=e,this._updateColor(),this.setNodeDirty()},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e){this._blendFunc=e},initWithColor:function(e){this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._color=new cc.Color3B(e.r,e.g,e.b),this._opacity=e.a;for(var t=0;t<this._squareVertices.length;t++)this._squareVertices[t].x=0,this._squareVertices[t].y=0;return this._updateColor(),!0},setContentSize:function(e){this._squareVertices[1].x=e.width*cc.CONTENT_SCALE_FACTOR(),this._squareVertices[2].y=e.height*cc.CONTENT_SCALE_FACTOR(),this._squareVertices[3].x=e.width*cc.CONTENT_SCALE_FACTOR(),this._squareVertices[3].y=e.height*cc.CONTENT_SCALE_FACTOR(),this._super(e)},changeWidthAndHeight:function(e,t){this.setContentSize(cc.SizeMake(e,t))},changeWidth:function(e){this.setContentSize(cc.SizeMake(e,this._contentSize.height))},changeHeight:function(e){this.setContentSize(cc.SizeMake(this._contentSize.width,e))},_updateColor:function(){for(var e=0;e<4;e++)this._squareColors[e].r=Math.round(this._color.r),this._squareColors[e].g=Math.round(this._color.g),this._squareColors[e].b=Math.round(this._color.b),this._squareColors[e].a=Math.round(this._opacity)},setIsOpacityModifyRGB:function(e){},getIsOpacityModifyRGB:function(){return!1},draw:function(e){var t=e||cc.renderContext;if(cc.renderContextType==cc.CANVAS){var n=this.getContentSize().width,r=this.getContentSize().height,i=t.createLinearGradient(-this.getAnchorPointInPixels().x,this.getAnchorPointInPixels().y,-this.getAnchorPointInPixels().x+n,-(this.getAnchorPointInPixels().y+r));i.addColorStop(0,"rgba("+this._squareColors[0].r+","+this._squareColors[0].g+","+this._squareColors[0].b+","+this._squareColors[0].a/255+")"),i.addColorStop(1,"rgba("+this._squareColors[3].r+","+this._squareColors[3].g+","+this._squareColors[3].b+","+this._squareColors[3].a/255+")"),t.fillStyle=i,t.fillRect(-this.getAnchorPointInPixels().x,this.getAnchorPointInPixels().y,n,-r)}this._super();return;var s}}),cc.LayerColor.create=function(e,t,n){var r=new cc.LayerColor;return e?r.initWithColor(e):r.init(),t&&n&&r.setContentSize(cc.SizeMake(t,n)),r},cc.LayerGradient=cc.LayerColor.extend({_startColor:new cc.Color3B(0,0,0),_endColor:new cc.Color3B(0,0,0),_startOpacity:null,_endOpacity:null,_alongVector:null,_compressedInterpolation:!1,ctor:function(){this._startColor=new cc.Color3B(0,0,0),this._endColor=new cc.Color3B(0,0,0),this._super()},getStartColor:function(){return this._color},setStartColor:function(e){this.setColor(e)},setEndColor:function(e){this._endColor=e,this._updateColor()},getEndColor:function(){return this._endColor},setStartOpacity:function(e){this._startOpacity=e,this._updateColor()},getStartOpacity:function(){return this._startOpacity},setEndOpacity:function(e){this._endOpacity=e,this._updateColor()},getEndOpacity:function(){return this._endOpacity},setVector:function(e){this.alongVector=e,this._updateColor()},getVector:function(){return this.alongVector},getIsCompressedInterpolation:function(){return this._compressedInterpolation},setIsCompressedInterpolation:function(e){this._compressedInterpolation=e,this._updateColor()},initWithColor:function(e,t,n){var r=arguments.length;return r==2&&(n=cc.ccp(0,-1)),this._startColor.r=e.r,this._startColor.g=e.g,this._startColor.b=e.b,this._startOpacity=e.a,this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endOpacity=t.a,this.alongVector=n,this._compressedInterpolation=!0,this._super(cc.ccc4(e.r,e.g,e.b,255))},_updateColor:function(){this._super();var e=cc.ccpLength(this.alongVector);if(e==0)return;var t=Math.sqrt(2),n=new cc.Point;n=cc.ccp(this.alongVector.x/e,this.alongVector.y/e);if(this._compressedInterpolation){var r=1/(Math.abs(n.x)+Math.abs(n.y));n=cc.ccpMult(n,r*t)}var i=this._opacity/255,s=new cc.Color4B(this._startColor.r,this._startColor.g,this._startColor.b,this._startOpacity*i),o=new cc.Color4B(this._endColor.r,this._endColor.g,this._endColor.b,this._endOpacity*i);this._squareColors[0].r=parseInt(o.r+(s.r-o.r)*((t+n.x+n.y)/(2*t))),this._squareColors[0].g=parseInt(o.g+(s.g-o.g)*((t+n.x+n.y)/(2*t))),this._squareColors[0].b=parseInt(o.b+(s.b-o.b)*((t+n.x+n.y)/(2*t))),this._squareColors[0].a=parseInt(o.a+(s.a-o.a)*((t+n.x+n.y)/(2*t))),this._squareColors[1].r=parseInt(o.r+(s.r-o.r)*((t-n.x+n.y)/(2*t))),this._squareColors[1].g=parseInt(o.g+(s.g-o.g)*((t-n.x+n.y)/(2*t))),this._squareColors[1].b=parseInt(o.b+(s.b-o.b)*((t-n.x+n.y)/(2*t))),this._squareColors[1].a=parseInt(o.a+(s.a-o.a)*((t-n.x+n.y)/(2*t))),this._squareColors[2].r=parseInt(o.r+(s.r-o.r)*((t+n.x-n.y)/(2*t))),this._squareColors[2].g=parseInt(o.g+(s.g-o.g)*((t+n.x-n.y)/(2*t))),this._squareColors[2].b=parseInt(o.b+(s.b-o.b)*((t+n.x-n.y)/(2*t))),this._squareColors[2].a=parseInt(o.a+(s.a-o.a)*((t+n.x-n.y)/(2*t))),this._squareColors[3].r=parseInt(o.r+(s.r-o.r)*((t-n.x-n.y)/(2*t))),this._squareColors[3].g=parseInt(o.g+(s.g-o.g)*((t-n.x-n.y)/(2*t))),this._squareColors[3].b=parseInt(o.b+(s.b-o.b)*((t-n.x-n.y)/(2*t))),this._squareColors[3].a=parseInt(o.a+(s.a-o.a)*((t-n.x-n.y)/(2*t)))}}),cc.LayerGradient.create=function(e,t,n){var r=arguments.length,i=new cc.LayerGradient;switch(r){case 2:if(i&&i.initWithColor(e,t))return i;return null;case 3:if(i&&i.initWithColor(e,t,n))return i;return null;case 0:i.init();break;default:throw"Arguments error "}},cc.LayerMultiplex=cc.Layer.extend({_enabledLayer:0,_layers:null,ctor:function(){this._super()},initWithLayer:function(e){return this._layers=[],this._layers.push(e),this._enabledLayer=0,this.addChild(e),!0},initWithLayers:function(e){return this._layers=e,this._enabledLayer=0,this.addChild(this._layers[this._enabledLayer]),!0},switchTo:function(e){cc.Assert(e<this._layers.length,"Invalid index in MultiplexLayer switchTo message"),this.removeChild(this._layers[this._enabledLayer],!0),this._enabledLayer=e,this.addChild(this._layers[e])},switchToAndReleaseMe:function(e){cc.Assert(e<this._layers.count(),"Invalid index in MultiplexLayer switchTo message"),this.removeChild(this._layers[this._enabledLayer],!0),this._layers[this._enabledLayer]=null,this._enabledLayer=e,this.addChild(this._layers[e])}}),cc.LayerMultiplex.create=function(){var e=new cc.LayerMultiplex;return e.initWithLayers(arguments)?e:null},cc.LazyLayer=cc.Node.extend({_layerCanvas:null,_layerContext:null,_isNeedUpdate:!1,_canvasZOrder:-10,ctor:function(){this._super(),this.setAnchorPoint(new cc.Point(0,0)),this._setupHtml()},setLayerZOrder:function(e){if(e>=0)throw"LazyLayer zOrder must Less than Zero.Because LazyLayer is a background Layer!";this._canvasZOrder=e,this._layerCanvas.style.zIndex=this._canvasZOrder},getLayerZOrder:function(){return this._canvasZOrder},_setupHtml:function(){var e=document.getElementById("Cocos2dGameContainer");e||(cc.setupHTML(),e=document.getElementById("Cocos2dGameContainer")),this._layerCanvas=document.createElement("canvas"),this._layerCanvas.width=cc.canvas.width,this._layerCanvas.height=cc.canvas.height,this._layerCanvas.id="lazyCanvas"+Date.now(),this._layerCanvas.style.zIndex=this._canvasZOrder,this._layerCanvas.style.position="absolute",this._layerCanvas.style.top="0",this._layerCanvas.style.left="0",this._layerContext=this._layerCanvas.getContext("2d"),this._layerContext.fillStyle="rgba(0,0,0,1)",this._layerContext.translate(0,this._layerCanvas.height),e.appendChild(this._layerCanvas);var t=this;window.addEventListener("resize",function(e){t.adjustSizeForCanvas()})},adjustSizeForCanvas:function(){this._isNeedUpdate=!0,this._layerCanvas.width=cc.canvas.width,this._layerCanvas.height=cc.canvas.height;var e=cc.canvas.width/cc.originalCanvasSize.width,t=cc.canvas.height/cc.originalCanvasSize.height;e>t&&(e=t),this._layerContext.translate(0,this._layerCanvas.height),this._layerContext.scale(e,e)},addChild:function(e,t,n){this._isNeedUpdate=!0,this._super(e,t,n)},removeChild:function(e,t){this._isNeedUpdate=!0,this._super(e,t)},visit:function(){if(!this._isVisible)return;if(!this._isNeedUpdate)return;this._isNeedUpdate=!1;var e=this._layerContext;e.save(),e.clearRect(0,0,this._layerCanvas.width,-this._layerCanvas.height),this._grid&&this._grid.isActive()&&(this._grid.beforeDraw(),this.transformAncestors());if(this._children)for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&n._zOrder<0&&n.visit(e)}if(this._children)for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&n._zOrder>=0&&n.visit(e)}this._grid&&this._grid.isActive()&&this._grid.afterDraw(this),e.restore()},_setNodeDirtyForCache:function(){this._isCacheDirty=!0,this._isNeedUpdate=!0}}),cc.SCENE_FADE=4208917214,cc.TransitionEaseScene=cc.Class.extend({easeActionWithAction:function(){}}),cc.ORIENTATION_LEFT_OVER=0,cc.ORIENTATION_RIGHT_OVER=1,cc.ORIENTATION_UP_OVER=0,cc.ORIENTATION_DOWN_OVER=1,cc.TransitionScene=cc.Scene.extend({_inScene:null,_outScene:null,_duration:null,_isInSceneOnTop:!1,_isSendCleanupToScene:!1,_setNewScene:function(e){this.unschedule(this._setNewScene);var t=cc.Director.sharedDirector();this._isSendCleanupToScene=t.isSendCleanupToScene(),t.replaceScene(this._inScene),cc.TouchDispatcher.sharedDispatcher().setDispatchEvents(!0),this._outScene.setIsVisible(!0)},_sceneOrder:function(){this._isInSceneOnTop=!0},draw:function(){this._super(),this._isInSceneOnTop?(this._outScene.visit(),this._inScene.visit()):(this._inScene.visit(),this._outScene.visit())},onEnter:function(){this._super(),this._inScene.onEnter()},onExit:function(){this._super(),this._outScene.onExit(),this._inScene.onEnterTransitionDidFinish()},cleanup:function(){this._super(),this._isSendCleanupToScene&&this._outScene.cleanup()},initWithDuration:function(e,t){return cc.Assert(t!=null,"CCTransitionScene.initWithDuration() Argument scene must be non-nil"),this.init()?(this._duration=e,this.setAnchorPoint(cc.ccp(0,0)),this.setPosition(cc.ccp(0,0)),this._inScene=t,this._outScene=cc.Director.sharedDirector().getRunningScene(),cc.Assert(this._inScene!=this._outScene,"CCTransitionScene.initWithDuration() Incoming scene must be different from the outgoing scene"),cc.TouchDispatcher.sharedDispatcher().setDispatchEvents(!1),this._sceneOrder(),!0):!1},finish:function(){this._inScene.setIsVisible(!0),this._inScene.setPosition(cc.ccp(0,0)),this._inScene.setScale(1),this._inScene.setRotation(0),this._inScene.getCamera().restore(),this._outScene.setIsVisible(!1),this._outScene.setPosition(cc.ccp(0,0)),this._outScene.setScale(1),this._outScene.setRotation(0),this._outScene.getCamera().restore(),this.schedule(this._setNewScene,0)},hideOutShowIn:function(){this._inScene.setIsVisible(!0),this._outScene.setIsVisible(!1)}}),cc.TransitionScene.create=function(e,t){var n=new cc.TransitionScene;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSceneOriented=cc.TransitionScene.extend({_orientation:0,initWithDuration:function(e,t,n){return this._super(e,t)&&(this._orientation=n),!0}}),cc.TransitionSceneOriented.create=function(e,t,n){var r=new cc.TransitionSceneOriented;return r.initWithDuration(e,t,n),r},cc.TransitionRotoZoom=cc.TransitionScene.extend({ctor:function(){},onEnter:function(){this._super(),this._inScene.setScale(.001),this._outScene.setScale(1),this._inScene.setAnchorPoint(cc.ccp(.5,.5)),this._outScene.setAnchorPoint(cc.ccp(.5,.5));var e=cc.Sequence.create(cc.Spawn.create(cc.ScaleBy.create(this._duration/2,.001),cc.RotateBy.create(this._duration/2,720),null),cc.DelayTime.create(this._duration/2),null);this._outScene.runAction(e),this._inScene.runAction(cc.Sequence.create(e.reverse(),cc.CallFunc.create(this,this.finish),null))}}),cc.TransitionRotoZoom.create=function(e,t){var n=new cc.TransitionRotoZoom;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionJumpZoom=cc.TransitionScene.extend({onEnter:function(){this._super();var e=cc.Director.sharedDirector().getWinSize();this._inScene.setScale(.5),this._inScene.setPosition(cc.ccp(e.width,0)),this._inScene.setAnchorPoint(cc.ccp(.5,.5)),this._outScene.setAnchorPoint(cc.ccp(.5,.5));var t=cc.JumpBy.create(this._duration/4,cc.ccp(-e.width,0),e.width/4,2),n=cc.ScaleTo.create(this._duration/4,1),r=cc.ScaleTo.create(this._duration/4,.5),i=cc.Sequence.create(r,t,null),s=cc.Sequence.create(t,n,null),o=cc.DelayTime.create(this._duration/2);this._outScene.runAction(i),this._inScene.runAction(cc.Sequence.create(o,s,cc.CallFunc.create(this,this.finish),null))}}),cc.TransitionJumpZoom.create=function(e,t){var n=new cc.TransitionJumpZoom;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInL=cc.TransitionScene.extend({onEnter:function(){this._super(),this.initScenes();var e=this.action();this._inScene.runAction(cc.Sequence.create(this.easeActionWithAction(e),cc.CallFunc.create(this,this.finish),null))},initScenes:function(){this._inScene.setPosition(cc.ccp(-cc.Director.sharedDirector().getWinSize().width,0))},action:function(){return cc.MoveTo.create(this._duration,cc.ccp(0,0))},easeActionWithAction:function(e){return cc.EaseOut.create(e,2)}}),cc.TransitionMoveInL.create=function(e,t){var n=new cc.TransitionMoveInL;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInR=cc.TransitionMoveInL.extend({initScenes:function(){var e=cc.Director.sharedDirector().getWinSize();this._inScene.setPosition(cc.ccp(e.width,0))}}),cc.TransitionMoveInR.create=function(e,t){var n=new cc.TransitionMoveInR;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInT=cc.TransitionMoveInL.extend({initScenes:function(){var e=cc.Director.sharedDirector().getWinSize();this._inScene.setPosition(cc.ccp(e.height,0))}}),cc.TransitionMoveInT.create=function(e,t){var n=new cc.TransitionMoveInT;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionMoveInB=cc.TransitionMoveInL.extend({initScenes:function(){var e=cc.Director.sharedDirector().getWinSize();this._inScene.setPosition(cc.ccp(0,-e.height))}}),cc.TransitionMoveInB.create=function(e,t){var n=new cc.TransitionMoveInB;return n!=null&&n.initWithDuration(e,t)?n:null},cc.ADJUST_FACTOR=.5,cc.TransitionSlideInL=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},ctor:function(){},onEnter:function(){this._super(),this.initScenes();var e=this.action(),t=this.action(),n=this.easeActionWithAction(e),r=cc.Sequence.create(this.easeActionWithAction(t),cc.CallFunc.create(this,this.finish),null);this._inScene.runAction(n),this._outScene.runAction(r)},initScenes:function(){var e=cc.Director.sharedDirector().getWinSize();this._inScene.setPosition(cc.ccp(-(e.width-cc.ADJUST_FACTOR),0))},action:function(){var e=cc.Director.sharedDirector().getWinSize();return cc.MoveBy.create(this._duration,cc.ccp(e.width-cc.ADJUST_FACTOR,0))},easeActionWithAction:function(e){return cc.EaseOut.create(e,2)}}),cc.TransitionSlideInL.create=function(e,t){var n=new cc.TransitionSlideInL;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSlideInR=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){var e=cc.Director.sharedDirector().getWinSize();this._inScene.setPosition(cc.ccp(e.width-cc.ADJUST_FACTOR,0))},action:function(){var e=cc.Director.sharedDirector().getWinSize();return cc.MoveBy.create(this._duration,cc.ccp(-(e.width-cc.ADJUST_FACTOR),0))}}),cc.TransitionSlideInR.create=function(e,t){var n=new cc.TransitionSlideInR;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSlideInB=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},initScenes:function(){var e=cc.Director.sharedDirector().getWinSize();this._inScene.setPosition(cc.ccp(0,e.height-cc.ADJUST_FACTOR))},action:function(){var e=cc.Director.sharedDirector().getWinSize();return cc.MoveBy.create(this._duration,cc.ccp(0,-(e.height-cc.ADJUST_FACTOR)))}}),cc.TransitionSlideInB.create=function(e,t){var n=new cc.TransitionSlideInB;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSlideInT=cc.TransitionSlideInL.extend({_sceneOrder:function(){this._isInSceneOnTop=!0},initScenes:function(){var e=cc.Director.sharedDirector().getWinSize();this._inScene.setPosition(cc.ccp(0,-(e.height-cc.ADJUST_FACTOR)))},action:function(){var e=cc.Director.sharedDirector().getWinSize();return cc.MoveBy.create(this._duration,cc.ccp(0,e.height-cc.ADJUST_FACTOR))}}),cc.TransitionSlideInT.create=function(e,t){var n=new cc.TransitionSlideInT;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionShrinkGrow=cc.TransitionScene.extend({onEnter:function(){this._super(),this._inScene.setScale(.001),this._outScene.setScale(1),this._inScene.setAnchorPoint(cc.ccp(2/3,.5)),this._outScene.setAnchorPoint(cc.ccp(1/3,.5));var e=cc.ScaleTo.create(this._duration,.01),t=cc.ScaleTo.create(this._duration,1);this._inScene.runAction(this.easeActionWithAction(t)),this._outScene.runAction(cc.Sequence.create(this.easeActionWithAction(e),cc.CallFunc.create(this,this.finish),null))},easeActionWithAction:function(e){return cc.EaseOut.create(e,2)}}),cc.TransitionShrinkGrow.create=function(e,t){var n=new cc.TransitionShrinkGrow;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFlipX=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setIsVisible(!1);var n,r,i,s;this._orientation==cc.ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,r,n,0,0),cc.CallFunc.create(this,this.finish),null),t=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,0,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2),null),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionFlipX.create=function(e,t,n){n==null&&(n=cc.ORIENTATION_RIGHT_OVER);var r=new cc.TransitionFlipX;return r.initWithDuration(e,t,n),r},cc.TransitionFlipY=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setIsVisible(!1);var n,r,i,s;this._orientation==cc.ORIENTATION_UP_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,r,n,90,0),cc.CallFunc.create(this,this.finish),null),t=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,90,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2),null),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionFlipY.create=function(e,t,n){n==null&&(n=cc.ORIENTATION_UP_OVER);var r=new cc.TransitionFlipY;return r.initWithDuration(e,t,n),r},cc.TransitionFlipAngular=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setIsVisible(!1);var n,r,i,s;this._orientation==cc.ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Show.create(),cc.OrbitCamera.create(this._duration/2,1,0,r,n,-45,0),cc.CallFunc.create(this,this.finish),null),t=cc.Sequence.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,45,0),cc.Hide.create(),cc.DelayTime.create(this._duration/2),null),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionFlipAngular.create=function(e,t,n){n==null&&(n=cc.ORIENTATION_RIGHT_OVER);var r=new cc.TransitionFlipAngular;return r.initWithDuration(e,t,n),r},cc.TransitionZoomFlipX=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setIsVisible(!1);var n,r,i,s;this._orientation==cc.ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,r,n,0,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create(),null),cc.CallFunc.create(this,this.finish),null),t=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,0,0),cc.ScaleTo.create(this._duration/2,.5),null),cc.Hide.create(),cc.DelayTime.create(this._duration/2),null),this._inScene.setScale(.5),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionZoomFlipX.create=function(e,t,n){n==null&&(n=cc.ORIENTATION_RIGHT_OVER);var r=new cc.TransitionZoomFlipX;return r.initWithDuration(e,t,n),r},cc.TransitionZoomFlipY=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setIsVisible(!1);var n,r,i,s;this._orientation==cc.ORIENTATION_UP_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,r,n,90,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create(),null),cc.CallFunc.create(this,this.finish),null),t=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,90,0),cc.ScaleTo.create(this._duration/2,.5),null),cc.Hide.create(),cc.DelayTime.create(this._duration/2),null),this._inScene.setScale(.5),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionZoomFlipY.create=function(e,t,n){n==null&&(n=cc.ORIENTATION_UP_OVER);var r=new cc.TransitionZoomFlipY;return r.initWithDuration(e,t,n),r},cc.TransitionZoomFlipAngular=cc.TransitionSceneOriented.extend({onEnter:function(){this._super();var e,t;this._inScene.setIsVisible(!1);var n,r,i,s;this._orientation==cc.ORIENTATION_RIGHT_OVER?(n=90,r=270,i=90,s=0):(n=-90,r=90,i=-90,s=0),e=cc.Sequence.create(cc.DelayTime.create(this._duration/2),cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,r,n,-45,0),cc.ScaleTo.create(this._duration/2,1),cc.Show.create(),null),cc.Show.create(),cc.CallFunc.create(this,this.finish),null),t=cc.Sequence.create(cc.Spawn.create(cc.OrbitCamera.create(this._duration/2,1,0,s,i,45,0),cc.ScaleTo.create(this._duration/2,.5),null),cc.Hide.create(),cc.DelayTime.create(this._duration/2),null),this._inScene.setScale(.5),this._inScene.runAction(e),this._outScene.runAction(t)}}),cc.TransitionZoomFlipAngular.create=function(e,t,n){n==null&&(n=cc.ORIENTATION_RIGHT_OVER);var r=new cc.TransitionZoomFlipAngular;return r.initWithDuration(e,t,n),r},cc.TransitionFade=cc.TransitionScene.extend({_color:new cc.Color3B,ctor:function(){},onEnter:function(){this._super();var e=cc.LayerColor.create(this._color);this._inScene.setIsVisible(!1),this.addChild(e,2,cc.SCENE_FADE);var t=this.getChildByTag(cc.SCENE_FADE),n=cc.Sequence.create(cc.FadeIn.create(this._duration/2),cc.CallFunc.create(this,this.hideOutShowIn),cc.FadeOut.create(this._duration/2),cc.CallFunc.create(this,this.finish),null);t.runAction(n)},onExit:function(){this._super(),this.removeChildByTag(cc.SCENE_FADE,!1)},initWithDuration:function(e,t,n){if(n=="undefined"||n==null)n=cc.BLACK();return this._super(e,t)&&(this._color.r=n.r,this._color.g=n.g,this._color.b=n.b,this._color.a=0),!0}}),cc.TransitionFade.create=function(e,t,n){var r=new cc.TransitionFade;return r.initWithDuration(e,t,n),r},cc.TransitionCrossFade=cc.TransitionScene.extend({onEnter:function(){this._super();var e=new cc.Color4B(0,0,0,0),t=cc.Director.sharedDirector().getWinSize(),n=cc.LayerColor.create(e),r=cc.RenderTexture.create(t.width,t.height);if(null==r)return;r.getSprite().setAnchorPoint(cc.ccp(.5,.5)),r.setPosition(cc.ccp(t.width/2,t.height/2)),r.setAnchorPoint(cc.ccp(.5,.5)),r.begin(),this._inScene.visit(),r.end();var i=cc.RenderTexture.create(t.width,t.height);i.getSprite().setAnchorPoint(cc.ccp(.5,.5)),i.setPosition(cc.ccp(t.width/2,t.height/2)),i.setAnchorPoint(cc.ccp(.5,.5)),i.begin(),this._outScene.visit(),i.end();var s=new cc.BlendFunc(cc.GL_ONE,cc.GL_ONE),o=cc.BlendFunc(cc.GL_SRC_ALPHA,cc.GL_ONE_MINUS_SRC_ALPHA);r.getSprite().setBlendFunc(s),i.getSprite().setBlendFunc(o),n.addChild(r),n.addChild(i),r.getSprite().setOpacity(255),i.getSprite().setOpacity(255);var u=cc.Sequence.create(cc.FadeTo.create(this._duration,0),cc.CallFunc.create(this,this.hideOutShowIn),cc.CallFunc.create(this,this.finish),null);i.getSprite().runAction(u),this.addChild(n,2,cc.SCENE_FADE)},onExit:function(){this.removeChildByTag(cc.SCENE_FADE,!1),this._super()},draw:function(){}}),cc.TransitionCrossFade.create=function(e,t){var n=new cc.TransitionCrossFade;return n.initWithDuration(e,t),n},cc.TransitionTurnOffTiles=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){this._super();var e=cc.Director.sharedDirector().getWinSize(),t=e.width/e.height,n=12*t,r=12,i=cc.TurnOffTiles.create(cc.ccg(n,r),this._duration),s=this.easeActionWithAction(i);this._outScene.runAction(cc.Sequence.create(s,cc.CallFunc.create(this,this.finish),cc.StopGrid.create(),null))},easeActionWithAction:function(e){return e}}),cc.TransitionTurnOffTiles.create=function(e,t){var n=new cc.TransitionTurnOffTiles;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSplitCols=cc.TransitionScene.extend({onEnter:function(){this._super(),this._inScene.setIsVisible(!1);var e=this.action(),t=cc.Sequence.create(e,cc.CallFunc.create(this,this.hideOutShowIn),e.reverse(),null);this.runAction(cc.Sequence.create(this.easeActionWithAction(t),cc.CallFunc.create(this,this.finish),cc.StopGrid.create(),null))},easeActionWithAction:function(e){return cc.EaseInOut.create(e,3)},action:function(){return cc.SplitCols.actionWithCols(3,this._duration/2)}}),cc.TransitionSplitCols.create=function(e,t){var n=new cc.TransitionSplitCols;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionSplitRows=cc.TransitionSplitCols.extend({action:function(){return cc.SplitRows.actionWithRows(3,this._duration/2)}}),cc.TransitionSplitRows.create=function(e,t){var n=new cc.TransitionSplitRows;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeTR=cc.TransitionScene.extend({_sceneOrder:function(){this._isInSceneOnTop=!1},onEnter:function(){this._super();var e=cc.Director.sharedDirector().getWinSize(),t=e.width/e.height,n=12*t,r=12,i=this.actionWithSize(cc.ccg(n,r));this._outScene.runAction(cc.Sequence.create(this.easeActionWithAction(i),cc.CallFunc.create(this,this.finish),cc.StopGrid.create(),null))},easeActionWithAction:function(e){return e},actionWithSize:function(e){return cc.FadeOutTRTiles.create(e,this._duration)}}),cc.TransitionFadeTR.create=function(e,t){var n=new cc.TransitionFadeTR;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeBL=cc.TransitionFadeTR.extend({actionWithSize:function(e){return cc.FadeOutBLTiles.create(e,this._duration)}}),cc.TransitionFadeBL.create=function(e,t){var n=new cc.TransitionFadeBL;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeUp=cc.TransitionFadeTR.extend({actionWithSize:function(e){return cc.FadeOutUpTiles.create(e,this._duration)}}),cc.TransitionFadeUp.create=function(e,t){var n=new cc.TransitionFadeUp;return n!=null&&n.initWithDuration(e,t)?n:null},cc.TransitionFadeDown=cc.TransitionFadeTR.extend({actionWithSize:function(e){return cc.FadeOutDownTiles.create(e,this._duration)}}),cc.TransitionFadeDown.create=function(e,t){var n=new cc.TransitionFadeDown;return n!=null&&n.initWithDuration(e,t)?n:null},cc.SCENE_RADIAL=49153,cc.TransitionRadialCCW=cc.TransitionScene.extend({onEnter:function(){this._super();var e=cc.Director.sharedDirector().getWinSize(),t=cc.RenderTexture.create(e.width,e.height);if(null==t)return;t.getSprite().setAnchorPoint(cc.ccp(.5,.5)),t.setPosition(cc.ccp(e.width/2,e.height/2)),t.setAnchorPoint(cc.ccp(.5,.5)),t.clear(0,0,0,1),t.begin(),this._outScene.visit(),t.end(),this.hideOutShowIn();var n=cc.ProgressTimer.createWithTexture(t.getSprite().getTexture());n.getSprite().setFlipY(!0),n.setType(_radialType()),n.setPercentage(100),n.setPosition(cc.ccp(e.width/2,e.height/2)),n.setAnchorPoint(cc.ccp(.5,.5));var r=cc.Sequence.create(cc.ProgressFromTo.create(this._duration,100,0),cc.CallFunc.create(this,cc.TransitionScene.finish),null);n.runAction(r),this.addChild(n,2,cc.SCENE_RADIAL)},onExit:function(){this.removeChildByTag(cc.SCENE_RADIAL,!1),this._super()},_sceneOrder:function(){this._isInSceneOnTop=!1},_radialType:function(){return cc.CCPROGRESS_TIMER_RADIAL_CCW}}),cc.TransitionRadialCW=cc.TransitionRadialCCW.extend({_radialType:function(){return cc.CCPROGRESS_TIMER_TYPE_RADIAL_CW}}),cc.TransitionRadialCCW.create=function(e,t){var n=new cc.TransitionRadialCCW;return n.initWithDuration(e,t),n},cc.TransitionRadialCW.create=function(e,t){var n=new cc.TransitionRadialCW;return n.initWithDuration(e,t),n},cc.TransitionPageTurn=cc.TransitionScene.extend({_back:!0,initWithDuration:function(e,t,n){return this._back=n,this._super(e,t),!0},actionWithSize:function(e){return this._back?cc.ReverseTime.create(this._super(e,this._duration)):this._super(e,this._duration)},onEnter:function(){this._super();var e=cc.Director.sharedDirector().getWinSize(),t,n;e.width>e.height?(t=16,n=12):(t=12,n=16);var r=this.actionWithSize(cc.ccg(t,n));this._back?(this._inScene.setIsVisible(!1),this._inScene.runAction(cc.Sequence.create(cc.Show.create(),r,cc.CallFunc.create(this,cc.TransitionScene.finish),cc.StopGrid.create(),null))):this._outScene.runAction(cc.Sequence.create(r,cc.CallFunc.create(this,cc.TransitionScene.finish),cc.StopGrid.create(),null))},_sceneOrder:function(){this.isInSceneOnTop=this._back}}),cc.TransitionPageTurn.create=function(e,t,n){var r=new cc.TransitionPageTurn;return r.initWithDuration(e,t,n),r},cc.SPRITE_INDEX_NOT_INITIALIZED="0xffffffff",cc.generateTextureCacheForColor=function(e){var t=e.width,n=e.height,r=[],i=document.createElement("canvas");i.width=t,i.height=n;var s=i.getContext("2d");s.drawImage(e,0,0);var o=document.createElement("canvas");o.width=t,o.height=n;var u=o.getContext("2d"),a=s.getImageData(0,0,t,n).data;for(var f=0;f<4;f++){var l=document.createElement("canvas");l.width=t,l.height=n;var c=l.getContext("2d");u.drawImage(e,0,0);var h=u.getImageData(0,0,t,n),p=h.data;for(var d=0;d<a.length;d+=4)p[d]=f===0?a[d]:0,p[d+1]=f===1?a[d+1]:0,p[d+2]=f===2?a[d+2]:0,p[d+3]=a[d+3];c.putImageData(h,0,0),r.push(l)}return r},cc.generateTintImage=function(e,t,n,r){r||(r=new cc.Rect,r.size=new cc.Size(e.width,e.height));var i;n instanceof cc.Color4F?i=cc.ccc3(n.r*255,n.g*255,n.b*255):i=n;var s=document.createElement("canvas");s.width=r.size.width,s.height=r.size.height;var o=s.getContext("2d");return o.globalAlpha=1,o.globalCompositeOperation="copy",o.drawImage(t[3],r.origin.x,r.origin.y,r.size.width,r.size.height,0,0,r.size.width,r.size.height),o.globalCompositeOperation="lighter",i.r>0&&(o.globalAlpha=i.r/255,o.drawImage(t[0],r.origin.x,r.origin.y,r.size.width,r.size.height,0,0,r.size.width,r.size.height)),i.g>0&&(o.globalAlpha=i.g/255,o.drawImage(t[1],r.origin.x,r.origin.y,r.size.width,r.size.height,0,0,r.size.width,r.size.height)),i.b>0&&(o.globalAlpha=i.b/255,o.drawImage(t[2],r.origin.x,r.origin.y,r.size.width,r.size.height,0,0,r.size.width,r.size.height)),s},cc.HONOR_PARENT_TRANSFORM_TRANSLATE=1,cc.HONOR_PARENT_TRANSFORM_ROTATE=2,cc.HONOR_PARENT_TRANSFORM_SCALE=4,cc.HONOR_PARENT_TRANSFORM_SKEW=8,cc.HONOR_PARENT_TRANSFORM_ALL=cc.HONOR_PARENT_TRANSFORM_TRANSLATE|cc.HONOR_PARENT_TRANSFORM_ROTATE|cc.HONOR_PARENT_TRANSFORM_SCALE|cc.HONOR_PARENT_TRANSFORM_SKEW,cc.TransformValues=function(e,t,n,r,i,s){this.pos=e,this.scale=t,this.rotation=n,this.skew=r,this.ap=i,this.visible=s},cc.RENDER_IN_SUBPIXEL=function(e){return cc.SPRITEBATCHNODE_RENDER_SUBPIXEL?e:parseInt(e)},cc.Sprite=cc.Node.extend({_textureAtlas:null,_atlasIndex:0,_batchNode:null,_honorParentTransform:null,_dirty:null,_recursiveDirty:null,_hasChildren:null,_blendFunc:new cc.BlendFunc,_texture:new cc.Texture2D,_originalTexture:null,_usesBatchNode:null,_rect:new cc.Rect,_rectInPixels:cc.RectZero(),_rectRotated:null,_offsetPositionInPixels:cc.PointZero(),_unflippedOffsetPositionFromCenter:cc.PointZero(),_quad:cc.V3F_C4B_T2F_QuadZero(),colorUnmodified:null,_opacityModifyRGB:null,_flipX:null,_flipY:null,_opacity:255,ctor:function(e){this._super();if(e)if(typeof e=="string"){var t=cc.SpriteFrameCache.sharedSpriteFrameCache().spriteFrameByName(e);this.initWithSpriteFrame(t)}else if(typeof e=="object")if(e instanceof cc.SpriteFrame)this.initWithSpriteFrame(e);else if(e instanceof cc.SpriteBatchNode){if(arguments.length>1){var n=arguments[1];n instanceof cc.Rect&&this.initWithBatchNode(e,n)}}else e instanceof HTMLImageElement||e instanceof HTMLCanvasElement?this.initWithTexture(e):e instanceof cc.Texture2D&&this.initWithTexture(e)},isDirty:function(){return this._dirty},setDirty:function(e){this._dirty=e},getQuad:function(){return this._quad},isTextureRectRotated:function(){return this._rectRotated},getAtlasIndex:function(){return this._atlasIndex},setAtlasIndex:function(e){this._atlasIndex=e},getTextureRect:function(){return new cc.Rect(this._rect)},isUsesBatchNode:function(){return this._usesBatchNode},setUsesSpriteBatchNode:function(e){this._usesBatchNode=e},getTextureAtlas:function(e){return this._textureAtlas},setTextureAtlas:function(e){this._textureAtlas=e},getSpriteBatchNode:function(){return this._batchNode},setSpriteBatchNode:function(e){this._batchNode=e},getHonorParentTransform:function(){return this._honorParentTransform},setHonorParentTransform:function(e){this._honorParentTransform=e},getOffsetPositionInPixels:function(){return new cc.Point(this._offsetPositionInPixels.x,this._offsetPositionInPixels.y)},getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e){this._blendFunc=e},initWithBatchNode:function(e,t){return this.initWithTexture(e.getTexture(),t)?(this.useBatchNode(e),!0):!1},initWithBatchNodeRectInPixels:function(e,t){return this.initWithTexture(e.getTexture())?(this.setTextureRectInPixels(t,!1,t.size),this.useBatchNode(e),!0):!1},init:function(){this._dirty=this._recursiveDirty=!1,this.useSelfRender(),this._opacityModifyRGB=!0,this._opacity=255,this._color=cc.WHITE(),this._colorUnmodified=cc.WHITE(),this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.setTexture(null),this._flipX=this._flipY=!1,this.setAnchorPoint(cc.ccp(.5,.5)),this._offsetPositionInPixels=cc.PointZero(),this._honorParentTransform=cc.HONOR_PARENT_TRANSFORM_ALL,this._hasChildren=!1;var e=new cc.Color4B(255,255,255,255);return this._quad.bl.colors=e,this._quad.br.colors=e,this._quad.tl.colors=e,this._quad.tr.colors=e,this.setTextureRectInPixels(cc.RectZero(),!1,cc.SizeZero()),!0},initWithTexture:function(e,t){var n=arguments.length;if(n==0)throw"Sprite.initWithTexture(): Argument must be non-nil ";cc.Assert(e!=null,"");if(n==1){t=new cc.Rect;if(e instanceof cc.Texture2D)t.size=e.getContentSize();else if(e instanceof HTMLImageElement||e instanceof HTMLCanvasElement)t.size=new cc.Size(e.width,e.height)}return cc.renderContextType==cc.CANVAS&&(this._originalTexture=e),this.init(),this.setTexture(e),this.setTextureRect(t),!0},initWithFile:function(e,t){var n=arguments.length;cc.Assert(e!=null,"");var r=cc.TextureCache.sharedTextureCache().textureForKey(e);r||(r=cc.TextureCache.sharedTextureCache().addImage(e));switch(n){case 1:if(r)return t=cc.RectZero(),cc.renderContextType==cc.CANVAS?t.size=new cc.Size(r.width,r.height):t.size=r.getContentSize(),this.initWithTexture(r,t);return!1;case 2:if(r)return this.initWithTexture(r,t);return!1;default:throw"initWithFile():Argument must be non-nil "}},initWithSpriteFrame:function(e){cc.Assert(e!=null,"");var t=this.initWithTexture(e.getTexture(),e.getRect());return this.setDisplayFrame(e),t},initWithSpriteFrameName:function(e){cc.Assert(e!=null,"");var t=cc.SpriteFrameCache.sharedSpriteFrameCache().spriteFrameByName(e);return this.initWithSpriteFrame(t)},useSelfRender:function(){this._atlasIndex=cc.SPRITE_INDEX_NOT_INITIALIZED,this._usesBatchNode=!1,this._textureAtlas=null,this._batchNode=null,this._dirty=this._recursiveDirty=!1;var e=0+this._offsetPositionInPixels.x,t=0+this._offsetPositionInPixels.y,n=e+this._rectInPixels.size.width,r=t+this._rectInPixels.size.height;this._quad.bl.vertices=cc.vertex3(e,t,0),this._quad.br.vertices=cc.vertex3(n,t,0),this._quad.tl.vertices=cc.vertex3(e,r,0),this._quad.tr.vertices=cc.vertex3(n,r,0)},useBatchNode:function(e){this._usesBatchNode=!0,this._textureAtlas=e.getTextureAtlas(),this._batchNode=e},setTextureRect:function(e){var t=cc.RECT_POINTS_TO_PIXELS(e);this.setTextureRectInPixels(t,!1,t.size)},setTextureRectInPixels:function(e,t,n){this._rectInPixels=e,this._rect=cc.RECT_PIXELS_TO_POINTS(e),this._rectRotated=t,this.setContentSizeInPixels(n),this._updateTextureCoords(this._rectInPixels);var r=this._unflippedOffsetPositionFromCenter;this._offsetPositionInPixels.x=r.x+(this._contentSizeInPixels.width-this._rectInPixels.size.width)/2,this._offsetPositionInPixels.y=r.y+(this._contentSizeInPixels.height-this._rectInPixels.size.height)/2;if(this._usesBatchNode)this._dirty=!0;else{var i=0+this._offsetPositionInPixels.x,s=0+this._offsetPositionInPixels.y,o=i+this._rectInPixels.size.width,u=s+this._rectInPixels.size.height;this._quad.bl.vertices=cc.vertex3(i,s,0),this._quad.br.vertices=cc.vertex3(o,s,0),this._quad.tl.vertices=cc.vertex3(i,u,0),this._quad.tr.vertices=cc.vertex3(o,u,0)}},_updateTextureCoords:function(e){if(cc.renderContextType==cc.WEBGL){var t=this._usesBatchNode?this._textureAtlas.getTexture():this._texture;if(!t)return;var n=t.getPixelsWide(),r=t.getPixelsHigh(),i,s,o,u;this._rectRotated?(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(2*e.origin.x+1)/(2*n),s=i+(e.size.height*2-2)/(2*n),o=(2*e.origin.y+1)/(2*r),u=o+(e.size.width*2-2)/(2*r)):(i=e.origin.x/n,s=i+e.size.height/n,o=e.origin.y/r,u=o+e.size.width/r),this._flipX&&cc.SWAP(o,u),this._flipY&&cc.SWAP(i,s),this._quad.bl.texCoords.u=i,this._quad.bl.texCoords.v=o,this._quad.br.texCoords.u=i,this._quad.br.texCoords.v=u,this._quad.tl.texCoords.u=s,this._quad.tl.texCoords.v=o,this._quad.tr.texCoords.u=s,this._quad.tr.texCoords.v=u):(cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(2*e.origin.x+1)/(2*n),s=i+(e.size.width*2-2)/(2*n),o=(2*e.origin.y+1)/(2*r),u=o+(e.size.height*2-2)/(2*r)):(i=e.origin.x/n,s=i+e.size.width/n,o=e.origin.y/r,u=o+e.size.height/r),this._flipX&&cc.SWAP(i,s),this._flipY&&cc.SWAP(o,u),this._quad.bl.texCoords.u=i,this._quad.bl.texCoords.v=u,this._quad.br.texCoords.u=s,this._quad.br.texCoords.v=u,this._quad.tl.texCoords.u=i,this._quad.tl.texCoords.v=o,this._quad.tr.texCoords.u=s,this._quad.tr.texCoords.v=o)}},updateTransform:function(){cc.Assert(this._usesBatchNode,"");if(!this._dirty)return;var e=new cc.AffineTransform;if(!this._isVisible){this._quad.br.vertices=this._quad.tl.vertices=this._quad.tr.vertices=this._quad.bl.vertices=cc.vertex3(0,0,0),this._textureAtlas.updateQuad(this._quad,this._atlasIndex),this._dirty=this._recursiveDirty=!1;return}if(!this._parent||this._parent==this._batchNode){var t=-cc.DEGREES_TO_RADIANS(this._rotation),n=Math.cos(t),r=Math.sin(t);e=cc.AffineTransformMake(n*this._scaleX,r*this._scaleX,-r*this._scaleY,n*this._scaleY,this._positionInPixels.x,this._positionInPixels.y);if(this._skewX||this._skewY){var i=cc.AffineTransformMake(1,Math.tan(cc.DEGREES_TO_RADIANS(this._skewY)),Math.tan(cc.DEGREES_TO_RADIANS(this._skewX)),1,0,0);e=cc.AffineTransformConcat(i,e)}e=cc.AffineTransformTranslate(e,-this._anchorPointInPixels.x,-this._anchorPointInPixels.y)}else{e=cc.AffineTransformIdentity();var s=cc.HONOR_PARENT_TRANSFORM_ALL;for(var o=this;o&&o!=this._batchNode;o=o.getParent()){var u=new cc.TransformValues;o._getTransformValues(u);if(!u.visible){this._quad.br.vertices=this._quad.tl.vertices=this._quad.tr.vertices=this._quad.bl.vertices=cc.vertex3(0,0,0),this._textureAtlas.updateQuad(this._quad,this._atlasIndex),this._dirty=this._recursiveDirty=!1;return}var a=cc.AffineTransformIdentity();s&cc.HONOR_PARENT_TRANSFORM_TRANSLATE&&(a=cc.AffineTransformTranslate(a,u.pos.x,u.pos.y)),s&cc.HONOR_PARENT_TRANSFORM_ROTATE&&(a=cc.AffineTransformRotate(a,-cc.DEGREES_TO_RADIANS(u.rotation)));if(s&cc.HONOR_PARENT_TRANSFORM_SKEW){var f=new cc.AffineTransform;f=cc.AffineTransformMake(1,Math.tan(cc.DEGREES_TO_RADIANS(u.skew.y)),Math.tan(cc.DEGREES_TO_RADIANS(u.skew.x)),1,0,0),a=cc.AffineTransformConcat(f,a)}s&cc.HONOR_PARENT_TRANSFORM_SCALE&&(a=cc.AffineTransformScale(a,u.scale.x,u.scale.y)),a=cc.AffineTransformTranslate(a,-u.ap.x,-u.ap.y),e=cc.AffineTransformConcat(e,a),s=o,this.getHonorParentTransform()}}var l=new cc.Size;l=this._rectInPixels.size;var c=this._offsetPositionInPixels.x,h=this._offsetPositionInPixels.y,p=c+l.width,d=h+l.height,v=e.tx,m=e.ty,g=e.a,y=e.b,b=e.d,w=-e.c,E=c*g-h*w+v,S=c*y+h*b+m,x=p*g-h*w+v,T=p*y+h*b+m,N=p*g-d*w+v,C=p*y+d*b+m,k=c*g-d*w+v,L=c*y+d*b+m;this._quad.bl.vertices=cc.vertex3(cc.RENDER_IN_SUBPIXEL(E),cc.RENDER_IN_SUBPIXEL(S),this._vertexZ),this._quad.br.vertices=cc.vertex3(cc.RENDER_IN_SUBPIXEL(x),cc.RENDER_IN_SUBPIXEL(T),this._vertexZ),this._quad.tl.vertices=cc.vertex3(cc.RENDER_IN_SUBPIXEL(k),cc.RENDER_IN_SUBPIXEL(L),this._vertexZ),this._quad.tr.vertices=cc.vertex3(cc.RENDER_IN_SUBPIXEL(N),cc.RENDER_IN_SUBPIXEL(C),this._vertexZ),this._textureAtlas.updateQuad(this._quad,this._atlasIndex),this._dirty=this._recursiveDirty=!1},_getTransformValues:function(e){return e.pos=this._positionInPixels,e.scale.x=this._scaleX,e.scale.y=this._scaleY,e.rotation=this._rotation,e.skew.x=this._skewX,e.skew.y=this._skewY,e.ap=this._anchorPointInPixels,e.visible=this._isVisible,e},draw:function(e){this._super();var t=e||cc.renderContext;if(cc.renderContextType==cc.CANVAS){t.globalAlpha=this._opacity/255,this._flipX&&t.scale(-1,1),this._flipY&&t.scale(1,-1);var n=this._offsetPositionInPixels,r=new cc.Point(0|-this._anchorPointInPixels.x+n.x,0|-this._anchorPointInPixels.y+n.y);this._texture?this._texture instanceof HTMLImageElement?this._contentSize.width==0&&this._contentSize.height==0?(this.setContentSize(new cc.Size(this._texture.width,this._texture.height)),this._rect.size.width=this._texture.width,this._rect.size.height=this._texture.height,t.drawImage(this._texture,r.x,-(r.y+this._texture.height))):t.drawImage(this._texture,this._rect.origin.x,this._rect.origin.y,this._rect.size.width,this._rect.size.height,r.x,-(r.y+this._rect.size.height),this._rect.size.width,this._rect.size.height):this._contentSize.width==0&&this._contentSize.height==0?(this.setContentSize(new cc.Size(this._texture.width,this._texture.height)),this._rect.size.width=this._texture.width,this._rect.size.height=this._texture.height,t.drawImage(this._texture,r.x,-(r.y+this._texture.height))):t.drawImage(this._texture,0,0,this._rect.size.width,this._rect.size.height,r.x,-(r.y+this._rect.size.height),this._rect.size.width,this._rect.size.height):(t.fillStyle="rgba("+this._color.r+","+this._color.g+","+this._color.b+",1)",t.fillRect(r.x,r.y,this._contentSize.width,this._contentSize.height));if(cc.SPRITE_DEBUG_DRAW==1){var i=this._contentSize,s=[cc.ccp(0,0),cc.ccp(i.width,0),cc.ccp(i.width,i.height),cc.ccp(0,i.height)];cc.drawingUtil.drawPoly(s,4,!0)}else if(cc.SPRITE_DEBUG_DRAW==2){var i=this._rect.size,o=this.getOffsetPositionInPixels(),s=[cc.ccp(o.x,o.y),cc.ccp(o.x+i.width,o.y),cc.ccp(o.x+i.width,o.y+i.height),cc.ccp(o.x,o.y+i.height)];cc.drawingUtil.drawPoly(s,4,!0)}}else{cc.Assert(!this._usesBatchNode,"");var u=this._blendFunc.src!=cc.BLEND_SRC||this._blendFunc.dst!=cc.BLEND_DST;u,this._texture;var a=this._quad,f=cc.offsetof(cc.V3F_C4B_T2F,cc.vertices);f=cc.offsetof(cc.V3F_C4B_T2F,cc.colors),f=cc.offsetof(cc.V3F_C4B_T2F,cc.texCoords),u;if(cc.SPRITE_DEBUG_DRAW==1){var i=this._contentSize,s=[cc.ccp(0,0),cc.ccp(i.width,0),cc.ccp(i.width,i.height),cc.ccp(0,i.height)];cc.drawingUtil.drawPoly(s,4,!0)}else if(cc.SPRITE_DEBUG_DRAW==2){var i=this._rect.size,o=new cc.Point;o=this.getOffsetPositionInPixels();var s=[cc.ccp(o.x,o.y),cc.ccp(o.x+i.width,o.y),cc.ccp(o.x+i.width,o.y+i.height),cc.ccp(o.x,o.y+i.height)];cc.drawingUtil.drawPoly(s,4,!0)}}},addChild:function(e,t,n){var r=arguments.length;switch(r){case 1:this._super(e);break;case 2:this._super(e,t);break;case 3:cc.Assert(e!=null,""),this._super(e,t,n);if(cc.renderContextType==cc.WEBGL){if(this._usesBatchNode){cc.Assert(e.getTexture().getName()==this._textureAtlas.getTexture().getName(),"");var i=this._batchNode.atlasIndexForChild(e,t);this._batchNode._insertChild(e,i)}this._hasChildren=!0}break;default:throw"Sprite.addChild():Argument must be non-nil "}},reorderChild:function(e,t){cc.Assert(e!=null,"child is null"),cc.Assert(this._children.indexOf(e)>-1,"");if(t==e.getZOrder())return;this._usesBatchNode?(this.removeChild(e,!1),this.addChild(e,t)):this._super(e,t)},removeChild:function(e,t){this._usesBatchNode&&this._batchNode.removeSpriteFromAtlas(e),this._super(e,t)},removeAllChildrenWithCleanup:function(e){if(this._usesBatchNode&&this._children!=null)for(var t=0;t<this._children.length;t++)this._children[t]instanceof cc.Sprite&&this._batchNode.removeSpriteFromAtlas(this._children[t]);this._super(e),this._hasChildren=!1},setDirtyRecursively:function(e){this._dirty=this._recursiveDirty=e;if(this._children!=null)for(var t in this._children)this._children[t]instanceof cc.Sprite&&this._children[t].setDirtyRecursively(!0)},SET_DIRTY_RECURSIVELY:function(){this._usesBatchNode&&!this._recursiveDirty&&(this._dirty=this._recursiveDirty=!0,this._hasChildren&&this.setDirtyRecursively(!0))},setPosition:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setPositionInPixels:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setRotation:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setSkewX:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setSkewY:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setScaleX:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setScaleY:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setScale:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setVertexZ:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setAnchorPoint:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setIsRelativeAnchorPoint:function(e){cc.Assert(!this._usesBatchNode,""),this._super(e)},setIsVisible:function(e){this._super(e),this.SET_DIRTY_RECURSIVELY()},setFlipX:function(e){this._flipX!=e&&(this._flipX=e,this.setTextureRectInPixels(this._rectInPixels,this._rectRotated,this._contentSizeInPixels),this.setNodeDirty())},setFlipY:function(e){this._flipY!=e&&(this._flipY=e,this.setNodeDirty())},isFlipX:function(){return this._flipX},isFlipY:function(){return this._flipY},updateColor:function(){var e=new cc.Color4B(this._color.r,this._color.g,this._color.b,this._opacity);this._quad.bl.colors=e,this._quad.br.colors=e,this._quad.tl.colors=e,this._quad.tr.colors=e,this._usesBatchNode&&(this._atlasIndex!=cc.SPRITE_INDEX_NOT_INITIALIZED?this._textureAtlas.updateQuad(this._quad,this._atlasIndex):this._dirty=!0)},getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e,this.setNodeDirty();return},getColor:function(){return this._opacityModifyRGB?new cc.Color3B(this._colorUnmodified):new cc.Color3B(this._color)},setColor:function(e){if(this._color.r==e.r&&this._color.g==e.g&&this._color.b==e.b)return;this._color=this._colorUnmodified=new cc.Color3B(e.r,e.g,e.b);if(this.getTexture()&&cc.renderContextType==cc.CANVAS){var t=cc.TextureCache.sharedTextureCache().getTextureColors(this._originalTexture);if(t){var n=cc.generateTintImage(this.getTexture(),t,this._color,this.getTextureRect());this.setTexture(n)}}this.updateColor(),this.setNodeDirty()},setIsOpacityModifyRGB:function(e){var t=this._color;this._opacityModifyRGB=e,this._color=t},getIsOpacityModifyRGB:function(){return this._opacityModifyRGB},setDisplayFrame:function(e){this.setNodeDirty(),this._unflippedOffsetPositionFromCenter=e.getOffsetInPixels();var t=e.getTexture();t!=this._texture&&this.setTexture(t),this._rectRotated=e.isRotated(),this._rectRotated&&this.setRotation(-90),this.setTextureRectInPixels(e.getRectInPixels(),e.isRotated(),e.getOriginalSizeInPixels())},setDisplayFrameWithAnimationName:function(e,t){cc.Assert(e,"");var n=cc.AnimationCache.sharedAnimationCache().animationByName(e);cc.Assert(n,"");var r=n.getFrames()[t];cc.Assert(r,""),this.setDisplayFrame(r)},isFrameDisplayed:function(e){return cc.renderContextType==cc.CANVAS?e.getTexture()!=this._texture?!1:cc.Rect.CCRectEqualToRect(e.getRect(),this._rect):cc.Rect.CCRectEqualToRect(e.getRect(),this._rect)&&e.getTexture().getName()==this._texture.getName()},displayedFrame:function(){return cc.renderContextType==cc.CANVAS?cc.SpriteFrame._frameWithTextureForCanvas(this._texture,this._rectInPixels,this._rectRotated,this._unflippedOffsetPositionFromCenter,this._contentSizeInPixels):cc.SpriteFrame.create(this._texture,this._rectInPixels,this._rectRotated,this._unflippedOffsetPositionFromCenter,this._contentSizeInPixels)},_updateBlendFunc:function(){cc.renderContextType==cc.WEBGL&&(cc.Assert(!this._usesBatchNode,"CCSprite: _updateBlendFunc doesn't work when the sprite is rendered using a CCSpriteSheet"),!this._texture||!this._texture.getHasPremultipliedAlpha()?(this._blendFunc.src=cc.GL_SRC_ALPHA,this._blendFunc.dst=cc.GL_ONE_MINUS_SRC_ALPHA,this.setIsOpacityModifyRGB(!1)):(this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this.setIsOpacityModifyRGB(!0)))},setTexture:function(e){cc.renderContextType!=cc.CANVAS&&cc.Assert(!this._usesBatchNode,"setTexture doesn't work when the sprite is rendered using a CCSpriteSheet"),this._texture=e,this._updateBlendFunc()},getTexture:function(){return this._texture}}),cc.Sprite.createWithTexture=function(e,t,n){var r=arguments.length,i=new cc.Sprite;switch(r){case 1:if(i&&i.initWithTexture(e))return i;return null;case 2:if(i&&i.initWithTexture(e,t))return i;return null;case 3:return cc.Assert(0,""),null;default:throw"Sprite.spriteWithTexture(): Argument must be non-nil "}},cc.Sprite.create=function(e,t){var n=arguments.length,r=new cc.Sprite;return n<2?r&&r.initWithFile(e)?r:null:r&&r.initWithFile(e,t)?r:null},cc.Sprite.createWithSpriteFrame=function(e){var t=new cc.Sprite;return t&&t.initWithSpriteFrame(e)?t:null},cc.Sprite.createWithBatchNode=function(e,t){var n=new cc.Sprite;return n&&n.initWithBatchNode(e,t)?n:null},cc.Animation=cc.Class.extend({_name:"",_delay:0,_frames:null,ctor:function(){this._frames=[]},getName:function(){return this._name},setName:function(e){this._name=e},getDelay:function(){return this._delay},setDelay:function(e){this._delay=e},getFrames:function(){return this._frames},setFrames:function(e){this._frames=e},initWithFrames:function(e,t){return this._delay=t,e?this._frames=e:this._frames=[],!0},addFrame:function(e){this._frames.push(e)},addFrameWithFileName:function(e){var t=cc.TextureCache.sharedTextureCache().addImage(e),n=cc.RectZero();t instanceof HTMLImageElement||t instanceof HTMLCanvasElement?n.size=cc.SizeMake(t.width,t.height):n.size=t.getContentSize();var r=cc.SpriteFrame.create(t,n);this._frames.push(r)},addFrameWithTexture:function(e,t){var n=cc.SpriteFrame.create(e,t);this._frames.push(n)},init:function(){return this.initWithFrames(null,0)}}),cc.Animation.create=function(e,t){var n=new cc.Animation;return e==null?n.init():(t||(t=0),n.initWithFrames(e,t)),n},cc.AnimationCache=cc.Class.extend({addAnimation:function(e,t){this._animations[t]=e},removeAnimationByName:function(e){if(!e)return;delete this._animations[e]},animationByName:function(e){return this._animations[e]},init:function(){return this._animations={},!0},_animations:null}),cc.AnimationCache.purgeSharedAnimationCache=function(){cc.sharedAnimationCache=null},cc.AnimationCache.sharedAnimationCache=function(){return cc.sharedAnimationCache==null&&(cc.sharedAnimationCache=new cc.AnimationCache,cc.sharedAnimationCache.init()),cc.sharedAnimationCache},cc.sharedAnimationCache=null,cc.SpriteFrame=cc.Class.extend({_rectInPixels:new cc.Rect,_rotated:null,_rect:new cc.Rect,_offsetInPixels:new cc.Point,_originalSizeInPixels:new cc.Size,_texture:null,getRectInPixels:function(){return this._rectInPixels},setRectInPixels:function(e){this._rectInPixels=e,this._rect=cc.RECT_PIXELS_TO_POINTS(e)},isRotated:function(){return this._rotated},setRotated:function(e){this._rotated=e},getRect:function(){return this._rect},setRect:function(e){this._rect=e,this._rectInPixels=cc.RECT_POINTS_TO_PIXELS(this._rect)},getOffsetInPixels:function(){return this._offsetInPixels},setOffsetInPixels:function(e){this._offsetInPixels=e},getOriginalSizeInPixels:function(){return this._originalSizeInPixels},setOriginalSizeInPixels:function(e){this._originalSizeInPixels=e},getTexture:function(){return this._texture},setTexture:function(e){this._texture=e},copyWithZone:function(){var e=new cc.SpriteFrame;return e.initWithTexture(this._texture,this._rectInPixels,this._rotated,this._offsetInPixels,this._originalSizeInPixels),e},initWithTexture:function(e,t,n,r,i){var s=arguments.length;switch(s){case 2:var o=cc.RECT_POINTS_TO_PIXELS(t);return this.initWithTexture(e,o,!1,cc.PointZero(),o.size);case 5:return this._texture=e,this._rectInPixels=t,this._rect=cc.RECT_PIXELS_TO_POINTS(t),this._rotated=n,this._offsetInPixels=r,this._originalSizeInPixels=i,!0;default:throw"Argument must be non-nil "}}}),cc.SpriteFrame.create=function(e,t,n,r,i){var s=arguments.length,o=new cc.SpriteFrame;switch(s){case 2:o.initWithTexture(e,t);break;case 5:o.initWithTexture(e,t,n,r,i);break;default:throw"Argument must be non-nil "}return o},cc.SpriteFrame._frameWithTextureForCanvas=function(e,t,n,r,i){var s=new cc.SpriteFrame;return s._texture=e,s._rectInPixels=t,s._rect=cc.RECT_PIXELS_TO_POINTS(t),s._rotated=n,s._offsetInPixels=r,s._originalSizeInPixels=i,s},cc.SpriteFrameCache=cc.Class.extend({_spriteFrames:null,_spriteFramesAliases:null,ctor:function(){this._spriteFrames={},this._spriteFramesAliases={}},addSpriteFramesWithDictionary:function(e,t){var n=e.metadata,r=e.frames,i=0;n!=null&&(i=parseInt(this._valueForKey("format",n))),cc.Assert(i>=0&&i<=3,"");var s=null;for(var o in r){s=r[o];if(s){var u=this._spriteFrames[o];if(u)continue;if(i==0){var a=parseFloat(this._valueForKey("x",s)),f=parseFloat(this._valueForKey("y",s)),l=parseFloat(this._valueForKey("width",s)),c=parseFloat(this._valueForKey("height",s)),h=parseFloat(this._valueForKey("offsetX",s)),p=parseFloat(this._valueForKey("offsetY",s)),d=parseInt(this._valueForKey("originalWidth",s)),v=parseInt(this._valueForKey("originalHeight",s));(!d||!v)&&cc.Log("cocos2d: WARNING: originalWidth/Height not found on the cc.SpriteFrame. AnchorPoint won't work as expected. Regenrate the .plist"),d=Math.abs(d),v=Math.abs(v),u=new cc.SpriteFrame,u.initWithTexture(t,cc.RectMake(a,f,l,c),!1,cc.PointMake(h,p),cc.SizeMake(d,v))}else if(i==1||i==2){var m=cc.RectFromString(this._valueForKey("frame",s)),g=!1;i==2&&(g=this._valueForKey("rotated",s)=="true");var y=cc.PointFromString(this._valueForKey("offset",s)),b=cc.SizeFromString(this._valueForKey("sourceSize",s));u=new cc.SpriteFrame,u.initWithTexture(t,m,g,y,b)}else if(i==3){var w=new cc.Size,E=new cc.Point,S=new cc.Size,x=new cc.Rect;w=cc.SizeFromString(this._valueForKey("spriteSize",s)),E=cc.PointFromString(this._valueForKey("spriteOffset",s)),S=cc.SizeFromString(this._valueForKey("spriteSourceSize",s)),x=cc.RectFromString(this._valueForKey("textureRect",s));var T=this._valueForKey("textureRotated",s)=="true",N=s.aliases,C=o.toString();for(var k in N)this._spriteFramesAliases.hasOwnProperty(N[k])&&cc.Log("cocos2d: WARNING: an alias with name "+k+" already exists"),this._spriteFramesAliases[N[k]]=C;u=new cc.SpriteFrame,u.initWithTexture(t,cc.RectMake(x.origin.x,x.origin.y,w.width,w.height),T,E,S)}if(u.isRotated()){var L=u.getRect();u.setRect(new cc.Rect(L.origin.x,L.origin.y,L.size.height,L.size.width))}this._spriteFrames[o]=u}}},addSpriteFramesWithJson:function(e){var t=e,n="",r=t.metadata;r&&(n=this._valueForKey("textureFileName",r),n=n.toString());var i=cc.TextureCache.sharedTextureCache().addImage(n);i?this.addSpriteFramesWithDictionary(t,i):cc.Log("cocos2d: cc.SpriteFrameCache: Couldn't load texture")},addSpriteFramesWithFile:function(e,t){var n=arguments.length,r=cc.FileUtils.dictionaryWithContentsOfFileThreadSafe(e);switch(n){case 1:var i="",s=r.metadata;s&&(i=this._valueForKey("textureFileName",s).toString());if(i!=""){var o=e.lastIndexOf("/"),u;u=o?e.substring(0,o+1):"",i=u+i}else{i=e;var a=i.lastIndexOf(".",i.length);i=i.substr(0,a),i+=".png",cc.Log("cocos2d: cc.SpriteFrameCache: Trying to use file "+i.toString()+" as texture")}var t=cc.TextureCache.sharedTextureCache().addImage(i);t?this.addSpriteFramesWithDictionary(r,t):cc.Log("cocos2d: cc.SpriteFrameCache: Couldn't load texture");break;case 2:if(arguments[1]instanceof cc.Texture2D)this.addSpriteFramesWithDictionary(r,t);else{var e=arguments[0],f=arguments[1];cc.Assert(f,"texture name should not be null");var t=cc.TextureCache.sharedTextureCache().addImage(f);t?this.addSpriteFramesWithDictionary(r,t):cc.Log("cocos2d: cc.SpriteFrameCache: couldn't load texture file. File not found "+f)}break;default:throw"Argument must be non-nil "}},addSpriteFrame:function(e,t){this._spriteFrames[t]=e},removeSpriteFrames:function(){this._spriteFrames=[],this._spriteFramesAliases=[]},removeSpriteFrameByName:function(e){if(!e)return;this._spriteFramesAliases.hasOwnProperty(e)&&delete this._spriteFramesAliases[e],this._spriteFrames.hasOwnProperty(e)&&delete this._spriteFrames[e]},removeSpriteFramesFromFile:function(e){var t=cc.FileUtils.fullPathFromRelativePath(e),n=cc.FileUtils.dictionaryWithContentsOfFileThreadSafe(t);this.removeSpriteFramesFromDictionary(n)},removeSpriteFramesFromDictionary:function(e){var t=e.frames;for(var n in t)this._spriteFrames.hasOwnProperty(n)&&delete this._spriteFrames[n]},removeSpriteFramesFromTexture:function(e){var t=null;for(var n in this._spriteFrames){var r=this._spriteFrames[n];r&&r.getTexture()==e&&delete this._spriteFrames[n]}},spriteFrameByName:function(e){var t;this._spriteFrames.hasOwnProperty(e)&&(t=this._spriteFrames[e]);if(!t){var n;this._spriteFramesAliases.hasOwnProperty(e)&&(n=this._spriteFramesAliases[e]),n&&(this._spriteFrames.hasOwnProperty(n.toString())&&(t=this._spriteFrames[n.toString()]),t||cc.Log("cocos2d: cc.SpriteFrameCahce: Frame "+e+" not found"))}return t},_valueForKey:function(e,t){return t&&t.hasOwnProperty(e)?t[e].toString():""}}),cc.sharedSpriteFrameCache=null,cc.SpriteFrameCache.sharedSpriteFrameCache=function(){return cc.sharedSpriteFrameCache||(cc.sharedSpriteFrameCache=new cc.SpriteFrameCache),cc.sharedSpriteFrameCache},cc.SpriteFrameCache.purgeSharedSpriteFrameCache=function(){cc.sharedSpriteFrameCache=null},cc.DEFAULT_CAPACITY=29,cc.UINT_MAX=4294967295,cc.GL_SRC_ALPHA=770,cc.GL_ONE_MINUS_SRC_ALPHA=771,cc.SpriteBatchNode=cc.Node.extend({_textureAtlas:new cc.TextureAtlas,_blendFunc:new cc.BlendFunc(0,0),_descendants:[],_renderTexture:null,_isUseCache:!1,_originalTexture:null,ctor:function(e){this._super(),e&&this.initWithFile(e,cc.DEFAULT_CAPACITY),this.setContentSize(new cc.Size(cc.canvas.width,cc.canvas.height)),this._renderTexture=cc.RenderTexture.create(cc.canvas.width,cc.canvas.height)},_updateBlendFunc:function(){this._textureAtlas.getTexture().getHasPremultipliedAlpha()||(this._blendFunc.src=cc.GL_SRC_ALPHA,this._blendFunc.dst=cc.GL_ONE_MINUS_SRC_ALPHA)},addQuadFromSprite:function(e,t){cc.Assert(e!=null,"SpriteBatchNode.addQuadFromSprite():Argument must be non-nil"),e.useBatchNode(this),e.setAtlasIndex(t);var n=e.getQuad();this._textureAtlas.insertQuad(n,t),e.setDirty(!0),e.updateTransform(),this._children=cc.ArrayAppendObjectToIndex(this._children,e,t)},addSpriteWithoutQuad:function(e,t,n){cc.Assert(e!=null,"SpriteBatchNode.addQuadFromSprite():Argument must be non-nil"),e.setAtlasIndex(t);var r=0;if(this._descendants&&this._descendants.length>0){var i=null;for(var s=0;s<this._descendants.length;s++)i=this._descendants[s],i&&i.getAtlasIndex()>=t&&++r}return this._descendants=cc.ArrayAppendObjectToIndex(this._descendants,e,r),this.addChild(e,t,n,!0),this},getTextureAtlas:function(){return this._textureAtlas},setTextureAtlas:function(e){e!=this._textureAtlas&&(this._textureAtlas=e)},getDescendants:function(){return this._descendants},initWithTexture:function(e,t){return this._children=[],this._descendants=[],this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._textureAtlas=new cc.TextureAtlas,this._textureAtlas.initWithTexture(e,t),cc.renderContextType==cc.CANVAS&&(this._originalTexture=e),cc.renderContextType==cc.WEBGL&&this._updateBlendFunc(),!0},setNodeDirty:function(){this._setNodeDirtyForCache(),this._isTransformDirty=this._isInverseDirty=!0,cc.NODE_TRANSFORM_USING_AFFINE_MATRIX&&(this._isTransformGLDirty=!0)},_setNodeDirtyForCache:function(){this._isCacheDirty=!0},setContentSizeInPixels:function(e){if(!e)return;this._super(e),this._renderTexture.setContentSize(e)},initWithFile:function(e,t){var n=cc.TextureCache.sharedTextureCache().textureForKey(e);return n||(n=cc.TextureCache.sharedTextureCache().addImage(e)),this.initWithTexture(n,t)},increaseAtlasCapacity:function(){var e=(this._textureAtlas.getCapacity()+1)*4/3;cc.Log("cocos2d: CCSpriteBatchNode: resizing TextureAtlas capacity from "+this._textureAtlas.getCapacity()+" to ["+e+"]."),this._textureAtlas.resizeCapacity(e)||(cc.Log("cocos2d: WARNING: Not enough memory to resize the atlas"),cc.Assert(!1,"Not enough memory to resize the atla"))},removeChildAtIndex:function(e,t){this.removeChild(this._children[e],t)},insertChild:function(e,t){e.useBatchNode(this),e.setAtlasIndex(t),e.setDirty(!0),this._textureAtlas.getTotalQuads()==this._textureAtlas.getCapacity()&&this.increaseAtlasCapacity();var n=e.getQuad();this._textureAtlas.insertQuad(n,t),this._descendants=cc.ArrayAppendObjectToIndex(this._descendants,e,t);var r=0;if(this._descendants&&this._descendants.length>0)for(var t=0;t<this._descendants.length;t++){var i=this._descendants[t];i&&(r>t&&i.setAtlasIndex(i.getAtlasIndex()+1),++r)}var s=e.getChildren();if(s&&s.length>0)for(t=0;t<this._descendants.length;t++){i=this._descendants[t];if(i){var o=this.atlasIndexForChild(i,i.getZOrder());this.insertChild(i,o)}}},removeSpriteFromAtlas:function(e){this._textureAtlas.removeQuadAtIndex(e.getAtlasIndex()),e.useSelfRender();var t=cc.ArrayGetIndexOfObject(this._descendants,e);if(t!=-1){cc.ArrayRemoveObjectAtIndex(this._descendants,t);var n=this._descendants.length;for(;t<n;++t){var r=this._descendants[t];r.setAtlasIndex(r.getAtlasIndex()-1)}}var i=e.getChildren();if(i&&i.length>0)for(var s=0;s<i.length;s++)i[s]&&this.removeSpriteFromAtlas(i[s])},rebuildIndexInOrder:function(e,t){var n=e.getChildren();if(n&&n.length>0)for(var r=0;r<n.length;r++){var i=n[r];i&&i.getZOrder()<0&&(t=this.rebuildIndexInOrder(i,t))}e.isEqual(this)||(e.setAtlasIndex(t),t++);if(n&&n.length>0)for(r=0;r<n.length;r++)i=n[r],i&&i.getZOrder()>=0&&(t=this.rebuildIndexInOrder(i,t));return t},highestAtlasIndexInChild:function(e){var t=e.getChildren();return!t||t.length==0?e.getAtlasIndex():this.highestAtlasIndexInChild(t.pop())},lowestAtlasIndexInChild:function(e){var t=e.getChildren();return!t||t.length==0?e.getAtlasIndex():this.lowestAtlasIndexInChild(t.pop())},atlasIndexForChild:function(e,t){var n=e.getParent().getChildren(),r=cc.ArrayGetIndexOfObject(n,e),i=e.getParent()==this,s=null;r>0&&r<cc.UINT_MAX&&(s=n[r-1]);if(i)return r==0?0:this.highestAtlasIndexInChild(s)+1;if(r==0){var o=e.getParent();return t<0?o.getAtlasIndex():o.getAtlasIndex()+1}if(s.getZOrder()<0&&t<0||s.getZOrder()>=0&&t>=0)return this.highestAtlasIndexInChild(s)+1;var o=e.getParent();return o.getAtlasIndex()+1},getTexture:function(){return this._textureAtlas.getTexture()},setTexture:function(e){this._textureAtlas.setTexture(e);for(var t=0;t<this._children.length;t++)this._children[t].setTexture(e)},setBlendFunc:function(e){this._blendFunc=e},getBlendFunc:function(){return this._blendFunc},visit:function(e){if(cc.renderContextType==cc.CANVAS){var t=e||cc.renderContext;if(!this._isVisible)return;t.save(),this._grid&&this._grid.isActive()&&(this._grid.beforeDraw(),this.transformAncestors()),this.transform();if(this._isUseCache){if(this._isCacheDirty){this._renderTexture.clear(),this._renderTexture.context.translate(this._anchorPointInPixels.x,-this._anchorPointInPixels.y);if(this._children)for(var n=0;n<this._children.length;n++)this._children[n]&&this._children[n].visit(this._renderTexture.context);this._isCacheDirty=!1}this.draw()}else if(this._children)for(var n=0;n<this._children.length;n++)this._children[n]&&this._children[n].visit(t);this._grid&&this._grid.isActive()&&this._grid.afterDraw(this),t.restore()}},addChild:function(e,t,n){switch(arguments.length){case 1:this._super(e);break;case 2:this._super(e,t);break;case 3:cc.Assert(e!=null,"SpriteBatchNode.addChild():child should not be null");var r=e;cc.renderContextType!=cc.CANVAS&&cc.Assert(r.getTexture().getName()==this._textureAtlas.getTexture().getName(),"SpriteBatchNode.addChild():check CCSprite is using the same texture id"),this._super(e,t,n);var i=this.atlasIndexForChild(r,t);this.insertChild(r,i);break;case 4:arguments[3]&&this._super(e,t,n);break;default:throw"Argument must be non-nil "}this.setNodeDirty()},reorderChild:function(e,t){cc.Assert(e!=null,"SpriteBatchNode.addChild():the child should not be null"),cc.Assert(this._children.indexOf(e)>-1,"SpriteBatchNode.addChild():sprite batch node should contain the child");if(t==e.getZOrder())return;this.removeChild(e,!1),this.addChild(e,t),this.setNodeDirty()},removeChild:function(e,t){if(e==null)return;cc.Assert(this._children.indexOf(e)>-1,"SpriteBatchNode.addChild():sprite batch node should contain the child"),this.removeSpriteFromAtlas(e),this._super(e,t)},removeAllChildrenWithCleanup:function(e){if(this._children&&this._children.length>0)for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&this.removeSpriteFromAtlas(n)}this._super(e),this._descendants=[],this._textureAtlas.removeAllQuads()},draw:function(e){this._super();if(cc.renderContextType==cc.CANVAS){var t=e||cc.renderContext,n=new cc.Point(0|-this._anchorPointInPixels.x,0|-this._anchorPointInPixels.y);this._renderTexture&&t.drawImage(this._renderTexture.getCanvas(),n.x,-(n.y+this._renderTexture.getCanvas().height))}else{if(this._textureAtlas.getTotalQuads()==0)return;if(this._descendants&&this._descendants.length>0){var r=null;for(var i=0;i<this._descendants.length;i++){r=this._descendants[i];if(r){r.updateTransform();var s=r.boundingBox(),o=[cc.ccp(s.origin.x,s.origin.y),cc.ccp(s.origin.x+s.size.width,s.origin.y),cc.ccp(s.origin.x+s.size.width,s.origin.y+s.size.height),cc.ccp(s.origin.x,s.origin.y+s.size.height)];cc.drawingUtil.drawPoly(o,4,!0)}}}var u=this._blendFunc.src!=cc.BLEND_SRC||this._blendFunc.dst!=cc.BLEND_DST;u,this._textureAtlas.drawQuads(),u}}}),cc.SpriteBatchNode.create=function(e,t){t||(t=cc.DEFAULT_CAPACITY);var n=new cc.SpriteBatchNode;return n.initWithFile(e,t),n},cc.SpriteBatchNode.createWithTexture=function(e,t){t||(t=cc.DEFAULT_CAPACITY);var n=new cc.SpriteBatchNode;return n.initWithTexture(e,t),n},cc.LabelAtlas=cc.AtlasNode.extend({initWithString:function(e,t,n,r,i){return cc.Assert(e!=null,""),this.initWithTileFile(t,n,r,e.length)?(this._mapStartChar=i,this.setString(e),!0):!1},updateAtlasValues:function(){var e=this.getTexture();for(var t=0;t<this._string.length;t++){var n=this._string.charCodeAt(t)-this._mapStartChar.charCodeAt(0),r=parseInt(n%this._itemsPerRow),i=parseInt(n/this._itemsPerRow),s=cc.RectMake(r*this._itemWidth,i*this._itemHeight,this._itemWidth,this._itemHeight),o=this._string.charCodeAt(t),u=this.getChildByTag(t);u?o==32?(u.init(),u.setTextureRect(cc.RectMake(0,0,0,0))):(u.initWithTexture(e,s),u.setIsVisible(!0),u.setOpacity(this._opacity)):(u=new cc.Sprite,o==32?(u.init(),u.setTextureRect(cc.RectMake(0,0,0,0))):u.initWithTexture(e,s),this.addChild(u,0,t)),u.setPosition(new cc.Point(t*this._itemWidth+this._itemWidth/2,this._itemHeight/2))}},setString:function(e){this._string=e;var t=e.length;this._textureAtlas.resizeCapacity(t);var n=new cc.Size;n.width=t*this._itemWidth,n.height=this._itemHeight,this.setContentSizeInPixels(n);if(this._children)for(var r=0;r<this._children.length;r++){var i=this._children[r];i&&i.setIsVisible(!1)}this.updateAtlasValues()},setColor:function(e){this._super(e),this.updateAtlasValues()},getString:function(){return this._string},draw:function(){this._super();if(cc.LABELATLAS_DEBUG_DRAW){var e=this.getContentSize(),t=[cc.ccp(0,0),cc.ccp(e.width,0),cc.ccp(e.width,e.height),cc.ccp(0,e.height)];cc.drawingUtil.drawPoly(t,4,!0)}},convertToLabelProtocol:function(){return this},_string:null,_mapStartChar:null}),cc.LabelAtlas.create=function(e,t,n,r,i){var s=new cc.LabelAtlas;return s&&s.initWithString(e,t,n,r,i)?s:null},cc.LabelTTF=cc.Sprite.extend({_dimensions:null,_alignment:cc.TEXT_ALIGNMENT_CENTER,_fontName:"Arial",_fontSize:0,_string:null,_fontStyleStr:null,ctor:function(){this._super(),this._string="",this._color=cc.WHITE(),this._opacityModifyRGB=!1,this._fontStyleStr=""},description:function(){return"<cc.LabelTTF | FontName ="+this._fontName+" FontSize = "+this._fontSize.toFixed(1)+">"},initWithString:function(e,t,n,r,i){return cc.Assert(e!=null,"cc.LabelTTF.initWithString() label is null"),arguments.length>3?this.init()?(this._dimensions=cc.SizeMake(t.width*cc.CONTENT_SCALE_FACTOR(),t.height*cc.CONTENT_SCALE_FACTOR()),this._alignment=n,this._fontName=r,this._fontSize=i*cc.CONTENT_SCALE_FACTOR(),this.setString(e),this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'",!0):!1:(r=arguments[1],i=arguments[2],this.init()?(this._dimensions=cc.SizeZero(),this._fontName=r,this._fontSize=i*cc.CONTENT_SCALE_FACTOR(),this.setString(e),this._fontStyleStr=this._fontSize+"px '"+this._fontName+"'",!0):!1)},setString:function(e){this._string=e,cc.renderContext.save(),cc.renderContext.font=this._fontSize+"px '"+this._fontName+"'";var t=cc.renderContext.measureText(this._string);this.setContentSize(new cc.Size(t.width,this._fontSize)),cc.renderContext.restore(),this.setNodeDirty();return;var n,r},draw:function(e){if(cc.renderContextType==cc.CANVAS){var t=e||cc.renderContext;this._flipX&&t.scale(-1,1),this._flipY&&t.scale(1,-1);var n=this._color;t.fillStyle="rgba("+n.r+","+n.g+","+n.b+", "+this._opacity/255+")",t.font!=this._fontStyleStr&&(t.font=this._fontStyleStr);var r=0;switch(this._alignment){case cc.TEXT_ALIGNMENT_LEFT:r=-(this._dimensions.width-this._contentSize.width)/2;break;case cc.TEXT_ALIGNMENT_RIGHT:r=(this._dimensions.width-this._contentSize.width)/2;break;default:}this._contentSize.width>this._dimensions.width&&this._dimensions.width!==0?this._wrapText(t,this._string,-this._dimensions.width*this._anchorPoint.x,-this._dimensions.height*this._anchorPoint.y,this._dimensions.width,this._fontSize*1.2,this._alignment):t.fillText(this._string,-this._contentSize.width*this._anchorPoint.x+r,this._contentSize.height*this._anchorPoint.y)}},_wrapText:function(e,t,n,r,i,s,o){var u=t.split(" "),a="";for(var f=0;f<u.length;f++){var l=a+u[f]+" ",c=e.measureText(l).width-e.measureText(" ").width;if(c>=i){var h=c-e.measureText(u[f]).width-2*e.measureText(" ").width,p;switch(o){case cc.TEXT_ALIGNMENT_LEFT:p=0;break;case cc.TEXT_ALIGNMENT_RIGHT:p=i-h;break;default:p=(i-h)/2}e.fillText(a,n+p,r),r+=s,a=u[f]+" "}else a=l,f==u.length-1&&e.fillText(a,n+p,r)}},getString:function(){return this._string},convertToLabelProtocol:function(){return this}}),cc.LabelTTF.create=function(e,t,n,r,i){var s=new cc.LabelTTF;return arguments.length>3?s!=null&&s.initWithString(e,t,n,r,i)?s:null:(r=arguments[1],i=arguments[2],s!=null&&s.initWithString(e,r,i)?s:null)},cc._KerningHashElement=function(e,t){this.key=e,this.amount=t},cc._BMFontDef=function(e,t,n,r,i){this.charID=e||0,this.rect=t||new cc.RectMake(0,0,10,10),this.xOffset=n||0,this.yOffset=r||0,this.xAdvance=i||0},cc._BMFontPadding=function(e,t,n,r){this.left=e||0,this.top=t||0,this.right=n||0,this.bottom=r||0},cc.BMFontConfiguration=cc.Class.extend({bitmapFontArray:{},commonHeight:0,padding:new cc._BMFontPadding,atlasName:"",kerningDictionary:{},description:function(){var e="<cc.BMFontConfiguration | Kernings:"+this.kerningDictionary+" | Image = "+this.atlasName.toString()+">";return e},initWithFNTfile:function(e){return cc.Assert(e!=null&&e.length!=0,""),this._parseConfigFile(e),!0},_parseConfigFile:function(e){var t=cc.SAXParser.shareParser().getList(e);cc.Assert(t,"cc.BMFontConfiguration._parseConfigFile | Open file error.");var n,r;r=/padding+[a-z0-9\-= ",]+/gi,n=r.exec(t)[0],n&&this._parseInfoArguments(n),r=/common lineHeight+[a-z0-9\-= ",]+/gi,n=r.exec(t)[0],n&&this._parseCommonArguments(n),r=/page id=[a-zA-Z0-9\.\-= ",]+/gi,n=r.exec(t)[0],n&&this._parseImageFileName(n,e),r=/chars c+[a-z0-9\-= ",]+/gi,n=r.exec(t)[0],n,r=/char id=\w[a-z0-9\-= ]+/gi,n=t.match(r);if(n)for(var i=0;i<n.length;i++){var s=new cc._BMFontDef;this._parseCharacterDefinition(n[i],s),this.bitmapFontArray[s.charID]=s}r=/kernings count+[a-z0-9\-= ",]+/gi,r.test(t)&&(n=RegExp.$1[0]),n&&this._parseKerningCapacity(n),r=/first=\w[a-z0-9\-= ]+/gi,n=t.match(r);if(n)for(var i=0;i<n.length;i++)this._parseKerningEntry(n[i])},_parseCharacterDefinition:function(e,t){var n=/id=(\d+)/gi.exec(e)[1];t.charID=n.toString(),n=/x=([\-\d]+)/gi.exec(e)[1],t.rect.origin.x=parseInt(n),n=/y=([\-\d]+)/gi.exec(e)[1],t.rect.origin.y=parseInt(n),n=/width=([\-\d]+)/gi.exec(e)[1],t.rect.size.width=parseInt(n),n=/height=([\-\d]+)/gi.exec(e)[1],t.rect.size.height=parseInt(n),n=/xoffset=([\-\d]+)/gi.exec(e)[1],t.xOffset=parseInt(n),n=/yoffset=([\-\d]+)/gi.exec(e)[1],t.yOffset=parseInt(n),n=/xadvance=([\-\d]+)/gi.exec(e)[1],t.xAdvance=parseInt(n)},_parseInfoArguments:function(e){var t=/padding=(\d+)[,](\d+)[,](\d+)[,](\d+)/gi.exec(e);this.padding.left=t[1],this.padding.top=t[2],this.padding.right=t[3],this.padding.bottom=t[4]},_parseCommonArguments:function(e){var t;this.commonHeight=/lineHeight=(\d+)/gi.exec(e)[1],t=/pages=(\d+)/gi.exec(e)[1],cc.Assert(parseInt(t)==1,"cc.BitfontAtlas: only supports 1 page")},_parseImageFileName:function(e,t){var n;n=/id=(\d+)/gi.exec(e)[1],cc.Assert(parseInt(n)==0,"LabelBMFont file could not be found"),n=/file="([a-zA-Z0-9\-\._]+)/gi.exec(e)[1],this.atlasName=cc.FileUtils.fullPathFromRelativeFile(n,t)},_parseKerningCapacity:function(e){},_parseKerningEntry:function(e){var t=/first=([\-\d]+)/gi.exec(e)[1],n=parseInt(t);t=/second=([\-\d]+)/gi.exec(e)[1];var r=parseInt(t);t=/amount=([\-\d]+)/gi.exec(e)[1];var i=parseInt(t),s=new cc._KerningHashElement;s.amount=i,s.key=n<<16|r&65535,this.kerningDictionary[s.key]=s},_purgeKerningDictionary:function(){this.kerningDictionary={}}}),cc.BMFontConfiguration.create=function(e){var t=new cc.BMFontConfiguration;return t.initWithFNTfile(e)?t:null},cc.LabelBMFont=cc.SpriteBatchNode.extend({_opacity:0,_color:null,_isOpacityModifyRGB:!1,_string:"",_configuration:null,ctor:function(){this._super();if(cc.LABELBMFONT_DEBUG_DRAW){this.draw();var e=this.getContentSize(),t=[cc.ccp(0,0),cc.ccp(e.width,0),cc.ccp(e.width,e.height),cc.ccp(0,e.height)];cc.drawPoly(t,4,!0)}},getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e;if(this._children)for(var t=0,n=this._children.length;t<n;t++){var r=this._children[t];r&&r.setOpacity(this._opacity)}},getColor:function(){return this._color},setColor:function(e){if(this._color.r==e.r&&this._color.g==e.g&&this._color.b==e.b)return;this._color=e;if(this.getTexture()&&cc.renderContextType==cc.CANVAS){var t=cc.TextureCache.sharedTextureCache().getTextureColors(this._originalTexture);if(t){var n=this.getTexture(),r=new cc.Rect(0,0,n.width,n.height),i=cc.generateTintImage(n,t,this._color,r),s=new Image;s.src=i.toDataURL(),this.setTexture(s)}}},getIsOpacityModifyRGB:function(){return this._isOpacityModifyRGB},setIsOpacityModifyRGB:function(e){this._isOpacityModifyRGB=e;if(this._children&&this._children.length!=0)for(var t=0,n=this._children.length;t<n;t++){var r=this._children[t];if(r){var i=r instanceof cc.RGBAProtocol;i&&i.setIsOpacityModifyRGB(this._isOpacityModifyRGB)}}},initWithString:function(e,t){return cc.Assert(e!=null,""),this._configuration=cc.FNTConfigLoadFile(t),cc.Assert(this._configuration,"Error creating config for LabelBMFont"),this.initWithFile(this._configuration.atlasName,e.length)?(this._opacity=255,this._color=cc.WHITE(),this._contentSize=cc.SizeZero(),this.setAnchorPoint(cc.ccp(.5,.5)),this.setString(e),!0):!1},createFontChars:function(){var e=0,t=0,n=-1,r=0,i=cc.SizeZero(),s=0,o=0,u=1,a=this._string.length;if(a==0)return;for(var f=0;f<a;f++){var l=this._string.charCodeAt(f);l==10&&u++}o=this._configuration.commonHeight*u,t=-(this._configuration.commonHeight-this._configuration.commonHeight*u);for(var f=0;f<a;f++){var l=this._string.charCodeAt(f);if(l==10){e=0,t-=this._configuration.commonHeight;continue}r=this._kerningAmountForFirst(n,l);var c=this._configuration.bitmapFontArray[l],h=c.rect,p=this.getChildByTag(f);p?l==32?(p.init(),p.setTextureRect(cc.RectMake(0,0,0,0))):(p.initWithBatchNodeRectInPixels(this,h),p.setIsVisible(!0),p.setOpacity(255)):(p=new cc.Sprite,l==32?(p.init(),p.setTextureRect(h)):p.initWithBatchNodeRectInPixels(this,h),this.addChild(p,0,f));var d=this._configuration.commonHeight-c.yOffset;p.setPositionInPixels(cc.ccp(e+c.xOffset+c.rect.size.width/2+r,t+d-h.size.height/2)),e+=this._configuration.bitmapFontArray[l].xAdvance+r,n=l,p.setIsOpacityModifyRGB(this._isOpacityModifyRGB),this._opacity!=255&&p.setOpacity(this._opacity),s<e&&(s=e)}i.width=s,i.height=o,this.setContentSizeInPixels(i)},getString:function(){return this._string},setString:function(e){this._string=e;if(this._children)for(var t=0;t<this._children.length;t++){var n=this._children[t];n&&n.setIsVisible(!1)}this.createFontChars()},setCString:function(e){this.setString(e)},setAnchorPoint:function(e){cc.Point.CCPointEqualToPoint(e,this._anchorPoint)||(this._super(e),this.createFontChars())},_atlasNameFromFntFile:function(e){},_kerningAmountForFirst:function(e,t){var n=0,r=e<<16|t&65535;if(this._configuration.kerningDictionary){var i=this._configuration.kerningDictionary[r.toString()];i&&(n=i.amount)}return n}}),cc.LabelBMFont.create=function(e,t){var n=new cc.LabelBMFont;return n&&n.initWithString(e,t)?n:null},cc.configurations=null,cc.FNTConfigLoadFile=function(e){cc.configurations||(cc.configurations={});var t=cc.configurations[e];return t||(t=cc.BMFontConfiguration.create(e)),t},cc.purgeCachedData=function(){cc.FNTConfigRemoveCache()},cc.FNTConfigRemoveCache=function(){cc.configurations&&(cc.configurations={})},cc.PARTICLE_SHAPE_MODE=0,cc.PARTICLE_TEXTURE_MODE=1,cc.PARTICLE_STAR_SHAPE=0,cc.PARTICLE_BALL_SHAPE=1,cc.CCPARTICLE_DURATION_INFINITY=-1,cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE=-1,cc.CCPARTICLE_START_RADIUS_EQUAL_TO_END_RADIUS=-1,cc.PARTICLE_START_SIZE_EQUAL_TO_END_SIZE=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,cc.PARTICLE_DURATION_INFINITY=cc.CCPARTICLE_DURATION_INFINITY,cc.CCPARTICLE_MODE_GRAVITY=0,cc.CCPARTICLE_MODE_RADIUS=1,cc.CCPARTICLE_TYPE_FREE=0,cc.CCPARTICLE_TYPE_RELATIVE=1,cc.CCPARTICLE_TYPE_GROUPED=2,cc.PARTICLE_TYPE_FREE=cc.CCPARTICLE_TYPE_FREE,cc.PARTICLE_TYPE_GROUPED=cc.CCPARTICLE_TYPE_GROUPED,cc.Particle=function(e,t,n,r,i,s,o,u,a,f,l){this.pos=e?e:cc.PointZero(),this.startPos=t?t:cc.PointZero(),this.color=n?n:new cc.Color4F(0,0,0,1),this.deltaColor=r?r:new cc.Color4F(0,0,0,1),this.size=i||0,this.deltaSize=s||0,this.rotation=o||0,this.deltaRotation=u||0,this.timeToLive=a||0,this.modeA=f?f:new cc.Particle.ModeA,this.modeB=l?l:new cc.Particle.ModeB,this.isChangeColor=!1,this.drawPos=new cc.Point(0,0)},cc.Particle.ModeA=function(e,t,n){this.dir=e?e:cc.PointZero(),this.radialAccel=t||0,this.tangentialAccel=n||0},cc.Particle.ModeB=function(e,t,n,r){this.angle=e||0,this.degreesPerSecond=t||0,this.radius=n||0,this.deltaRadius=r||0},cc.ParticleSystem=cc.Node.extend({_plistFile:"",_elapsed:0,modeA:null,modeB:null,_particles:null,_emitCounter:0,_particleIdx:0,_profilingTimer:null,_drawMode:cc.PARTICLE_SHAPE_MODE,getDrawMode:function(){return this._drawMode},setDrawMode:function(e){this._drawMode=e},_shapeType:cc.PARTICLE_BALL_SHAPE,getShapeType:function(){return this._shapeType},setShapeType:function(e){this._shapeType=e},_isActive:!1,getIsActive:function(){return this._isActive},setIsActive:function(e){this._isActive=e},_particleCount:0,getParticleCount:function(){return this._particleCount},setParticleCount:function(e){this._particleCount=e},_duration:0,getDuration:function(){return this._duration},setDuration:function(e){this._duration=e},_sourcePosition:cc.PointZero(),getSourcePosition:function(){return this._sourcePosition},setSourcePosition:function(e){this._sourcePosition=e},_posVar:cc.PointZero(),getPosVar:function(){return this._posVar},setPosVar:function(e){this._posVar=e},_life:0,getLife:function(){return this._life},setLife:function(e){this._life=e},_lifeVar:0,getLifeVar:function(){return this._lifeVar},setLifeVar:function(e){this._lifeVar=e},_angle:0,getAngle:function(){return this._angle},setAngle:function(e){this._angle=e},_angleVar:0,getAngleVar:function(){return this._angleVar},setAngleVar:function(e){this._angleVar=e},getGravity:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.gravity},setGravity:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.gravity=e},getSpeed:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.speed},setSpeed:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.speed=e},getSpeedVar:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.speedVar},setSpeedVar:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.speedVar=e},getTangentialAccel:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.tangentialAccel},setTangentialAccel:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.tangentialAccel=e},getTangentialAccelVar:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.tangentialAccelVar},setTangentialAccelVar:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.tangentialAccelVar=e},getRadialAccel:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.radialAccel},setRadialAccel:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.radialAccel=e},getRadialAccelVar:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.radialAccelVar},setRadialAccelVar:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeA.radialAccelVar=e},getStartRadius:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.startRadius},setStartRadius:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.startRadius=e},getStartRadiusVar:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.startRadiusVar},setStartRadiusVar:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.startRadiusVar=e},getEndRadius:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.endRadius},setEndRadius:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.endRadius=e},getEndRadiusVar:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.endRadiusVar},setEndRadiusVar:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.endRadiusVar=e},getRotatePerSecond:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.rotatePerSecond},setRotatePerSecond:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.rotatePerSecond=e},getRotatePerSecondVar:function(){return cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.rotatePerSecondVar},setRotatePerSecondVar:function(e){cc.Assert(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY,"Particle Mode should be Gravity"),this.modeB.rotatePerSecondVar=e},_startSize:0,getStartSize:function(){return this._startSize},setStartSize:function(e){this._startSize=e},_startSizeVar:0,getStartSizeVar:function(){return this._startSizeVar},setStartSizeVar:function(e){this._startSizeVar=e},_endSize:0,getEndSize:function(){return this._endSize},setEndSize:function(e){this._endSize=e},_endSizeVar:0,getEndSizeVar:function(){return this._endSizeVar},setEndSizeVar:function(e){this._endSizeVar=e},_startColor:new cc.Color4F(0,0,0,1),getStartColor:function(){return this._startColor},setStartColor:function(e){this._startColor=e},_startColorVar:new cc.Color4F(0,0,0,1),getStartColorVar:function(){return this._startColorVar},setStartColorVar:function(e){this._startColorVar=e},_endColor:new cc.Color4F(0,0,0,1),getEndColor:function(){return this._endColor},setEndColor:function(e){this._endColor=e},_endColorVar:new cc.Color4F(0,0,0,1),getEndColorVar:function(){return this._endColorVar},setEndColorVar:function(e){this._endColorVar=e},_startSpin:0,getStartSpin:function(){return this._startSpin},setStartSpin:function(e){this._startSpin=e},_startSpinVar:0,getStartSpinVar:function(){return this._startSpinVar},setStartSpinVar:function(e){this._startSpinVar=e},_endSpin:0,getEndSpin:function(){return this._endSpin},setEndSpin:function(e){this._endSpin=e},_endSpinVar:0,getEndSpinVar:function(){return this._endSpinVar},setEndSpinVar:function(e){this._endSpinVar=e},_emissionRate:0,getEmissionRate:function(){return this._emissionRate},setEmissionRate:function(e){this._emissionRate=e},_totalParticles:0,getTotalParticles:function(){return this._totalParticles},setTotalParticles:function(e){this._totalParticles=e},_texture:null,getTexture:function(){return this._texture},setTexture:function(e){this._texture=e,e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||this._texture&&!this._texture.getHasPremultipliedAlpha()&&this._blendFunc.src==cc.BLEND_SRC&&this._blendFunc.dst==cc.BLEND_DST&&(this._blendFunc.src=GL_SRC_ALPHA,this._blendFunc.dst=GL_ONE_MINUS_SRC_ALPHA)},_blendFunc:new cc.BlendFunc(0,0),getBlendFunc:function(){return this._blendFunc},setBlendFunc:function(e){this._blendFunc=e},_isBlendAdditive:!1,getIsBlendAdditive:function(){return this._isBlendAdditive},setIsBlendAdditive:function(e){this._isBlendAdditive=e;return},_positionType:cc.CCPARTICLE_TYPE_FREE,getPositionType:function(){return this._positionType},setPositionType:function(e){this._positionType=e},_isAutoRemoveOnFinish:!1,getIsAutoRemoveOnFinish:function(){return this._isAutoRemoveOnFinish},setIsAutoRemoveOnFinish:function(e){this._isAutoRemoveOnFinish=e},_emitterMode:0,getEmitterMode:function(){return this._emitterMode},setEmitterMode:function(e){this._emitterMode=e},ctor:function(){this._super(),this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA=new cc.ParticleSystem.ModeA,this.modeB=new cc.ParticleSystem.ModeB,this._blendFunc=new cc.BlendFunc(cc.BLEND_SRC,cc.BLEND_DST)},initWithFile:function(e){var t=!1;this._plistFile=e;var n=cc.FileUtils.dictionaryWithContentsOfFileThreadSafe(this._plistFile);return cc.Assert(n!=null,"Particles: file not found"),this.initWithDictionary(n)},boundingBoxToWorld:function(){return new cc.Rect(0,0,cc.canvas.width,cc.canvas.height)},initWithDictionary:function(e){var t=!1,n=null,r=null,i=null,s=parseInt(this._valueForKey("maxParticles",e));if(this.initWithTotalParticles(s)){this._angle=parseFloat(this._valueForKey("angle",e)),this._angleVar=parseFloat(this._valueForKey("angleVariance",e)),this._duration=parseFloat(this._valueForKey("duration",e)),this._blendFunc.src=parseInt(this._valueForKey("blendFuncSource",e)),this._blendFunc.dst=parseInt(this._valueForKey("blendFuncDestination",e)),this._startColor.r=parseFloat(this._valueForKey("startColorRed",e)),this._startColor.g=parseFloat(this._valueForKey("startColorGreen",e)),this._startColor.b=parseFloat(this._valueForKey("startColorBlue",e)),this._startColor.a=parseFloat(this._valueForKey("startColorAlpha",e)),this._startColorVar.r=parseFloat(this._valueForKey("startColorVarianceRed",e)),this._startColorVar.g=parseFloat(this._valueForKey("startColorVarianceGreen",e)),this._startColorVar.b=parseFloat(this._valueForKey("startColorVarianceBlue",e)),this._startColorVar.a=parseFloat(this._valueForKey("startColorVarianceAlpha",e)),this._endColor.r=parseFloat(this._valueForKey("finishColorRed",e)),this._endColor.g=parseFloat(this._valueForKey("finishColorGreen",e)),this._endColor.b=parseFloat(this._valueForKey("finishColorBlue",e)),this._endColor.a=parseFloat(this._valueForKey("finishColorAlpha",e)),this._endColorVar.r=parseFloat(this._valueForKey("finishColorVarianceRed",e)),this._endColorVar.g=parseFloat(this._valueForKey("finishColorVarianceGreen",e)),this._endColorVar.b=parseFloat(this._valueForKey("finishColorVarianceBlue",e)),this._endColorVar.a=parseFloat(this._valueForKey("finishColorVarianceAlpha",e)),this._startSize=parseFloat(this._valueForKey("startParticleSize",e)),this._startSizeVar=parseFloat(this._valueForKey("startParticleSizeVariance",e)),this._endSize=parseFloat(this._valueForKey("finishParticleSize",e)),this._endSizeVar=parseFloat(this._valueForKey("finishParticleSizeVariance",e));var o=parseFloat(this._valueForKey("sourcePositionx",e)),u=parseFloat(this._valueForKey("sourcePositiony",e));this.setPosition(cc.ccp(o,u)),this._posVar.x=parseFloat(this._valueForKey("sourcePositionVariancex",e)),this._posVar.y=parseFloat(this._valueForKey("sourcePositionVariancey",e)),this._startSpin=parseFloat(this._valueForKey("rotationStart",e)),this._startSpinVar=parseFloat(this._valueForKey("rotationStartVariance",e)),this._endSpin=parseFloat(this._valueForKey("rotationEnd",e)),this._endSpinVar=parseFloat(this._valueForKey("rotationEndVariance",e)),this._emitterMode=parseInt(this._valueForKey("emitterType",e));if(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY){this.modeA.gravity.x=parseFloat(this._valueForKey("gravityx",e)),this.modeA.gravity.y=parseFloat(this._valueForKey("gravityy",e)),this.modeA.speed=parseFloat(this._valueForKey("speed",e)),this.modeA.speedVar=parseFloat(this._valueForKey("speedVariance",e));var a=this._valueForKey("radialAcceleration",e);this.modeA.radialAccel=a?parseFloat(a):0,a=this._valueForKey("radialAccelVariance",e),this.modeA.radialAccelVar=a?parseFloat(a):0,a=this._valueForKey("tangentialAcceleration",e),this.modeA.tangentialAccel=a?parseFloat(a):0,a=this._valueForKey("tangentialAccelVariance",e),this.modeA.tangentialAccelVar=a?parseFloat(a):0}else this._emitterMode==cc.CCPARTICLE_MODE_RADIUS?(this.modeB.startRadius=parseFloat(this._valueForKey("maxRadius",e)),this.modeB.startRadiusVar=parseFloat(this._valueForKey("maxRadiusVariance",e)),this.modeB.endRadius=parseFloat(this._valueForKey("minRadius",e)),this.modeB.endRadiusVar=0,this.modeB.rotatePerSecond=parseFloat(this._valueForKey("rotatePerSecond",e)),this.modeB.rotatePerSecondVar=parseFloat(this._valueForKey("rotatePerSecondVariance",e))):(cc.Assert(!1,"Invalid emitterType in config file"),cc.BREAK_IF(!0));this._life=parseFloat(this._valueForKey("particleLifespan",e)),this._lifeVar=parseFloat(this._valueForKey("particleLifespanVariance",e)),this._emissionRate=this._totalParticles/this._life;var f=this._valueForKey("textureFileName",e),l=cc.FileUtils.fullPathFromRelativeFile(f,this._plistFile),c=null;if(f.length>0){var h=cc.FileUtils.getIsPopupNotify();cc.FileUtils.setIsPopupNotify(!1),c=cc.TextureCache.sharedTextureCache().addImage(l),cc.FileUtils.setIsPopupNotify(h)}if(c)this._texture=c;else{var p=this._valueForKey("textureImageData",e);cc.Assert(p,"cc.ParticleSystem.initWithDictory:textureImageData is null");if(p.length!=0){var d=cc.base64Decode(p,p.length,n);cc.Assert(n!=null,"CCParticleSystem: error decoding textureImageData");if(!n)return!1;var v=cc.ZipUtils.ccInflateMemory(n,d,r);cc.Assert(r!=null,"CCParticleSystem: error ungzipping textureImageData");if(!r)return!1;i=new cc.Image;var m=i.initWithImageData(r,v);cc.Assert(m,"CCParticleSystem: error init image with Data");if(!m)return!1;this._texture=cc.TextureCache.sharedTextureCache().addUIImage(i,l)}}cc.Assert(this._texture!=null,"CCParticleSystem: error loading the texture");if(!this._texture)return!1;t=!0}return t},initWithTotalParticles:function(e){return this._totalParticles=e,this._particles=[],this._particles?(this._isActive=!0,this._blendFunc.src=cc.BLEND_SRC,this._blendFunc.dst=cc.BLEND_DST,this._positionType=cc.CCPARTICLE_TYPE_FREE,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this._isAutoRemoveOnFinish=!1,this.scheduleUpdateWithPriority(1),!0):(cc.Log("Particle system: not enough memory"),!1)},addParticle:function(){if(this.isFull())return!1;var e=new cc.Particle;return this.initParticle(e),this._particles.push(e),++this._particleCount,!0},initParticle:function(e){e.timeToLive=this._life+this._lifeVar*cc.RANDOM_MINUS1_1(),e.timeToLive=Math.max(0,e.timeToLive),e.pos.x=this._sourcePosition.x+this._posVar.x*cc.RANDOM_MINUS1_1(),e.pos.x*=cc.CONTENT_SCALE_FACTOR(),e.pos.y=this._sourcePosition.y+this._posVar.y*cc.RANDOM_MINUS1_1(),e.pos.y*=cc.CONTENT_SCALE_FACTOR();var t=new cc.Color4F(cc.clampf(this._startColor.r+this._startColorVar.r*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._startColor.g+this._startColorVar.g*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._startColor.b+this._startColorVar.b*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._startColor.a+this._startColorVar.a*cc.RANDOM_MINUS1_1(),0,1)),n=new cc.Color4F(cc.clampf(this._endColor.r+this._endColorVar.r*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._endColor.g+this._endColorVar.g*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._endColor.b+this._endColorVar.b*cc.RANDOM_MINUS1_1(),0,1),cc.clampf(this._endColor.a+this._endColorVar.a*cc.RANDOM_MINUS1_1(),0,1));e.color=t,e.deltaColor.r=(n.r-t.r)/e.timeToLive,e.deltaColor.g=(n.g-t.g)/e.timeToLive,e.deltaColor.b=(n.b-t.b)/e.timeToLive,e.deltaColor.a=(n.a-t.a)/e.timeToLive;var r=this._startSize+this._startSizeVar*cc.RANDOM_MINUS1_1();r=Math.max(0,r),r*=cc.CONTENT_SCALE_FACTOR(),e.size=r;if(this._endSize==cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE)e.deltaSize=0;else{var i=this._endSize+this._endSizeVar*cc.RANDOM_MINUS1_1();i=Math.max(0,i),i*=cc.CONTENT_SCALE_FACTOR(),e.deltaSize=(i-r)/e.timeToLive}var s=this._startSpin+this._startSpinVar*cc.RANDOM_MINUS1_1(),o=this._endSpin+this._endSpinVar*cc.RANDOM_MINUS1_1();e.rotation=s,e.deltaRotation=(o-s)/e.timeToLive;if(this._positionType==cc.CCPARTICLE_TYPE_FREE){var u=this.convertToWorldSpace(cc.PointZero());e.startPos=cc.ccpMult(u,cc.CONTENT_SCALE_FACTOR())}else this._positionType==cc.CCPARTICLE_TYPE_RELATIVE&&(e.startPos=cc.ccpMult(this._position,cc.CONTENT_SCALE_FACTOR()));var a=cc.DEGREES_TO_RADIANS(this._angle+this._angleVar*cc.RANDOM_MINUS1_1());if(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY){var f=cc.ccp(Math.cos(a),Math.sin(a)),l=this.modeA.speed+this.modeA.speedVar*cc.RANDOM_MINUS1_1();l*=cc.CONTENT_SCALE_FACTOR(),e.modeA.dir=cc.ccpMult(f,l),e.modeA.radialAccel=this.modeA.radialAccel+this.modeA.radialAccelVar*cc.RANDOM_MINUS1_1(),e.modeA.radialAccel*=cc.CONTENT_SCALE_FACTOR(),e.modeA.tangentialAccel=this.modeA.tangentialAccel+this.modeA.tangentialAccelVar*cc.RANDOM_MINUS1_1(),e.modeA.tangentialAccel*=cc.CONTENT_SCALE_FACTOR()}else{var c=this.modeB.startRadius+this.modeB.startRadiusVar*cc.RANDOM_MINUS1_1(),h=this.modeB.endRadius+this.modeB.endRadiusVar*cc.RANDOM_MINUS1_1();c*=cc.CONTENT_SCALE_FACTOR(),h*=cc.CONTENT_SCALE_FACTOR(),e.modeB.radius=c,this.modeB.endRadius==cc.CCPARTICLE_START_RADIUS_EQUAL_TO_END_RADIUS?e.modeB.deltaRadius=0:e.modeB.deltaRadius=(h-c)/e.timeToLive,e.modeB.angle=a,e.modeB.degreesPerSecond=cc.DEGREES_TO_RADIANS(this.modeB.rotatePerSecond+this.modeB.rotatePerSecondVar*cc.RANDOM_MINUS1_1())}},stopSystem:function(){this._isActive=!1,this._elapsed=this._duration,this._emitCounter=0},resetSystem:function(){this._isActive=!0,this._elapsed=0;for(this._particleIdx=0;this._particleIdx<this._particleCount;++this._particleIdx){var e=this._particles[this._particleIdx];e.timeToLive=0}},isFull:function(){return this._particleCount>=this._totalParticles},updateQuadWithParticle:function(e,t){},postStep:function(){},update:function(e){if(this._isActive&&this._emissionRate){var t=1/this._emissionRate;this._emitCounter+=e;while(this._particleCount<this._totalParticles&&this._emitCounter>t)this.addParticle(),this._emitCounter-=t;this._elapsed+=e,this._duration!=-1&&this._duration<this._elapsed&&this.stopSystem()}this._particleIdx=0;var n=cc.PointZero();this._positionType==cc.CCPARTICLE_TYPE_FREE?(n=this.convertToWorldSpace(cc.PointZero()),n.x*=cc.CONTENT_SCALE_FACTOR(),n.y*=cc.CONTENT_SCALE_FACTOR()):this._positionType==cc.CCPARTICLE_TYPE_RELATIVE&&(n=cc.ccp(this._position.x,this._position.y),n.x*=cc.CONTENT_SCALE_FACTOR(),n.y*=cc.CONTENT_SCALE_FACTOR());while(this._particleIdx<this._particleCount){var r=this._particles[this._particleIdx];r.timeToLive-=e;if(r.timeToLive>0){if(this._emitterMode==cc.CCPARTICLE_MODE_GRAVITY){var i,s,o;s=cc.PointZero();if(r.pos.x||r.pos.y)s=cc.ccpNormalize(r.pos);o=s,s=cc.ccpMult(s,r.modeA.radialAccel);var u=o.x;o.x=-o.y,o.y=u,o=cc.ccpMult(o,r.modeA.tangentialAccel),i=cc.ccpAdd(cc.ccpAdd(s,o),this.modeA.gravity),i=cc.ccpMult(i,e),r.modeA.dir=cc.ccpAdd(r.modeA.dir,i),i=cc.ccpMult(r.modeA.dir,e),r.pos=cc.ccpAdd(r.pos,i)}else r.modeB.angle+=r.modeB.degreesPerSecond*e,r.modeB.radius+=r.modeB.deltaRadius*e,r.pos.x=-Math.cos(r.modeB.angle)*r.modeB.radius,r.pos.y=-Math.sin(r.modeB.angle)*r.modeB.radius;r.color.r+=r.deltaColor.r*e,r.color.g+=r.deltaColor.g*e,r.color.b+=r.deltaColor.b*e,r.color.a+=r.deltaColor.a*e,r.isChangeColor=!0,r.size+=r.deltaSize*e,r.size=Math.max(0,r.size),r.rotation+=r.deltaRotation*e;var a;if(this._positionType==cc.CCPARTICLE_TYPE_FREE||this._positionType==cc.CCPARTICLE_TYPE_RELATIVE){var f=cc.ccpSub(n,r.startPos);a=cc.ccpSub(r.pos,f)}else a=r.pos;cc.renderContextType==cc.WEBGL?this.updateQuadWithParticle(r,a):r.drawPos=a,++this._particleIdx}else{cc.ArrayRemoveObject(this._particles,r),--this._particleCount;if(this._particleCount==0&&this._isAutoRemoveOnFinish){this.unscheduleUpdate(),this._parent.removeChild(this,!0);return}}}cc.USES_VBO&&this.postStep()},_valueForKey:function(e,t){if(t){var n=t[e];return n?n:""}return""}}),cc.ParticleSystem.create=function(e){var t=new cc.ParticleSystem;return t&&t.initWithFile(e)?t:null},cc.ParticleSystem.ModeA=function(e,t,n,r,i,s,o){this.gravity=e?e:cc.PointZero(),this.speed=t||0,this.speedVar=n||0,this.tangentialAccel=r||0,this.tangentialAccelVar=i||0,this.radialAccel=s||0,this.radialAccelVar=o||0},cc.ParticleSystem.ModeB=function(e,t,n,r,i,s){this.startRadius=e||0,this.startRadiusVar=t||0,this.endRadius=n||0,this.endRadiusVar=r||0,this.rotatePerSecond=i||0,this.rotatePerSecondVar=s||0},cc.ParticleSystemQuad=cc.ParticleSystem.extend({_quads:null,_indices:null,_quadsID:0,ctor:function(){this._super()},initIndices:function(){for(var e=0;e<this._totalParticles;++e){var t=e*6,n=e*4;this._indices[t+0]=n+0,this._indices[t+1]=n+1,this._indices[t+2]=n+2,this._indices[t+5]=n+1,this._indices[t+4]=n+2,this._indices[t+3]=n+3}},initTexCoordsWithRect:function(e){var t=cc.RectMake(e.origin.x*cc.CONTENT_SCALE_FACTOR(),e.origin.y*cc.CONTENT_SCALE_FACTOR(),e.size.width*cc.CONTENT_SCALE_FACTOR(),e.size.height*cc.CONTENT_SCALE_FACTOR()),n=e.size.width,r=e.size.height;this._texture&&(this._texture instanceof HTMLImageElement||this._texture instanceof HTMLCanvasElement?(n=this._texture.width,r=this._texture.height):(n=this._texture.getPixelsWide(),r=this._texture.getPixelsHigh()));var i,s,o,u;cc.FIX_ARTIFACTS_BY_STRECHING_TEXEL?(i=(t.origin.x*2+1)/(n*2),s=(t.origin.y*2+1)/(r*2),o=i+(t.size.width*2-2)/(n*2),u=s+(t.size.height*2-2)/(r*2)):(i=t.origin.x/n,s=t.origin.y/r,o=i+t.size.width/n,u=s+t.size.height/r);var a=u;u=s,s=a,this._quads=[];for(var f=0;f<this._totalParticles;f++)this._quads[f]=cc.V3F_C4B_T2F_QuadZero();for(var f=0;f<this._totalParticles;f++)this._quads[f].bl.texCoords.u=i,this._quads[f].bl.texCoords.v=s,this._quads[f].br.texCoords.u=o,this._quads[f].br.texCoords.v=s,this._quads[f].tl.texCoords.u=i,this._quads[f].tl.texCoords.v=u,this._quads[f].tr.texCoords.u=o,this._quads[f].tr.texCoords.v=u},setDisplayFrame:function(e){cc.Assert(cc.Point.CCPointEqualToPoint(e.getOffsetInPixels(),cc.PointZero()),"QuadParticle only supports SpriteFrames with no offsets"),(!this._texture||e.getTexture().getName()!=this._texture.getName())&&this.setTexture(e.getTexture())},setTextureWithRect:function(e,t){(!this._texture||e.getName()!=this._texture.getName())&&this.setTexture(e,!0),this.initTexCoordsWithRect(t)},initWithTotalParticles:function(e){if(this._super(e)){this._quads=[];for(var t=0;t<this._totalParticles;t++)this._quads[t]=cc.V3F_C4B_T2F_QuadZero();this._indices=[];for(t=0;t<this._totalParticles*6;t++)this._indices[t]=0;return!this._quads||!this._indices?(cc.Log("cocos2d: Particle system: not enough memory"),this._quads&&(this._quads=null),this._indices&&(this._indices=null),null):(this._texture?this.initTexCoordsWithRect(cc.RectMake(0,0,this._texture.getPixelsWide(),this._texture.getPixelsHigh())):this.initTexCoordsWithRect(cc.RectMake(0,0,1,1)),this.initIndices(),cc.USES_VBO,!0)}return!1},setTexture:function(e,t){if(t&&t==1){this._super(e);return}var n=null;e instanceof HTMLImageElement||e instanceof HTMLCanvasElement?n=cc.SizeMake(e.width,e.height):n=e.getContentSize(),this.setTextureWithRect(e,cc.RectMake(0,0,n.width,n.height))},updateQuadWithParticle:function(e,t){var n=this._quads[this._particleIdx],r=new cc.Color4B(e.color.r*255,e.color.g*255,e.color.b*255,e.color.a*255);n.bl.colors=r,n.br.colors=r,n.tl.colors=r,n.tr.colors=r;var i=e.size/2;if(e.rotation){var s=-i,o=-i,u=i,a=i,f=t.x,l=t.y,c=-cc.DEGREES_TO_RADIANS(e.rotation),h=Math.cos(c),p=Math.sin(c),d=s*h-o*p+f,v=s*p+o*h+l,m=u*h-o*p+f,g=u*p+o*h+l,y=u*h-a*p+f,b=u*p+a*h+l,w=s*h-a*p+f,E=s*p+a*h+l;n.bl.vertices.x=d,n.bl.vertices.y=v,n.br.vertices.x=m,n.br.vertices.y=g,n.tl.vertices.x=w,n.tl.vertices.y=E,n.tr.vertices.x=y,n.tr.vertices.y=b}else n.bl.vertices.x=t.x-i,n.bl.vertices.y=t.y-i,n.br.vertices.x=t.x+i,n.br.vertices.y=t.y-i,n.tl.vertices.x=t.x-i,n.tl.vertices.y=t.y+i,n.tr.vertices.x=t.x+i,n.tr.vertices.y=t.y+i},postStep:function(){cc.renderContextType!=cc.CANVAS&&cc.USES_VBO&&(glBindBuffer(GL_ARRAY_BUFFER,quadsID),glBufferSubData(GL_ARRAY_BUFFER,0,sizeof(quads[0])*particleCount,quads),glBindBuffer(GL_ARRAY_BUFFER,0))},draw:function(e){this._super();if(cc.renderContextType==cc.CANVAS){var t=e||cc.renderContext;t.save(),this._isBlendAdditive?t.globalCompositeOperation="lighter":t.globalCompositeOperation="source-over";for(var n=0;n<this._particleCount;n++){var r=this._particles[n],i=0|r.size*.5;if(this._drawMode==cc.PARTICLE_TEXTURE_MODE){var s=this.getTexture();if(r.isChangeColor){var o=cc.TextureCache.sharedTextureCache().getTextureColors(this.getTexture());o&&(s=cc.generateTintImage(this.getTexture(),o,r.color))}t.save(),t.globalAlpha=r.color.a,t.translate(0|r.drawPos.x,-(0|r.drawPos.y)),t.drawImage(s,i,-(i+r.size),r.size,r.size),t.restore()}else t.save(),t.globalAlpha=r.color.a,t.translate(0|r.drawPos.x,-(0|r.drawPos.y)),this._shapeType==cc.PARTICLE_STAR_SHAPE?cc.drawingUtil.drawStar(t,new cc.Point(0,0),i,r.color):cc.drawingUtil.drawColorBall(t,new cc.Point(0,0),i,r.color),t.restore()}t.restore()}else{glBindTexture(GL_TEXTURE_2D,this._texture.getName());var u=sizeof(this._quads[0].bl);if(cc.USES_VBO)glBindBuffer(GL_ARRAY_BUFFER,this._quadsID),cc.ENABLE_CACHE_TEXTTURE_DATA&&glBufferData(GL_ARRAY_BUFFER,sizeof(this._quads[0])*this._totalParticles,this._quads,GL_DYNAMIC_DRAW),glVertexPointer(2,GL_FLOAT,u,0),glColorPointer(4,GL_UNSIGNED_BYTE,u,offsetof(ccV2F_C4B_T2F,colors)),glTexCoordPointer(2,GL_FLOAT,u,offsetof(ccV2F_C4B_T2F,texCoords));else{var a=this._quads,f=offsetof(cc.V2F_C4B_T2F,vertices);glVertexPointer(2,GL_FLOAT,u,a+f),f=offsetof(cc.V2F_C4B_T2F,colors),glColorPointer(4,GL_UNSIGNED_BYTE,u,a+f),f=offsetof(cc.V2F_C4B_T2F,texCoords),glTexCoordPointer(2,GL_FLOAT,u,a+f)}var l=this._blendFunc.src!=cc.BLEND_SRC||this._blendFunc.dst!=cc.BLEND_DST;l&&glBlendFunc(this._blendFunc.src,this._blendFunc.dst),cc.Assert(this._particleIdx==this._particleCount,"Abnormal error in particle quad"),glDrawElements(GL_TRIANGLES,this._particleIdx*6,GL_UNSIGNED_SHORT,this._indices),l&&glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST),cc.USES_VBO&&glBindBuffer(GL_ARRAY_BUFFER,0)}}}),cc.ParticleSystemQuad.create=function(e){var t=new cc.ParticleSystemQuad;return t&&t.initWithFile(e)?t:null},cc.ARCH_OPTIMAL_PARTICLE_SYSTEM=cc.ParticleSystemQuad;var cc=cc=cc||{};cc.MAX_PARTICLE_SIZE=64,cc.ParticleSystemPoint=cc.ParticleSystem.extend({_vertices:null,_verticesID:0,initWithTotalParticles:function(e){if(this._super(e)){this._vertices=[];for(var t=0;t<this._totalParticles;t++)this._vertices[t]=new cc.PointSprite(new cc.Vertex2F(0,0),new cc.Color4B(0,0,0,255),0);return this._vertices?(cc.USES_VBO&&(glGenBuffers(1,this._verticesID),glBindBuffer(GL_ARRAY_BUFFER,this._verticesID),glBufferData(GL_ARRAY_BUFFER,sizeof(cc.PointSprite)*this._totalParticles,this._vertices,GL_DYNAMIC_DRAW),glBindBuffer(GL_ARRAY_BUFFER,0)),!0):(cc.Log("cocos2d: Particle system: not enough memory"),!1)}return!1},updateQuadWithParticle:function(e,t){this._vertices[this._particleIdx].pos=new cc.Vertex2(t.x,t.y),this._vertices[this._particleIdx].size=e.size;var n=new cc.Color4B(e.color.r*255,e.color.g*255,e.color.b*255,e.color.a*255);this._vertices[this._particleIdx].color=n},postStep:function(){cc.USES_VBO&&(glBindBuffer(GL_ARRAY_BUFFER,this._verticesID),glBufferSubData(GL_ARRAY_BUFFER,0,sizeof(cc.PointSprite)*this._particleCount,this._vertices),glBindBuffer(GL_ARRAY_BUFFER,0))},draw:function(){this._super();if(this._particleIdx==0)return;glDisableClientState(GL_TEXTURE_COORD_ARRAY),glBindTexture(GL_TEXTURE_2D,this._texture.getName()),glEnable(GL_POINT_SPRITE_OES),glTexEnvi(GL_POINT_SPRITE_OES,GL_COORD_REPLACE_OES,GL_TRUE);var e=sizeof(this._vertices[0]);if(cc.USES_VBO)glBindBuffer(GL_ARRAY_BUFFER,verticesID),cc.ENABLE_CACHE_TEXTTURE_DATA&&glBufferData(GL_ARRAY_BUFFER,sizeof(cc.PointSprite)*this._totalParticles,this._vertices,GL_DYNAMIC_DRAW),glVertexPointer(2,GL_FLOAT,e,0),glColorPointer(4,GL_UNSIGNED_BYTE,e,offsetof(cc.PointSprite,color)),glEnableClientState(GL_POINT_SIZE_ARRAY_OES),glPointSizePointerOES(GL_FLOAT,e,offsetof(cc.PointSprite,size));else{var t=this._vertices.length;glVertexPointer(2,GL_FLOAT,e,t);var n=offsetof(cc.PointSprite,color);glColorPointer(4,GL_UNSIGNED_BYTE,e,t+n),glEnableClientState(GL_POINT_SIZE_ARRAY_OES),n=offsetof(cc.PointSprite,size),glPointSizePointerOES(GL_FLOAT,e,t+n)}var r=this._blendFunc.src!=cc.BLEND_SRC||this._blendFunc.dst!=cc.BLEND_DST?!0:!1;r&&glBlendFunc(this._blendFunc.src,this._blendFunc.dst),glDrawArrays(GL_POINTS,0,this._particleIdx),r&&glBlendFunc(cc.BLEND_SRC,cc.BLEND_DST),cc.USES_VBO&&glBindBuffer(GL_ARRAY_BUFFER,0),glDisableClientState(GL_POINT_SIZE_ARRAY_OES),glDisable(GL_POINT_SPRITE_OES),glEnableClientState(GL_TEXTURE_COORD_ARRAY)},setStartSpin:function(e){cc.Assert(e==0,"PointParticleSystem doesn't support spinning"),this._super(e)},setStartSpinVar:function(e){cc.Assert(e==0,"PointParticleSystem doesn't support spinning"),this._super(e)},setEndSpin:function(e){cc.Assert(e==0,"PointParticleSystem doesn't support spinning"),this._super(e)},setEndSpinVar:function(e){cc.Assert(e==0,"PointParticleSystem doesn't support spinning"),this._super(e)},setStartSize:function(e){cc.Assert(e>=0&&e<=cc.MAX_PARTICLE_SIZE,"PointParticleSystem only supports 0 <= size <= 64"),this._super(e)},setEndSize:function(e){cc.Assert(e==cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE||e>=0&&e<=cc.MAX_PARTICLE_SIZE,"PointParticleSystem only supports 0 <= size <= 64"),this._super(e)}}),cc.ParticleSystemPoint.create=function(e){var t=new cc.ParticleSystemPoint;return t&&t.initWithFile(e)?t:null},cc.ParticleFire=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(150)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.CCPARTICLE_DURATION_INFINITY,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(0,0),this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.speed=60,this.modeA.speedVar=20,this._angle=90,this._angleVar=10;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,60)),this._posVar=cc.ccp(40,20),this._life=3,this._lifeVar=.25,this._startSize=54,this._startSizeVar=10,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.76,this._startColor.g=.25,this._startColor.b=.12,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=0,this._startColorVar.a=0,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setIsBlendAdditive(!0),!0}return!1}}),cc.ParticleFire.create=function(){var e=new cc.ParticleFire;return e.init()?e:null},cc.ParticleFireworks=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(150)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.CCPARTICLE_DURATION_INFINITY,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(0,-90),this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.speed=180,this.modeA.speedVar=50;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,t.height/2)),this._angle=90,this._angleVar=20,this._life=3.5,this._lifeVar=1,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.5,this._startColor.g=.5,this._startColor.b=.5,this._startColor.a=1,this._startColorVar.r=.5,this._startColorVar.g=.5,this._startColorVar.b=.5,this._startColorVar.a=.1,this._endColor.r=.1,this._endColor.g=.1,this._endColor.b=.1,this._endColor.a=.2,this._endColorVar.r=.1,this._endColorVar.g=.1,this._endColorVar.b=.1,this._endColorVar.a=.2,this._startSize=8,this._startSizeVar=2,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this.setIsBlendAdditive(!1),!0}return!1}}),cc.ParticleFireworks.create=function(){var e=new cc.ParticleFireworks;return e.init()?e:null},cc.ParticleSun=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(150)},initWithTotalParticles:function(e){if(this._super(e)){this.setIsBlendAdditive(!0),this._duration=cc.CCPARTICLE_DURATION_INFINITY,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(0,0),this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.speed=20,this.modeA.speedVar=5,this._angle=90,this._angleVar=360;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=1,this._lifeVar=.5,this._startSize=30,this._startSizeVar=10,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.76,this._startColor.g=.25,this._startColor.b=.12,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=0,this._startColorVar.a=0,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,!0}return!1}}),cc.ParticleSun.create=function(){var e=new cc.ParticleSun;return e.init()?e:null},cc.ParticleGalaxy=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(100)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.CCPARTICLE_DURATION_INFINITY,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(0,0),this.modeA.speed=60,this.modeA.speedVar=10,this.modeA.radialAccel=-80,this.modeA.radialAccelVar=0,this.modeA.tangentialAccel=80,this.modeA.tangentialAccelVar=0,this._angle=90,this._angleVar=360;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=4,this._lifeVar=1,this._startSize=37,this._startSizeVar=10,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.12,this._startColor.g=.25,this._startColor.b=.76,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=0,this._startColorVar.a=0,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setIsBlendAdditive(!0),!0}return!1}}),cc.ParticleGalaxy.create=function(){var e=new cc.ParticleGalaxy;return e.init()?e:null},cc.ParticleFlower=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(100)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.CCPARTICLE_DURATION_INFINITY,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(0,0),this.modeA.speed=80,this.modeA.speedVar=10,this.modeA.radialAccel=-60,this.modeA.radialAccelVar=0,this.modeA.tangentialAccel=15,this.modeA.tangentialAccelVar=0,this._angle=90,this._angleVar=360;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=4,this._lifeVar=1,this._startSize=30,this._startSizeVar=10,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.5,this._startColor.g=.5,this._startColor.b=.5,this._startColor.a=1,this._startColorVar.r=.5,this._startColorVar.g=.5,this._startColorVar.b=.5,this._startColorVar.a=.5,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setIsBlendAdditive(!0),!0}return!1}}),cc.ParticleFlower.create=function(){var e=new cc.ParticleFlower;return e.init()?e:null},cc.ParticleMeteor=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(100)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.CCPARTICLE_DURATION_INFINITY,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(-200,200),this.modeA.speed=15,this.modeA.speedVar=5,this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.tangentialAccel=0,this.modeA.tangentialAccelVar=0,this._angle=90,this._angleVar=360;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=2,this._lifeVar=1,this._startSize=60,this._startSizeVar=10,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.2,this._startColor.g=.4,this._startColor.b=.7,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=.2,this._startColorVar.a=.1,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setIsBlendAdditive(!0),!0}return!1}}),cc.ParticleMeteor.create=function(){var e=new cc.ParticleMeteor;return e.init()?e:null},cc.ParticleSpiral=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(100)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.CCPARTICLE_DURATION_INFINITY,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(0,0),this.modeA.speed=150,this.modeA.speedVar=0,this.modeA.radialAccel=-380,this.modeA.radialAccelVar=0,this.modeA.tangentialAccel=45,this.modeA.tangentialAccelVar=0,this._angle=90,this._angleVar=0;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=12,this._lifeVar=0,this._startSize=20,this._startSizeVar=0,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.5,this._startColor.g=.5,this._startColor.b=.5,this._startColor.a=1,this._startColorVar.r=.5,this._startColorVar.g=.5,this._startColorVar.b=.5,this._startColorVar.a=0,this._endColor.r=.5,this._endColor.g=.5,this._endColor.b=.5,this._endColor.a=1,this._endColorVar.r=.5,this._endColorVar.g=.5,this._endColorVar.b=.5,this._endColorVar.a=0,this.setIsBlendAdditive(!1),!0}return!1}}),cc.ParticleSpiral.create=function(){var e=new cc.ParticleSpiral;return e.init()?e:null},cc.ParticleExplosion=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(300)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=.1,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(0,0),this.modeA.speed=70,this.modeA.speedVar=40,this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.tangentialAccel=0,this.modeA.tangentialAccelVar=0,this._angle=90,this._angleVar=360;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,t.height/2)),this._posVar=cc.PointZero(),this._life=5,this._lifeVar=2,this._startSize=15,this._startSizeVar=10,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._duration,this._startColor.r=.7,this._startColor.g=.1,this._startColor.b=.2,this._startColor.a=1,this._startColorVar.r=.5,this._startColorVar.g=.5,this._startColorVar.b=.5,this._startColorVar.a=0,this._endColor.r=.5,this._endColor.g=.5,this._endColor.b=.5,this._endColor.a=0,this._endColorVar.r=.5,this._endColorVar.g=.5,this._endColorVar.b=.5,this._endColorVar.a=0,this.setIsBlendAdditive(!1),!0}return!1}}),cc.ParticleExplosion.create=function(){var e=new cc.ParticleExplosion;return e.init()?e:null},cc.ParticleSmoke=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(100)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.CCPARTICLE_DURATION_INFINITY,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(0,0),this.modeA.radialAccel=0,this.modeA.radialAccelVar=0,this.modeA.speed=25,this.modeA.speedVar=10,this._angle=90,this._angleVar=5;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,0)),this._posVar=cc.ccp(20,0),this._life=4,this._lifeVar=1,this._startSize=60,this._startSizeVar=10,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=this._totalParticles/this._life,this._startColor.r=.8,this._startColor.g=.8,this._startColor.b=.8,this._startColor.a=1,this._startColorVar.r=.02,this._startColorVar.g=.02,this._startColorVar.b=.02,this._startColorVar.a=0,this._endColor.r=0,this._endColor.g=0,this._endColor.b=0,this._endColor.a=1,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setIsBlendAdditive(!1),!0}return!1}}),cc.ParticleSmoke.create=function(){var e=new cc.ParticleSmoke;return e.init()?e:null},cc.ParticleSnow=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(250)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.CCPARTICLE_DURATION_INFINITY,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(0,-1),this.modeA.speed=5,this.modeA.speedVar=1,this.modeA.radialAccel=0,this.modeA.radialAccelVar=1,this.modeA.tangentialAccel=0,this.modeA.tangentialAccelVar=1;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,t.height+10)),this._posVar=cc.ccp(t.width/2,0),this._angle=-90,this._angleVar=5,this._life=45,this._lifeVar=15,this._startSize=10,this._startSizeVar=5,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=10,this._startColor.r=1,this._startColor.g=1,this._startColor.b=1,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=0,this._startColorVar.a=0,this._endColor.r=1,this._endColor.g=1,this._endColor.b=1,this._endColor.a=0,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setIsBlendAdditive(!1),!0}return!1}}),cc.ParticleSnow.create=function(){var e=new cc.ParticleSnow;return e.init()?e:null},cc.ParticleRain=cc.ARCH_OPTIMAL_PARTICLE_SYSTEM.extend({init:function(){return this.initWithTotalParticles(300)},initWithTotalParticles:function(e){if(this._super(e)){this._duration=cc.CCPARTICLE_DURATION_INFINITY,this._emitterMode=cc.CCPARTICLE_MODE_GRAVITY,this.modeA.gravity=cc.ccp(10,-10),this.modeA.radialAccel=0,this.modeA.radialAccelVar=1,this.modeA.tangentialAccel=0,this.modeA.tangentialAccelVar=1,this.modeA.speed=130,this.modeA.speedVar=30,this._angle=-90,this._angleVar=5;var t=cc.Director.sharedDirector().getWinSize();return this.setPosition(cc.ccp(t.width/2,t.height)),this._posVar=cc.ccp(t.width/2,0),this._life=4.5,this._lifeVar=0,this._startSize=4,this._startSizeVar=2,this._endSize=cc.CCPARTICLE_START_SIZE_EQUAL_TO_END_SIZE,this._emissionRate=20,this._startColor.r=.7,this._startColor.g=.8,this._startColor.b=1,this._startColor.a=1,this._startColorVar.r=0,this._startColorVar.g=0,this._startColorVar.b=0,this._startColorVar.a=0,this._endColor.r=.7,this._endColor.g=.8,this._endColor.b=1,this._endColor.a=.5,this._endColorVar.r=0,this._endColorVar.g=0,this._endColorVar.b=0,this._endColorVar.a=0,this.setIsBlendAdditive(!1),!0}return!1}}),cc.ParticleRain.create=function(){var e=new cc.ParticleRain;return e.init()?e:null},cc.Touch=cc.Class.extend({_viewId:0,_point:null,_prevPoint:cc.PointZero(),_id:0,ctor:function(e,t,n){this._viewId=e,this._point=new cc.Point(t||0,n||0)},locationInView:function(e){return this._point},previousLocationInView:function(e){return this._prevPoint},view:function(){return this._viewId},id:function(){return this._id},setTouchInfo:function(e,t,n,r){this._viewId=e,this._prevPoint=this._point,this._point=new cc.Point(t||0,n||0),this._id=r||0},_setPrevPoint:function(e,t){this._prevPoint=new cc.Point(e||0,t||0)}}),cc.TouchDelegate=cc.Class.extend({_eventTypeFuncMap:null,ccTouchBegan:function(e,t){return!1},ccTouchMoved:function(e,t){},ccTouchEnded:function(e,t){},ccTouchCancelled:function(e,t){},ccTouchesBegan:function(e,t){},ccTouchesMoved:function(e,t){},ccTouchesEnded:function(e,t){},ccTouchesCancelled:function(e,t){},touchDelegateRetain:function(){},touchDelegateRelease:function(){}}),cc.TargetedTouchDelegate=cc.TouchDelegate.extend({ccTouchBegan:function(e,t){return!1},ccTouchMoved:function(e,t){},ccTouchEnded:function(e,t){},ccTouchCancelled:function(e,t){}}),cc.StandardTouchDelegate=cc.TouchDelegate.extend({ccTouchesBegan:function(e,t){},ccTouchesMoved:function(e,t){},ccTouchesEnded:function(e,t){},ccTouchesCancelled:function(e,t){}}),cc.TouchHandler=cc.Class.extend({_delegate:null,_priority:0,_enabledSelectors:0,getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},getPriority:function(){return this._priority},setPriority:function(e){this._priority=e},getEnabledSelectors:function(){return this._enabledSelectors},setEnalbedSelectors:function(e){this._enabledSelectors=e},initWithDelegate:function(e,t){return cc.Assert(e!=null,"TouchHandler.initWithDelegate():touch delegate should not be null"),this._delegate=e,this._priority=t,this._enabledSelectors=0,!0}}),cc.TouchHandler.handlerWithDelegate=function(e,t){var n=new cc.TouchHandler;return n&&n.initWithDelegate(e,t),n},cc.StandardTouchHandler=cc.TouchHandler.extend({initWithDelegate:function(e,t){return this._super(e,t)?!0:!1}}),cc.StandardTouchHandler.handlerWithDelegate=function(e,t){var n=new cc.StandardTouchHandler;return n&&n.initWithDelegate(e,t),n},cc.TargetedTouchHandler=cc.TouchHandler.extend({_swallowsTouches:!1,_claimedTouches:null,isSwallowsTouches:function(){return this._swallowsTouches},setSwallowsTouches:function(e){this._swallowsTouches=e},getClaimedTouches:function(){return this._claimedTouches},initWithDelegate:function(e,t,n){return this._super(e,t)?(this._claimedTouches=[],this._swallowsTouches=n,!0):!1}}),cc.TargetedTouchHandler.handlerWithDelegate=function(e,t,n){var r=new cc.TargetedTouchHandler;return r&&r.initWithDelegate(e,t,n),r},cc.TouchSelectorBeganBit=1,cc.TouchSelectorMovedBit=2,cc.TouchSelectorEndedBit=4,cc.TouchSelectorCancelledBit=8,cc.TouchSelectorAllBits=cc.TouchSelectorBeganBit|cc.TouchSelectorMovedBit|cc.TouchSelectorEndedBit|cc.TouchSelectorCancelledBit,cc.TOUCH_BEGAN=0,cc.TOUCH_MOVED=1,cc.TOUCH_ENDED=2,cc.TOUCH_CANCELLED=3,cc.TouchMax=4,cc.less=function(e,t){return e.getPriority()>t.getPriority()},cc.TouchHandlerHelperData=function(e){this.type=e},cc.TouchDispatcher=cc.Class.extend({_targetedHandlers:null,_standardHandlers:null,_locked:!1,_toAdd:!1,_toRemove:!1,_handlersToAdd:null,_handlersToRemove:null,_toQuit:!1,_dispatchEvents:!1,_handlerHelperData:[new cc.TouchHandlerHelperData(cc.TOUCH_BEGAN),new cc.TouchHandlerHelperData(cc.TOUCH_MOVED),new cc.TouchHandlerHelperData(cc.TOUCH_ENDED),new cc.TouchHandlerHelperData(cc.TOUCH_CANCELLED)],init:function(){return this._dispatchEvents=!0,this._targetedHandlers=new Array,this._standardHandlers=new Array,this._handlersToAdd=new Array,this._handlersToRemove=new Array,this._toRemove=!1,this._toAdd=!1,this._toQuit=!1,this._locked=!1,!0},isDispatchEvents:function(){return this._dispatchEvents},setDispatchEvents:function(e){this._dispatchEvents=e},addStandardDelegate:function(e,t){var n=cc.StandardTouchHandler.handlerWithDelegate(e,t);if(!this._locked)this._standardHandlers=this.forceAddHandler(n,this._standardHandlers);else{if(this._handlersToRemove.indexOf(e)!=-1){cc.ArrayRemoveObject(this._handlersToRemove,e);return}this._handlersToAdd.push(n),this._toAdd=!0}},addTargetedDelegate:function(e,t,n){var r=cc.TargetedTouchHandler.handlerWithDelegate(e,t,n);if(!this._locked)this._targetedHandlers=this.forceAddHandler(r,this._targetedHandlers);else{if(this._handlersToRemove.indexOf(e)!=-1){cc.ArrayRemoveObject(this._handlersToRemove,e);return}this._handlersToAdd.push(r),this._toAdd=!0}},forceAddHandler:function(e,t){var n=0;for(var r=0;r<t.length;r++){var i=t[r];if(i){i.getPriority()<e.getPriority()&&++n;if(i.getDelegate()==e.getDelegate())return cc.Assert(0,"TouchDispatcher.forceAddHandler()"),t}}return cc.ArrayAppendObjectToIndex(t,e,n)},forceRemoveAllDelegates:function(){this._standardHandlers.length=0,this._targetedHandlers.length=0},removeDelegate:function(e){if(e==null)return;if(!this._locked)this.forceRemoveDelegate(e);else{var t=this.findHandler(this._handlersToAdd,e);if(t){cc.ArrayRemoveObject(this._handlersToAdd,t);return}this._handlersToRemove.push(e),this._toRemove=!0}},removeAllDelegates:function(){this._locked?this._toQuit=!0:this.forceRemoveAllDelegates()},setPriority:function(e,t){cc.Assert(t!=null,"TouchDispatcher.setPriority():Arguments is null");var n=this.findHandler(t);cc.Assert(n!=null,"TouchDispatcher.setPriority():Cant find TouchHandler"),n.setPriority(e),this.rearrangeHandlers(this._targetedHandlers),this.rearrangeHandlers(this._standardHandlers)},touches:function(e,t,n){cc.Assert(n>=0&&n<4,"TouchDispatcher.touches()"),this._locked=!0;var r=this._targetedHandlers.length,i=this._standardHandlers.length,s=r&&i,o=s?e.slice():e,u=this._handlerHelperData[n];if(r>0){var a;for(var f=0;f<e.length;f++){a=e[f];var l;for(var c=0;c<this._targetedHandlers.length;c++){l=this._targetedHandlers[c];if(!l)break;var h=!1;if(n==cc.TOUCH_BEGAN)h=l.getDelegate().ccTouchBegan(a,t),h&&l.getClaimedTouches().push(a);else if(l.getClaimedTouches().length>0){h=!0;switch(u.type){case cc.TOUCH_MOVED:l.getDelegate().ccTouchMoved(a,t);break;case cc.TOUCH_ENDED:l.getDelegate().ccTouchEnded(a,t),l.getClaimedTouches().length=0;break;case cc.TOUCH_CANCELLED:l.getDelegate().ccTouchCancelled(a,t),l.getClaimedTouches().length=0}}if(h&&l.isSwallowsTouches()){s&&cc.ArrayRemoveObject(o,a);break}}}}if(i>0)for(f=0;f<this._standardHandlers.length;f++){l=this._standardHandlers[f];if(!l)break;switch(u.type){case cc.TOUCH_BEGAN:o.length>0&&l.getDelegate().ccTouchesBegan(o,t);break;case cc.TOUCH_MOVED:o.length>0&&l.getDelegate().ccTouchesMoved(o,t);break;case cc.TOUCH_ENDED:l.getDelegate().ccTouchesEnded(o,t);break;case cc.TOUCH_CANCELLED:l.getDelegate().ccTouchesCancelled(o,t)}}s&&(o=null),this._locked=!1;if(this._toRemove){this._toRemove=!1;for(f=0;f<this._handlersToRemove.length;f++)this.forceRemoveDelegate(this._handlersToRemove[f]);this._handlersToRemove.length=0}if(this._toAdd){this._toAdd=!1;for(f=0;f<this._handlersToAdd.length;f++){l=this._handlersToAdd[f];if(!l)break;l instanceof cc.TargetedTouchHandler?this._targetedHandlers=this.forceAddHandler(l,this._targetedHandlers):this._standardHandlers=this.forceAddHandler(l,this._standardHandlers)}this._handlersToAdd.length=0}this._toQuit&&(this._toQuit=!1,this.forceRemoveAllDelegates())},touchesBegan:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_BEGAN)},touchesMoved:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_MOVED)},touchesEnded:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_ENDED)},touchesCancelled:function(e,t){this._dispatchEvents&&this.touches(e,t,cc.TOUCH_CANCELLED)},findHandler:function(e,t){switch(arguments.length){case 1:t=arguments[0];for(var n=0;n<this._targetedHandlers.length;n++)if(this._targetedHandlers[n].getDelegate()==t)return this._targetedHandlers[n];for(n=0;n<this._standardHandlers.length;n++)if(this._standardHandlers[n].getDelegate()==t)return this._standardHandlers[n];return null;case 2:cc.Assert(e!=null&&t!=null,"TouchDispatcher.findHandler():Arguments is null");for(n=0;n<e.length;n++)if(e[n].getDelegate()==t)return e[n];return null;default:throw"Argument must be non-nil "}},forceRemoveDelegate:function(e){var t;for(var n=0;n<this._standardHandlers.length;n++){t=this._standardHandlers[n];if(t&&t.getDelegate()==e){cc.ArrayRemoveObject(this._standardHandlers,t);break}}for(n=0;n<this._targetedHandlers.length;n++){t=this._targetedHandlers[n];if(t&&t.getDelegate()==e){cc.ArrayRemoveObject(this._targetedHandlers,t);break}}},rearrangeHandlers:function(e){e.sort(cc.less)}}),cc.TouchDispatcher.preTouchPoint=new cc.Point(0,0),cc.TouchDispatcher.registerHtmlElementEvent=function(e){e.addEventListener("mousedown",function(t){var n=e,r=null;e instanceof HTMLCanvasElement?r={left:0,top:0,height:n.height}:r={left:0,top:0,height:parseInt(n.style.height)};while(n!=null)r.left+=n.offsetLeft,r.top+=n.offsetTop,n=n.offsetParent;var i=t.pageX,s=t.pageY,o=(i-r.left)/cc.Director.sharedDirector().getContentScaleFactor(),u=(r.height-(s-r.top))/cc.Director.sharedDirector().getContentScaleFactor(),a=new cc.Touch(0,o,u);a._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=o,cc.TouchDispatcher.preTouchPoint.y=u;var f=[];f.push(a),cc.TouchDispatcher.sharedDispatcher().touchesBegan(f,null)}),e.addEventListener("mouseup",function(t){var n=e,r=null;e instanceof HTMLCanvasElement?r={left:0,top:0,height:n.height}:r={left:0,top:0,height:parseInt(n.style.height)};while(n!=null)r.left+=n.offsetLeft,r.top+=n.offsetTop,n=n.offsetParent;var i=t.pageX,s=t.pageY,o=(i-r.left)/cc.Director.sharedDirector().getContentScaleFactor(),u=(r.height-(s-r.top))/cc.Director.sharedDirector().getContentScaleFactor(),a=new cc.Touch(0,o,u);a._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=o,cc.TouchDispatcher.preTouchPoint.y=u;var f=[];f.push(a),cc.TouchDispatcher.sharedDispatcher().touchesEnded(f,null)}),e.addEventListener("mousemove",function(t){var n=e,r=null;e instanceof HTMLCanvasElement?r={left:0,top:0,height:n.height}:r={left:0,top:0,height:parseInt(n.style.height)};while(n!=null)r.left+=n.offsetLeft,r.top+=n.offsetTop,n=n.offsetParent;var i=t.pageX,s=t.pageY,o=(i-r.left)/cc.Director.sharedDirector().getContentScaleFactor(),u=(r.height-(s-r.top))/cc.Director.sharedDirector().getContentScaleFactor(),a=new cc.Touch(0,o,u);a._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=o,cc.TouchDispatcher.preTouchPoint.y=u;var f=[];f.push(a),cc.TouchDispatcher.sharedDispatcher().touchesMoved(f,null)}),e.addEventListener("touchstart",function(t){if(!t.touches)return;var n=[],r=e,i=null;e instanceof HTMLCanvasElement?i={left:0,top:0,height:r.height}:i={left:0,top:0,height:parseInt(r.style.height)};while(r!=null)i.left+=r.offsetLeft,i.top+=r.offsetTop,r=r.offsetParent;i.left-=document.body.scrollLeft,i.top-=document.body.scrollTop;for(var s=0;s<t.touches.length;s++){var o=t.touches[s].pageX,u=t.touches[s].pageY;t.touches[s]&&(o=t.touches[s].clientX,u=t.touches[s].clientY);var a=(o-i.left)/cc.Director.sharedDirector().getContentScaleFactor(),f=(i.height-(u-i.top))/cc.Director.sharedDirector().getContentScaleFactor(),l=new cc.Touch(0,a,f);l._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=a,cc.TouchDispatcher.preTouchPoint.y=f,n.push(l)}cc.TouchDispatcher.sharedDispatcher().touchesBegan(n,null),t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("touchmove",function(t){if(!t.touches)return;var n=[],r=e,i=null;e instanceof HTMLCanvasElement?i={left:0,top:0,height:r.height}:i={left:0,top:0,height:parseInt(r.style.height)};while(r!=null)i.left+=r.offsetLeft,i.top+=r.offsetTop,r=r.offsetParent;i.left-=document.body.scrollLeft,i.top-=document.body.scrollTop;for(var s=0;s<t.touches.length;s++){var o=t.touches[s].pageX,u=t.touches[s].pageY;t.touches[s]&&(o=t.touches[s].clientX,u=t.touches[s].clientY);var a=(o-i.left)/cc.Director.sharedDirector().getContentScaleFactor(),f=(i.height-(u-i.top))/cc.Director.sharedDirector().getContentScaleFactor(),l=new cc.Touch(0,a,f);l._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=a,cc.TouchDispatcher.preTouchPoint.y=f,n.push(l)}cc.TouchDispatcher.sharedDispatcher().touchesMoved(n,null),t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("touchend",function(t){if(!t.touches)return;var n=[],r=e,i=null;e instanceof HTMLCanvasElement?i={left:0,top:0,height:r.height}:i={left:0,top:0,height:parseInt(r.style.height)};while(r!=null)i.left+=r.offsetLeft,i.top+=r.offsetTop,r=r.offsetParent;i.left-=document.body.scrollLeft,i.top-=document.body.scrollTop;var s=t.touches;if(!s||s.length==0)s=t.changedTouches;for(var o=0;o<s.length;o++){var u=s[o].pageX,a=s[o].pageY;s[o]&&(u=s[o].clientX,a=s[o].clientY);var f=(u-i.left)/cc.Director.sharedDirector().getContentScaleFactor(),l=(i.height-(a-i.top))/cc.Director.sharedDirector().getContentScaleFactor(),c=new cc.Touch(0,f,l);c._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=f,cc.TouchDispatcher.preTouchPoint.y=l,n.push(c)}cc.TouchDispatcher.sharedDispatcher().touchesEnded(n,null),t.stopPropagation(),t.preventDefault()},!1),e.addEventListener("touchcancel",function(t){if(!t.touches)return;var n=[],r=e,i=null;e instanceof HTMLCanvasElement?i={left:0,top:0,height:r.height}:i={left:0,top:0,height:parseInt(r.style.height)};while(r!=null)i.left+=r.offsetLeft,i.top+=r.offsetTop,r=r.offsetParent;i.left-=document.body.scrollLeft,i.top-=document.body.scrollTop;for(var s=0;s<t.touches.length;s++){var o=t.touches[s].pageX,u=t.touches[s].pageY;t.touches[s]&&(o=t.touches[s].clientX,u=t.touches[s].clientY);var a=(o-i.left)/cc.Director.sharedDirector().getContentScaleFactor(),f=(i.height-(u-i.top))/cc.Director.sharedDirector().getContentScaleFactor(),l=new cc.Touch(0,a,f);l._setPrevPoint(cc.TouchDispatcher.preTouchPoint.x,cc.TouchDispatcher.preTouchPoint.y),cc.TouchDispatcher.preTouchPoint.x=a,cc.TouchDispatcher.preTouchPoint.y=f,n.push(l)}cc.TouchDispatcher.sharedDispatcher().touchesCancelled(n,null),t.stopPropagation(),t.preventDefault()},!1)},cc._pSharedDispatcher=null,cc.TouchDispatcher.sharedDispatcher=function(){return cc._pSharedDispatcher==null&&(cc._pSharedDispatcher=new cc.TouchDispatcher,cc._pSharedDispatcher.init(),cc.TouchDispatcher.registerHtmlElementEvent(cc.canvas)),cc._pSharedDispatcher},cc.KeypadDelegate=cc.Class.extend({keyDown:function(){},keyUp:function(){}}),cc.KeypadHandler=cc.Class.extend({getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},initWithDelegate:function(e){return cc.Assert(e!=null,"It's a wrong delegate!"),this._delegate=e,!0},_delegate:null}),cc.KeypadHandler.create=function(e){var t=new cc.KeypadHandler;return t.initWithDelegate(e),t},cc.TYPE_BACK_CLICKED=1,cc.TYPE_MENU_CLICKED=2,cc.KEY={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,semicolon:186,",":186,equal:187,"=":187,";":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,"]":221,closebracket:221,backslash:220,quote:222,space:32},cc.KeypadDispatcher=cc.Class.extend({addDelegate:function(e){if(!e)return;this._locked?(this._handlersToAdd.push(e),this._toAdd=!0):this.forceAddDelegate(e)},removeDelegate:function(e){if(!e)return;this._locked?(this._handlersToRemove.push(e),this._toRemove=!0):this.forceRemoveDelegate(e)},forceAddDelegate:function(e){var t=cc.KeypadHandler.create(e);if(t){for(var n=0;n<this._delegates;n++)this._delegates[n].getDelegate()==t.getDelegate();this._delegates.push(t)}},forceRemoveDelegate:function(e){var t=this._delegates.indexOf(e);t!=-1&&this._delegates.splice(this._delegates.indexOf(e),1)},dispatchKeypadMSG:function(e,t){this._locked=!0,e.stopPropagation(),e.preventDefault();if(t&&e)for(var n=0;n<this._delegates.length;n++)this._delegates[n].getDelegate().keyDown(e.keyCode);else if(!t&&e)for(var n=0;n<this._delegates.length;n++)this._delegates[n].getDelegate().keyUp(e.keyCode);this._locked=!1;if(this._toRemove){this._toRemove=!1;for(var n=0;n<this._handlersToRemove.length;++n)this.forceRemoveDelegate(this._handlersToRemove[n]);delete this._handlersToRemove,this._handlersToRemove=[]}if(this._toAdd){this._toAdd=!1;for(var n=0;n<this._handlersToAdd.length;++n)this.forceAddDelegate(this._handlersToAdd[n]);this._handlersToAdd=[]}return!0},_delegates:[],_locked:!1,_toAdd:!1,_toRemove:!1,_handlersToAdd:[],_handlersToRemove:[]}),cc.KeypadDispatcher.sharedDispatcher=function(){return cc.keypadDispatcher||(cc.keypadDispatcher=new cc.KeypadDispatcher,cc.canvas.setAttribute("contentEditable",!0),cc.canvas.style.outline="none",cc.canvas.style.cursor="default",cc.canvas.addEventListener("keydown",function(e){cc.keypadDispatcher.dispatchKeypadMSG(e,!0),cc.IMEDispatcher.sharedDispatcher().processKeycode(e.keyCode)}),cc.canvas.addEventListener("keyup",function(e){cc.keypadDispatcher.dispatchKeypadMSG(e,!1)})),cc.keypadDispatcher},cc.KeypadDispatcher.purgeSharedDispatcher=function(){cc.keypadDispatcher&&(delete cc.keypadDispatcher,cc.keypadDispatcher=null)},cc.IMEKeyboardNotificationInfo=function(e,t,n){this.begin=e||cc.RectZero(),this.end=t||cc.RectZero(),this.duration=n||0},cc.IMEDelegate=cc.Class.extend({ctor:function(){cc.IMEDispatcher.sharedDispatcher().addDelegate(this)},removeDelegate:function(){cc.IMEDispatcher.sharedDispatcher().removeDelegate(this)},attachWithIME:function(){return cc.IMEDispatcher.sharedDispatcher().attachDelegateWithIME(this)},detachWithIME:function(){return cc.IMEDispatcher.sharedDispatcher().detachDelegateWithIME(this)},canAttachWithIME:function(){return!1},didAttachWithIME:function(){},canDetachWithIME:function(){return!1},didDetachWithIME:function(){},insertText:function(e,t){},deleteBackward:function(){},getContentText:function(){return""},keyboardWillShow:function(e){},keyboardDidShow:function(e){},keyboardWillHide:function(e){},keyboardDidHide:function(e){}}),cc.IMEDispatcher=cc.Class.extend({impl:null,ctor:function(){this.impl=new cc.IMEDispatcher.Impl},dispatchInsertText:function(e,t){if(!this.impl||!e||t<=0)return;if(!this.impl._delegateWithIme)return;this.impl._delegateWithIme.insertText(e,t)},dispatchDeleteBackward:function(){if(!this.impl)return;if(!this.impl._delegateWithIme)return;this.impl._delegateWithIme.deleteBackward()},getContentText:function(){if(this.impl&&this.impl._delegateWithIme){var e=this.impl._delegateWithIme.getContentText();return e?e:""}return""},dispatchKeyboardWillShow:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardWillShow(e)}},dispatchKeyboardDidShow:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardDidShow(e)}},dispatchKeyboardWillHide:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardWillHide(e)}},dispatchKeyboardDidHide:function(e){if(this.impl)for(var t=0;t<this.impl._delegateList.length;t++){var n=this.impl._delegateList[t];n&&n.keyboardDidHide(e)}},addDelegate:function(e){if(!e||!this.impl)return;if(this.impl._delegateList.indexOf(e)>-1)return;this.impl._delegateList=cc.ArrayAppendObjectToIndex(this.impl._delegateList,e,0)},attachDelegateWithIME:function(e){if(!this.impl||!e)return!1;if(this.impl._delegateList.indexOf(e)==-1)return!1;if(this.impl._delegateWithIme){if(!this.impl._delegateWithIme.canDetachWithIME()||!e.canAttachWithIME())return!1;var t=this.impl._delegateWithIme;return this.impl._delegateWithIme=null,t.didDetachWithIME(),this.impl._delegateWithIme=e,e.didAttachWithIME(),!0}return e.canAttachWithIME()?(this.impl._delegateWithIme=e,e.didAttachWithIME(),!0):!1},detachDelegateWithIME:function(e){return!this.impl||!e?!1:this.impl._delegateWithIme!=e?!1:e.canDetachWithIME()?(this.impl._delegateWithIme=0,e.didDetachWithIME(),!0):!1},removeDelegate:function(e){if(!this.impl||!e)return;if(this.impl._delegateList.indexOf(e)==-1)return;this.impl._delegateWithIme&&e==this.impl._delegateWithIme&&(this.impl._delegateWithIme=null),cc.ArrayRemoveObject(this.impl._delegateList,e)},processKeycode:function(e){e<32?e==cc.KEY.backspace?this.dispatchDeleteBackward():e==cc.KEY.enter?this.dispatchInsertText("\n",1):e!=cc.KEY.tab&&e==cc.KEY.escape:e<255&&this.dispatchInsertText(String.fromCharCode(e),1)}}),cc.IMEDispatcher.Impl=cc.Class.extend({_delegateWithIme:null,_delegateList:null,ctor:function(){this._delegateList=[]},findDelegate:function(e){for(var t=0;t<this._delegateList.length;t++)if(this._delegateList[t]==e)return t;return null}}),cc.IMEDispatcher.sharedDispatcher=function(){return cc.IMEDispatcher.instance||(cc.IMEDispatcher.instance=new cc.IMEDispatcher,cc.KeypadDispatcher.sharedDispatcher()),cc.IMEDispatcher.instance},cc.IMEDispatcher.instance=null,cc.TextFieldDelegate=cc.Class.extend({onTextFieldAttachWithIME:function(e){return!1},onTextFieldDetachWithIME:function(e){return!1},onTextFieldInsertText:function(e,t,n){return!1},onTextFieldDeleteBackward:function(e,t,n){return!1},onDraw:function(e){return!1}}),cc.TextFieldTTF=cc.LabelTTF.extend({_lens:null,_inputText:"",_placeHolder:"",_charCount:0,_delegate:null,_ColorSpaceHolder:null,ctor:function(){this._ColorSpaceHolder=new cc.Color3B(127,127,127),cc.IMEDispatcher.sharedDispatcher().addDelegate(this),this._super()},getDelegate:function(){return this._delegate},setDelegate:function(e){this._delegate=e},getCharCount:function(){return this._charCount},getColorSpaceHolder:function(){return this._ColorSpaceHolder},setColorSpaceHolder:function(e){this._ColorSpaceHolder=e},initWithPlaceHolder:function(e,t,n,r,i){switch(arguments.length){case 5:return e&&(this._placeHolder=e),this.initWithString(this._placeHolder,t,n,r,i);case 3:return e&&(this._placeHolder=e),r=arguments[1],i=arguments[2],this.initWithString(this._placeHolder,r,i);default:throw"Argument must be non-nil "}},setString:function(e,t){if(t&&t==1){this._super(e);return}e?this._inputText=e:this._inputText="",this._inputText.length?this._super(this._inputText):this._super(this._placeHolder),this._charCount=this._inputText.length},getString:function(){return this._inputText},setPlaceHolder:function(e){this._placeHolder=e||"",this._inputText.length||this.setString(this._placeHolder,!0)},getPlaceHolder:function(){return this._placeHolder},draw:function(e){var t=e||cc.renderContext;if(this._delegate&&this._delegate.onDraw(this))return;if(this._inputText){this._super(t);return}var n=this.getColor();this.setColor(this._ColorSpaceHolder),this._super(t),this.setColor(n)},attachWithIME:function(){var e=cc.IMEDispatcher.sharedDispatcher().attachDelegateWithIME(this);return e},detachWithIME:function(){var e=cc.IMEDispatcher.sharedDispatcher().detachDelegateWithIME(this);return e},canAttachWithIME:function(){return this._delegate?!this._delegate.onTextFieldAttachWithIME(this):!0},didAttachWithIME:function(){},canDetachWithIME:function(){return this._delegate?!this._delegate.onTextFieldDetachWithIME(this):!0},didDetachWithIME:function(){},deleteBackward:function(){var e=this._inputText.length;if(e==0)return;var t=1;if(this._delegate&&this._delegate.onTextFieldDeleteBackward(this,this._inputText[e-t],t))return;if(e<=t){this._inputText="",this._charCount=0,this.setString(this._placeHolder,!0);return}var n=this._inputText.substring(0,e-t);this.setString(n)},removeDelegate:function(){cc.IMEDispatcher.sharedDispatcher().removeDelegate(this)},insertText:function(e,t){var n=e,r=n.indexOf("\n");r>-1&&(n=n.substring(0,r));if(n.length>0){if(this._delegate&&this._delegate.onTextFieldInsertText(this,n,n.length))return;var i=this._inputText+n;this._charCount=i.length,this.setString(i)}if(r==-1)return;if(this._delegate&&this._delegate.onTextFieldInsertText(this,"\n",1))return;this.detachWithIME()},getContentText:function(){return this._inputText},keyboardWillShow:function(e){},keyboardDidShow:function(e){},keyboardWillHide:function(e){},keyboardDidHide:function(e){}}),cc.TextFieldTTF.create=function(e,t,n,r,i){switch(arguments.length){case 5:var s=new cc.TextFieldTTF;if(s&&s.initWithPlaceHolder("",t,n,r,i))return e&&s.setPlaceHolder(e),s;return null;case 3:var s=new cc.TextFieldTTF;r=arguments[1],i=arguments[2];if(s&&s.initWithString("",r,i))return e&&s.setPlaceHolder(e),s;return null;default:throw"Argument must be non-nil "}},cc.ENABLE_PROFILERS,cc.CCDIRECTOR_PROJECTION_2D=0,cc.CCDIRECTOR_PROJECTION_3D=1,cc.CCDIRECTOR_PROJECTION_CUSTOM=3,cc.CCDIRECTOR_PROJECTION_DEFAULT=cc.CCDIRECTOR_PROJECTION_3D,cc.DIRECTOR_PROJECTION_2D=cc.CCDIRECTOR_PROJECTION_2D,cc.DIRECTOR_PROJECTION_3D=cc.CCDIRECTOR_PROJECTION_3D,cc.DIRECTOR_PROJECTION_CUSTOM=cc.CCDIRECTOR_PROJECTION_CUSTOM,cc.CCDIRECTOR_TYPE_NS_TIMER=0,cc.CCDIRECTOR_TYPE_MAIN_LOOP=1,cc.CCDIRECTOR_TYPE_THREAD_MAIN_LOOP=2,cc.CCDIRECTOR_TYPE_DISPLAY_LINK=3,cc.CCDIRECTOR_TYPE_DEFAULT=cc.CCDIRECTOR_TYPE_NS_TIMER,cc.DIRECTOR_TYPE_NS_TIMER=cc.CCDIRECTOR_TYPE_NS_TIMER,cc.DIRECTOR_TYPE_MAIN_LOOP=cc.CCDIRECTOR_TYPE_MAIN_LOOP,cc.DIRECTOR_TYPE_THREAD_MAIN_LOOP=cc.CCDIRECTOR_TYPE_THREAD_MAIN_LOOP,cc.DIRECTOR_TYPE_DISPLAY_LINK=cc.CCDIRECTOR_TYPE_DISPLAY_LINK,cc.DIRECTOR_TYPE_DEFAULT=cc.CCDIRECTOR_TYPE_DEFAULT,cc.CCDEVICE_ORIENTATION_PORTRAIT=0,cc.CCDEVICE_ORIENTATION_LANDSCAPE_LEFT=1,cc.CCDEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN=2,cc.CCDEVICE_ORIENTATION_LANDSCAPE_RIGHT=3,cc.DEVICE_MAX_ORIENTATIONS=2,cc.DEVICE_ORIENTATION_PORTRAIT=cc.CCDEVICE_ORIENTATION_PORTRAIT,cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN=cc.CCDEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN,cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT=cc.CCDEVICE_ORIENTATION_LANDSCAPE_LEFT,cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT=cc.CCDEVICE_ORIENTATION_LANDSCAPE_RIGHT,cc.Director=cc.Class.extend({_displayFPS:!1,_isContentScaleSupported:!1,_landscape:!1,_nextDeltaTimeZero:!1,_paused:!1,_purgeDirecotorInNextLoop:!1,_retinaDisplay:!1,_sendCleanupToScene:!1,_animationInterval:0,_oldAnimationInterval:0,_deviceOrientation:0,_projection:0,_accumDt:0,_accumDtForProfiler:0,_contentScaleFactor:1,_deltaTime:0,_frameRate:0,_winSizeInPixels:null,_winSizeInPoints:null,_FPSLabel:null,_lastUpdate:null,_nextScene:null,_notificationNode:null,_openGLView:null,_scenesStack:null,_projectionDelegate:null,_runningScene:null,_szFPS:"",_frames:0,_totalFrames:0,_dirtyRegion:null,init:function(){return this._FPSLabel||(this._FPSLabel=cc.LabelTTF.create("00.0","Arial",24)),this._FPSLabel.setPosition(cc.ccp(0,0)),this._FPSLabel.setAnchorPoint(cc.ccp(0,0)),this._runningScene=null,this._nextScene=null,this._notificationNode=null,this._oldAnimationInterval=this._animationInterval=1/cc.defaultFPS,this._scenesStack=[],this._projection=cc.CCDIRECTOR_PROJECTION_DEFAULT,this._projectionDelegate=null,this._displayFPS=!1,this._totalFrames=this._frames=0,this._szFPS="",this._lastUpdate=new cc.timeval,this._paused=!1,this._purgeDirecotorInNextLoop=!1,this._winSizeInPixels=this._winSizeInPoints=cc.SizeMake(cc.canvas.width,cc.canvas.height),this._deviceOrientation=cc.DEVICE_ORIENTATION_PORTRAIT,this._openGLView=null,this._retinaDisplay=!1,this._contentScaleFactor=1,this._isContentScaleSupported=!1,!0},applyOrientation:function(){var e=this._winSizeInPixels,t=e.width/2,n=e.height/2;switch(this._deviceOrientation){case cc.DEVICE_ORIENTATION_PORTRAIT:break;case cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN:break;case cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT:break;case cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT:}},calculateDeltaTime:function(){var e=new cc.timeval;e=cc.Time.gettimeofdayCocos2d();if(!e){cc.Log("error in gettimeofday"),this._deltaTime=0;return}this._nextDeltaTimeZero?(this._deltaTime=0,this._nextDeltaTimeZero=!1):(this._deltaTime=e.tv_sec-this._lastUpdate.tv_sec+(e.tv_usec-this._lastUpdate.tv_usec)/1e6,this._deltaTime=Math.max(0,this._deltaTime)),cc.DEBUG&&this._deltaTime>.2&&(this._deltaTime=1/60),this._lastUpdate=e},convertToGL:function(e){var t=this._winSizeInPoints,n=t.height-e.y,r=t.width-e.x,i=cc.PointZero();switch(this._deviceOrientation){case cc.DEVICE_ORIENTATION_PORTRAIT:i=cc.ccp(e.x,n);break;case cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN:i=cc.ccp(r,e.y);break;case cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT:i.x=e.y,i.y=e.x;break;case cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT:i.x=n,i.y=r}return i},convertToUI:function(e){var t=this._winSizeInPoints,n=t.width-e.x,r=t.height-e.y,i=cc.PointZero();switch(this._deviceOrientation){case cc.DEVICE_ORIENTATION_PORTRAIT:i=cc.ccp(e.x,r);break;case cc.DEVICE_ORIENTATION_PORTRAIT_UPSIDE_DOWN:i=cc.ccp(n,e.y);break;case cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT:i=cc.ccp(e.y,e.x);break;case cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT:i=cc.ccp(t.width-e.y,t.height-e.x)}return i},drawScene:function(){this.calculateDeltaTime(),this._paused||cc.Scheduler.sharedScheduler().tick(this._deltaTime),cc.renderContext.clearRect(0,0,cc.canvas.width,-cc.canvas.height),this._nextScene&&this.setNextScene(),this.applyOrientation(),cc.ENABLE_DEFAULT_GL_STATES(),this._runningScene&&this._runningScene.visit(),this._notificationNode&&this._notificationNode.visit(),this._displayFPS&&this.showFPS(),cc.ENABLE_PROFILERS&&this.showProfilers(),cc.DISABLE_DEFAULT_GL_STATES(),this._totalFrames++,this._openGLView&&this._openGLView.swapBuffers()},addRegionToDirtyRegion:function(e){if(!e)return;if(!this._dirtyRegion){this._dirtyRegion=new cc.Rect(e.origin.x,e.origin.y,e.size.width,e.size.height);return}this._dirtyRegion=cc.Rect.CCRectUnion(this._dirtyRegion,new cc.Rect(e.origin.x,e.origin.y,e.size.width,e.size.height))},rectIsInDirtyRegion:function(e){return!e||!this._fullRect?!1:cc.Rect.CCRectIntersectsRect(this._fullRect,e)},enableRetinaDisplay:function(e){if(e&&this._contentScaleFactor==2)return!0;if(!e&&this._contentScaleFactor==1)return!1;if(!this._openGLView.canSetContentScaleFactor())return!1;var t=e?2:1;return this.setContentScaleFactor(t),cc.TextureCache.purgeSharedTextureCache(),cc.DIRECTOR_FAST_FPS&&(this._FPSLabel||(this._FPSLabel=cc.LabelTTF.create("00.0","Arial",24),this._FPSLabel.setPosition(cc.ccp(0,0)),this._FPSLabel.setAnchorPoint(cc.ccp(0,0)))),this._retinaDisplay=this._contentScaleFactor==2,!0},end:function(){this._purgeDirecotorInNextLoop=!0},getContentScaleFactor:function(){return this._contentScaleFactor},getDeviceOrientation:function(){return this._deviceOrientation},getDisplaySizeInPixels:function(){return this._winSizeInPixels},getNotificationNode:function(){return this._notificationNode},getWinSize:function(){var e=this._winSizeInPoints;if(this._deviceOrientation==cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT||this._deviceOrientation==cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT){var t=new cc.SizeZero;return t.width=e.height,t.height=e.width,t}return e},getWinSizeInPixels:function(){var e=this.getWinSize();return e.width*=cc.CONTENT_SCALE_FACTOR(),e.height*=cc.CONTENT_SCALE_FACTOR(),e},getZEye:function(){return this._winSizeInPixels.height/1.1566},pause:function(){if(this._paused)return;this._oldAnimationInterval=this._animationInterval,this.setAnimationInterval(.25),this._paused=!0},popScene:function(){cc.Assert(this._runningScene!=null,"running scene should not null"),this._scenesStack.pop();var e=this._scenesStack.length;e==0?this.end():(this._sendCleanupToScene=!0,this._nextScene=this._scenesStack[e-1])},purgeCachedData:function(){cc.LabelBMFont.purgeCachedData(),cc.TextureCache.sharedTextureCache().removeUnusedTextures()},purgeDirector:function(){cc.TouchDispatcher.sharedDispatcher().removeAllDelegates(),this._runningScene&&(this._runningScene.onExit(),this._runningScene.cleanup()),this._runningScene=null,this._nextScene=null,this._scenesStack=[],this.stopAnimation(),cc.AnimationCache.purgeSharedAnimationCache(),cc.SpriteFrameCache.purgeSharedSpriteFrameCache(),cc.ActionManager.sharedManager().purgeSharedManager(),cc.Scheduler.purgeSharedScheduler(),cc.TextureCache.purgeSharedTextureCache(),cc.TARGET_PLATFORM!=cc.PLATFORM_MARMALADE&&cc.UserDefault.purgeSharedUserDefault(),this._openGLView=null},pushScene:function(e){cc.Assert(e,"the scene should not null"),this._sendCleanupToScene=!1,this._scenesStack.push(e),this._nextScene=e},replaceScene:function(e){cc.Assert(e!=null,"the scene should not be null");var t=this._scenesStack.length;this._sendCleanupToScene=!0,this._scenesStack[t-1]=e,this._nextScene=e},resetDirector:function(){cc.TouchDispatcher.sharedDispatcher().removeAllDelegates(),this._runningScene&&(this._runningScene.onExit(),this._runningScene.cleanup(),this._runningScene.release()),this._runningScene=null,this._nextScene=null,this._scenesStack.removeAllObjects(),this.stopAnimation(),cc.LabelBMFont.purgeCachedData(),cc.AnimationCache.purgeSharedAnimationCache(),cc.SpriteFrameCache.purgeSharedSpriteFrameCache(),cc.ActionManager.sharedManager().purgeSharedManager(),cc.Scheduler.purgeSharedScheduler(),cc.TextureCache.purgeSharedTextureCache()},reshapeProjection:function(e){cc.UNUSED_PARAM(e),this._winSizeInPoints=this._openGLView.getSize(),this._winSizeInPixels=cc.SizeMake(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor),this.setProjection(this._projection)},resume:function(){if(!this._paused)return;this.setAnimationInterval(this._oldAnimationInterval),this._lastUpdate=cc.Time.gettimeofdayCocos2d(),this._lastUpdate||cc.Log("cocos2d: Director: Error in gettimeofday"),this._paused=!1,this._deltaTime=0},runWithScene:function(e){cc.Assert(e!=null,"running scene should not be null"),cc.Assert(this._runningScene==null,"_runningScene should be null"),this.pushScene(e),this.startAnimation()},setAlphaBlending:function(e){e},setContentScaleFactor:function(e){e!=this._contentScaleFactor&&(this._contentScaleFactor=e,this._winSizeInPixels=cc.SizeMake(this._winSizeInPoints.width*e,this._winSizeInPoints.height*e),this._openGLView&&this.updateContentScaleFactor(),this.setProjection(this._projection))},setDepthTest:function(e){e},setDeviceOrientation:function(e){var t=cc.Application.sharedApplication().setOrientation(e);if(this._deviceOrientation%cc.DEVICE_MAX_ORIENTATIONS!=t%cc.DEVICE_MAX_ORIENTATIONS){this._deviceOrientation=t;if(cc.renderContextType==cc.CANVAS){var n=cc.canvas.height;cc.canvas.height=cc.canvas.width,cc.canvas.width=n,cc.renderContext.translate(0,cc.canvas.height);if(cc.domNode){var r=cc.$("#Cocos2dGameContainer");r&&(r.style.width=cc.canvas.width+"px",r.style.height=cc.canvas.height+"px")}}}},setGLDefaultValues:function(){cc.Assert(this._openGLView,"opengl view should not be null"),this.setAlphaBlending(!0),this.setDepthTest(!0),this.setProjection(this._projection),cc.DIRECTOR_FAST_FPS&&(this._FPSLabel||(this._FPSLabel=cc.LabelTTF.create("00.0","Arial",24),this._FPSLabel.setPosition(cc.ccp(0,0)),this._FPSLabel.setAnchorPoint(cc.ccp(0,0))))},setNextDeltaTimeZero:function(e){this._nextDeltaTimeZero=e},setNextScene:function(){var e=this._runningScene?this._runningScene instanceof cc.TransitionScene:!1,t=this._nextScene?this._nextScene instanceof cc.TransitionScene:!1;t||(this._runningScene&&this._runningScene.onExit(),this._sendCleanupToScene&&this._runningScene&&this._runningScene.cleanup()),this._runningScene=this._nextScene,this._nextScene=null,!e&&this._runningScene!=null&&(this._runningScene.onEnter(),this._runningScene.onEnterTransitionDidFinish())},setNotificationNode:function(e){this._notificationNode=e},setOpenGLView:function(e){cc.Assert(e,"opengl view should not be null");if(this._openGLView!=e){delete this._openGLView,this._openGLView=e,this._winSizeInPoints=this._openGLView.getSize(),this._winSizeInPixels=cc.SizeMake(this._winSizeInPoints.width*this._contentScaleFactor,this._winSizeInPoints.height*this._contentScaleFactor),this.setGLDefaultValues(),this._contentScaleFactor!=1&&this.updateContentScaleFactor();var t=cc.TouchDispatcher.sharedDispatcher();this._openGLView.setTouchDelegate(t),t.setDispatchEvents(!0)}},setProjection:function(e){var t=this._winSizeInPixels,n=this.getZEye();switch(e){case cc.CCDIRECTOR_PROJECTION_2D:this._openGLView&&this._openGLView.setViewPortInPoints(0,0,t.width,t.height);break;case cc.CCDIRECTOR_PROJECTION_3D:this._openGLView&&this._openGLView.setViewPortInPoints(0,0,t.width,t.height);break;case cc.CCDIRECTOR_PROJECTION_CUSTOM:this._projectionDelegate&&this._projectionDelegate.updateProjection();break;default:cc.Log("cocos2d: Director: unrecognized projecgtion")}this._projection=e},showFPS:function(){this._frames++,this._accumDt+=this._deltaTime,this._accumDt>cc.DIRECTOR_FPS_INTERVAL&&(this._frameRate=this._frames/this._accumDt,this._frames=0,this._accumDt=0,this._szFPS=""+this._frameRate.toFixed(1),this._FPSLabel.setString(this._szFPS)),this._FPSLabel.draw()},showProfilers:function(){cc.ENABLE_PROFILERS&&(this._accumDtForProfiler+=this._deltaTime,this._accumDtForProfiler>1&&(this._accumDtForProfiler=0,cc.Profiler.sharedProfiler().displayTimers()))},updateContentScaleFactor:function(){this._openGLView.canSetContentScaleFactor()?(this._openGLView.setContentScaleFactor(this._contentScaleFactor),this._isContentScaleSupported=!0):cc.Log("cocos2d: setContentScaleFactor:'is not supported on this device")},isRetinaDisplay:function(){return this._retinaDisplay},isSendCleanupToScene:function(){return this._sendCleanupToScene},getRunningScene:function(){return this._runningScene},getAnimationInterval:function(){return this._animationInterval},isDisplayFPS:function(){return this._displayFPS},setDisplayFPS:function(e){this._displayFPS=e},getOpenGLView:function(){return this._openGLView},isNextDeltaTimeZero:function(){return this._nextDeltaTimeZero},isPaused:function(){return this._paused},getFrames:function(){return this._frames},getProjection:function(){return this._projection}}),cc.Director.sharedDirector=function(){return cc.firstRun&&(cc.sharedDirector.init(),cc.firstRun=!1),cc.sharedDirector},cc.Director.setDirectorType=function(e){return cc.Director.sharedDirector(),!0},cc.DisplayLinkDirector=cc.Director.extend({invalid:!1,startAnimation:function(){this._lastUpdate=cc.Time.gettimeofdayCocos2d(),this.invalid=!1,cc.Application.sharedApplication().setAnimationInterval(this._animationInterval)},mainLoop:function(){this._purgeDirecotorInNextLoop?(this.purgeDirector(),this._purgeDirecotorInNextLoop=!1):this.invalid||this.drawScene()},stopAnimation:function(){this.invalid=!0},setAnimationInterval:function(e){this._animationInterval=e,this.invalid||(this.stopAnimation(),this.startAnimation())}}),cc.sharedDirector=new cc.DisplayLinkDirector,cc.firstRun=!0,cc.defaultFPS=60;var cc=cc=cc||{};cc.Camera=cc.Class.extend({_eyeX:null,_eyeY:null,_eyeZ:null,_centerX:null,_centerY:null,_centerZ:null,_upX:null,_upY:null,_upZ:null,_dirty:null,ctor:function(){this.restore()},description:function(){return"<CCCamera | center =("+this._centerX+","+this._centerY+","+this._centerZ+")>"},setDirty:function(e){this._dirty=e},getDirty:function(){return this._dirty},restore:function(){this._eyeX=this._eyeY=0,this._eyeZ=cc.Camera.getZEye(),this._centerX=this._centerY=this._centerZ=0,this._upX=0,this._upY=1,this._upZ=0,this._dirty=!1},locate:function(){this._dirty},setEyeXYZ:function(e,t,n){this._eyeX=e*cc.CONTENT_SCALE_FACTOR,this._eyeY=t*cc.CONTENT_SCALE_FACTOR,this._eyeZ=n*cc.CONTENT_SCALE_FACTOR,this._dirty=!0},setCenterXYZ:function(e,t,n){this._centerX=e*cc.CONTENT_SCALE_FACTOR,this._centerY=t*cc.CONTENT_SCALE_FACTOR,this._centerZ=n*cc.CONTENT_SCALE_FACTOR,this._dirty=!0},setUpXYZ:function(e,t,n){this._upX=e,this._upY=t,this._upZ=n,this._dirty=!0},getEyeXYZ:function(e,t,n){e=this._eyeX/cc.CONTENT_SCALE_FACTOR,t=this._eyeY/cc.CONTENT_SCALE_FACTOR,n=this._eyeZ/cc.CONTENT_SCALE_FACTOR},getCenterXYZ:function(e,t,n){e=this._centerX/cc.CONTENT_SCALE_FACTOR,t=this._centerY/cc.CONTENT_SCALE_FACTOR,n=this._centerZ/cc.CONTENT_SCALE_FACTOR},getUpXYZ:function(e,t,n){e=this._upX,t=this._upY,n=this._upZ},_DISALLOW_COPY_AND_ASSIGN:function(e){}}),cc.Camera.getZEye=function(){return cc.FLT_EPSILON},cc.ArrayRemoveObjectAtIndex=function(e,t){e.splice(t,1)},cc.ArrayRemoveObject=function(e,t){for(var n=0;n<e.length;n++)e[n]==t&&e.splice(n,1)},cc.ArrayRemoveArray=function(e,t){for(var n=0;n<t.length;n++)cc.ArrayRemoveObject(e,t[n])},cc.ArrayGetIndexOfValue=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return n;return-1},cc.ArrayAppendObject=function(e,t){e.push(t)},cc.ArrayAppendObjectToIndex=function(e,t,n){var r=e.slice(0,n),i=e.slice(n);return r.push(t),e=r.concat(i),e},cc.ArrayGetIndexOfObject=function(e,t){for(var n=0;n<e.length;n++)if(e[n]==t)return n;return-1},cc.ArrayContainsObject=function(e,t){return cc.ArrayGetIndexOfObject(e,t)!=-1},cc.HASH_FIND_INT=function(e,t){if(e==null)return null;for(var n=0;n<e.length;n++)if(e[n].target==t)return e[n];return null},cc.ListEntry=function(e,t,n,r,i,s){this.prev=e,this.next=t,this.target=n,this.priority=r,this.paused=i,this.makedForDeletion=s},cc.HashUpdateEntry=function(e,t,n,r){this.list=e,this.entry=t,this.target=n,this.hh=r},cc.HashSelectorEntry=function(e,t,n,r,i,s,o){this.timers=e,this.target=t,this.timerIndex=n,this.currentTimer=r,this.currentTimerSalvaged=i,this.paused=s,this.hh=o},cc.Timer=cc.Class.extend({_interval:0,_selector:"",_target:null,_elapsed:0,ctor:function(){},getInterval:function(){return this._interval},initWithTarget:function(e,t,n){try{return this._target=e,this._selector=t,this._elapsed=-1,this._interval=n||0,!0}catch(r){return!1}},update:function(e){this._elapsed==-1?this._elapsed=0:this._elapsed+=e,this._elapsed>=this._interval&&this._selector&&(typeof this._selector=="string"?this._target[this._selector](this._elapsed):typeof this._selector=="function"&&this._selector.call(this._target,this._elapsed),this._elapsed=0)}}),cc.Timer.timerWithTarget=function(e,t,n){if(arguments<2)throw new Error("timerWithTarget'argument can't is null");var r=new cc.Timer;return arguments.length==2?r.initWithTarget(e,t,0):r.initWithTarget(e,t,n),r},cc._sharedScheduler=null,cc.Scheduler=cc.Class.extend({_timeScale:0,_updatesNegList:[],_updates0List:[],_updatesPosList:[],_hashForUpdates:[],_hashForSelectors:[],_currentTarget:null,_currentTargetSalvaged:!1,_updateHashLocked:!1,ctor:function(){},_removeHashElement:function(e){e.Timer=null,e.target=null,cc.ArrayRemoveObject(this._hashForSelectors,e),e=null},_findElementFromArray:function(e,t){for(var n=0;n<e.length;n++)if(e[n].target==t)return e[n];return null},_removeUpdateFromHash:function(e){var t=this._findElementFromArray(this._hashForUpdates,e.target);t&&(cc.ArrayRemoveObject(t.list,t.entry),t.entry=null,t.target=null,cc.ArrayRemoveObject(this._hashForUpdates,t))},_init:function(){return this._timeScale=1,this._updatesNegList=[],this._updates0List=[],this._updatesPosList=[],this._hashForUpdates=[],this._hashForSelectors=[],this._currentTarget=null,this._currentTargetSalvaged=!1,this._updateHashLocked=!1,!0},_priorityIn:function(e,t,n,r){var i=new cc.ListEntry(null,null,t,n,r,!1);if(!e)e=[],e.push(i);else{var s=!1;for(var o=0;o<e.length;o++)if(n<e[o].priority){e=cc.ArrayAppendObjectToIndex(e,i,o),s=!0;break}s||e.push(i)}var u=new cc.HashUpdateEntry(e,i,t,null);this._hashForUpdates.push(u)},_appendIn:function(e,t,n){var r=new cc.ListEntry(null,null,t,0,n,!1);e.push(r);var i=new cc.HashUpdateEntry(e,r,t,null);this._hashForUpdates.push(i)},setTimeScale:function(e){this._timeScale=e},getTimeScale:function(){return this._timeScale},tick:function(e){this._updateHashLocked=!0,this._timeScale!=1&&(e*=this._timeScale);var t,n=0;for(n=0;n<this._updatesNegList.length;n++)t=this._updatesNegList[n],!t.paused&&!t.makedForDeletion&&t.target.update(e);for(n=0;n<this._updates0List.length;n++)t=this._updates0List[n],!t.paused&&!t.makedForDeletion&&t.target.update(e);for(n=0;n<this._updatesPosList.length;n++)t=this._updatesPosList[n],!t.paused&&!t.makedForDeletion&&t.target.update(e);var r;for(n=0;n<this._hashForSelectors.length;n++){this._currentTarget=this._hashForSelectors[n],r=this._currentTarget,this._currentTargetSalvaged=!1;if(!this._currentTarget.paused)for(r.timerIndex=0;r.timerIndex<r.timers.length;r.timerIndex++)r.currentTimer=r.timers[r.timerIndex],r.currentTimerSalvaged=!1,r.currentTimer.update(e),r.currentTimer=null;this._currentTargetSalvaged&&this._currentTarget.timers.length==0&&this._removeHashElement(this._currentTarget)}for(n=0;n<this._updatesNegList.length;n++)this._updatesNegList[n].makedForDeletion&&this._removeUpdateFromHash(t);for(n=0;n<this._updates0List.length;n++)this._updates0List[n].makedForDeletion&&this._removeUpdateFromHash(t);for(n=0;n<this._updatesPosList.length;n++)this._updatesPosList[n].makedForDeletion&&this._removeUpdateFromHash(t);this._updateHashLocked=!1,this._currentTarget=null},scheduleSelector:function(e,t,n,r){cc.Assert(e,"scheduler.scheduleSelector()"),cc.Assert(t,"");var i=cc.HASH_FIND_INT(this._hashForSelectors,t);i?cc.Assert(i.paused==r,"Sheduler.scheduleSelector()"):(i=new cc.HashSelectorEntry(null,t,0,null,null,r,null),this._hashForSelectors.push(i));if(i.timers==null)i.timers=[];else for(var s=0;s<i.timers.length;s++){var o=i.timers[s];if(e==o._selector){cc.Log("CCSheduler#scheduleSelector. Selector already scheduled."),o._interval=n;return}}var o=new cc.Timer;o.initWithTarget(t,e,n),i.timers.push(o)},scheduleUpdateForTarget:function(e,t,n){var r=cc.HASH_FIND_INT(this._hashForUpdates,e);if(r){cc.COCOS2D_DEBUG>=1&&cc.Assert(r.entry.markedForDeletion,""),r.entry.markedForDeletion=!1;return}t==0?this._appendIn(this._updates0List,e,n):t<0?this._priorityIn(this._updatesNegList,e,t,n):this._priorityIn(this._updatesPosList,e,t,n)},unscheduleSelector:function(e,t){if(t==null||e==null)return;var n=cc.HASH_FIND_INT(this._hashForSelectors,t);if(n!=null)for(var r=0;r<n.timers.length;r++){var i=n.timers[r];if(e==i._selector){i==n.currentTimer&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0),cc.ArrayRemoveObjectAtIndex(n.timers,r),n.timerIndex>=r&&n.timerIndex--,n.timers.length==0&&(this._currentTarget==n?this._currentTargetSalvaged=!0:this._removeHashElement(n));return}}},unscheduleUpdateForTarget:function(e){if(e==null)return;var t=cc.HASH_FIND_INT(this._hashForUpdates,e);t!=null&&(this._updateHashLocked?t.entry.markedForDeletion=!0:this._removeUpdateFromHash(t.entry))},unscheduleAllSelectorsForTarget:function(e){if(e==null)return;var t=cc.HASH_FIND_INT(this._hashForSelectors,e);t&&(!t.currentTimerSalvaged&&cc.ArrayContainsObject(t.timers,t.currentTimer)&&(t.currentTimerSalvaged=!0),t.timers.length=0,this._currentTarget==t?this._currentTargetSalvaged=!0:this._removeHashElement(t)),this.unscheduleUpdateForTarget(e)},unscheduleAllSelectors:function(){var e;for(e=0;e<this._hashForSelectors.length;e++)this.unscheduleAllSelectorsForTarget(this._hashForSelectors[e].target);for(e=0;e<this._updates0List.length;e++)this.unscheduleUpdateForTarget(this._updates0List[e].target);for(e=0;e<this._updatesNegList.length;e++)this.unscheduleUpdateForTarget(this._updatesNegList[e].target);for(e=0;e<this._updatesPosList.length;e++)this.unscheduleUpdateForTarget(this._updatesPosList[e].target)},pauseTarget:function(e){cc.Assert(e!=null,"Scheduler.pauseTarget():entry must be non nil");var t=cc.HASH_FIND_INT(this._hashForSelectors,e);t&&(t.paused=!0);var n=cc.HASH_FIND_INT(this._hashForUpdates,e);n&&(cc.Assert(n.entry!=null,"Scheduler.pauseTarget():entry must be non nil"),n.entry.paused=!0)},resumeTarget:function(e){cc.Assert(e!=null,"");var t=cc.HASH_FIND_INT(this._hashForSelectors,e);t&&(t.paused=!1);var n=cc.HASH_FIND_INT(this._hashForUpdates,e);n&&(cc.Assert(n.entry!=null,"Scheduler.resumeTarget():entry must be non nil"),n.entry.paused=!1)},isTargetPaused:function(e){cc.Assert(e!=null,"Scheduler.isTargetPaused():target must be non nil");var t=cc.HASH_FIND_INT(this._hashForSelectors,e);return t?t.paused:!1}}),cc.Scheduler.sharedScheduler=function(){return cc._sharedScheduler||(cc._sharedScheduler=new cc.Scheduler,cc._sharedScheduler._init()),cc._sharedScheduler},cc.Scheduler.purgeSharedScheduler=function(){cc._sharedScheduler=null},cc.Loader=cc.Class.extend({resourceCount:0,loadedResourceCount:0,timer:0,isLoadedComplete:function(){var e=cc.Loader.shareLoader();e.loadedResourceCount==e.resourceCount?e.onload?e.timer=setTimeout(e.onload,16):cc.Assert(0,"cocos2d:no load callback defined"):(e.onloading?e.timer=setTimeout(e.onloading,16):cc.LoaderScene.shareLoaderScene().draw(),e.timer=setTimeout(e.isLoadedComplete,16))},onResLoadingErr:function(e){cc.Log("cocos2d:Failed loading resource: "+e)},onResLoaded:function(){this.loadedResourceCount++},getProgressBar:function(){var e=this.loadedResourceCount/this.resourceCount;return e=parseInt(e*100),e},onload:undefined,onerror:undefined,onloading:undefined,preload:function(e){var t=cc.TextureCache.sharedTextureCache(),n=cc.AudioManager.sharedEngine(),r=cc.SAXParser.shareParser();for(var i=0;i<e.length;i++)switch(e[i].type){case"image":t.addImage(e[i].src),this.resourceCount+=1;break;case"bgm":n.preloadBackgroundMusic(e[i].src),this.resourceCount+=1;break;case"effect":n.preloadEffect(e[i].src),this.resourceCount+=1;break;case"plist":case"tmx":case"fnt":r.preloadPlist(e[i].src),this.resourceCount+=1;break;case"tga":break;default:throw"cocos2d:unknow type : "+e[i].type}this.isLoadedComplete()}}),cc.Loader.shareLoader=function(){return cc.shareLoader||(cc.shareLoader=new cc.Loader),cc.shareLoader},cc.LoaderScene=cc.Class.extend({_logo:new Image,ctor:function(){this._logo.src="data:image/jpeg;base64,/9j/4QAYRXhpZgAASUkqAAgAAAAAAAAAAAAAAP/sABFEdWNreQABAAQAAABBAAD/4QMpaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wLwA8P3hwYWNrZXQgYmVnaW49Iu+7vyIgaWQ9Ilc1TTBNcENlaGlIenJlU3pOVGN6a2M5ZCI/PiA8eDp4bXBtZXRhIHhtbG5zOng9ImFkb2JlOm5zOm1ldGEvIiB4OnhtcHRrPSJBZG9iZSBYTVAgQ29yZSA1LjAtYzA2MCA2MS4xMzQ3NzcsIDIwMTAvMDIvMTItMTc6MzI6MDAgICAgICAgICI+IDxyZGY6UkRGIHhtbG5zOnJkZj0iaHR0cDovL3d3dy53My5vcmcvMTk5OS8wMi8yMi1yZGYtc3ludGF4LW5zIyI+IDxyZGY6RGVzY3JpcHRpb24gcmRmOmFib3V0PSIiIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIiB4bWxuczpzdFJlZj0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL3NUeXBlL1Jlc291cmNlUmVmIyIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bXBNTTpEb2N1bWVudElEPSJ4bXAuZGlkOkU2RTk0OEM5OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiB4bXBNTTpJbnN0YW5jZUlEPSJ4bXAuaWlkOkU2RTk0OEM4OERCNDExRTE5NEUyRkE3M0M3QkE1NTlEIiB4bXA6Q3JlYXRvclRvb2w9IkFkb2JlIFBob3Rvc2hvcCBDUzUgV2luZG93cyI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuZGlkOjU1RUQ3MTcwQjQ4REUxMTE4RkUxODUzMUE4ODZGQ0I4IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjU1RUQ3MTcwQjQ4REUxMTE4RkUxODUzMUE4ODZGQ0I4Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+/+4ADkFkb2JlAGTAAAAAAf/bAIQABQQEBAQEBQQEBQcFBAUHCQYFBQYJCggICQgICg0KCwsLCwoNDAwMDQwMDA8PEREPDxcWFhYXGRkZGRkZGRkZGQEGBgYKCQoTDQ0TFhEOERYZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZGRkZ/8AAEQgAyACgAwERAAIRAQMRAf/EAMQAAAEEAwEBAAAAAAAAAAAAAAcABAUGAQMIAgkBAQACAwEBAAAAAAAAAAAAAAABAwIEBgUHEAABAwICBAcKCQkFBQkAAAABAgMEAAURBiExEgdBUXEiMrITYXIzc5MUNBU2CIGRodFCUpLSVLFigqIjQ3QWF/DBUyRWwqOzNSbhY0SEpCV1RhgRAAIBAwAGBgYJBAIDAAAAAAABAhEDBCExQXESBVFhMnIzFZGhUhMUNLHB0eEiQmIjBoFTYxbwonMkJf/aAAwDAQACEQMRAD8A5loBUAqAVAKgM4UAsKAyE40BtDaRhtEJ2jspx0YnioRU9qjKTwUFTSpBHBQk8YUAqAVALCgFhQCoDFAKgFQCoDNALCgM4UAsKAzhQHoJoDY2nE0IY5nwlP2qTsjFbaO1Thxo0/kqaGFdJAW2/uR9lqWkvxtQP7xI7h4eQ0qZNFl7GPMYEmIsOsq4U6weIjgNTQxqMXGFIOkViZ1NJSRQkxhQCwoBYUAsKAxhQCwoDGFAIUB7CcaA9homgPYYVxUIqZDCuKgqZ7BXFQVPQYVxUFRyxFUVDRUpGLkTDsmBaIK5FyVstLSpCGhpW4SMNlIrPUVvS9BK+7pZcu50v993f5iiofi3y3KkW9a9DjMuEvaSptY5yVdktYOGusC4jc/7sMzbqri/Ohlcywoc7J14jFTRJ0NyUjQMfouDQe4dFTuMK7GREKTDvccvRuY+gft456STxjjT3aayNKND0RSDqqDNMblhQ4KgmouwVxUFTHYK4qCpgsKoDBZUKCp4KMKCp4IoSYTQDuO12hAFEYtm9c6zxHCxKlJQ6npJAUrA8R2QayRjpNgvGXPxo+w592mgijPQvOW/xo8m592mgUZn11lv8aPJufdpoFJGRe8tg+mjybn3aaB+I9O5my9EjrejvedSEj9mwlC07Su6VAADjqaox4Wy1bsN0F53mibnzN7jtvyDaGnZMiQOYuUmMkrUxFx6KBs4Lc4ODFWrFstSoT+53dhm6yHK+/GCwU2ZN5KJFobSoyEWd9Xm65SccStCNtWI17I2tIqDI7C3gZbanw3Lm0yh5SGy1PjrSFoejK0ELSdCtnh7lFoMZRTVGcO70N1MvJzqs55LCzYUK2psMYrcgFR4eFcZR0Ano6lcdZ00VRUpaeGRVI2Z7DMiodmO+aS9TrJStQx40lIOg0qmTwtGDest4+nDybn3aaCaMXrrLn40fYc+7UaBRmPXOXPxo8m592mgUYject4emj7Dn3aaBSRpXd8vnQmYCT+Ysf7NNAoxPsoKUuNELbWNpKknEEHhFQzJDBYw0VBkjwnXQkmbYgKWnlqUVyB9JxMl8nSe0Xif0jQyJS15WzJe2FSbRaJc2Mk7JeYaUpG0NY2tWNWQsznpSbNe7l2bTpOSi94//p5nn/Ttw8iay+Gu+y/QVeZY39yPpF/TzPP+nLh5E0+Gu+y/QPMsb+5H0jG6ZUzLZIwl3i0yoEVSw2l6QjYSVkYhIJ4dFYzszjrVC2zl2brpCSk+oLXu+7i5O9K6+ur2hcfI9tdCZTgxQqY8nT5u0fq/4ixqGgaToqZsnc+c8qetckuZGsTSbfbrgli1OebANojW4qSJGwkYAfsEqQnukUJLVb4EO1wYtst7KY8CGyiNFjoGCUNNJCUpA4gBQDgpSpJSoApIwKTqIOgigAtmW0Gw3Z6MlCVwZCVKabcAUhbDmhTawdCk/RI4qlNp1RhO2pqjOPd8+6lOUJAzNl1pRyjcHdhTIxUYElWnsVH/AA1fu1HvTp15uK1rUVW7jrwy7S9YNrVlXMl8jql2e1SZ8ZC+zW7HRtpSsDHA4ajhSFqctSqRey7Vp0nJRfWP/wCnmef9OXDyJrP4a77L9BT5ljf3I+kX9PM8/wCnLh5E0+Gu+y/QPMsb+5H0nh3IOdmW1vO5duCW0AqWrsFHADWcBiafDXV+V+glcxxpOiuR9JWyCCQdBGgg1UbZe7KjasEZR06XAOQLNSY10jZ0YE1gWI0p10JJ+0eETyiskVSBxJ9If8YvrGoZmjsrIrTbGS8vNMoDbfq9hWykYDaWgKUeUqOJrp8VUtRp0HzDmsnLKuN+0WHE1sHn0MKWltCnHFhDaAVLWo4BKUjEkniApWhKi26LWwAsQLx7we82Nly0uOMZZglSlyQMUsQkKAdkqGrtHTzUA9wcdc1mZLuz/StR9K5Ry1YllJ9uWmX2f0PoHl2yWjKllg5esUZES1W5pLEZlPAka1KP0lKPOUTrNah6xK9tyUBUd5uZG8s7vc031xewYdskFlSTsntnEFtoAjhLik0AOPd+3lZmvNubyTvEiPws5QYLVwt78xJQ5cbW4AEP6ek43iErPDoJ07VAE7O1uTc7Ot9tIMqDi+3hrKB00/Fp+ChDBA83b58SVa7rHTLtFwaMedFXqW2rhHEpJ5yTwGsoSpuKb1vjVV2lqOZFNXLcTvDct0pxcrKlyCVtvjU/CWr9m8ODtWDoUOXjFbdi87Fz9LPMz8SOdYpquR1dT+8vEfPzTu9peX25CXbRIgNxI60KxbMoDzgKB/OCtivSjlVyeGv4dRzc+VNcu941S4pVe7UFDE16JzlDOJGo4UFDjreQy0xnzMTTKEttiashCRgAVAKOA7pNcxlKl2W8+ocrk5YttvXwkrYx/wBORu+c65qnYbm0ZP8ASNYFiNKNdCSes/hE8orJFUwcSvSJHjF9Y1DM0djZKd/6Ry+OK3Rv+GK6rGX7Udx8q5lKmVc7z+ksgUDqq01VKoKN9+blWaxN5ehObNwvIPblPSREScFeVVzeTGvN5lf4Y8C1s6X+N4PvLruy7MNW/wC4Pfu97u2t3ORmHJrQRma/hE+7KUOe2gjFiP3OzQcVD6xNeCd2Fl26RGHo8d6Q23IlqUiK0tQC3VISVqCE61bKRicNQoSbvOhx0BC5jsdszVFiW+8gv2yNMZnvQtHZyFxiVNId+s2lzBZT9IgY6KA33O2W67TbZcpKNm52d8ybdNbwDre2kodbx4WnkEpWjUdesCgJMyUEEK0pIwIPCDwUAEb1G9WXWXC/dtOEtHjbVzk/IamhBTt4OUW94WT5NnbQDmC1hc6wunpFaR+0j4/VdSNHdwq6H4o8O1ajSuv3U1P8r1nHUJy4W2Q1d46FtuW+S2Q6QRsPoO2lCuI8w6KrUmnXoNqcFOLi9Ukdq2i5sXq1QbvGOLE9hEhHc2xiR+icRXVW5qcU1tR8qybDs3ZQf5XQe1mUHH2872/zH/GHqprmcvxpbz6byr5S33SSsXs5F75zrmqNhu7Rk/0jWDLUaE66Ek/Z/CJ5RWSKpA4lekSPGL6xqGZo6syvMWzk21qQcFt2ttSDxKSziPlFdXYdLCf6T5VnxUs6aep3PrHeRs4R822Ji5JKW5bf7K4s4+DeSNJ71Q5wrHFyFdhXo1mXNeXTw77guzLsv/m0HWRbeN7W/Dz+Yntsv2hwzXEK0oMWEoJYbPjXdnHlNc5k3feXGz6NyzFWPjxhtpV7ztty4IbS4++4G2m0qcdcVoSlCRtKUe4AMa1zfOW7Rm3Nmad9mUt4NwivRsiz5kyx5WU5oQWgwtO3s8Cn1c7aw52odGpB1L52eOoAvO+7SoNbVzYfLyWHkOlhwsPhCgrYdSAVIVhqUARooDZ533aAoGfUhMuJNH75stLP5zZxHyGpBU408xZDUlCtlTSgva7g1/JWUZcLTK7ttTg49IJ7tlmNfsn50ukaImO9fJ0i/wBuYSnZKWoqipoYcBdbDiv0qmvFJlUY+7hGuwdbibybhlB62OKxdtMlSEA6+xfHaJ+JW1XuctuVt06GcX/JsfgyFP2160FavROcOPt53t/mP+MPVTXM5fjS3n03lXylvuknYvZyL3zvXNUbDe2jJ/pGsCxGhGuhJPWjwieUVkiuQOJXpEjxi+sahmSOmrA4U5Ngf/FJ/wCDXVWH+wu6fMc23/70n/k+s57y7me55aVNNuXgi4RXIkhsk4YLSQlY/OQTiK5qzflbrw7UfQ8vCt5CjxrsSUkdP+67Y0W3KV0zE4nCReJfm7Kzr83hjD5XFq+KqTdDHmmI9fbK9Ym3FNMXRSIs95s4KTDUcZGyeBS2wWx31AO5EC1yIMW2qitogwVsOQGWxshhcQgslvDolGGjuUBIGVjicaAY3i+s2W03C8vkdjbor0tYPCGUFeHwkYUABtwGYcxwrncbdmxl1gZyC8z2WS9jsyHCopkbB4yjZVs68E46qA6H85oCr5xfblWZqQ0oLS2+kpUOJQKT8tAD1TgWkoUAUqBSoHUQdBFAOIK2jJjsuAebrUllaODs18wjDi2TWUO0im+q23uAxuc27BvAzHlZw4DZfZCTwrhPkD9UmvS5bLhuuJzv8igrmLC50P6ToGvcOHOPt53t/mP+MPVTXM5fjS3n03lXylvuknYvZuL3zvXNUbDd2jJ/pGsC1GhGuhJP2jwieUVkiuQN5XpEjxi+sahmSOkLC7jlGC3wm2JSPhZrqLPgLunz3LS+Ll3/AKwc7sckR895fzdbEBKL3Dbiy7Q8rRg6kuBTZP1XRzT3cDXLH0NHSu6N2LG3d2KFGxQ7CbcjT2VDZW3MQ6rt0LSdIUlZ+KoJLyJXBUgiZObsvwnSxJusZt4HBSC4CQe7s44UBIx7pGmNB+I+3IZVqcaUFp+MUBA54juXnKlzszRIVcwzCURrDbz7aXD9jaoCZXHt6mokcx0Fm3qQqAMBiyWk7CCgjSkhOjRwaKAdedHHRQA0v2abbbHrxZpk5ptLj6X2EFeJSoqClDAY4Yg0BCx7jGlt9rFfQ+3wqbUFAcuGqgN6JOytKhrCgR8BonpMZqqYNV4Wz3jpSUc1uZMcJA4RLi9of1jXoY74cldZz+dHj5bLqX0MPZroDganH2872/zH/GHqprmcvxpbz6byr5S33STsXs3G753rmqNhvbRk/wBI1gWI0I10JJ+0dNPKKyRXMG8n0h/xi+sahmSOhMtOA2C1tnUYbSfjQBXVY6raW4+fZypkzf6vrIj3epPmWasw29RwU5ExA7rD+H+1XKzVGfQYOsUw/RoTMK6TLjEV2SbkEruEcdBchsbKXxxLUjmr+tgDrFQZFYzvmKUP/ZoDpa2k7U11BwVgrU2CNWjSqgBfLl2m1kJnzGIqjpCHFAKP6IxNQCVy5fm2ZHneXri06tPhW2VhSVJ4lo4vgoAzWq9N3WGiSgbC+i80dOwsaxycVSB95yeOgKTmzM8o9pbbc6WW0AiXJScD3UJV9EDhNQwAq73OyC4LSmfHUohO0UrCudw4qGI+WgNsGQ9CdRNgO4HWFIOKFjiOGgipARodwRMjNSUYgODSniUNBHwGo2kPUVDMRx94WApOsvwtrl81SDXoWvmI/wBDwLjry6b6pfSH010KPn5x9vO9v8x/xh6qa5nL8aW8+m8q+Ut90k7F7Nxu+c65qjYb20ZP9I1gWI0I10JJ+0eETyiskVSBvK9If8YvrGoZmg75ddwsls7kVrqiuoxn+3HccNn263p7yt5Gk+ot7ymVHZbnOSI3cwkI7RH6wFc9lw4bsl1nYYM+OxF9R0gJOnXWubYGN42YnLHFfmNEG5XB9bUUq07IHSXh+aMMO7UIMALrrr7q3nlqdecO044s7SlE8JJrIxqe4z8mG+iTFcWxIbO0262dlQI7ooKnSW6jOBv0VxL5Si4x9lqc2nQF449m6BwbWBB7tYmQS5MxTbDi0K5+ydjlPD8FSDlPPmcZF8nvW+A6pFmYWUc04GQtJwLi+NOPRFCGykYEcGAqSKkxYbw5apaErUTBdUEvtHUMdG2OIioJDdYlFKCwDiC6kp/TwolpRjclSLfUyGQoXT3hFuAgtRJStpWOgJixdkknuEVv2NOSjnr74eVvpkvpYcGcw2KVcPVMS4x5Vy2FOKjR1h1SUI1lRRiEgd017qvQb4U9JxksO9G37yUXGPWco7zfb/MX8Yeqmudy/GlvPonKflLfdJOxezkXvneuao2G9tGT/SNYFiNCNdCSetHhE8tZIqkDiV6Q/wCMX1jUMzQZ7C7hZ7cMf/DN9UV0+O/247jj8yP7st5Us5qdtWYrXmGOMFpLbgI/xIygcPhTXk8yt0mpdJ7XJrtbTj7LOiI1zZmxmJsdQUxJbQ+0ocKXEhQ/LXm1PYAdvsC03a0I/cmK4tHFtKdwP5BREMGsGKZLgQPhrKKqyq7c4FUJsnc5miNYvXrsJIihrt1thYL6WsMdtTevDDTx1tvEdKnjrm8XOgy3TrdgZ6biJJ7OZGfbcHBzE9ok/AU1ptUPatz4lUMub7g5EynfZbKsHWYThQRrBXggH4NqoLDnzKWTrjmma3brYx20lYKsCQlKUp1qUo6ABx1fasuZ52ZmKytJI5y3eXjKDjbV0YSjtklTLragttYGg4KHCOEVlex3AqxOYK86FBcTs4itc9MO9hnMW+HapU4rKezYccQ2hTjitlIOASnEkmpjokqmGRGUrbjHW0CbMUS7tzZN6uKfNnLpJedS2VjtSHFFasQk6AAcDjUuVXUm1bUIKPQkH/crlL1FlxV7lN7NxvYDiQoYKRET4NP6Z55+Cvc5dY4IcT1yOG/ked7697uL/DD6fuAhvO9v8x/xh6qa8rK8aW86vlPylvuknYvZyN3znXNUbDe2jJ/pGsCxDdOuhJP2jwieWskVTBxJ9Jf8YvrGoMwr2V/C1wRjqYb6orpsfw1uOVyl+7Lea8zwvWtmebbG1Ij/AOYZHCSnpD4U1Xm2veW30rSWYF33V1V1PQTG6zMomWVVmeX/AJq2H9kDrVHWcR9hXN+KubZ1CHe9CyOX/Ljdyho7SdYlKddbTpUqG7htqA4ezUAo9ypQaAxaJSY8hDh4CCDyVnCXCzVyLbnBo6Onb9LdIy07FbgLTeH4xjrUVJMdJUjYUsfSOjUnCvTeVHhOajy25x9QPN1kBcm+XLMpSRCtUZUdtw6lSpfMSgHjSjaUa8uTqzqbEOGKQTpMZN9gXCxFQSq6RHojSidAdWnFv9cCsC5go3Z5z/kW9uuXCKpY2Vwp0foOoKVDawx+klSdRrdxryizxOZYcrmlExvW3lQc4IiRYEdTEKHtrSXikuLW4ACSE4gAAaKsychTWgo5fgzhLiYJLVbHr3dGIDIwDitp5zgQ0nStZ5BXnnQIMK5DacdghuO0nAFRwCWmxrPcCRQSaSqyp5atDu8rOyA4lQsMHBySo6MI6FaE98+r+2itvEx3enTYtZ5fNM9YlhzfbloW/wC46mSlCUJQ2kJbSAlCE6AlIGAAHEBXSpUPmrk5aWcgbzfb/Mf8YeqmuZy/GlvPpvKvlLfdJKxezcbvneuao2G9tGb/AEjWBYhunXQkn7R4RPLWSK5A4lekv+MX1jUMyQTLUcLbC8Q31RXS4/hx3HMZPiy3kih4pNXlFCmSzJylmBm829P+VdUVdmNCSFeEaPLrFc/m4/u51XZZ0WDke8hR9pBgtF/blMx7rbXQptY2kEgHWMFIWk/EoGtA3yBu+7HLuY31Tcu3JnLtwdJU9ap215kVnWWHk4lsE/QUNHBWRDQ2hbkJbLqF5lzXaoNvxxUITplSFpGsNowSMeWhHCi6retFvgxrFlyOYtihEqaDhBefdV033jwrV8gqCRki4gyCy2rntALUoHDZOPNHLQkhs62fLub5SJ7MlNmzYpOFxeUP8nKIACVqA0odI6RojFopB3bXFC9qferazGGtxDqnlEfmoSASakJE9AhW20MG32VC3FPkCTMdA7Z8jUAB0ED6vx0pXQRKUYqregrt/uUi6SW8r2IGTIkOBuStrSHF46Gkn6idajw8gqyMG3wrS2a0rqUXdufhhHT9/wBgdcjZdi5PszduaKVzHCHp8kfvHiMNH5qNSf8AtrqMXGVmFNu0+ac25lLMvOX5V2V1fay5Nv48NX0PNTOSt5Z2s/ZiPHMPVTXLZnjS3n1TlHydvuknY/ZuL3zvXNUbDf2jN/pGsCxDdOuhJPWfwieUVkiuQOZPpL/jF9Y1DMkEy1/8theIb6orpcfw47jmMnxZbx5V5QaJkRmdGciyBtNuDXwpI1KHdFV3bSuR4WWWrrtS4kVODcLpkycppaS/b3zipGpKwPpIP0Vjhrnb9iVqVGdLYyI3Y1Rf4GYrfc2g5GfGJ6Ta+aoHiIqgvHT60vtFAOyo6ULGghQ1HEUBGC9yW21tOjF9PNS5xHuioA3Yujkdt3Y0vunEuHgHz0A1MgkkqViTpJOvGgPbRU5tFOylCBi46rmoSONSjoFTGLZXcuxhrIO4356W4LNlxK5EiSeyXKbB7RzHQUND6KeNXDyVbFaeGOls1pKv47rSitn29YUMh5JYyvH88l7L17kJwccGlLKD+7Qesrh5K97Bw1aXE+0cbzrmUsr8EPDXr3l7Q6RXpJnMyttDtqQRQqaOXt4itvPF/Vxyz1U1yuZ40t59W5P8na7pL2P2bi9871zWvsN/aMn+kawLEaE66Ek9Z/CJ5RWSK5A5k+kv+MX1jUMyQTLX/wAsh+Ib6orpcfw47jl8nxZbxyp1CdZq5yRUkzQua2ngqt3UWK02MJkuLKZVHktJcaVrSeA8YPAaou3IyVJI2LUJwdYsqUiE7Ce7e3OqwGoY88dziUK8e7ZUXoeg9q1e4u0qMdxc0SmeZICgRoKmzgfhSdFa9DYqSHr2FIVtuSQlZ19olST8gNRwmLl1Hs3W2p6U5HIhK1H8gqeEx949iGz2ZLez6Ow5Kc4FOnsm/iGKjWSojBq49qiM1vXjMCktyHUx4QOIQBsNDkSNKjy1ZGEp9RXJ27OnXIIOVxZsvt4xG+0lrGDsxzAuEcQ+qnuCvWxVbtalp6Tns93sntOkegusa/tKw/urfV5M8WeJKJLsXGO7qVge7Vikac7XSPkuYjEHEVYmac7JzTn045yvh45R6qa5bM8aW8+mcoVMO33Scsfs5G753rmtfYb20ZP9I1gWI0J10JJ20eETyiskVzB1K9Jf8YvrGoZkgl2wY2yGP+4b6orpsfw1uOYyfFlvNrkfa1Gs3CpWp0GbsFZ1VTK0y6N1DJy3O8RqiVhs2I5CQ0ctrx+iaolitmxHMQ0ds63Okgnu1S8RlyzIjc2JR4FCsHhyM/jYmU5fUfrU+DkQ82I8ZsCknFLenjw+erI4bKpZ8SUYs0jRoNXRxmjUuZaZMxbO+CDgavjYZqTyETsW2upAxxFbEbLNK5fROxo5RhtK1VfCFDzr1zi1Eyw8EJA/LVpqs53z0cc33o8ck9UVzGX40t59B5Z8rb7pO2P2ci9851zWvsNzaMn+kawLEaU66Ek5aPCJ5RWSK5g7k+kveMX1jUElsteaYbEJmPLbcS6ykNgtgKCgnUdYwr1sfPjGCUlqPJyOXylNyi1pHn83Wnif+wPnq7zG31lHltzpQv5utP1X/sD56eY2+seWXeoX832nif8AsD56eY2+seW3eoX83Wj6r32B89PMbfWPLbvSjH822f6j3kx89PMLRPlt3pRj+bLN9R7yY+enmFoeXXelGRm2zjUh7yY+enmFojy270o3oznZ060PeTHz08wt9Y8su9Q5Rnuyp+jIHI2Pnp5jb6zF8quvoHCd4FjTwSfJj71SuZW+srfJ7r2o3p3jWAa0yfJj71T5na6yt8lvP2TcneVl4a0yvJD71T5na6yp8hvPbH0m3+qGXkJJS3LWoDEI7MDE8WJVR80tU1Mw/wBfvt6XEE93uK7vdJlzcQG1y3VOlAOISDqGPcFeJdm5zcuk6qxZVq3GC/KqFysns5F753rmsdhntGT3SNYFiNCddCSdtHhE8orJFcgdyfSH/GL6xqCToHLvu62B7J9izVnjeDByqrMTPnduhvoQQWSAoc9x1G0vZUCoAaMagyoaIfu92PMGeoWU8oZ+hXq2m2u3W73hhtCxFQy4Gw2ENuKClr2gRioYDE0FCft/uzZDv8lVqyzvat1zvjiHFRYTTTS1KU2CTiG3lK2RhpwGigoV7J3u7wrllh/NWec6QspQE3GRaY3apS4lb0R1bLhLji20jFbatkDgGNTUUNc/cNlqZmPLOWcjbw7fmWffpLzMotJRhEYYa7VTyg24sq0AgJ0YmoFCzo92nd09dfUDO92Au+KeMNNvDTJeMgHZ7PYD+1tbWjCgoV/Lnu2OS5mcP5uzZCy9ZcnzhbJFzKNtDrqkocSvnrbDaChxGs44nDgoKHnMW5PdfaLDc7pb97tsuU+FFdkRbc2lnbkOtpKktJ2XlHFZGyMBSooD7KOSss5gtJn3fNsayTA8przF8IKthIBC+ctPSxrcsWITjWUlE8nNzr1mfDC07iprRL3ndTbY9gm33L2aI17btxSZbTSEgBClAHBSVK5wBxwOurbmEuByjLioa+PzmUr0bd204OWolJ25zLFqcbYuueI8GQ42l1LUhtDailXCAXNWNZywIR7U0nuNe1z29dTduy5JOlUyNf3NyE5otdkjXlmRbLpFcnNXII0hpnDa5gJCidpOzgrA41g8B+8UU9DVS6PPofDyuSi1KDo49Zav/wA8wdf8xvYHUfNk/frZ8qXteo83/a/8frMH3eYWySMxug8BMZOGPd59R5V+r1D/AGv/AB+sCN9tD9hvE+yylpcfgPqYW430VbJ0KGPGNNeXcg4ScXsOrx7yvW4zjqki3WT2cjd851zWOwz2jJ7pGsCxGka6Ek5aPCJ5RWSK5A8lekP+MX1jQkPm++SH91m5xo6extS0/wC4j/NUGRj3VJIiZwzGoaNrL8hPxuIqGCF92d8Rt8tpeGA2Wp2nlZWKEl13ny+13BxmCccM6XNzDllzPnoiAf8Au3PCNvjy68NGyJXyx1ijB5sjwHvEsSNHteteP/m1GgD/AHXzLOLO+XIDd3hW69XW+RpbQnOBCeyTHjHbw1kYtFPNxwNESAvMnu85jsFguGYIt6tF4ZtbZkS40BxZdSynSpQ2k7J2Rpwx1aqVIKRlnIdxzPCduLUqNCgtOdkHpRI2lgAkDAcGPDW5Yw5XVxVSSPLzua28WSg1KUmtSL5GtbeScj5it8y5xJLl1U0GEx1YkqBCQnA6SeGt1WlYsSTkm5U1HiTyJZubanCElG3WtSv76HzIzJCWrSRbWh8SlVRzTxF3Ub38aTWPKvtsJNtmqF5yYcfB2B9A+FLNelbS47fcOdyLcnZyF/mX1mjMN4uWTswHNiHHpWXbkER7xC2irsXEjZbdaBOAxw/tjWORJ2LnvFphLX1GeDjxzsb4eSUbsNMJdK6GOsmSbzcZUvOV4dcbXdEBq227aPZsQ0nFJ2dW0rj+erMNSm3dn+bUuoq5soWoRxrS7Hal0yAhn9wu50vrh+lLUfkFeJmeNLednylUxLa/STNk9nI3fOdc1r7Dd2jJ7pGsC1Gka6Ek1afCp5RWSK5A+k+kP+MX1jUEhi3syg7u93YNE+Ctyh/umaEmPd2lCNme+LB6VlfT8a01DJoRW4WQI+9G2u46m5fytKoSWrP8wObnI7GOrNU9fxyZJ/voQU3cW+GN6FjdB6Ikau6wujCPFpfA33Mv4/8A2Za//UmgGe+J1L+8zMrqiOdJQdPiUCiBbN0EkMZG3nNg+FtaRo8W9QFTiv4brZkfHQZyTh+kivSj8o+8eLcj/wDRi/0FGbw7VvDDpp/KK89az2JamXfeg/298jKJ1QW0/rKr0OZeIu6jyORw4bL7zLxCmkXPLJx8HZ3UY8oar0IP8dvunjXrT91e/wDIjXdmJmZr2mHckKbyzbgHNjHDzt5Q0aR9FP8AbXS7bleu0kqW4+snGlHFscUHW9P/AKo35ZXdLG9KsT22/Z2f21rmKPRQo6WT3U41lixnbk4Ps7H9RhzCNvIhG6tFx9pfWCnN6+0zPd3PrSVH5BXi5fjS3nT8vVMeC/SWGy+zkbvnOuao2GztGLx5xrBliNYoSStscCXE8tSiuRQ5PpD2P+IvrGhIQrNvdvFqs8OzSbZAubMBHZRnZaCVpbGpJ1jQNGNQZVPCt7N3Rf4t/hWyBCcYjLhPRWUENPNOK2zt4YHEEDAilBUk077rqyVOQ7Dao0nAhD7aFBSSeHRhjShJE5f3rXux25y1vwod1jLkOSkeeIJKXHlFa9Wg4qJOrRQip6uG9a6yp9quUK12+2y7S8t5tUdsgOBxGwpC9WKSmgqSv9brkHe3Tl61CRjtB7ZVt7XHtdLH4aCpE2rerc4D1zlS7Vb7nLukozX3pLelKikICEa8EAJGFAbrvvevFztEy0RbXAtjU9BZkvRUELLZ0EDUNI0Y0oSVSzZmmWeK5CQy1IirX2gbeBwCuHVyVt2MqVqPDSqNLIw43ZcTbT6hzMze9MiuxTborYdTslxCecNOOI0VnPNclThSMLWAoSUuKToOVZ7luYFy3RXCAAFLBUcBy1n5i3rimVLlkVqlJDN7OF0cuUe4pS02YyFNNsJB2NhfSB4dOFVvNnxqXQXR5fbVtw11JD+oVz/CsfGv56u8zn0Gv5Ra6WY/qFc+CKxjwaV/PTzOfQPKLXSyqSpT02S9LkHaffWVuEaBia0JycpNvWz0oQUIqK1IuNnXhYI6fznOuaxeobRs6cVGsSxGuhJvZeLZBoYtGHIlokuqefYPaK0qKFFIJ48BU1IozItuX+GOvyqqnQNJn1bl78O55VVNA0i9W5e/Dr8qqo0DSL1bl38OvyqqaBpF6ty9+Hc8qqmgaRercu/hnPKqpoGkXqzLv4ZflVU0DSL1Zl78O55VVToGkXqzLv4dflVVGgaRercvfh3PKqpoFGL1bl38O55VVToGkXq3L34dzyqqaBpF6ty9+HX5VVRoGkx6ty9+Hc8qqmgaTCrZYfosL+FxVBRm9x9sIS0ykIaQNlCE6AAKE0GajiagkxQkVAKgFQCoBUAqAVAKgFQCoBUAqAVAKgFQCoBUAqAVAf/Z",this._logo.width=160,this._logo.height=200},draw:function(){var e=(cc.canvas.width-this._logo.width)/2,t=(cc.canvas.height-this._logo.height)/2;cc.renderContext.clearRect(0,-cc.canvas.height,cc.canvas.width,cc.canvas.height),cc.renderContext.fillStyle="#202020",cc.renderContext.fillRect(0,-cc.canvas.height,cc.canvas.width,cc.canvas.height),cc.drawingUtil.drawImage(this._logo,new cc.PointMake(e,t)),cc.renderContext.fillStyle="#b2b4b3",cc.renderContext.font="Bold 12px Verdana",cc.renderContext.textAlign="left",cc.drawingUtil.fillText("Loading "+cc.Loader.shareLoader().getProgressBar()+"%",e+30,t-15)}}),cc.LoaderScene.shareLoaderScene=function(){return cc.shareLoaderScene||(cc.shareLoaderScene=new cc.LoaderScene),cc.shareLoaderScene},cc.DrawingPrimitive=cc.Class.extend({_renderContext:null,setRenderContext:function(e){this._renderContext=e},getRenderContext:function(){return this._renderContext},ctor:function(e){this._renderContext=e},drawPoint:function(e){cc.log("DrawingPrimitive.drawPoint() not implement!")},drawPoints:function(e,t){cc.log("DrawingPrimitive.drawPoints() not implement!")},drawLine:function(e,t){cc.log("DrawingPrimitive.drawLine() not implement!")},drawPoly:function(e,t,n,r){cc.log("DrawingPrimitive.drawPoly() not implement!")},drawCircle:function(e,t,n,r,i){if(r=="undefined"||r==0)return;var s=1;i&&++s;var o=2*Math.PI/r,u=[];for(var a=0;a<=r;a++){var f=a*o,l=t*Math.cos(f+n)+e.x,c=t*Math.sin(f+n)+e.y,h=new cc.Point(l*cc.CONTENT_SCALE_FACTOR(),c*cc.CONTENT_SCALE_FACTOR());u.push(h)}if(i){var p=new cc.Point(e.x*cc.CONTENT_SCALE_FACTOR(),e.y*cc.CONTENT_SCALE_FACTOR());u.push(p)}this.drawPoly(u,r+2,!0,!1)},drawQuadBezier:function(e,t,n,r){cc.log("DrawingPrimitive.drawQuadBezier() not implement!")},drawCubicBezier:function(e,t,n,r,i){cc.log("DrawingPrimitive.drawCubicBezier() not implement!")}}),cc.DrawingPrimitiveCanvas=cc.DrawingPrimitive.extend({drawPoint:function(e,t){t||(t=1);var n=new cc.Point(e.x*cc.CONTENT_SCALE_FACTOR(),e.y*cc.CONTENT_SCALE_FACTOR());this._renderContext.beginPath(),this._renderContext.arc(n.x,-n.y,t*cc.CONTENT_SCALE_FACTOR(),0,Math.PI*2,!1),this._renderContext.closePath(),this._renderContext.fill()},drawPoints:function(e,t,n){if(e==null)return;n||(n=1),this._renderContext.beginPath();for(var r=0;r<e.length;r++)this._renderContext.arc(e[r].x*cc.CONTENT_SCALE_FACTOR(),-e[r].y*cc.CONTENT_SCALE_FACTOR(),n*cc.CONTENT_SCALE_FACTOR(),0,Math.PI*2,!1);this._renderContext.closePath(),this._renderContext.fill()},drawLine:function(e,t){this._renderContext.beginPath(),this._renderContext.moveTo(e.x*cc.CONTENT_SCALE_FACTOR(),-e.y*cc.CONTENT_SCALE_FACTOR()),this._renderContext.lineTo(t.x*cc.CONTENT_SCALE_FACTOR(),-t.y*cc.CONTENT_SCALE_FACTOR()),this._renderContext.closePath(),this._renderContext.stroke()},drawPoly:function(e,t,n,r){r=="undefined"&&(r=!1);if(e==null)return;if(e.length<3)throw new Error("Polygon's point must greater than 2");var i=e[0];this._renderContext.beginPath(),this._renderContext.moveTo(i.x*cc.CONTENT_SCALE_FACTOR(),-i.y*cc.CONTENT_SCALE_FACTOR());for(var s=1;s<e.length;s++)this._renderContext.lineTo(e[s].x*cc.CONTENT_SCALE_FACTOR(),-e[s].y*cc.CONTENT_SCALE_FACTOR());n&&this._renderContext.closePath(),r?this._renderContext.fill():this._renderContext.stroke()},drawCircle:function(e,t,n,r,i){this._renderContext.beginPath();var s=n-Math.PI*2;this._renderContext.arc(0|e.x,0|-e.y,t,-n,-s,!1),i&&this._renderContext.lineTo(0|e.x,0|-e.y),this._renderContext.stroke()},drawQuadBezier:function(e,t,n,r){var i=[],s=0;for(var o=0;o<r;o++){var u=Math.pow(1-s,2)*e.x+2*(1-s)*s*t.x+s*s*n.x,a=Math.pow(1-s,2)*e.y+2*(1-s)*s*t.y+s*s*n.y;i.push(new cc.Point(u*cc.CONTENT_SCALE_FACTOR(),a*cc.CONTENT_SCALE_FACTOR())),s+=1/r}i.push(new cc.Point(n.x*cc.CONTENT_SCALE_FACTOR(),n.y*cc.CONTENT_SCALE_FACTOR())),this.drawPoly(i,r+1,!1,!1)},drawCubicBezier:function(e,t,n,r,i){var s=[],o=0;for(var u=0;u<i;u++){var a=Math.pow(1-o,3)*e.x+3*Math.pow(1-o,2)*o*t.x+3*(1-o)*o*o*n.x+o*o*o*r.x,f=Math.pow(1-o,3)*e.y+3*Math.pow(1-o,2)*o*t.y+3*(1-o)*o*o*n.y+o*o*o*r.y;s.push(new cc.Point(a*cc.CONTENT_SCALE_FACTOR(),f*cc.CONTENT_SCALE_FACTOR())),o+=1/i}s.push(new cc.Point(r.x*cc.CONTENT_SCALE_FACTOR(),r.y*cc.CONTENT_SCALE_FACTOR())),this.drawPoly(s,i+1,!1,!1)},drawImage:function(e,t,n,r,i){var s=arguments.length;switch(s){case 2:var o=e.height;this._renderContext.drawImage(e,t.x,-(t.y+o));break;case 3:this._renderContext.drawImage(e,t.x,-(t.y+n.height),n.width,n.height);break;case 5:this._renderContext.drawImage(e,t.x,t.y,n.width,n.height,r.x,-(r.y+i.height),i.width,i.height);break;default:throw new Error("Argument must be non-nil")}},drawStar:function(e,t,n,r){var i=e||this._renderContext;i.save(),i.translate(t.x,-t.y),i.rotate(cc.DEGREES_TO_RADIANS(45)),r instanceof cc.Color4F&&(r=new cc.Color3B(0|r.r*255,0|r.g*255,0|r.b*255));var s="rgba("+r.r+","+r.g+","+r.b;i.fillStyle=s+",1)";var o=n/10;i.beginPath(),i.moveTo(-n,0),i.lineTo(0,-o),i.lineTo(n,0),i.lineTo(0,o),i.lineTo(-n,0),i.closePath(),i.fill(),i.beginPath(),i.moveTo(0,-n),i.lineTo(-o,0),i.lineTo(0,n),i.lineTo(o,0),i.lineTo(0,-n),i.closePath(),i.fill();var u=i.createRadialGradient(0,0,o,0,0,n);u.addColorStop(0,s+", 1)"),u.addColorStop(.3,s+", 0.8)"),u.addColorStop(1,s+", 0.0)"),i.fillStyle=u,i.beginPath();var a=0,f=Math.PI*2;i.arc(0,0,n,a,f,!1),i.closePath(),i.fill(),i.restore()},drawColorBall:function(e,t,n,r){var i=e||this._renderContext;r instanceof cc.Color4F&&(r=new cc.Color3B(0|r.r*255,0|r.g*255,0|r.b*255));var s="rgba("+r.r+","+r.g+","+r.b,o=n/10,u=i.createRadialGradient(t.x,-t.y,o,t.x,-t.y,n);u.addColorStop(0,s+", 1)"),u.addColorStop(.3,s+", 0.8)"),u.addColorStop(.6,s+", 0.4)"),u.addColorStop(1,s+", 0.0)"),i.fillStyle=u,i.beginPath();var a=0,f=Math.PI*2;i.arc(t.x,-t.y,n,a,f,!1),i.closePath(),i.fill()},fillText:function(e,t,n){this._renderContext.fillText(e,t,-n)}}),cc.ORIENTATION_PORTRAIT=0,cc.ORIENTATION_PORTRAIT_UPSIDE_DOWN=1,cc.ORIENTATION_LANDSCAPE_LEFT=2,cc.ORIENTATION_LANDSCAPE_RIGHT=3,cc.CANVAS=0,cc.WEBGL=1,cc.drawingUtil=null,cc.renderContext=null,cc.canvas=null,cc.gameDiv=null,cc.renderContextType=cc.CANVAS,cc.originalCanvasSize=new cc.Size(0,0),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame}(),window.console||(window.console={},window.console.log=function(){},window.console.assert=function(){}),cc.setup=function(){var e;switch(arguments.length){case 0:e=document.createElement("Canvas"),e.setAttribute("id","gameCanvas"),e.setAttribute("width",480),e.setAttribute("height",320),document.body.appendChild(e),cc.canvas=e,cc.renderContext=cc.canvas.getContext("2d"),cc.gameDiv=document.body,cc.renderContextType=cc.CANVAS;break;case 1:var t=arguments[0],n=null;typeof t=="string"?n=document.getElementById(t):n=arguments[0],n instanceof HTMLCanvasElement?(cc.canvas=n,cc.gameDiv=n.parentNode,cc.renderContext=cc.canvas.getContext("2d"),cc.renderContextType=cc.CANVAS):n instanceof HTMLDivElement&&(e=document.createElement("Canvas"),e.setAttribute("id","gameCanvas"),e.setAttribute("width",n.width),e.setAttribute("height",n.height),n.appendChild(e),cc.canvas=e,cc.renderContext=cc.canvas.getContext("2d"),cc.gameDiv=n,cc.renderContextType=cc.CANVAS);break;case 2:break;case 3:}cc.renderContextType==cc.CANVAS&&(cc.renderContext.translate(0,cc.canvas.height),cc.drawingUtil=new cc.DrawingPrimitiveCanvas(cc.renderContext)),cc.originalCanvasSize=new cc.Size(cc.canvas.width,cc.canvas.height),console.log(cc.ENGINE_VERSION)},cc.setupHTML=function(e){var t=cc.canvas;t.style.zIndex=0;var n=document.createElement("div");n.id="Cocos2dGameContainer",n.style.position="relative",n.style.display="inline-block",e&&n.setAttribute("height",e.getContentSize().height),t.parentNode.insertBefore(n,t),n.appendChild(t)},cc.Application=cc.Class.extend({ctor:function(){this._animationInterval=0,cc.Assert(!cc._sharedApplication,"CCApplication ctor"),cc._sharedApplication=this},setAnimationInterval:function(e){this._animationInterval=e},setOrientation:function(e){return e},statusBarFrame:function(e){e&&(e=cc.RectMake(0,0,0,0))},run:function(){if(!this.initInstance()||!this.applicationDidFinishLaunching())return 0;if(window.requestAnimFrame){var e=function(){cc.Director.sharedDirector().mainLoop(),window.requestAnimFrame(e)};cc.Log(window.requestAnimFrame),window.requestAnimFrame(e)}else{var e=function(){cc.Director.sharedDirector().mainLoop()};setInterval(e,this._animationInterval*1e3)}},_animationInterval:null}),cc.Application.sharedApplication=function(){return cc.Assert(cc._sharedApplication,"sharedApplication"),cc._sharedApplication},cc.Application.getCurrentLanguage=function(){var e=cc.LANGUAGE_ENGLISH,t=navigator.language;t=t.toLowerCase();switch(t){case"zh-cn":e=cc.LANGUAGE_CHINESE;break;case"fr":e=cc.LANGUAGE_FRENCH;break;case"it":e=cc.LANGUAGE_ITALIAN;break;case"de":e=cc.LANGUAGE_GERMAN;break;case"es":e=cc.LANGUAGE_SPANISH;break;case"ru":e=cc.LANGUAGE_RUSSIAN}return e},cc._sharedApplication=null,cc.SAXParser=cc.Class.extend({xmlDoc:null,parser:null,xmlList:[],plist:[],parse:function(e){var e=this.getList(e);window.DOMParser?(this.parser=new DOMParser,this.xmlDoc=this.parser.parseFromString(e,"text/xml")):(this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async="false",this.xmlDoc.loadXML(e)),this.xmlDoc==null&&cc.Log("xml "+this.xmlDoc+" not found!");var t=this.xmlDoc.documentElement;if(t.tagName!="plist")throw"Not a plist file";var n=null;for(var r=0,i=t.childNodes.length;r<i;r++){n=t.childNodes[r];if(n.nodeType==1)break}return this.plist=this._parseNode(n),this.plist},tmxParse:function(e){var e=this.getList(e);return window.DOMParser?(this.parser=new DOMParser,this.xmlDoc=this.parser.parseFromString(e,"text/xml")):(this.xmlDoc=new ActiveXObject("Microsoft.XMLDOM"),this.xmlDoc.async="false",this.xmlDoc.loadXML(e)),this.xmlDoc==null&&cc.Log("xml "+this.xmlDoc+" not found!"),this.xmlDoc},_parseNode:function(e){var t=null;switch(e.tagName){case"dict":t=this._parseDict(e);break;case"array":t=this._parseArray(e);break;case"string":t=e.firstChild.nodeValue;break;case"false":t=!1;break;case"true":t=!0;break;case"real":t=parseFloat(e.firstChild.nodeValue);break;case"integer":t=parseInt(e.firstChild.nodeValue,10)}return t},_parseArray:function(e){var t=[];for(var n=0,r=e.childNodes.length;n<r;n++){var i=e.childNodes[n];if(i.nodeType!=1)continue;t.push(this._parseNode(i))}return t},_parseDict:function(e){var t={},n=null;for(var r=0,i=e.childNodes.length;r<i;r++){var s=e.childNodes[r];if(s.nodeType!=1)continue;s.tagName=="key"?n=s.firstChild.nodeValue:t[n]=this._parseNode(s)}return t},preloadPlist:function(e){if(window.XMLHttpRequest){var t=new XMLHttpRequest;t.overrideMimeType&&t.overrideMimeType("text/xml")}else t=new ActiveXObject("Microsoft.XMLHTTP");t!=null?(t.open("GET",e,!1),t.send(null),this.xmlList[e]=t.responseText,cc.Loader.shareLoader().onResLoaded()):alert("Your browser does not support XMLHTTP.")},getName:function(e){var t=e.lastIndexOf("/",e.length)+1,n=e.lastIndexOf(".",e.length);return e.substring(t,n)},getExt:function(e){var t=e.lastIndexOf(".",e.length)+1;return e.substring(t,e.length)},getList:function(e){return this.xmlList!=null?this.xmlList[e]:null}}),cc.SAXParser.shareParser=function(){return cc.shareParser||(cc.shareParser=new cc.SAXParser),cc.shareParser},cc.AppController=cc.Class.extend({didFinishLaunchingWithOptions:function(){var e=new cc.AppDelegate;return cc.Application.sharedApplication().run(),!0},applicationWillResignActive:function(){cc.Director.sharedDirector().pause()},applicationDidBecomeActive:function(){cc.Director.sharedDirector().resume()},applicationDidEnterBackground:function(){cc.Application.sharedApplication().applicationDidEnterBackground()},applicationWillEnterForeground:function(){cc.Application.sharedApplication().applicationWillEnterForeground()},applicationWillTerminate:function(){}}),cc.AppController.shareAppController=function(){return cc.sharedAppController==null&&(cc.sharedAppController=new cc.AppController),cc.Assert(cc.sharedAppController,"shareAppController"),cc.sharedAppController},cc.sharedAppController=null,cc.CCITEM_SIZE=32,cc._fontSize=cc.CCITEM_SIZE,cc._fontName="Marker Felt",cc._fontNameRelease=!1,cc.CURRENT_ITEM=3233828865,cc.ZOOM_ACTION_TAG=3233828866,cc.NORMAL_TAG=8801,cc.SELECTED_TAG=8802,cc.DISABLE_TAG=8803,cc.MenuItem=cc.Node.extend({_listener:null,_selector:null,_isSelected:!1,getIsSelected:function(){return this._isSelected},_isEnabled:!1,getIsEnabled:function(){return this._isEnabled},setIsEnabled:function(e){this._isEnabled=e},initWithTarget:function(e,t){return this.setAnchorPoint(cc.ccp(.5,.5)),this._listener=e,this._selector=t,this._isEnabled=!0,this._isSelected=!1,!0},rect:function(){return cc.RectMake(this._position.x-this._contentSize.width*this._anchorPoint.x,this._position.y-this._contentSize.height*this._anchorPoint.y,this._contentSize.width,this._contentSize.height)},selected:function(){this._isSelected=!0},unselected:function(){this._isSelected=!1},setTarget:function(e,t){this._listener=e,this._selector=t},activate:function(){this._isEnabled&&(this._listener&&typeof this._selector=="string"?this._listener[this._selector](this):this._listener&&typeof this._selector=="function"&&this._selector.call(this._listener,this))}}),cc.MenuItem.create=function(e,t){var n=new cc.MenuItem;return n.initWithTarget(e,t),n},cc.MenuItemLabel=cc.MenuItem.extend({RGBAProtocol:!0,_disabledColor:new cc.Color3B,getDisabledColor:function(){return this._disabledColor},setDisabledColor:function(e){this._disabledColor=e},_label:null,getLabel:function(){return this._label},setLabel:function(e){e&&(this.addChild(e),e.setAnchorPoint(cc.ccp(0,0)),this.setContentSize(e.getContentSize())),this._label&&this.removeChild(this._label,!0),this._label=e},_orginalScale:0,setIsEnabled:function(e){this._isEnabled!=e&&(e?this._label.setColor(this._colorBackup):(this._colorBackup=this._label.getColor(),this._label.setColor(this._disabledColor))),this._super(e)},setOpacity:function(e){this._label.setOpacity(e)},getOpacity:function(){return this._label.getOpacity()},setColor:function(e){this._label.setColor(e)},getColor:function(){return this._label.getColor},setIsOpacityModifyRGB:function(e){},getIsOpacityModifyRGB:function(){},initWithLabel:function(e,t,n){return this.initWithTarget(t,n),this._originalScale=1,this._colorBackup=cc.WHITE(),this._disabledColor=cc.ccc3(126,126,126),this.setLabel(e),!0},activate:function(){this._isEnabled&&(this.stopAllActions(),this.setScale(this._originalScale),this._super())},selected:function(){if(this._isEnabled){this._super();var e=this.getActionByTag(cc.ZOOM_ACTION_TAG);e?this.stopAction(e):this._originalScale=this.getScale();var t=cc.ScaleTo.create(.1,this._originalScale*1.2);t.setTag(cc.ZOOM_ACTION_TAG),this.runAction(t)}},unselected:function(){if(this._isEnabled){this._super(),this.stopActionByTag(cc.ZOOM_ACTION_TAG);var e=cc.ScaleTo.create(.1,this._originalScale);e.setTag(cc.ZOOM_ACTION_TAG),this.runAction(e)}}}),cc.MenuItemLabel.create=function(e,t,n){var r=new cc.MenuItemLabel;return arguments.length==3?r.initWithLabel(e,t,n):r.initWithLabel(e),r},cc.MenuItemAtlasFont=cc.MenuItemLabel.extend({initFromString:function(e,t,n,r,i,s,o){cc.Assert(e!=null&&e.length!=0,"value length must be greater than 0");var u=new cc.LabelAtlas;return u.initWithString(e,t,n,r,i),this.initWithLabel(u,s,o),!0}}),cc.MenuItemAtlasFont.create=function(e,t,n,r,i,s,o){var u=new cc.MenuItemAtlasFont;return u.initFromString(e,t,n,r,i,s,o),u},cc.MenuItemFont=cc.MenuItemLabel.extend({initFromString:function(e,t,n){cc.Assert(e!=null&&e.length!=0,"Value length must be greater than 0"),this._fontName=cc._fontName,this._fontSize=cc._fontSize;var r=cc.LabelTTF.create(e,this._fontName,this._fontSize);return this.initWithLabel(r,t,n),!0},setFontSizeObj:function(e){this._fontSize=e,this._recreateLabel()},fontSizeObj:function(){return this._fontSize},setFontNameObj:function(e){this._fontName=e,this._recreateLabel()},fontNameObj:function(){return this._fontName},_recreateLabel:function(){var e=cc.LabelTTF.create(this._label.getString(),this._fontName,this._fontSize);this.setLabel(e)},_fontSize:0,_fontName:""}),cc.MenuItemFont.setFontSize=function(e){cc._fontSize=e},cc.MenuItemFont.fontSize=function(){return cc._fontSize},cc.MenuItemFont.setFontName=function(e){cc._fontNameRelease&&(cc._fontName=""),cc._fontName=e,cc._fontNameRelease=!0},cc.MenuItemFont.fontName=function(){return cc._fontName},cc.MenuItemFont.create=function(e,t,n){var r=new cc.MenuItemFont;return r.initFromString(e,t,n),r},cc.MenuItemSprite=cc.MenuItem.extend({RGBAProtocol:!0,_normalImage:null,getNormalImage:function(){return this._normalImage},setNormalImage:function(e){e&&(this.addChild(e,0,cc.NORMAL_TAG),e.setAnchorPoint(cc.ccp(0,0)),e.setIsVisible(!0)),this._normalImage&&this.removeChild(this._normalImage,!0),this._normalImage=e},_selectedImage:null,getSelectedImage:function(){return this._selectedImage},setSelectedImage:function(e){e&&(this.addChild(e,0,cc.SELECTED_TAG),e.setAnchorPoint(cc.ccp(0,0)),e.setIsVisible(!1)),this._selectedImage&&this.removeChild(this._selectedImage,!0),this._selectedImage=e},_disabledImage:null,getDisabledImage:function(){return this._disabledImage},setDisabledImage:function(e){e&&(this.addChild(e,0,cc.DISABLE_TAG),e.setAnchorPoint(cc.ccp(0,0)),e.setIsVisible(!1)),this._disabledImage&&this.removeChild(this._disabledImage,!0),this._disabledImage=e},initFromNormalSprite:function(e,t,n,r,i){return cc.Assert(e!=null,""),this.initWithTarget(r,i),this.setNormalImage(e),this.setSelectedImage(t),this.setDisabledImage(n),this.setContentSize(this._normalImage.getContentSize()),!0},setColor:function(e){this._normalImage.setColor(e),this._selectedImage&&this._selectedImage.setColor(e),this._disabledImage&&this._disabledImage.setColor(e)},getColor:function(){return this._normalImage.getColor()},setOpacity:function(e){this._normalImage.setOpacity(e),this._selectedImage&&this._selectedImage.setOpacity(e),this._disabledImage&&this._disabledImage.setOpacity(e)},getOpacity:function(){return this._normalImage.getOpacity()},selected:function(){this._super(),this._disabledImage&&this._disabledImage.setIsVisible(!1),this._selectedImage?(this._normalImage.setIsVisible(!1),this._selectedImage.setIsVisible(!0)):this._normalImage.setIsVisible(!0)},unselected:function(){this._super(),this._normalImage.setIsVisible(!0),this._selectedImage&&this._selectedImage.setIsVisible(!1),this._disabledImage&&this._disabledImage.setIsVisible(!1)},setIsEnabled:function(e){this._super(e),this._selectedImage&&this._selectedImage.setIsVisible(!1),e?(this._normalImage.setIsVisible(!0),this._disabledImage&&this._disabledImage.setIsVisible(!1)):this._disabledImage?(this._disabledImage.setIsVisible(!0),this._normalImage.setIsVisible(!1)):this._normalImage.setIsVisible(!0)}}),cc.MenuItemSprite.create=function(e,t,n,r,i){var s=new cc.MenuItemSprite;return i?(s.initFromNormalSprite(e,t,n,r,i),s):r?cc.MenuItemSprite.create(e,t,null,n,r):cc.MenuItemSprite.create(e,t,n,null,null)},cc.MenuItemImage=cc.MenuItemSprite.extend({initFromNormalImage:function(e,t,n,r,i){var s=cc.Sprite.create(e),o=null,u=null;return t&&(o=cc.Sprite.create(t)),n&&(u=cc.Sprite.create(n)),this.initFromNormalSprite(s,o,u,r,i)}}),cc.MenuItemImage.create=function(e,t,n,r,i){if(arguments.length==4)return cc.MenuItemImage.create(e,t,null,n,r);var s=new cc.MenuItemImage;return s.initFromNormalImage(e,t,n,r,i)?s:null},cc.MenuItemToggle=cc.MenuItem.extend({RGBAProtocol:!0,_opacity:0,getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e;if(this._subItems&&this._subItems.length>0)for(var t=0;t<this._subItems.length;t++)this._subItems[t].setOpacity(e)},_color:new cc.Color3B,getColor:function(){return this._color},setColor:function(e){this._color=e;if(this._subItems&&this._subItems.length>0)for(var t=0;t<this._subItems.length;t++)this._subItems[t].setColor(e)},_selectedIndex:0,getSelectedIndex:function(){return this._selectedIndex},setSelectedIndex:function(e){if(e!=this._selectedIndex){this._selectedIndex=e,this.removeChildByTag(cc.CURRENT_ITEM,!1);var t=this._subItems[this._selectedIndex];this.addChild(t,0,cc.CURRENT_ITEM);var n=t.getContentSize();this.setContentSize(n),t.setPosition(cc.ccp(n.width/2,n.height/2))}},_subItems:[],getSubItems:function(){return this._subItems},setSubItems:function(e){this._subItems=e},initWithTarget:function(e){var t=e[0],n=e[1];this._super(t,n);if(e.length==2)return!1;this._subItems=[];for(var r=2;r<e.length;r++)e[r]&&this._subItems.push(e[r]);return this._selectedIndex=4294967295,this.setSelectedIndex(0),!0},initWithItem:function(e){return this.initWithTarget(null,null),this._subItems=[],this._subItems.push(e),this._selectedIndex=4294967295,this.setSelectedIndex(0),!0},addSubItem:function(e){this._subItems.push(e)},activate:function(){if(this._isEnabled){var e=(this._selectedIndex+1)%this._subItems.length;this.setSelectedIndex(e)}this._super()},selected:function(){this._super(),this._subItems[this._selectedIndex].selected()},unselected:function(){this._super(),this._subItems[this._selectedIndex].unselected()},setIsEnabled:function(e){this._super(e);if(this._subItems&&this._subItems.length>0)for(var t=0;t<this._subItems.length;t++)this._subItems[t].setIsEnabled(e)},selectedItem:function(){return this._subItems[this._selectedIndex]},setIsOpacityModifyRGB:function(e){},getIsOpacityModifyRGB:function(){}}),cc.MenuItemToggle.create=function(){var e=new cc.MenuItemToggle;return arguments.length==1?e.initWithItem(arguments):e.initWithTarget(arguments),e},cc.CCMENU_STATE_WAITING=0,cc.CCMENU_STATE_TRACKING_TOUCH=1,cc.CCMENU_TOUCH_PRIORITY=-128,cc.DEFAULT_PADDING=5,cc.Menu=cc.Layer.extend({_color:new cc.Color3B,getColor:function(){return this._color},setColor:function(e){this._color=e;if(this._children&&this._children.length>0)for(var t=0;t<this._children.length;t++)this._children[t].setColor(this._color)},_opacity:0,getOpacity:function(){return this._opacity},setOpacity:function(e){this._opacity=e;if(this._children&&this._children.length>0)for(var t=0;t<this._children.length;t++)this._children[t].setOpacity(this._opacity)},_selectedItem:null,init:function(){if(this._super()){this.setIsTouchEnabled(!0);var e=cc.Director.sharedDirector().getWinSize();this._isRelativeAnchorPoint=!1,this.setAnchorPoint(cc.ccp(.5,.5)),this.setContentSize(e);var t=new cc.Rect;cc.Application.sharedApplication().statusBarFrame(t);var n=cc.Director.sharedDirector().getDeviceOrientation();return n==cc.DEVICE_ORIENTATION_LANDSCAPE_LEFT||n==cc.DEVICE_ORIENTATION_LANDSCAPE_RIGHT?e.height-=t.size.width:e.height-=t.size.height,this.setPosition(cc.ccp(e.width/2,e.height/2)),this._selectedItem=null,this._state=cc.CCMENU_STATE_WAITING,!0}return!1},initWithItems:function(e){if(this.init()){if(e.length>0)for(var t=0;t<e.length;t++)e[t]&&this.addChild(e[t],t);return!0}return!1},addChild:function(e,t,n){n=n||e._tag,this._super(e,t,n)},alignItemsVertically:function(){this.alignItemsVerticallyWithPadding(cc.DEFAULT_PADDING)},alignItemsVerticallyWithPadding:function(e){var t=-e;if(this._children&&this._children.length>0)for(var n=0;n<this._children.length;n++)t+=this._children[n].getContentSize().height*this._children[n].getScaleY()+e;var r=t/2;if(this._children&&this._children.length>0)for(n=0;n<this._children.length;n++)this._children[n].setPosition(cc.ccp(0,r-this._children[n].getContentSize().height*this._children[n].getScaleY()/2)),r-=this._children[n].getContentSize().height*this._children[n].getScaleY()+e},alignItemsHorizontally:function(){this.alignItemsHorizontallyWithPadding(cc.DEFAULT_PADDING)},alignItemsHorizontallyWithPadding:function(e){var t=-e;if(this._children&&this._children.length>0)for(var n=0;n<this._children.length;n++)t+=this._children[n].getContentSize().width*this._children[n].getScaleX()+e;var r=-t/2;if(this._children&&this._children.length>0)for(n=0;n<this._children.length;n++)this._children[n].setPosition(cc.ccp(r+this._children[n].getContentSize().width*this._children[n].getScaleX()/2,0)),r+=this._children[n].getContentSize().width*this._children[n].getScaleX()+e},alignItemsInColumns:function(){var e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);var n=-5,r=0,i=0,s=0,o;if(this._children&&this._children.length>0)for(t=0;t<this._children.length;t++){cc.Assert(r<e.length,""),o=e[r],cc.Assert(o,"");var u=this._children[t].getContentSize().height;i=i>=u||isNaN(u)?i:u,++s,s>=o&&(n+=i+5,s=0,i=0,++r)}cc.Assert(!s,"");var a=cc.Director.sharedDirector().getWinSize();r=0,i=0,o=0;var f=0,l=0,c=n/2;if(this._children&&this._children.length>0)for(t=0;t<this._children.length;t++){var h=this._children[t];o==0&&(o=e[r],f=a.width/(1+o),l=f);var u=h.getContentSize().height;i=i>=u||isNaN(u)?i:u,h.setPosition(cc.ccp(l-a.width/2,c-h.getContentSize().height/2)),l+=f,++s,s>=o&&(c-=i+5,s=0,o=0,i=0,++r)}},alignItemsInRows:function(){var e=[];for(var t=0;t<arguments.length;t++)e.push(arguments[t]);var n=[],r=[],i=-10,s=-5,o=0,u=0,a=0,f;if(this._children&&this._children.length>0)for(var t=0;t<this._children.length;t++){var l=this._children[t];cc.Assert(o<e.size(),""),f=e[o],cc.Assert(f,"");var c=l.getContentSize().width;u=u>=c||isNaN(c)?u:c,s+=l.getContentSize().height+5,++a,a>=f&&(n.push(u),r.push(s),i+=u+10,a=0,u=0,s=-5,++o)}cc.Assert(!a,"");var h=cc.Director.sharedDirector().getWinSize();o=0,u=0,f=0;var p=-i/2,d=0;if(this._children&&this._children.length>0)for(var t=0;t<this._children.length;t++){var l=this._children[t];f==0&&(f=e[o],d=r[o]);var c=l.getContentSize().width;u=u>=c||isNaN(c)?u:c,l.setPosition(cc.ccp(p+n[o]/2,d-h.height/2)),d-=l.getContentSize().height+10,++a,a>=f&&(p+=u+5,a=0,f=0,u=0,++o)}},registerWithTouchDispatcher:function(){cc.TouchDispatcher.sharedDispatcher().addTargetedDelegate(this,cc.CCMENU_TOUCH_PRIORITY,!0)},ccTouchBegan:function(e,t){if(this._state!=cc.CCMENU_STATE_WAITING||!this._isVisible)return!1;for(var n=this._parent;n!=null;n=n.getParent())if(!n.getIsVisible())return!1;return this._selectedItem=this._itemForTouch(e),this._selectedItem?(this._state=cc.CCMENU_STATE_TRACKING_TOUCH,this._selectedItem.selected(),!0):!1},ccTouchEnded:function(e,t){cc.Assert(this._state==cc.CCMENU_STATE_TRACKING_TOUCH,"[Menu ccTouchEnded] -- invalid state"),this._selectedItem&&(this._selectedItem.unselected(),this._selectedItem.activate()),this._state=cc.CCMENU_STATE_WAITING},ccTouchCancelled:function(e,t){cc.Assert(this._state==cc.CCMENU_STATE_TRACKING_TOUCH,"[Menu ccTouchCancelled] -- invalid state"),this._selectedItem&&this._selectedItem.unselected(),this._state=cc.CCMENU_STATE_WAITING},ccTouchMoved:function(e,t){cc.Assert(this._state==cc.CCMENU_STATE_TRACKING_TOUCH,"[Menu ccTouchMoved] -- invalid state");var n=this._itemForTouch(e);n!=this._selectedItem&&(this._selectedItem&&this._selectedItem.unselected(),this._selectedItem=n,this._selectedItem&&this._selectedItem.selected())},onExit:function(){this._state==cc.CCMENU_STATE_TRACKING_TOUCH&&(this._selectedItem.unselected(),this._state=cc.CCMENU_STATE_WAITING,this._selectedItem=null),this._super()},setIsOpacityModifyRGB:function(e){},getIsOpacityModifyRGB:function(){},_itemForTouch:function(e){var t=e.locationInView(e.view());if(this._children&&this._children.length>0)for(var n=0;n<this._children.length;n++)if(this._children[n].getIsVisible()&&this._children[n].getIsEnabled()){var r=this._children[n].convertToNodeSpace(t),i=this._children[n].rect();i.origin=cc.PointZero();if(cc.Rect.CCRectContainsPoint(i,r))return this._children[n]}return null},_state:-1}),cc.Menu.create=function(){var e=new cc.Menu;return e.initWithItems(arguments),e},cc.TMXOrientationOrtho=0,cc.TMXOrientationHex=1,cc.TMXOrientationIso=2,cc.TMXTiledMap=cc.Node.extend({_mapSize:cc.SizeZero(),_tileSize:cc.SizeZero(),_properties:null,_objectGroups:null,_mapOrientation:null,_TMXLayers:null,_tileProperties:[],getMapSize:function(){return this._mapSize},setMapSize:function(e){this._mapSize=e},getTileSize:function(){return this._tileSize},setTileSize:function(e){this._tileSize=e},getMapOrientation:function(){return this._mapOrientation},setMapOrientation:function(e){this._mapOrientation=e},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(e){this._objectGroups=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties=e},initWithTMXFile:function(e){cc.Assert(e!=null&&e.length>0,"TMXTiledMap: tmx file should not be nil"),this.setContentSize(cc.SizeZero());var t=cc.TMXMapInfo.create(e);if(!t)return!1;cc.Assert(t.getTilesets().length!=0,"TMXTiledMap: Map not found. Please check the filename."),this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.getOrientation(),this.setObjectGroups(t.getObjectGroups()),this.setProperties(t.getProperties()),this._tileProperties=t.getTileProperties();var n=0,r=t.getLayers();if(r){this._TMXLayers=new Object;var i=null;for(var s=0,o=r.length;s<o;s++){i=r[s];if(i&&i.visible){var u=this._parseLayer(i,t);this.addChild(u,n,n);var a=u.getLayerName();this._TMXLayers[a]=u;var f=u.getContentSize(),l=this.getContentSize();l.width=Math.max(l.width,f.width),l.height=Math.max(l.height,f.height),this.setContentSize(l),n++}}}return!0},layerNamed:function(e){return this._TMXLayers.hasOwnProperty(e)?this._TMXLayers[e]:null},objectGroupNamed:function(e){if(this._objectGroups)for(var t=0;t<this._objectGroups.length;t++){var n=this._objectGroups[t];if(n&&n.getGroupName()==e)return n}return null},propertyNamed:function(e){return this._properties[e.toString()]},propertiesForGID:function(e){return this._tileProperties[e]},_parseLayer:function(e,t){var n=this._tilesetForLayer(e,t),r=cc.TMXLayer.create(n,e,t);return e.ownTiles=!1,r.setupTiles(),r},_tilesetForLayer:function(e,t){var n=e._layerSize,r=t.getTilesets();if(r){var i=null;for(var s=r.length-1;s>=0;s--){i=r[s];if(i)for(var o=0;o<n.height;o++)for(var u=0;u<n.width;u++){var a=(u+n.width*o).toString(),f=e._tiles[a];if(f!==0&&f>=i.firstGid)return i}}}return cc.Log("cocos2d: Warning: TMX Layer "+e.name+" has no tiles"),null}}),cc.TMXTiledMap.create=function(e){var t=new cc.TMXTiledMap;return t.initWithTMXFile(e)?t:null},cc.TMXLayerAttribNone=1,cc.TMXLayerAttribBase64=2,cc.TMXLayerAttribGzip=4,cc.TMXLayerAttribZlib=8,cc.TMXPropertyNone=0,cc.TMXPropertyMap=1,cc.TMXPropertyLayer=2,cc.TMXPropertyObjectGroup=3,cc.TMXPropertyObject=4,cc.TMXPropertyTile=5,cc.TMXLayerInfo=cc.Class.extend({_properties:[],name:"",_layerSize:null,_tiles:[],visible:null,_opacity:null,ownTiles:!0,_minGID:1e5,_maxGID:0,offset:cc.PointZero(),getProperties:function(){return this._properties},setProperties:function(e){this._properties=e}}),cc.TMXTilesetInfo=cc.Class.extend({name:null,firstGid:0,_tileSize:cc.SizeZero(),spacing:0,margin:0,sourceImage:null,imageSize:cc.SizeZero(),rectForGID:function(e){var t=cc.RectZero();t.size=this._tileSize,e-=parseInt(this.firstGid);var n=parseInt((this.imageSize.width-this.margin*2+this.spacing)/(this._tileSize.width+this.spacing));return t.origin.x=parseInt(e%n*(this._tileSize.width+this.spacing)+this.margin),t.origin.y=parseInt(parseInt(e/n)*(this._tileSize.height+this.spacing)+this.margin),t}}),cc.TMXMapInfo=cc.SAXParser.extend({_orientation:null,_mapSize:cc.SizeZero(),_tileSize:cc.SizeZero(),_layers:null,_tileSets:null,_objectGroups:null,_parentElement:null,_parentGID:null,_layerAttribs:0,_storingCharacters:!1,_properties:null,_TMXFileName:null,_currentString:null,_tileProperties:[],getOrientation:function(){return this._orientation},setOrientation:function(e){this._orientation=e},getMapSize:function(){return this._mapSize},setMapSize:function(e){this._mapSize=e},getTileSize:function(){return this._tileSize},setTileSize:function(e){this._tileSize=e},getLayers:function(){return this._layers},setLayers:function(e){this._layers.push(e)},getTilesets:function(){return this._tileSets},setTilesets:function(e){this._tileSets.push(e)},getObjectGroups:function(){return this._objectGroups},setObjectGroups:function(e){this._objectGroups.push(e)},getParentElement:function(){return this._parentElement},setParentElement:function(e){this._parentElement=e},getParentGID:function(){return this._parentGID},setParentGID:function(e){this._parentGID=e},getLayerAttribs:function(){return this._layerAttribs},setLayerAttribs:function(e){this._layerAttribs=e},getStoringCharacters:function(){return this._storingCharacters},setStoringCharacters:function(e){this._storingCharacters=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties.push(e)},initWithTMXFile:function(e){return this._tileSets=[],this._layers=[],this._TMXFileName=e,this._objectGroups=[],this._properties=[],this._tileProperties=[],this._currentString="",this._storingCharacters=!1,this._layerAttribs=cc.TMXLayerAttribNone,this._parentElement=cc.TMXPropertyNone,this.parseXMLFile(this._TMXFileName)},parseXMLFile:function(e){var t=cc.SAXParser.shareParser().tmxParse(e),n=t.documentElement,r=n.getAttribute("version"),i=n.getAttribute("orientation");if(n.nodeName=="map"){r!="1.0"&&r!==null&&cc.Log("cocos2d: TMXFormat: Unsupported TMX version:"+r),i=="orthogonal"?this.setOrientation(cc.TMXOrientationOrtho):i=="isometric"?this.setOrientation(cc.TMXOrientationIso):i=="hexagonal"?this.setOrientation(cc.TMXOrientationHex):i!==null&&cc.Log("cocos2d: TMXFomat: Unsupported orientation:"+this.getOrientation());var s=new cc.Size;s.width=parseFloat(n.getAttribute("width")),s.height=parseFloat(n.getAttribute("height")),this.setMapSize(s),s=new cc.Size,s.width=parseFloat(n.getAttribute("tilewidth")),s.height=parseFloat(n.getAttribute("tileheight")),this.setTileSize(s),this.setParentElement(cc.TMXPropertyMap)}var o=n.getElementsByTagName("tileset");n.nodeName!=="map"&&(o=[],o.push(n));for(var u=0,a=o.length;u<a;u++){var f=o[u],l=f.getAttribute("source"),c=e.substring(0,e.lastIndexOf("/")+1);if(l)this.parseXMLFile(c+l);else{var h=new cc.TMXTilesetInfo;h.name=f.getAttribute("name")||"",h.firstGid=parseInt(f.getAttribute("firstgid"))||1,h.spacing=parseInt(f.getAttribute("spacing"))||0,h.margin=parseInt(f.getAttribute("margin"))||0;var s=cc.Size;s.width=parseFloat(f.getAttribute("tilewidth")),s.height=parseFloat(f.getAttribute("tileheight")),h._tileSize=s;var p=f.getElementsByTagName("image")[0],d=p.getAttribute("source");d&&(d=c+d),h.sourceImage=d,this.setTilesets(h)}}var v=n.getElementsByTagName("tile");if(v)for(var u=0,a=v.length;u<a;u++){var m=this.getTilesets()[0],f=v[u];this.setParentGID(m.firstGid+parseInt(f.getAttribute("id"))),this.setTileProperties(this.getParentGID()),this.setParentElement(cc.TMXPropertyTile)}var g=n.getElementsByTagName("layer");if(g)for(var u=0,a=g.length;u<a;u++){var y=g[u],b=y.getElementsByTagName("data")[0],w=new cc.TMXLayerInfo;w.name=y.getAttribute("name");var s=new cc.Size;s.width=parseFloat(y.getAttribute("width")),s.height=parseFloat(y.getAttribute("height")),w._layerSize=s;var E=y.getAttribute("visible");w.visible=E!="0";var S=y.getAttribute("opacity")||1;S?w._opacity=parseInt(255*parseFloat(S)):w._opacity=255;var x=parseFloat(y.getAttribute("x"))||0,T=parseFloat(y.getAttribute("y"))||0;w.offset=cc.ccp(x,T);var N="";for(var C=0;C<b.childNodes.length;C++)N+=b.childNodes[C].nodeValue;var k=b.getAttribute("compression");cc.Assert(k==null||k=="gzip"||k=="zlib","TMX: unsupported compression method");switch(k){case"gzip":w._tiles=cc.unzipBase64AsArray(N,4);break;case"zlib":break;case null:case"":w._tiles=cc.Codec.Base64.decodeAsArray(N,4);break;default:cc.Assert(this.getLayerAttribs()!=cc.TMXLayerAttribNone,"TMX tile map: Only base64 and/or gzip/zlib maps are supported")}this.setLayers(w),this.setParentElement(cc.TMXPropertyLayer)}var L=n.getElementsByTagName("objectgroup");if(L)for(var u=0;u<L.length;u++){var A=L[u],O=new cc.TMXObjectGroup;O.setGroupName(A.getAttribute("name"));var M=new cc.Point;M.x=parseFloat(A.getAttribute("x"))*this.getTileSize().width||0,M.y=parseFloat(A.getAttribute("y"))*this.getTileSize().height||0,O.setPositionOffset(M);var _=A.querySelectorAll("object");if(_)for(var C=0;C<_.length;C++){var D=_[C],P=new Object;P.name=D.getAttribute("name")||"",P.type=D.getAttribute("type")||"",P.x=parseInt(D.getAttribute("x")||0)+O.getPositionOffset().x;var T=parseInt(D.getAttribute("y")||0)+O.getPositionOffset().y;T=parseInt(this.getMapSize().height*this.getTileSize().height)-T-parseInt(D.getAttribute("height")),P.y=T,P.width=parseInt(D.getAttribute("width")),P.height=parseInt(D.getAttribute("height")),O.setObjects(P),this.setParentElement(cc.TMXPropertyObject)}this.setObjectGroups(O),this.setParentElement(cc.TMXPropertyObjectGroup)}this.setParentElement(cc.TMXPropertyMap);var H=t.querySelectorAll("map > properties > property");if(H)for(u=0;u<H.length;u++){var B=H[u];if(this.getParentElement()==cc.TMXPropertyNone)cc.Log("TMX tile map: Parent element is unsupported. Cannot add property named "+B.getAttribute("name")+" with value "+B.getAttribute("value"));else if(this.getParentElement()==cc.TMXPropertyMap){var j=new String(B.getAttribute("value")),F=B.getAttribute("name");this.getProperties()[F]=j}else if(this.getParentElement()==cc.TMXPropertyLayer){var w=this.getLayers()[0],j=new String(B.getAttribute("value")),F=B.getAttribute("name");w.getProperties()[F]=j}else if(this.getParentElement()==cc.TMXPropertyObjectGroup){var O=this.getObjectGroups()[0],j=new String(B.getAttribute("value")),F=B.getAttribute("name");O.getProperties()[F]=j}else if(this.getParentElement()==cc.TMXPropertyObject){var O=this.getObjectGroups()[0],P=O.getObjects()[0],I=B.getAttribute("name"),q=new String(B.getAttribute("value"));P[I]=q}else if(this.getParentElement()==cc.TMXPropertyTile){var P;P=this.getTileProperties()[this.getParentGID()];var I=B.getAttribute("name"),q=new String(B.getAttribute("name"));P[I]=q}}return n},getTileProperties:function(){return this._tileProperties},setTileProperties:function(e){this._tileProperties[e]={}},getCurrentString:function(){return this._currentString},setCurrentString:function(e){this._currentString=e},getTMXFileName:function(){return this._TMXFileName},setTMXFileName:function(e){this._TMXFileName=e}}),cc.TMXMapInfo.create=function(e){var t=new cc.TMXMapInfo;return t.initWithTMXFile(e)?t:null},cc.TMXObjectGroup=cc.Class.extend({_groupName:"",_positionOffset:cc.PointZero(),_properties:null,_objects:null,ctor:function(){this._properties=[],this._objects=[]},getPositionOffset:function(){return this._positionOffset},setPositionOffset:function(e){this._positionOffset=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties.push(e)},getGroupName:function(){return this._groupName.toString()},setGroupName:function(e){this._groupName=e},propertyNamed:function(e){return this._properties[e]},objectNamed:function(e){if(this._objects&&this._objects.length>0)for(var t=0,n=this._objects.length;t<n;t++){var r=this._objects[t].name;if(r&&r==e)return this._objects[t]}return null},getObjects:function(){return this._objects},setObjects:function(e){this._objects.push(e)}}),cc.TMXLayer=cc.SpriteBatchNode.extend({_layerSize:cc.SizeZero(),_mapTileSize:cc.SizeZero(),_tiles:null,_tileSet:null,_layerOrientation:null,_properties:null,_layerName:"",_opacity:255,_minGID:null,_maxGID:null,_vertexZvalue:null,_useAutomaticVertexZ:null,_alphaFuncValue:null,_reusedTile:null,_atlasIndexArray:null,_contentScaleFactor:null,ctor:function(){this._super(),this._children=[],this._descendants=[],this._isUseCache=!0},getLayerSize:function(){return this._layerSize},setLayerSize:function(e){this._layerSize=e},getMapTileSize:function(){return this._mapTileSize},setMapTileSize:function(e){this._mapTileSize=e},getTiles:function(){return this._tiles},setTiles:function(e){this._tiles=e},getTileSet:function(){return this._tileSet},setTileSet:function(e){this._tileSet=e},getLayerOrientation:function(){return this._layerOrientation},setLayerOrientation:function(e){this._layerOrientation=e},getProperties:function(){return this._properties},setProperties:function(e){this._properties=e},initWithTilesetInfo:function(e,t,n){var r=t._layerSize,i=parseInt(r.width*r.height),s=i*.35+1,o=null;e&&(o=cc.TextureCache.sharedTextureCache().addImage(e.sourceImage.toString()));if(this.initWithTexture(o,s)){this._layerName=t.name,this._layerSize=t._layerSize,this._tiles=t._tiles,this._minGID=t._minGID,this._maxGID=t._maxGID,this._opacity=t._opacity,this._properties=t.getProperties(),this._contentScaleFactor=cc.Director.sharedDirector().getContentScaleFactor(),this._tileSet=e,this._mapTileSize=n.getTileSize(),this._layerOrientation=n.getOrientation();var u=this._calculateLayerOffset(t.offset);return this.setPosition(u),this._atlasIndexArray=[],this.setContentSizeInPixels(cc.SizeMake(this._layerSize.width*this._mapTileSize.width,this._layerSize.height*this._mapTileSize.height)),this._mapTileSize.width/=this._contentScaleFactor,this._mapTileSize.height/=this._contentScaleFactor,this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._alphaFuncValue=0,!0}return!1},releaseMap:function(){this._tiles&&(this._tiles=null),this._atlasIndexArray&&(this._atlasIndexArray=null)},tileAt:function(e){cc.Assert(e.x<this._layerSize.width&&e.y<this._layerSize.height&&e.x>=0&&e.y>=0,"TMXLayer: invalid position"),cc.Assert(this._tiles&&this._atlasIndexArray,"TMXLayer: the tiles map has been released");var t=null,n=this.tileGIDAt(e);if(n){var r=e.x+e.y*this._layerSize.width;t=this.getChildByTag(r);if(!t){var i=this._tileSet.rectForGID(n);i=cc.RectMake(i.origin.x/this._contentScaleFactor,i.origin.y/this._contentScaleFactor,i.size.width/this._contentScaleFactor,i.size.height/this._contentScaleFactor),t=new cc.Sprite,t.initWithBatchNode(this,i),t.setPosition(this.positionAt(e)),t.setVertexZ(this._vertexZForPos(e)),t.setAnchorPoint(cc.PointZero()),t.setOpacity(this._opacity);var s=this._atlasIndexForExistantZ(r);this.addSpriteWithoutQuad(t,s,r)}}return t},tileGIDAt:function(e){cc.Assert(e.x<this._layerSize.width&&e.y<this._layerSize.height&&e.x>=0&&e.y>=0,"TMXLayer: invalid position"),cc.Assert(this._tiles&&this._atlasIndexArray,"TMXLayer: the tiles map has been released");var t=e.x+e.y*this._layerSize.width;return this._tiles[t]},setTileGID:function(e,t){cc.Assert(t.x<this._layerSize.width&&t.y<this._layerSize.height&&t.x>=0&&t.y>=0,"TMXLayer: invalid position"),cc.Assert(this._tiles&&this._atlasIndexArray,"TMXLayer: the tiles map has been released"),cc.Assert(e!==0||!(e>=this._tileSet.firstGid),"TMXLayer: invalid gid:"+e),this._setNodeDirtyForCache();var n=this.tileGIDAt(t);if(n!=e)if(e==0)this.removeTileAt(t);else if(n==0)this._insertTileForGID(e,t);else{var r=t.x+t.y*this._layerSize.width,i=this.getChildByTag(r);if(i){var s=this._tileSet.rectForGID(e);s=cc.RectMake(s.origin.x/this._contentScaleFactor,s.origin.y/this._contentScaleFactor,s.size.width/this._contentScaleFactor,s.size.height/this._contentScaleFactor),i.setTextureRectInPixels(s,!1,s.size),this._tiles[r]=e}else this._updateTileForGID(e,t)}},removeTileAt:function(e){cc.Assert(e.x<this._layerSize.width&&e.y<this._layerSize.height&&e.x>=0&&e.y>=0,"TMXLayer: invalid position"),cc.Assert(this._tiles&&this._atlasIndexArray,"TMXLayer: the tiles map has been released"),this._setNodeDirtyForCache();var t=this.tileGIDAt(e);if(t){var n=e.x+e.y*this._layerSize.width,r=this._atlasIndexForExistantZ(n);this._tiles[n]=0,cc.ArrayRemoveObjectAtIndex(this._atlasIndexArray,r);var i=this.getChildByTag(n);if(i)this.removeChild(i,!0);else{this._textureAtlas.removeQuadAtIndex(r);if(this._children)for(var s=0,o=this._children.length;s<o;s++){var u=this._children[s];if(u){var a=u.getAtlasIndex();a>=r&&u.setAtlasIndex(a-1)}}}}},positionAt:function(e){var t=cc.PointZero();switch(this._layerOrientation){case cc.TMXOrientationOrtho:t=this._positionForOrthoAt(e);break;case cc.TMXOrientationIso:t=this._positionForIsoAt(e);break;case cc.TMXOrientationHex:t=this._positionForHexAt(e)}return t},propertyNamed:function(e){return this._properties[e]},setupTiles:function(){var e=this._textureAtlas.getTexture();this._tileSet.imageSize=new cc.Size(e.width,e.height),this._parseInternalProperties(),this._setNodeDirtyForCache();for(var t=0;t<this._layerSize.height;t++)for(var n=0;n<this._layerSize.width;n++){var r=n+this._layerSize.width*t,i=this._tiles[r];i!=0&&(this._appendTileForGID(i,cc.ccp(n,t)),this._minGID=Math.min(i,this._minGID),this._maxGID=Math.max(i,this._maxGID))}cc.Assert(this._maxGID>=this._tileSet.firstGid&&this._minGID>=this._tileSet.firstGid,"TMX: Only 1 tilset per layer is supported")},addChild:function(e){cc.Assert(0,"addChild: is not supported on cc.TMXLayer. Instead use setTileGID:at:/tileAt:")},removeChild:function(e,t){var n=e;if(!n)return;cc.Assert(cc.ArrayContainsObject(this._children,n),"Tile does not belong to TMXLayer"),this._setNodeDirtyForCache();var r=cc.ArrayGetIndexOfObject(this._children,n),i=this._atlasIndexArray[r];this._tiles[i]=0,cc.ArrayRemoveObjectAtIndex(this._atlasIndexArray,r),this._super(n,t)},draw:function(){this._useAutomaticVertexZ,this._super(),this._useAutomaticVertexZ},getLayerName:function(){return this._layerName.toString()},setLayerName:function(e){this._layerName=e},_positionForIsoAt:function(e){var t=cc.PointMake(this._mapTileSize.width/2*(this._layerSize.width+e.x-e.y-1),this._mapTileSize.height/2*(this._layerSize.height*2-e.x-e.y-2));return t},_positionForOrthoAt:function(e){var t=cc.PointMake(e.x*this._mapTileSize.width,(this._layerSize.height-e.y-1)*this._mapTileSize.height);return t},_positionForHexAt:function(e){var t=0;e.x%2==1&&(t=-this._mapTileSize.height/2);var n=cc.PointMake(e.x*this._mapTileSize.width*3/4,(this._layerSize.height-e.y-1)*this._mapTileSize.height+t);return n},_calculateLayerOffset:function(e){var t=cc.PointZero();switch(this._layerOrientation){case cc.TMXOrientationOrtho:t=cc.ccp(e.x*this._mapTileSize.width,-e.y*this._mapTileSize.height);break;case cc.TMXOrientationIso:t=cc.ccp(this._mapTileSize.width/2*(e.x-e.y),this._mapTileSize.height/2*(-e.x-e.y));break;case cc.TMXOrientationHex:t=cc.ccp(0,0),cc.Log("cocos2d:offset for hexagonal map not implemented yet")}return t},_appendTileForGID:function(e,t){var n=this._tileSet.rectForGID(e);n=cc.RectMake(n.origin.x/this._contentScaleFactor,n.origin.y/this._contentScaleFactor,n.size.width/this._contentScaleFactor,n.size.height/this._contentScaleFactor),this._setNodeDirtyForCache();var r=t.x+t.y*this._layerSize.width;this._reusedTile=new cc.Sprite,this._reusedTile.setParent(this),this._reusedTile.initWithBatchNode(this,n),this._reusedTile.setPosition(this.positionAt(t)),this._reusedTile.setVertexZ(this._vertexZForPos(t)),this._reusedTile.setAnchorPoint(cc.PointZero()),this._reusedTile.setOpacity(this._opacity),this._reusedTile.setTag(r);var i=this._atlasIndexArray.length;return this.addQuadFromSprite(this._reusedTile,i),this._atlasIndexArray=cc.ArrayAppendObjectToIndex(this._atlasIndexArray,r,i),this._reusedTile},_insertTileForGID:function(e,t){var n=this._tileSet.rectForGID(e);n=cc.RectMake(n.origin.x/this._contentScaleFactor,n.origin.y/this._contentScaleFactor,n.size.width/this._contentScaleFactor,n.size.height/this._contentScaleFactor);var r=parseInt(t.x+t.y*this._layerSize.width);this._setNodeDirtyForCache(),this._reusedTile=new cc.Sprite,this._reusedTile.setParent(this),this._reusedTile.initWithBatchNode(this,n),this._reusedTile.setPositionInPixels(this.positionAt(t)),this._reusedTile.setVertexZ(this._vertexZForPos(t)),this._reusedTile.setAnchorPoint(cc.PointZero()),this._reusedTile.setOpacity(this._opacity);var i=this._atlasIndexForNewZ(r);this.addQuadFromSprite(this._reusedTile,i),this._atlasIndexArray=cc.ArrayAppendObjectToIndex(this._atlasIndexArray,r,i);if(this._children)for(var s=0,o=this._children.length;s<o;s++){var u=this._children[s];if(u){var a=u.getAtlasIndex();a>=i&&u.setAtlasIndex(a+1)}}return this._tiles[r]=e,this._reusedTile},_updateTileForGID:function(e,t){var n=this._tileSet.rectForGID(e);n=cc.RectMake(n.origin.x/this._contentScaleFactor,n.origin.y/this._contentScaleFactor,n.size.width/this._contentScaleFactor,n.size.height/this._contentScaleFactor);var r=t.x+t.y*this._layerSize.width;this._setNodeDirtyForCache(),this._reusedTile=new cc.Sprite,this._reusedTile.initWithBatchNode(this,n),this._reusedTile.setPositionInPixels(this.positionAt(t)),this._reusedTile.setVertexZ(this._vertexZForPos(t)),this._reusedTile.setAnchorPoint(cc.PointZero()),this._reusedTile.setOpacity(this._opacity);var i=this._atlasIndexForExistantZ(r);return this._reusedTile.setAtlasIndex(i),this._reusedTile.setDirty(!0),this._reusedTile.updateTransform(),this._tiles[r]=e,this._reusedTile},_parseInternalProperties:function(){var e=this.propertyNamed("cc_vertexz");e&&(e=="automatic"?this._useAutomaticVertexZ=!0:this._vertexZvalue=parseInt(e));var t=this.propertyNamed("cc_alpha_func");t&&(this._alphaFuncValue=parseInt(t))},_vertexZForPos:function(e){var t=0,n=0;if(this._useAutomaticVertexZ)switch(this._layerOrientation){case cc.TMXOrientationIso:n=this._layerSize.width+this._layerSize.height,t=-(n-(e.x+e.y));break;case cc.TMXOrientationOrtho:t=-(this._layerSize.height-e.y);break;case cc.TMXOrientationHex:cc.Assert(0,"TMX Hexa zOrder not supported");break;default:cc.Assert(0,"TMX invalid value")}else t=this._vertexZvalue;return t},_atlasIndexForExistantZ:function(e){var t;if(this._atlasIndexArray)for(var n=0;n<this._atlasIndexArray.length;n++){t=this._atlasIndexArray[n];if(t==e)break}return cc.Assert(t,"TMX atlas index not found. Shall not happen"),n},_atlasIndexForNewZ:function(e){for(var t=0;t<this._atlasIndexArray.length;t++){var n=this._atlasIndexArray[t];if(e<n)break}return t}}),cc.TMXLayer.create=function(e,t,n){var r=new cc.TMXLayer;return r.initWithTilesetInfo(e,t,n)?r:null},cc.compareInts=function(e,t){return e-t},cc.PointObject=cc.Class.extend({_ratio:null,_offset:null,_child:null,getRatio:function(){return this._ratio},setRatio:function(e){this._ratio=e},getOffset:function(){return this._offset},setOffset:function(e){this._offset=e},getChild:function(){return this._child},setChild:function(e){this._child=e},initWithCCPoint:function(e,t){return this._ratio=e,this._offset=t,this._child=null,!0}}),cc.PointObject.create=function(e,t){var n=new cc.PointObject;return n.initWithCCPoint(e,t),n},cc.ParallaxNode=cc.Node.extend({_lastPosition:null,_parallaxArray:[],getParallaxArray:function(){return this._parallaxArray},setParallaxArray:function(e){this._parallaxArray=e},ctor:function(){this._parallaxArray=[],this._lastPosition=cc.PointMake(-100,-100)},addChild:function(e,t,n,r){if(arguments.length==3){cc.Assert(0,"ParallaxNode: use addChild:z:parallaxRatio:positionOffset instead");return}cc.Assert(e!=null,"Argument must be non-nil");var i=cc.PointObject.create(n,r);i.setChild(e),this._parallaxArray.push(i);var s=this._position;s.x=s.x*n.x+r.x,s.y=s.y*n.y+r.y,e.setPosition(s),this._super(e,t,e.getTag())},removeChild:function(e,t){for(var n=0;n<this._parallaxArray.length;n++){var r=this._parallaxArray[n];if(r.getChild().isEqual(e)){this._parallaxArray.splice(n,1);break}}this._super(e,t)},removeAllChildrenWithCleanup:function(e){this._parallaxArray=[],this._super(e)},visit:function(){var e=this._absolutePosition();if(!cc.Point.CCPointEqualToPoint(e,this._lastPosition)){for(var t=0;t<this._parallaxArray.length;t++){var n=this._parallaxArray[t],r=-e.x+e.x*n.getRatio().x+n.getOffset().x,i=-e.y+e.y*n.getRatio().y+n.getOffset().y;n.getChild().setPosition(cc.ccp(r,i))}this._lastPosition=e}this._super()},_absolutePosition:function(){var e=this._position,t=this;while(t.getParent()!=null)t=t.getParent(),e=cc.ccpAdd(e,t.getPosition());return e}}),cc.ParallaxNode.create=function(){var e=new cc.ParallaxNode;return e},cc.sound=!0,cc.capabilities={mp3:!1,ogg:!1,wav:!1},cc.AudioManager=cc.Class.extend({_initialized:!1,_supportedFormat:["mp3","ogg","wav"],_requestedFormat:null,_sound_enable:!0,_audioList:{},_activeAudioExt:-1,_bgmList:{},_isBgmPlaying:!1,_playingBgm:null,_effectsVolume:1,ctor:function(){if(this._initialized)return;var e=document.createElement("audio");e.canPlayType&&(cc.capabilities.mp3="no"!=e.canPlayType("audio/mpeg")&&""!=e.canPlayType("audio/mpeg"),cc.capabilities.ogg="no"!=e.canPlayType('audio/ogg; codecs="vorbis"')&&""!=e.canPlayType('audio/ogg; codecs="vorbis"'),cc.capabilities.wav="no"!=e.canPlayType('audio/wav; codecs="1"')&&""!=e.canPlayType('audio/wav; codecs="1"'),cc.sound=cc.capabilities.mp3||cc.capabilities.ogg||cc.capabilities.wav),this._initialized=!0},init:function(e){return e?this._requestedFormat=new String(e):this._requestedFormat=new String("mp3"),this._activeAudioExt=this._getSupportedAudioFormat(),this._sound_enable},_getSupportedAudioFormat:function(){var e=0;if(!cc.sound){this._sound_enable=!1;return}return this._requestedFormat.search(/mp3/i)!=-1&&cc.capabilities.mp3?this._supportedFormat[e]:this._requestedFormat.search(/ogg/i)!=-1&&cc.capabilities.ogg?this._supportedFormat[++e]:this._requestedFormat.search(/wav/i)!=-1&&cc.capabilities.wav?this._supportedFormat[++e]:(this._sound_enable=!1,-1)},preloadBackgroundMusic:function(e){if(this._sound_enable){if(this._activeAudioExt==-1)return;var t=e+"."+this._activeAudioExt,n=new Audio(t);n.preload="auto",n.addEventListener("canplaythrough",function(e){this.removeEventListener("canplaythrough",arguments.callee,!1)},!1),n.addEventListener("error",function(e){cc.Loader.shareLoader().onResLoadingErr()},!1),n.addEventListener("playing",function(e){cc.sharedEngine._isBgmPlaying=!0},!1),n.addEventListener("pause",function(e){cc.sharedEngine._isBgmPlaying=!1},!1),n.load(),this._bgmList[e]=n}cc.Loader.shareLoader().onResLoaded()},playBackgroundMusic:function(e,t){this._bgmList[this._playingBgm]&&this._bgmList[this._playingBgm].pause(),this._playingBgm=e,this._bgmList[this._playingBgm]&&(this._bgmList[this._playingBgm].loop=t||!1,this._bgmList[this._playingBgm].play())},stopBackgroundMusic:function(e){this._bgmList[this._playingBgm]&&(this._bgmList[this._playingBgm].pause(),this._bgmList[this._playingBgm].currentTime=0,e&&this._bgmList.hasOwnProperty(this._playingBgm)&&delete this._bgmList[this._playingBgm])},pauseBackgroundMusic:function(){this._bgmList[this._playingBgm]&&this._bgmList[this._playingBgm].pause()},resumeBackgroundMusic:function(){this._bgmList[this._playingBgm]&&this._bgmList[this._playingBgm].play()},rewindBackgroundMusic:function(){this._bgmList[this._playingBgm]&&(this._bgmList[this._playingBgm].currentTime=0,this._bgmList[this._playingBgm].play())},willPlayBackgroundMusic:function(){return!1},isBackgroundMusicPlaying:function(){return cc.sharedEngine._isBgmPlaying},getBackgroundMusicVolume:function(){return this._bgmList[this._playingBgm]?this._bgmList[this._playingBgm].volume:0},setBackgroundMusicVolume:function(e){this._bgmList[this._playingBgm]&&(e>1?this._bgmList[this._playingBgm].volume=1:e<0?this._bgmList[this._playingBgm].volume=0:this._bgmList[this._playingBgm].volume=e)},getEffectsVolume:function(){return this._effectsVolume},setEffectsVolume:function(e){e>1?this._effectsVolume=1:e<0?this._effectsVolume=0:this._effectsVolume=e;if(this._audioList)for(var t in this._audioList)this._audioList[t].volume=this._effectsVolume},playEffect:function(e,t){var n=this._getEffectList(e);return n&&(n.currentTime=0,n.loop=t||!1,n.play()),e},pauseEffect:function(e){this._audioList[e]&&this._audioList[e].pause()},pauseAllEffects:function(){if(this._audioList)for(var e in this._audioList)this._audioList[e].pause()},resumeEffect:function(e){this._audioList[e]&&this._audioList[e].play()},resumeAllEffects:function(){if(this._audioList)for(var e in this._audioList)this._audioList[e].play()},stopEffect:function(e){this._audioList[e]&&(this._audioList[e].pause(),this._audioList[e].currentTime=0)},stopAllEffects:function(){if(this._audioList)for(var e in this._audioList)this._audioList[e].pause(),this._audioList[e].currentTime=0},preloadEffect:function(e){if(this._sound_enable){if(this._activeAudioExt==-1)return;var t=e+"."+this._activeAudioExt,n=new Audio(t);n.preload="auto",n.addEventListener("canplaythrough",function(e){this.removeEventListener("canplaythrough",arguments.callee,!1)},!1),n.addEventListener("error",function(e){cc.Loader.shareLoader().onResLoadingErr()},!1),n.load(),this._audioList[e]=n}cc.Loader.shareLoader().onResLoaded()},unloadEffect:function(e){this._audioList.hasOwnProperty(e)&&delete this._audioList[e]},_getEffectList:function(e){return this._audioList!=null?this._audioList[e]:null},end:function(){this.stopBackgroundMusic(),this.stopAllEffects()}}),cc.AudioManager.sharedEngine=function(){return cc.sharedEngine||(cc.sharedEngine=new cc.AudioManager),cc.sharedEngine},define("cocos2d",function(e){return function(){return e.cc}}(this)),define("actors/Darwin",["cocos2d"],function(e){var t=-360,n=1e3,r=1,i=58,s=i*i,o=6,u=e.Sprite.extend({ctor:function(){var t=e.SpriteFrameCache.sharedSpriteFrameCache();this.walkAnimation=e.Animation.create([t.spriteFrameByName("walk0.png"),t.spriteFrameByName("walk1.png"),t.spriteFrameByName("walk2.png"),t.spriteFrameByName("walk3.png"),t.spriteFrameByName("walk4.png"),t.spriteFrameByName("walk5.png"),t.spriteFrameByName("walk6.png"),t.spriteFrameByName("walk7.png")],.15),this.idleAnimation=e.Animation.create([t.spriteFrameByName("stay0.png"),t.spriteFrameByName("stay1.png")],.15),this.jumpAnimation=e.Animation.create([t.spriteFrameByName("jump0.png"),t.spriteFrameByName("jump1.png"),t.spriteFrameByName("jump2.png"),t.spriteFrameByName("jump3.png"),t.spriteFrameByName("jump4.png"),t.spriteFrameByName("jump5.png"),t.spriteFrameByName("jump6.png")],.2),this.attackAnimation=e.Animation.create([t.spriteFrameByName("attack0.png"),t.spriteFrameByName("attack1.png"),t.spriteFrameByName("attack2.png"),t.spriteFrameByName("attack3.png"),t.spriteFrameByName("attack4.png")],.1),this.facingRight=!0,this.initWithSpriteFrame(t.spriteFrameByName("stay0.png")),this.velocity=e.ccp(0,0),this.xAccel=0,this.onGround=!1,this.attacking=!1,this.lives=o,this.regenerating=!1,this.setAnchorPoint(e.ccp(.5,0)),this.playAnimation(this.idleAnimation)},moveAlongX:function(t){var n=this.xAccel*t;this.velocity.x=(this.velocity.x+n)*.9;var r=this.velocity.x*t;this.setPosition(e.ccp(this.getPosition().x+r,this.getPosition().y))},moveAlongY:function(n){var r=t*n;this.velocity.y+=r;var i=this.velocity.y*n;this.setPosition(e.ccp(this.getPosition().x,this.getPosition().y+i))},collisionBox:function(){var t=this.getPosition(),n=this.getContentSize();return e.RectMake(t.x-15,t.y,30,n.height)},moveRight:function(){if(this.attacking)return;this.facingRight=!0,this.xAccel=n,this.setFlipX(!1),this.onGround&&this.playAnimation(this.walkAnimation)},moveLeft:function(){if(this.attacking)return;this.facingRight=!1,this.xAccel=-n,this.setFlipX(!0),this.onGround&&this.playAnimation(this.walkAnimation)},playAnimation:function(t){if(!this.isAnimationPlaying(t)){this.stopAnimation();var n=e.RepeatForever.create(e.Animate.create(t,!1));n.setTag(r),this.runAction(n)}},isAnimationPlaying:function(e){var t=this.getActionByTag(r);return t&&t.getInnerAction().getAnimation()===e},stopAnimation:function(){this.stopActionByTag(r)},stop:function(){this.xAccel=0,this.onGround&&!this.attacking&&this.playAnimation(this.idleAnimation)},jump:function(){this.onGround&&(e.sharedEngine.playEffect("resources/jump"),this.velocity.y=330,this.onGround=!1,this.stopAnimation(),this.attacking||this.runAction(e.Animate.create(this.jumpAnimation,!1)))},attack:function(){if(this.attacking)return;e.sharedEngine.playEffect("resources/hit"),this.attacking=!0,this.runAction(e.Sequence.create(e.Animate.create(this.attackAnimation),e.CallFunc.create(this,function(){this.attacking=!1})))},hitIfPossible:function(e){this.isHitPossible(e)&&e.hit()},isHitPossible:function(e){if(!this.yAligned(e))return!1;if(this.facingRight&&this.getPosition().x<e.getPosition().x)return this.distanceRightSqr(e)<s;if(!this.facingRight&&this.getPosition().x>e.getPosition().x)return this.distanceLeftSqr(e)<s},yAligned:function(t){var n=this.collisionBox(),r=t.collisionBox(),i=e.Rect.CCRectGetMinY(n),s=e.Rect.CCRectGetMaxY(n),o=e.Rect.CCRectGetMinY(r),u=e.Rect.CCRectGetMaxY(r);return o>i&&o<s||u>i&&u<s},distanceLeftSqr:function(t){var n=this.getPosition().x-e.Rect.CCRectGetMinX(t.collisionBox());return n*n},distanceRightSqr:function(t){var n=this.getPosition().x-e.Rect.CCRectGetMaxX(t.collisionBox());return n*n},hit:function(){e.sharedEngine.playEffect("resources/damage"),this.regenerating=!0,this.lives--,this.runAction(e.Sequence.create(e.Blink.create(2,20),e.CallFunc.create(this,function(){this.regenerating=!1})))}});return u.MAX_LIVES=o,u.create=function(){return new u},u}),define("actors/Enemy",["cocos2d"],function(e){var t=e.Sprite.extend({loadMapObject:function(t){this.dieAnimation=this.createDieAnimation(),this.createIdleAnimation(),this.setAnchorPoint(e.ccp(.5,0)),this.setPosition(e.ccp(t.x+t.width,t.y)),this.dead=!1,this.beginMoving(t);var n=this.createIdleAnimation();this.runAction(e.RepeatForever.create(e.Animate.create(n,!1)))},createDieAnimation:function(){throw new Error("Subclass should override this method")},createIdleAnimation:function(){throw new Error("Subclass should override this method")},beginMoving:function(e){throw new Error("Subclass should override this method")},collisionBox:function(){return this.boundingBox()},hit:function(){if(this.dead)return;this.dead=!0,this.stopAllActions(),this.runAction(e.Sequence.create(e.Animate.create(this.dieAnimation,!1),e.Blink.create(1,3),e.CallFunc.create(this,function(){this.removeFromParentAndCleanup(!0)})))}});return t}),define("actors/Snake",["cocos2d","actors/Enemy"],function(e,t){var n=125,r=t.extend({initWithMapObject:function(t){var n=e.SpriteFrameCache.sharedSpriteFrameCache();return this.initWithSpriteFrame(n.spriteFrameByName("snake_stay0.png")),this.loadMapObject(t),!0},createIdleAnimation:function(){var t=e.SpriteFrameCache.sharedSpriteFrameCache();return e.Animation.create([t.spriteFrameByName("snake_stay0.png"),t.spriteFrameByName("snake_stay1.png")],.3)},createDieAnimation:function(){var t=e.SpriteFrameCache.sharedSpriteFrameCache();return e.Animation.create([t.spriteFrameByName("snake_die0.png"),t.spriteFrameByName("snake_die1.png"),t.spriteFrameByName("snake_die2.png")],.1)},beginMoving:function(t){var r=t.width/n,i=e.Sequence.create(e.MoveBy.create(r,e.ccp(-t.width,0)),e.FlipX.create(!0),e.MoveBy.create(r,e.ccp(t.width,0)),e.FlipX.create(!1));this.runAction(e.RepeatForever.create(i))},collisionBox:function(){return e.RectMake(this.getPosition().x-20,this.getPosition().y,40,36)}});return r.create=function(e){var t=new r;if(t&&t.initWithMapObject(e))return t;throw new Error("Unable to initialize object")},r}),define("actors/Bat",["cocos2d","actors/Enemy"],function(e,t){var n=150,r=t.extend({initWithMapObject:function(t){var n=e.SpriteFrameCache.sharedSpriteFrameCache();return this.initWithSpriteFrame(n.spriteFrameByName("bat_stay0.png")),this.loadMapObject(t),!0},createIdleAnimation:function(){var t=e.SpriteFrameCache.sharedSpriteFrameCache();return e.Animation.create([t.spriteFrameByName("bat_stay0.png"),t.spriteFrameByName("bat_stay1.png")],.3)},createDieAnimation:function(){var t=e.SpriteFrameCache.sharedSpriteFrameCache();return e.Animation.create([t.spriteFrameByName("bat_die0.png"),t.spriteFrameByName("bat_die1.png"),t.spriteFrameByName("bat_die2.png")],.1)},beginMoving:function(e){e.width>e.height?this.moveHorizontaly(e):this.moveVerticaly(e)},moveHorizontaly:function(t){var r=t.width/n,i=e.Sequence.create(e.MoveBy.create(r,e.ccp(-t.width,0)),e.MoveBy.create(r,e.ccp(t.width,0)));this.runAction(e.RepeatForever.create(i))},moveVerticaly:function(t){var r=t.height/n,i=e.Sequence.create(e.MoveBy.create(r,e.ccp(0,t.height)),e.MoveBy.create(r,e.ccp(0,-t.height)));this.runAction(e.RepeatForever.create(i))}});return r.create=function(e){var t=new r;if(t&&t.initWithMapObject(e))return t;throw new Error("Unable to initialize object")},r}),define("actors/Spider",["cocos2d","actors/Enemy"],function(e,t){var n=80,r=100,i=t.extend({initWithMapObject:function(t){var n=e.SpriteFrameCache.sharedSpriteFrameCache();return this.initWithSpriteFrame(n.spriteFrameByName("spider_stay0.png")),this.loadMapObject(t),!0},createIdleAnimation:function(){var t=e.SpriteFrameCache.sharedSpriteFrameCache();return e.Animation.create([t.spriteFrameByName("spider_stay0.png"),t.spriteFrameByName("spider_stay1.png")],.3)},createDieAnimation:function(){var t=e.SpriteFrameCache.sharedSpriteFrameCache();return e.Animation.create([t.spriteFrameByName("spider_die0.png"),t.spriteFrameByName("spider_die1.png"),t.spriteFrameByName("spider_die2.png")],.1)},beginMoving:function(t){var i=t.width/n,s=Math.floor(t.width/r),o=e.JumpBy.create(i,e.ccp(-t.width,0),t.y+t.height,s),u=e.Sequence.create(o,o.reverse());this.runAction(e.RepeatForever.create(u))}});return i.create=function(e){var t=new i;if(t&&t.initWithMapObject(e))return t;throw new Error("Unable to initialize object")},i}),define("actors/enemies",["actors/Snake","actors/Bat","actors/Spider"],function(e,t,n){return{Snake:e,Bat:t,Spider:n}}),define("actors/Skull",["cocos2d"],function(e){var t=e.Sprite.extend({initWithMapObject:function(t){return this.name=t.name,this.initWithFile("resources/"+t.name+".png"),this.setPosition(e.ccp(t.x,t.y)),this.collected=!1,!0},collisionBox:function(){return this.boundingBox()},collect:function(t){if(this.collected)return;e.sharedEngine.playEffect("resources/pick"),this.collected=!0,t.skulls.push(this.name);var n=e.Director.sharedDirector().getWinSize();this.runAction(e.Sequence.create(e.MoveTo.create(.5,e.ccp(n.width+this.getContentSize().width/2,n.height+this.getContentSize().height/2)),e.CallFunc.create(this,function(){this.removeFromParentAndCleanup(!0)})))}});return t.create=function(e){var n=new t;if(n&&n.initWithMapObject(e))return n;throw new Error("Unable to initialize skull")},t}),define("layers/GUILayer",["cocos2d","actors/Darwin"],function(e,t){var n=e.Layer.extend({init:function(){var t=e.Director.sharedDirector().getWinSize();this.lives=e.ProgressTimer.create("resources/hearts.png"),this.lives.setType(e.CCPROGRESS_TIMER_TYPE_HORIZONTATAL_BAR_LR),this.lives.setAnchorPoint(e.ccp(0,1)),this.lives.setPercentage(100),this.lives.setPosition(e.ccp(5,t.height-5)),this.addChild(this.lives);var n=e.Sprite.create("resources/skull5.png");return n.setAnchorPoint(e.ccp(1,1)),n.setPosition(e.ccp(t.width-60,t.height-5)),this.addChild(n),this.skullCount=e.LabelTTF.create("0/6","Press Start 2P",15),this.skullCount.setAnchorPoint(e.ccp(0,.5)),this.skullCount.setPosition(e.ccp(t.width-55,n.getPosition().y-n.getContentSize().height/2)),this.addChild(this.skullCount),!0},setLives:function(e){this.lives.setPercentage(e/t.MAX_LIVES*100)},setSkulls:function(e){this.skullCount.setString(e+"/6")}});return n.create=function(){var e=new n;if(e&&e.init())return e;throw new Error("Unable to initialize node")},n}),define("scenes/GameScene",["cocos2d","require","actors/Darwin","actors/enemies","actors/Skull","layers/GUILayer"],function(e,t,n,r,i,s){var o={SKY:e.ccc4(188,231,241,255),CAVE:e.ccc4(0,0,0,255)},u=6,a=e.Layer.extend({init:function(t){return this.gui=t,this.background=e.LayerColor.create(o.SKY),this.addChild(this.background),this.player=new n,this.skulls=[],this.changeMapAndPlacePlayer("resources/level0.tmx",function(t,n){var r=t.objectGroupNamed("objects"),i=r.objectNamed("Spawn");n.setPosition(e.ccp(i.x+n.getContentSize().width/2,i.y))}),this.keys={},this.setIsKeypadEnabled(!0),this.scheduleUpdate(),!0},keyDown:function(e){this.keys[e]=!0},keyUp:function(e){this.keys[e]=!1},onEnter:function(){this._super(),e.sharedEngine.playBackgroundMusic("resources/bgm",!0)},onExit:function(){this._super(),e.sharedEngine.stopBackgroundMusic()},update:function(t){this.keys[e.KEY.right]?this.player.moveRight():this.keys[e.KEY.left]?this.player.moveLeft():this.player.stop(),(this.keys[e.KEY.z]||this.keys[e.KEY.w])&&this.player.jump(),this.keys[e.KEY.x]&&this.player.attack(),this.player.update(t),this.movePlayer(t),this.moveCamera(),this.checkEnemiesHit(),this.checkPlayerHit(),this.checkItemsCollisions(),this.updateGUI(),this.checkPortals()},movePlayer:function(t){var n=this;this.player.moveAlongX(1/60);var r=this.getLeftTiles(this.player.collisionBox());this.collide(r,function(){n.player.setPosition(e.ccp(r.baseline+n.player.collisionBox().size.width*.5,n.player.getPosition().y)),n.player.velocity.x=0});var i=this.getRightTiles(this.player.collisionBox());this.collide(i,function(){n.player.setPosition(e.ccp(i.baseline-n.player.collisionBox().size.width*.5,n.player.getPosition().y)),n.player.velocity.x=0}),this.player.moveAlongY(1/60);var s=this.getBottomTiles(this.player.collisionBox());this.collide(s,function(){n.player.setPosition(e.ccp(n.player.getPosition().x,s.baseline)),n.player.onGround=!0,n.player.velocity.y=0});var o=this.getTopTiles(this.player.collisionBox());this.collide(o,function(){n.player.setPosition(e.ccp(n.player.getPosition().x,o.baseline-n.player.collisionBox().size.height)),n.player.velocity.y=0})},collide:function(e,t){var n=this;e.tiles.forEach(function(e){if(e.x>=0&&e.x<n.walls.getLayerSize().width&&e.y>=0&&e.y<n.walls.getLayerSize().height){var r=n.walls.tileGIDAt(e);r&&t()}})},getBottomTiles:function(t){var n=Math.floor(e.Rect.CCRectGetMinX(t)/this.map.getTileSize().width),r=e.Rect.CCRectGetMaxX(t)/this.map.getTileSize().width,i=Math.floor(r);i===r&&i--;var s=Math.floor((this.mapHeight()-e.Rect.CCRectGetMinY(t))/this.map.getTileSize().height),o={baseline:this.mapHeight()-s*this.map.getTileSize().height,tiles:[]};for(var u=n;u<=i;u++)o.tiles.push(e.ccp(u,s));return o},getTopTiles:function(t){var n=Math.floor(e.Rect.CCRectGetMinX(t)/this.map.getTileSize().width),r=e.Rect.CCRectGetMaxX(t)/this.map.getTileSize().width,i=Math.floor(r);i===r&&i--;var s=Math.floor((this.mapHeight()-e.Rect.CCRectGetMaxY(t))/this.map.getTileSize().height),o={baseline:this.mapHeight()-(s+1)*this.map.getTileSize().height,tiles:[]};for(var u=n;u<=i;u++)o.tiles.push(e.ccp(u,s));return o},getLeftTiles:function(t){var n=(this.mapHeight()-e.Rect.CCRectGetMinY(t))/this.map.getTileSize().height,r=Math.floor(n);r===n&&r--;var i=Math.floor((this.mapHeight()-e.Rect.CCRectGetMaxY(t))/this.map.getTileSize().height),s=Math.floor(e.Rect.CCRectGetMinX(t)/this.map.getTileSize().width),o={baseline:(s+1)*this.map.getTileSize().width,tiles:[]};for(var u=i;u<=r;u++)o.tiles.push(e.ccp(s,u));return o},getRightTiles:function(t){var n=(this.mapHeight()-e.Rect.CCRectGetMinY(t))/this.map.getTileSize().height,r=Math.floor(n);r===n&&r--;var i=Math.floor((this.mapHeight()-e.Rect.CCRectGetMaxY(t))/this.map.getTileSize().height),s=Math.floor(e.Rect.CCRectGetMaxX(t)/this.map.getTileSize().width),o={baseline:s*this.map.getTileSize().width,tiles:[]};for(var u=i;u<=r;u++)o.tiles.push(e.ccp(s,u));return o},mapHeight:function(){return this.map.getMapSize().height*this.map.getTileSize().height},mapWidth:function(){return this.map.getMapSize().width*this.map.getTileSize().width},moveCamera:function(){var t=e.Director.sharedDirector().getWinSize(),n=this.player.getPosition(),r=Math.max(t.width/2,n.x),i=Math.max(t.height/2,n.y);r=Math.min(r,this.mapWidth()-t.width/2),i=Math.min(i,this.mapHeight()-t.height/2);var s=e.ccp(r,i);s=e.ccpSub(e.ccp(t.width/2,t.height/2),s),this.map.setPosition(s)},checkEnemiesHit:function(){if(this.player.attacking){var e=this;this.enemies.forEach(function(t){e.player.hitIfPossible(t)})}},checkPlayerHit:function(){if(this.player.regenerating)return;var n=this;this.enemies.forEach(function(t){t.dead||e.Rect.CCRectIntersectsRect(n.player.collisionBox(),t.collisionBox())&&n.player.hit()});if(this.player.lives<=0){var r=t("scenes/IdleScene");e.Director.sharedDirector().replaceScene(r.create("Click to restart"))}},checkItemsCollisions:function(){var n=this;this.items.forEach(function(t){e.Rect.CCRectIntersectsRect(n.player.collisionBox(),t.collisionBox())&&t.collect(n)});if(this.skulls.length===u){var r=t("scenes/IdleScene");e.Director.sharedDirector().replaceScene(r.create("Click to play again"))}},updateGUI:function(){this.gui.setLives(this.player.lives),this.gui.setSkulls(this.skulls.length)},checkPortals:function(){var t;this.player.getPosition().x>this.mapWidth()?(t=this.map.propertyNamed("rightPortal"),this.changeMapAndPlacePlayer(t,function(t,n){n.setPosition(e.ccp(n.collisionBox().size.width*.5+10,n.getPosition().y))})):this.player.getPosition().x<0?(t=this.map.propertyNamed("leftPortal"),this.changeMapAndPlacePlayer(t,function(t,n){var r=t.getMapSize().width*t.getTileSize().width;n.setPosition(e.ccp(r-n.collisionBox().size.width*.5-10,n.getPosition().y+.1))})):this.player.getPosition().y<0?(t=this.map.propertyNamed("bottomPortal"),this.changeMapAndPlacePlayer(t,function(t,n){var r=t.getMapSize().height*t.getTileSize().height;n.setPosition(e.ccp(n.getPosition().x,r-10))})):this.player.getPosition().y>this.mapHeight()&&(t=this.map.propertyNamed("topPortal"),this.changeMapAndPlacePlayer(t,function(t,n){n.setPosition(e.ccp(n.getPosition().x,10))}))},changeMapAndPlacePlayer:function(t,n){if(t){this.player.getParent()&&this.player.removeFromParentAndCleanup(!1),this.map&&this.map.removeFromParentAndCleanup(!0),this.map=e.TMXTiledMap.create(t);var s=o[this.map.propertyNamed("background")];s||(s=o.CAVE),this.background.setColor(s),this.enemies=[],this.items=[];var u=this.map.objectGroupNamed("objects"),a=this;u.getObjects().forEach(function(e){console.log(e);var t,n=r[e.type];typeof n!="undefined"?(t=n.create(e),a.enemies.push(t)):e.name.indexOf("skull")===0&&a.skulls.indexOf(e.name)===-1&&(t=i.create(e),a.items.push(t)),t&&a.map.addChild(t,e.z)}),this.walls=this.map.layerNamed("walls"),this.addChild(this.map),n(this.map,this.player);var f=1;this.map.layerNamed("cave_background")&&(f=2),this.map.addChild(this.player,f)}}});return a.create=function(e){var t=new a;if(t&&t.init(e))return t;throw new Error("Unable to initialize scene")},a.scene=function(){var t=e.Scene.create(),n=s.create(),r=this.create(n);return t.addChild(r),t.addChild(n),t},a}),define("scenes/IdleScene",["cocos2d","scenes/GameScene"],function(e,t){var n=e.Layer.extend({initWithTextBackground:function(t,n){var r=e.Director.sharedDirector().getWinSize(),i=e.LabelTTF.create(t,"Press Start 2P",15);return i.setPosition(e.ccp(r.width/2,r.height/2)),i.runAction(e.RepeatForever.create(e.Blink.create(1,1))),this.addChild(i),this.setIsTouchEnabled(!0),!0},ccTouchesEnded:function(){e.Director.sharedDirector().replaceScene(t.scene())}});return n.node=function(e,t){var r=new n;if(r&&r.initWithTextBackground(e,t))return r;throw new Error("Unable to initialize node")},n.create=function(t,n){var r=e.Scene.create();return r.addChild(this.node(t,n)),r},n}),require(["cocos2d","scenes/IdleScene"],function(e,t){e.AppDelegate=e.Application.extend({ctor:function(){this._super()},initInstance:function(){return!0},applicationDidFinishLaunching:function(){e.SpriteFrameCache.sharedSpriteFrameCache().addSpriteFramesWithFile("resources/Darwin.plist"),e.SpriteFrameCache.sharedSpriteFrameCache().addSpriteFramesWithFile("resources/snake.plist"),e.SpriteFrameCache.sharedSpriteFrameCache().addSpriteFramesWithFile("resources/bat.plist"),e.SpriteFrameCache.sharedSpriteFrameCache().addSpriteFramesWithFile("resources/spider.plist");var n=e.Director.sharedDirector();n.setDisplayFPS(!0),n.setAnimationInterval(1/60);var r=t.create("Click to start");return n.runWithScene(r),!0},applicationDidEnterBackground:function(){e.Director.sharedDirector().pause()},applicationWillEnterForeground:function(){e.Director.sharedDirector().resume()}})}),define("AppDelegate",[],function(){}),require.config({paths:{cocos2d:"../lib/Cocos2d-html5-canvasmenu",domReady:"../lib/domReady"},shim:{cocos2d:{exports:"cc"}}}),require(["domReady","cocos2d","AppDelegate"],function(e,t){function n(e){e.addEventListener("blur",function(){console.log("Focus lost")},!1),e.addEventListener("focus",function(){console.log("Focus obtained")},!1)}e(function(){var e=document.getElementById("gameCanvas");n(e),t.setup("gameCanvas"),t.AudioManager.sharedEngine().init("mp3,ogg,wav");var r=t.Loader.shareLoader();r.onloading=function(){t.LoaderScene.shareLoaderScene().draw()},r.onload=function(){e.focus(),t.AppController.shareAppController().didFinishLaunchingWithOptions()},r.preload([{type:"image",src:"resources/beach_bg.png"},{type:"image",src:"resources/beach_fg.png"},{type:"image",src:"resources/jungle_bg.png"},{type:"image",src:"resources/jungle_fg.png"},{type:"image",src:"resources/tiles_cave.png"},{type:"image",src:"resources/tiles_cave_bg.png"},{type:"image",src:"resources/tiles2.png"},{type:"image",src:"resources/cave_background.png"},{type:"image",src:"resources/cave_beach_bg.png"},{type:"image",src:"resources/skull0.png"},{type:"image",src:"resources/skull2.png"},{type:"image",src:"resources/skull3.png"},{type:"image",src:"resources/skull4.png"},{type:"image",src:"resources/skull5.png"},{type:"image",src:"resources/hearts.png"},{type:"plist",src:"resources/Darwin.plist"},{type:"image",src:"resources/Darwin.png"},{type:"plist",src:"resources/snake.plist"},{type:"image",src:"resources/snake.png"},{type:"plist",src:"resources/bat.plist"},{type:"image",src:"resources/bat.png"},{type:"plist",src:"resources/spider.plist"},{type:"image",src:"resources/spider.png"},{type:"tmx",src:"resources/level0.tmx"},{type:"tmx",src:"resources/level1.tmx"},{type:"tmx",src:"resources/cave00.tmx"},{type:"tmx",src:"resources/cave01.tmx"},{type:"tmx",src:"resources/cave02.tmx"},{type:"tmx",src:"resources/cave03.tmx"},{type:"tmx",src:"resources/cave04.tmx"},{type:"tmx",src:"resources/cave05.tmx"},{type:"tmx",src:"resources/cave06.tmx"},{type:"tmx",src:"resources/cave07.tmx"},{type:"tmx",src:"resources/cave08.tmx"},{type:"tmx",src:"resources/cave09.tmx"},{type:"tmx",src:"resources/cave10.tmx"},{type:"tmx",src:"resources/cave11.tmx"},{type:"tmx",src:"resources/cave12.tmx"},{type:"tmx",src:"resources/cave13.tmx"},{type:"tmx",src:"resources/cave14.tmx"},{type:"tmx",src:"resources/cave15.tmx"},{type:"tmx",src:"resources/cave16.tmx"},{type:"tmx",src:"resources/cave17.tmx"},{type:"bgm",src:"resources/bgm"},{type:"effect",src:"resources/hit"},{type:"effect",src:"resources/damage"},{type:"effect",src:"resources/jump"},{type:"effect",src:"resources/pick"}])})}),define("main",[],function(){})